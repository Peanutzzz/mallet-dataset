lock aspect around within lock annotation lock public object around lock proceeding join point point lock lock throw throwable object lock obj null if lock null lock point get target get class get declare annotation lock class string lock key lock key if locker null throw new lock exception distribute lock be null if str util be empty lock key throw new lock exception lock key be null if lock key contain method signature method signature method signature point get signature object arg point get arg lock key get val by sp e l lock key method signature arg try if lock wait time lock obj locker try lock lock key lock wait time lock lease time lock unit lock be fair else lock obj locker lock lock key lock lease time lock unit lock be fair if lock obj null return point proceed else throw new lock exception finally locker unlock lock obj 
oauth token aspect around execution org springframework security oauth2 provider endpoint token endpoint post access token public object handle controller method proceeding join point join point throw throwable try object arg join point get arg principal principal principal arg if principal instanceof authentication throw new insufficient authentication exception there be no client authentication try add a appropriate authentication filter string client id get client id principal map string string parameter map string string arg string grant type parameter get o auth2 util grant type id tenant context holder set tenant client id object proceed join point proceed if security constant authorization code equal grant type enable o auth2 sso sso demo ss sso enable o auth2 sso token return proceed else response entity o auth2 access token response entity response entity o auth2 access token proceed o auth2 access token body response entity get body return response entity status http status ok body result succeed body catch exception e log error e return response entity status http status bad request body result fail e get message finally tenant context holder clear 
oauth authorize aspect around execution org springframework security oauth2 provider endpoint authorization endpoint authorize public object do around method proceeding join point join point throw throwable object arg join point get arg map string string parameter map string string arg principal principal principal arg if principal instanceof tenant username password authentication token tenant username password authentication token tenant token tenant username password authentication token principal string client id tenant token get client id string request client id parameter get o auth2 util client id if request client id equal client id try tenant context holder set tenant request client id login app user user user service find by username tenant token get name tenant token new tenant username password authentication token user tenant token get credentials user get authority request client id arg tenant token finally tenant context holder clear return join point proceed arg 
repository aspect around any repository method public object invoke with cat transaction proceed join point join point throw throwable string name join point get signature get declare type get simple name join point get signature get name transaction cat transaction tracer new transaction sql name try object result join point proceed cat transaction set status transaction success return result catch throwable ex cat transaction set status ex throw ex finally cat transaction complete 
capacity management aspect around sync update config all public object around sync update config all proceeding join point pjp http servlet request request http servlet response response string datum id string group string content string app name string src user string tenant string tag throw throwable if property util be manage capacity return pjp proceed logger info capacity management around sync update config all string beta ip request get header beta ip if string util be blank beta ip if string util be blank tag do capacity management limination check for writting or update config info table if persist service find config info datum id group tenant null write operation return do4 insert pjp request response group tenant content update operation return do4 update pjp request response datum id group tenant content return pjp proceed 
capacity management aspect around delete config public object around delete config proceeding join point pjp http servlet request request http servlet response response string datum id string group string tenant throw throwable if property util be manage capacity return pjp proceed logger info capacity management around delete config config info config info persist service find config info datum id group tenant if config info null return pjp proceed return do4 delete pjp response group tenant config info 
request log aspect around client interface publish single config public object interface publish single proceeding join point pjp http servlet request request http servlet response response string datum id string group string tenant string content throw throwable final string md5 content null null m d5 util md5 hex content constant encode metric monitor get publish monitor increment and get return log client request publish pjp request response datum id group tenant md5 
request log aspect around client interface remove all config public object interface remove all proceeding join point pjp http servlet request request http servlet response response string datum id string group string tenant throw throwable return log client request remove pjp request response datum id group tenant null 
request log aspect around client interface get config public object interface get config proceeding join point pjp http servlet request request http servlet response response string datum id string group string tenant throw throwable final string group key group key2 get key datum id group tenant final string md5 config cache service get content md5 group key metric monitor get config monitor increment and get return log client request get pjp request response datum id group tenant md5 
sentinel resource aspect around sentinel resource annotation pointcut public object invoke resource with sentinel proceeding join point pjp throw throwable method origin method resolve method pjp sentinel resource annotation origin method get annotation sentinel resource class if annotation null should not go through here throw new illegal state exception wrong state for sentinel resource annotation string resource name get resource name annotation value origin method entry type entry type annotation entry type int resource type annotation resource type entry entry null try entry sph u entry resource name resource type entry type pjp get arg object result pjp proceed return result catch block exception ex return handle block exception pjp annotation ex catch throwable ex class extend throwable exception to ignore annotation exception to ignore the ignore list will be check first if exception to ignore length exception belong to ex exception to ignore throw ex if exception belong to ex annotation exception to trace trace exception ex return handle fallback pjp annotation ex no fallback function can handle the exception so throw it out throw ex finally if entry null entry exit pjp get arg 
