abstract spring mvc test web app configuration run with spring j unit4 class runner class context configuration location classpath spring xml public class abstract spring mvc test autowire private web application context application context protect mock mvc mock mvc before public void setup this mock mvc mock mvc builder web app context setup this application context build 
xxl job group dao test run with spring j unit4 class runner class context configuration location classpath spring applicationcontext xml public class xxl job group dao test resource private xxl job group dao xxl job group dao test public void test list xxl job group list xxl job group dao find all list xxl job group list2 xxl job group dao find by address type xxl job group group new xxl job group group set app name set app name group set title set title group set order group set address type group set address list set address list int ret xxl job group dao save group xxl job group group2 xxl job group dao load group get id group2 set app name set app name2 group2 set title set title2 group2 set order group2 set address type group2 set address list set address list2 int ret2 xxl job group dao update group2 int ret3 xxl job group dao remove group get id 
xxl job info dao test run with spring j unit4 class runner class context configuration location classpath spring applicationcontext xml public class xxl job info dao test resource private xxl job info dao xxl job info dao test public void page list list xxl job info list xxl job info dao page list null null int list count xxl job info dao page list count null null system out println list system out println list count list xxl job info list2 xxl job info dao get job by group test public void save load xxl job info info new xxl job info info set job group info set job cron job cron info set job desc desc info set author set author info set alarm email set alarm email info set executor route strategy set executor route strategy info set executor handler set executor handler info set executor param set executor param info set executor block strategy set executor block strategy info set glue type set glue type info set glue source set glue source info set glue remark set glue remark info set child job id int count xxl job info dao save info xxl job info info2 xxl job info dao load by id info get id info2 set job cron job cron2 info2 set job desc desc2 info2 set author set author2 info2 set alarm email set alarm email2 info2 set executor route strategy set executor route strategy2 info2 set executor handler set executor handler2 info2 set executor param set executor param2 info2 set executor block strategy set executor block strategy2 info2 set glue type set glue type2 info2 set glue source set glue source2 info2 set glue remark set glue remark2 info2 set glue updatetime new date info2 set child job id int item2 xxl job info dao update info2 xxl job info dao delete info2 get id list xxl job info list2 xxl job info dao get job by group int ret3 xxl job info dao find all count 
xxl job log dao test run with spring j unit4 class runner class context configuration location classpath spring applicationcontext xml public class xxl job log dao test resource private xxl job log dao xxl job log dao test public void test list xxl job log list xxl job log dao page list null null int list count xxl job log dao page list count null null xxl job log log new xxl job log log set job group log set job id int ret1 xxl job log dao save log xxl job log dto xxl job log dao load log get id log set trigger time new date log set trigger code log set trigger msg log set executor address log set executor handler log set executor param ret1 xxl job log dao update trigger info log dto xxl job log dao load log get id log set handle time new date log set handle code log set handle msg ret1 xxl job log dao update handle info log dto xxl job log dao load log get id list map string object list2 xxl job log dao trigger count by day date util add day new date new date int ret4 xxl job log dao clear log new date int ret2 xxl job log dao delete log get job id int ret3 xxl job log dao trigger count by handle code 
xxl job log glue dao test run with spring j unit4 class runner class context configuration location classpath spring applicationcontext xml public class xxl job log glue dao test resource private xxl job log glue dao xxl job log glue dao test public void test xxl job log glue log glue new xxl job log glue log glue set job id log glue set glue type log glue set glue source log glue set glue remark int ret xxl job log glue dao save log glue list xxl job log glue list xxl job log glue dao find by job id int ret2 xxl job log glue dao remove old int ret3 xxl job log glue dao delete by job id 
xxl job registry dao test run with spring j unit4 class runner class context configuration location classpath spring applicationcontext xml public class xxl job registry dao test resource private xxl job registry dao xxl job registry dao test public void test int ret xxl job registry dao registry update g1 k1 v1 if ret ret xxl job registry dao registry save g1 k1 v1 list xxl job registry list xxl job registry dao find all int ret2 xxl job registry dao remove dead 
i18n util test run with spring j unit4 class runner class context configuration location classpath spring applicationcontext xml public class i18n util test test public void test system out println i18n util get string admin name system out println i18n util get mult string admin name admin name full system out println i18n util get mult string 
conditional on profile test run with spring j unit4 class runner class context configuration class conditional on profile test test configuration class active profile some profile another profile public class conditional on profile test static final string some profile some profile static final string another profile another profile static final string yet another profile yet another profile static boolean some configuration enable false static boolean another configuration enable false static boolean yet another configuration enable false static boolean combine configuration enable false static boolean another combine configuration enable false test public void test throw exception assert true some configuration enable assert false another configuration enable assert true yet another configuration enable assert true combine configuration enable assert false another combine configuration enable configuration static class test configuration configuration conditional on profile some profile static class some configuration some configuration enable true configuration conditional on miss profile another profile static class another configuration another configuration enable true configuration conditional on miss profile yet another profile static class yet another configuration yet another configuration enable true configuration conditional on profile some profile another profile conditional on miss profile yet another profile static class combine configuration combine configuration enable true configuration conditional on profile some profile conditional on miss profile yet another profile another profile static class another combine configuration another combine configuration enable true 
health controller unit test run with spring j unit4 class runner class context configuration class mock servlet context class web app configuration public class health controller unit test inject mock health controller health controller mock datum source service datum source service private mock mvc mockmvc before public void set up throw exception mockmvc mock mvc builder standalone setup health controller build test public void test get health throw exception mockito when datum source service get health then return up mock http servlet request builder builder mock mvc request builder get constant health controller path string actual value mockmvc perform builder and return get response get content as string assert assert equal up actual value 
health controller test run with spring j unit4 class runner class context configuration class mock servlet context class web app configuration public class health controller test inject mock private health controller health controller mock private persist service persist service mock private operator controller api command private mock mvc mockmvc before public void set up mockmvc mock mvc builder standalone setup health controller build test public void test liveness throw exception string url v1 console health liveness mock http servlet request builder builder mock mvc request builder get url assert assert equal mockmvc perform builder and return get response get status test public void test readiness throw exception string url v1 console health readiness mockito when persist service config info count any string class then return mockito when api command metric any http servlet request class then return jackson util create empty json node mock http servlet request builder builder mock mvc request builder get url assert assert equal mockmvc perform builder and return get response get status config and naming be not in readiness mockito when persist service config info count any string class then throw new runtime exception health controller test test readiness mockito when api command metric any http servlet request class then throw new runtime exception health controller test test readiness builder mock mvc request builder get url mock http servlet response response mockmvc perform builder and return get response assert assert equal response get status assert assert equal config and naming be not in readiness response get content as string config be not in readiness mockito when persist service config info count any string class then throw new runtime exception health controller test test readiness mockito when api command metric any http servlet request class then return jackson util create empty json node response mockmvc perform builder and return get response assert assert equal response get status assert assert equal config be not in readiness response get content as string naming be not in readiness mockito when persist service config info count any string class then return mockito when api command metric any http servlet request class then throw new runtime exception health controller test test readiness builder mock mvc request builder get url response mockmvc perform builder and return get response assert assert equal response get status assert assert equal naming be not in readiness response get content as string 
cluster controller test run with spring j unit4 class runner class context configuration class mock servlet context class web app configuration public class cluster controller test extend base test inject mock private cluster controller cluster controller private mock mvc mockmvc before public void before super before mockmvc mock mvc builder standalone setup cluster controller build test public void test update throw exception service service new service test service name service set namespace id test namespace when service manager get service constant default namespace id test service name then return service mock http servlet request builder builder mock mvc request builder put util and common naco name context cluster param cluster name test cluster name param service name test service name param health checker type http param check port param use instance port4 check true assert assert equal ok mockmvc perform builder and return get response get content as string cluster expect cluster new cluster test cluster name service cluster actual cluster service get cluster map get test cluster name assert assert equal expect cluster actual cluster assert assert equal actual cluster get def ckport assert assert true actual cluster be use i p port4 check test public void test update no service throw exception expect exception expect cause be a nacos exception class expect exception expect message service not find test service not find mock http servlet request builder builder mock mvc request builder put util and common naco name context cluster param cluster name test cluster name param service name test service not find param health checker type http param check port param use instance port4 check true mockmvc perform builder test public void test update invalid type throw exception expect exception expect cause be a nacos exception class expect exception expect message unknown health check type type service service new service test service name service set namespace id constant default namespace id when service manager get service constant default namespace id test service name then return service mock http servlet request builder builder mock mvc request builder put util and common naco name context cluster param cluster name test cluster name param service name test service name param health checker type param check port param use instance port4 check true mockmvc perform builder 
instance controller test run with spring j unit4 class runner class context configuration class mock servlet context class web app configuration public class instance controller test extend base test inject mock private instance controller instance controller mock private raft peer set peer set private mock mvc mockmvc before public void before super before mockmvc mock mvc builder standalone setup instance controller build test public void register instance throw exception service service new service service set name test service name cluster cluster new cluster util and common default cluster name service service add cluster cluster instance instance new instance instance set ip 1.1 1.1 instance set port list instance ip list new array list ip list add instance service update i ps ip list false mockito when service manager get service constant default namespace id test service name then return service mock http servlet request builder builder mock mvc request builder put util and common naco name context instance param service name test service name param ip 1.1 1.1 param port string actual value mockmvc perform builder and return get response get content as string assert assert equal ok actual value test public void deregister instance throw exception mock http servlet request builder builder mock mvc request builder delete util and common naco name context instance param service name test service name param ip 1.1 1.1 param port param cluster name util and common default cluster name string actual value mockmvc perform builder and return get response get content as string assert assert equal ok actual value test public void get instance throw exception service service new service service set name test service name cluster cluster new cluster util and common default cluster name service service add cluster cluster instance instance new instance instance set ip 10.10 10.10 instance set port instance set weight 2.0 instance set service name test service name list instance ip list new array list ip list add instance service update i ps ip list false mockito when service manager get service constant default namespace id test service name then return service mock http servlet request builder builder mock mvc request builder get util and common naco name context instance list param service name test service name mock http servlet response response mockmvc perform builder and return get response string actual value response get content as string json node result jackson util to obj actual value assert assert equal test service name result get name as text json node host result get host assert assert not null host assert assert equal host size json node host host get assert assert not null host assert assert equal 10.10 10.10 host get ip as text assert assert equal host get port as int assert assert equal 2.0 host get weight as double 0.001 test public void get null service instance throw exception mockito when service manager get service constant default namespace id test service name then return null mock http servlet request builder builder mock mvc request builder get util and common naco name context instance list param service name test service name mock http servlet response response mockmvc perform builder and return get response string actual value response get content as string json node result jackson util to obj actual value json node host result get host assert assert equal host size 
push service test run with spring j unit4 class runner class context configuration class mock servlet context class web app configuration public class push service test extend base test inject mock private push service push service before public void before super before test public void test get client fuzzy throw exception string namespace id public string cluster default string agent naco java client v1 1.4 string client ip localhost string app naco int udp port string hello service name hello group name hello service name int hello udp port string test service name test group name test service name int test udp port push service add client namespace id hello service name cluster agent new inet socket address client ip hello udp port null namespace id app push service add client namespace id test service name cluster agent new inet socket address client ip test udp port null namespace id app list subscriber fuzzylist push service get client fuzzy hello hello public assert assert equal fuzzylist size assert assert equal fuzzylist get get service name hello group name hello service name list subscriber list push service get client fuzzy hello group name hello service name public assert assert equal list size assert assert equal list get get service name hello group name hello service name list subscriber no datum list push service get client fuzzy bad group name bad service name public assert assert equal no datum list size 
subscribe manager test spring boot test run with spring j unit4 class runner class context configuration class mock servlet context class public class subscribe manager test extend base test mock private subscribe manager subscribe manager mock private push service push service mock private server member manager member manager before public void before super before subscribe manager new subscribe manager test public void get subscriber with false string service name test string namespace id public boolean aggregation boolean false try list subscriber client new array list subscriber subscriber subscriber new subscriber 127.0 0.1 test app 127.0 0.1 namespace id service name client add subscriber mockito when push service get client mockito any string mockito any string then return client list subscriber list subscribe manager get subscriber service name namespace id aggregation assert assert not null list assert assert equal list size assert assert equal public list get get namespace id catch exception ignore test public void test get subscriber fuzzy string service name test string namespace id public boolean aggregation boolean true try list subscriber client new array list subscriber subscriber subscriber new subscriber 127.0 0.1 test app 127.0 0.1 namespace id test group name test subscriber client add subscriber mockito when push service get client fuzzy mockito any string mockito any string then return client list subscriber list subscribe manager get subscriber service name namespace id aggregation assert assert not null list assert assert equal list size assert assert equal test group name test subscriber list get get service name catch exception ignore test public void get subscriber with true string service name test string namespace id public boolean aggregation boolean true try list subscriber client new array list subscriber subscriber subscriber new subscriber 127.0 0.1 test app 127.0 0.1 namespace id service name client add subscriber list member healthy server new array list for int i i i member server new member server set ip 127.0 0.1 server set port i server set state node state up server set extend val member meta datum constant ad weight server set extend val member meta datum constant site key site server set extend val member meta datum constant weight server set extend val member meta datum constant raft port i healthy server add server mockito when member manager all member then return healthy server mockito do return when server list manager get healthy server size list subscriber list subscribe manager get subscriber service name namespace id aggregation assert assert not null list assert assert equal list size assert assert equal public list get get namespace id catch exception ignore 
sentinel annotation integration test context configuration class sentinel annotation integration test class aop test config class public class sentinel annotation integration test extend abstract j unit4 spring context test autowire private foo service foo service autowire private bar service bar service test public void test proxy successful assert that aop util be aop proxy foo service be true assert that aop util be cglib proxy foo service be true test public void test foreign block handler class throw exception assert that foo service random be not equal to foo util block flag string resource name method util resolve method name foo service class get declare method random cluster node cn cluster builder slot get cluster node resource name assert that cn be not null assert that cn pass qps be positive flow rule manager load rule collection singleton list new flow rule resource name set count assert that foo service random be equal to foo util block flag assert that cn block qps be positive test expect undeclared throwable exception class public void test block handler not find assert that foo service baz sentinel be equal to cheer sentinel string resource name api baz cluster node cn cluster builder slot get cluster node resource name assert that cn be not null assert that cn pass qps be positive flow rule manager load rule collection singleton list new flow rule resource name set count foo service baz sentinel test public void test annotation exception to ignore assert that foo service baz sentinel be equal to cheer sentinel string resource name api baz cluster node cn cluster builder slot get cluster node resource name assert that cn be not null assert that cn pass qps be positive try foo service baz fail fail should not reach here catch illegal monitor state exception ex assert that cn exception qps be zero test public void test fallback with no param throw exception assert that foo service foo with fallback be equal to hello for string resource name api foo with fallback cluster node cn cluster builder slot get cluster node resource name assert that cn be not null assert that cn pass qps be positive fallback should be ignore for this try foo service foo with fallback fail should not reach here catch illegal access exception e assert that cn exception qps be zero fallback should take effect assert that foo service foo with fallback be equal to eee assert that cn exception qps be positive assert that cn block qps be zero flow rule manager load rule collection singleton list new flow rule resource name set count fallback should not take effect for block exception as block handler be configure assert that foo service foo with fallback be equal to oops assert that cn block qps be positive test public void test default fallback with single param assert that foo service another foo be equal to hello for string resource name api another foo with default fallback cluster node cn cluster builder slot get cluster node resource name assert that cn be not null assert that cn pass qps be positive default fallback should take effect assert that foo service another foo be equal to foo util fallback default result assert that cn exception qps be positive assert that cn block qps be zero flow rule manager load rule collection singleton list new flow rule resource name set count default fallback should also take effect for block exception assert that foo service another foo be equal to foo util fallback default result assert that cn block qps be positive test public void test normal block handler and fallback throw exception assert that foo service foo be equal to hello for string resource name api foo cluster node cn cluster builder slot get cluster node resource name assert that cn be not null assert that cn pass qps be positive test for biz exception try foo service foo fail should not reach here catch exception ex should not be trace assert that cn exception qps be zero try foo service foo fail should not reach here catch exception ex assert that cn exception qps be positive test for block handler flow rule manager load rule collection singleton list new flow rule resource name set count assert that foo service foo be equal to oops assert that cn block qps be positive test public void test class level default fallback with single param assert that bar service another bar be equal to hello for string resource name api another bar with default fallback cluster node cn cluster builder slot get cluster node resource name assert that cn be not null assert that cn pass qps be positive assert that bar service do something be equal to do something string resource name1 com alibaba csp sentinel annotation aspectj integration service bar service do something int cluster node cn1 cluster builder slot get cluster node resource name1 assert that cn1 be not null assert that cn1 pass qp be positive assert that bar service another bar be equal to eee assert that cn exception qps be positive assert that cn block qps be zero assert that bar service do something be equal to global fallback do fallback assert that cn1 exception qps be positive assert that cn1 block qps be zero before public void set up throw exception flow rule manager load rule new array list flow rule cluster builder slot reset cluster node after public void tear down throw exception flow rule manager load rule new array list flow rule cluster builder slot reset cluster node 
