config controller post mapping secure action action type write parser config resource parser class public boolean publish config http servlet request request http servlet response response request param value datum id string data id request param value group string group request param value tenant require false default value string util empty string tenant request param value content string content request param value tag require false string tag request param value app name require false string app name request param value src user require false string src user request param value config tag require false string config tag request param value desc require false string desc request param value use require false string use request param value effect require false string effect request param value type require false string type request param value schema require false string schema throw naco exception final string src ip request util get remote ip request final string request ip app request util get app name request check tenant param util check tenant tenant param util check param datum id group datum id content param util check param tag map string object config advance info new hash map string object map util put if val no null config advance info config tag config tag map util put if val no null config advance info desc desc map util put if val no null config advance info use use map util put if val no null config advance info effect effect map util put if val no null config advance info type type map util put if val no null config advance info schema schema param util check param config advance info if aggr whitelist be aggr datum id datum id logger warn aggr conflict attemp to publish single datum request util get remote ip request datum id group throw new naco exception naco exception no right datum id datum id be aggr final timestamp time time util get current time string beta ip request get header beta ip config info config info new config info datum id group tenant app name content config info set type type if string util be blank beta ip if string util be blank tag persist service insert or update src ip src user config info time config advance info true config change publisher notify config change new config datum change event false datum id group tenant time get time else persist service insert or update tag config info tag src ip src user time true config change publisher notify config change new config datum change event false datum id group tenant tag time get time else beta publish persist service insert or update beta config info beta ip src ip src user time true config change publisher notify config change new config datum change event true datum id group tenant time get time config trace service log persistence event datum id group tenant request ip app time get time inet util get self ip config trace service persistence event pub content return true 
config controller get map secure action action type read parser config resource parser class public void get config http servlet request request http servlet response response request param datum id string data id request param group string group request param value tenant require false default value string util empty string tenant request param value tag require false string tag throw i o exception servlet exception naco exception check tenant param util check tenant tenant tenant process tenant tenant check param param util check param datum id group datum id content param util check param tag final string client ip request util get remote ip request inner do get config request response datum id group tenant tag client ip 
config controller get map param show all secure action action type read parser config resource parser class public config all info detail config info http servlet request request http servlet response response request param datum id string data id request param group string group request param value tenant require false default value string util empty string tenant throw naco exception check tenant param util check tenant tenant check param param util check param datum id group datum id content return persist service find config all info data id group tenant 
config controller delete mapping secure action action type write parser config resource parser class public boolean delete config http servlet request request http servlet response response request param datum id string data id request param group string group request param value tenant require false default value string util empty string tenant request param value tag require false string tag throw naco exception check tenant param util check tenant tenant param util check param datum id group datum id rm param util check param tag string client ip request util get remote ip request if string util be blank tag persist service remove config info datum id group tenant client ip null else persist service remove config info tag datum id group tenant tag client ip null final timestamp time time util get current time config trace service log persistence event datum id group tenant null time get time client ip config trace service persistence event remove null config change publisher notify config change new config datum change event false datum id group tenant tag time get time return true 
config controller delete mapping params del type id secure action action type write parser config resource parser class public rest result boolean delete config http servlet request request http servlet response response request param value id list long id string client ip request util get remote ip request final timestamp time time util get current time list config info config info list persist service remove config info by id id client ip null if collection util be empty config info list for config info config info config info list config change publisher notify config change new config datum change event false config info get datum id config info get group config info get tenant time get time config trace service log persistence event config info get datum id config info get group config info get tenant null time get time client ip config trace service persistence event remove null return result builder build success result true 
config controller get map catalog secure action action type read parser config resource parser class public rest result config advance info get config advance info request param datum id string data id request param group string group request param value tenant require false default value string util empty string tenant rest result config advance info rr new rest result config advance info config advance info config info persist service find config advance info datum id group tenant rr set code rr set datum config info return rr 
config controller post mapping listener secure action action type read parser config resource parser class public void listener http servlet request request http servlet response response throw servlet exception i o exception request set attribute org apache catalina async support true string probe modify request get parameter listen config if string util be blank probe modify throw new illegal argument exception invalid probe modify probe modify u r l decoder decode probe modify constant encode map string string client md5 map try client md5 map m d5 util get client md5 map probe modify catch throwable e throw new illegal argument exception invalid probe modify do long polling inner do polling config request response client md5 map probe modify length 
config controller get map listener secure action action type read parser config resource parser class public groupkey listenser status get listener request param datum id string data id request param group string group request param value tenant require false string tenant request param value sample time require false default value int sample time throw exception group string util be blank group constant default group group sample result collect sample result config sub service get collect sample result datum id group tenant sample time groupkey listenser status gl new groupkey listenser status gl set collect status if collect sample result get lisenter groupkey status null gl set lisenter groupkey status collect sample result get lisenter groupkey status return gl 
config controller get map param search accurate secured action action type read parser config resource parser class public page config info search config request param datum id string data id request param group string group request param value app name require false string app name request param value tenant require false default value string util empty string tenant request param value config tag require false string config tag request param page no int page no request param page size int page size map string object config advance info new hash map string object if string util be not blank app name config advance info put app name app name if string util be not blank config tag config advance info put config tag config tag try return persist service find config info4 page page no page size datum id group tenant config advance info catch exception e string error msg serialize page error datum id datum id group group logger error error msg e throw new runtime exception error msg e 
config controller get map param search blur secure action action type read parser config resource parser class public page config info fuzzy search config request param datum id string data id request param group string group request param value app name require false string app name request param value tenant require false default value string util empty string tenant request param value config tag require false string config tag request param page no int page no request param page size int page size map string object config advance info new hash map string object if string util be not blank app name config advance info put app name app name if string util be not blank config tag config advance info put config tag config tag try return persist service find config info like4 page page no page size datum id group tenant config advance info catch exception e string error msg serialize page error datum id datum id group group logger error error msg e throw new runtime exception error msg e 
config controller delete mapping param beta true secured action action type write parser config resource parser class public rest result boolean stop beta request param value datum id string data id request param value group string group request param value tenant require false default value string util empty string tenant rest result boolean rr new rest result boolean try persist service remove config info4 beta datum id group tenant catch exception e logger error remove beta datum error e rr set code rr set datum false rr set message remove beta datum error return rr config change publisher notify config change new config datum change event true datum id group tenant system current time millis rr set code rr set datum true rr set message stop beta ok return rr 
config controller get map param beta true secured action action type read parser config resource parser class public rest result config info4 beta query beta request param value datum id string data id request param value group string group request param value tenant require false default value string util empty string tenant rest result config info4 beta rr new rest result config info4 beta try config info4 beta ci persist service find config info4 beta datum id group tenant rr set code rr set datum ci rr set message stop beta ok return rr catch exception e logger error remove beta datum error e rr set code rr set message remove beta datum error return rr 
config controller get map param export true secured action action type read parser config resource parser class public response entity byte export config request param value datum id require false string datum id request param value group require false string group request param value app name require false string app name request param value tenant require false default value string util empty string tenant request param value id require false list long id id remove all collection singleton null tenant process tenant tenant list config all info datum list persist service find all config info4 export datum id group tenant app name id list zip util zip item zip item list new array list string builder meta datum null for config info ci datum list if string util be not blank ci get app name handle app name if meta datum null meta datum new string builder string meta data id ci get datum id if meta datum id contain meta datum id meta datum id substring meta datum id last index of meta datum id substring meta datum id last index of meta datum append ci get group append append meta datum id append app fix use of r n here append ci get app name append r n string item name ci get group ci get datum id zip item list add new zip util zip item item name ci get content if meta data null zip item list add new zip util zip item meta yml meta datum to string http header header new http header string file name export config file name date format util format new date export config file name date format export config file name ext header add content disposition attachment filename file name return new response entity byte zip util zip zip item list header http status ok 
config controller post mapping param import true secured action action type write parser config resource parser class public rest result map string object import and publish config http servlet request request request param value src user require false string src user request param value namespace require false string namespace request param value policy default value abort same config policy policy multipart file file throw naco exception map string object fail datum new hash map if object be null file return result builder build result result code enum datum empty fail datum if string util be not blank namespace if persist service tenant info count by tenant id namespace fail datum put succ count return result builder build result result code enum namespace not exist fail datum list config all info config info list null try zip util un zip result unziped zip util unzip file get byte zip util zip item meta datum zip item unziped get meta datum item map string string meta datum map new hash map if meta datum zip item null string meta datum str meta datum zip item get item datum string meta datum arr meta datum str split be n for string meta datum item meta datum arr string meta datum item arr meta datum item split if meta datum item arr length fail datum put succ count return result builder build result result code enum metadata illegal fail datum meta datum map put meta datum item arr meta datum item arr list zip util zip item item list unziped get zip item list if item list null item list be empty config info list new array list item list size for zip util zip item item item list string group adn data id item get item name split if item get item name contain group adn datum id length fail datum put succ count return result builder build result result code enum datum validation fail fail datum string group group adn datum id string datum id group adn datum id string temp datum id data id if temp datum id contain temp datum id temp datum id substr temp datum id last index of temp datum id substr temp datum id last index of final string meta datum id group temp datum id app config all info ci new config all info ci set tenant namespace ci set group group ci set datum id data id ci set content item get item datum if meta datum map get meta datum id null ci set app name meta datum map get meta datum id config info list add ci catch i o exception e fail datum put succ count logger error parse datum fail e return result builder build result result code enum parse datum fail fail datum if config info list null config info list be empty fail datum put succ count return result builder build result result code enum datum empty fail datum final string src ip request util get remote ip request string request ip app request util get app name request final timestamp time time util get current time map string object save result persist service batch insert or update config info list src user src ip null time false policy for config info config info config info list config change publisher notify config change new config datum change event false config info get datum id config info get group config info get tenant time get time config trace service log persistence event config info get datum id config info get group config info get tenant request ip app time get time inet util get self ip config trace service persistence event pub config info get content return result builder build success result save result 
config controller post mapping param clone true secured action action type write parser config resource parser class public rest result map string object clone config http servlet request request request param value src user require false string src user request param value tenant require true string namespace request body require true list same namespace clone config bean config bean list request param value policy default value abort same config policy policy throw naco exception map string object fail datum new hash map if collection util be empty config bean list fail datum put succ count return result builder build result result code enum no select config fail datum config bean list remove all collection singleton null if namespace public key equal ignore case namespace namespace else if persist service tenant info count by tenant id namespace fail datum put succ count return result builder build result result code enum namespace not exist fail datum list long id list new array list config bean list size map long same namespace clone config bean config bean map config bean list stream collect collector to map same namespace clone config bean get cfg id cfg id list add cfg get cfg id return cfg k1 k2 k1 list config all info querye datum list persist service find all config info4 export null null null null id list if querye datum list null querye datum list be empty fail datum put succ count return result builder build result result code enum datum empty fail datum list config all info config info list4 clone new array list querye datum list size for config all info ci querye datum list same namespace clone config bean prarm bean config bean map get ci get id config all info ci4save new config all info ci4save set tenant namespace ci4save set type ci get type ci4save set group prarm bean null string util be not blank prarm bean get group prarm bean get group ci get group ci4save set datum id prarm bean null string util be not blank prarm bean get datum id prarm bean get datum id ci get datum id ci4save set content ci get content if string util be not blank ci get app name ci4save set app name ci get app name config info list4 clone add ci4save if config info list4 clone be empty fail datum put succ count return result builder build result result code enum datum empty fail datum final string src ip request util get remote ip request string request ip app request util get app name request final timestamp time time util get current time map string object save result persist service batch insert or update config info list4 clone src user src ip null time false policy for config info config info config info list4 clone config change publisher notify config change new config datum change event false config info get datum id config info get group config info get tenant time get time config trace service log persistence event config info get datum id config info get group config info get tenant request ip app time get time inet util get self ip config trace service persistence event pub config info get content return result builder build success result clone complete successfully save result 
config op controller post mapping value datum removal secure action action type write resource naco admin public defer result rest result string import derby request param value file multipart file multipart file defer result rest result string response new deferred result if property util be embed storage response set result rest result util fail limit to embed storage mode return response database operate database operate application util get bean database operate class web util on file upload multipart file file notify center publish event new derby import event false database operate datum import file when complete result ex notify center publish event new derby import event true if object non null ex response set result rest result util fail ex get message return response set result result response return response 
namespace controller post mapping secure resource naco auth config console resource name prefix namespace action action type write public boolean create namespace http servlet request request http servlet response response request param custom namespace id string namespace id request param namespace name string namespace name request param value namespace desc require false string namespace desc todo kp if string util be blank namespace id namespace id uuid random u u i d to string else namespace id namespace id trim if namespace id check pattern matcher namespace id match return false if namespace id length namespace id max length return false if persist service tenant info count by tenant id namespace id return false persist service insert tenant info atomic namespace id namespace name namespace desc naco system current time millis return true 
namespace controller put mapping secure resource naco auth config console resource name prefix namespace action action type write public boolean edit namespace request param namespace string namespace request param namespace show name string namespace show name request param value namespace desc require false string namespace desc todo kp persist service update tenant name atomic namespace namespace show name namespace desc return true 
namespace controller delete mapping secure resource naco auth config console resource name prefix namespace action action type write public boolean delete config http servlet request request http servlet response response request param namespace id string namespace id persist service remove tenant info atomic namespace id return true 
permission controller get map secure resource naco auth config console resource name prefix permission action action type read public object get permission request param int page no request param int page size request param name role default value string util empty string role return naco role service get permission from database role page no page size 
permission controller post mapping secure resource naco auth config console resource name prefix permission action action type write public object add permission request param string role request param string resource request param string action naco role service add permission role resource action return new rest result add permission ok 
permission controller delete mapping secure resource naco auth config console resource name prefix permission action action type write public object delete permission request param string role request param string resource request param string action naco role service delete permission role resource action return new rest result delete permission ok 
role controller get map secure resource naco auth config console resource name prefix role action action type read public object get role request param int page no request param int page size request param name username default value string username return role service get role from database username page no page size 
role controller post mapping secure resource naco auth config console resource name prefix role action action type write public object add role request param string role request param string username role service add role role username return new rest result add role ok 
role controller delete mapping secure resource naco auth config console resource name prefix role action action type write public object delete role request param string role request param name username default value string util empty string username if string util be blank username role service delete role role else role service delete role role username return new rest result delete role of user username ok 
user controller secure resource naco auth config console resource name prefix user action action type write post map public object create user request param string username request param string password user user user detail service get user from database username if user null throw new illegal argument exception user username already exist user detail service create user username password encoder util encode password return new rest result create user ok 
user controller delete mapping secure resource naco auth config console resource name prefix user action action type write public object delete user request param string username list role info role info list role service get role username if role info list null for role info role info role info list if role info get role equal naco role service impl global admin role throw new illegal argument exception can not delete admin username user detail service delete user username return new rest result delete user ok 
user controller put mapping secure resource naco auth config console resource name prefix user action action type write public object update user request param string username request param string new password user user user detail service get user from database username if user null throw new illegal argument exception user username not exist user detail service update user password username password encoder util encode new password return new rest result update user ok 
user controller get map secure resource naco auth config console resource name prefix user action action type read public object get user request param int page no request param int page size return user detail service get user from database page no page size 
catalog controller secure parser name resource parser class action action type read get mapping service public object node service detail request param default value constant default namespace id string namespace id string service name throw naco exception service detailed service service manager get service namespace id service name if detailed service null throw new naco exception naco exception not find service service name be not find object node service object jackson util create empty json node service object put name name util get service name service name service object put protect threshold detailed service get protect threshold service object put group name name util get group name service name service object replace selector jackson util transfer to json node detailed service get selector service object replace metadata jackson util transfer to json node detailed service get metadata object node detail view jackson util create empty json node detail view replace service service object list cluster cluster new array list for com alibaba naco name core cluster cluster detailed service get cluster map value cluster cluster view new cluster cluster view set name cluster get name cluster view set health checker cluster get health checker cluster view set metadata cluster get metadata cluster view set use i p port4 check cluster be use i p port4 check cluster view set default port cluster get default port cluster view set default check port cluster get default check port cluster view set service name cluster get service get name cluster add cluster view detail view replace cluster jackson util transfer to json node cluster return detail view 
catalog controller secure parser name resource parser class action action type read request mapping value instance public object node instance list request param default value constant default namespace id string namespace id request param string service name request param string cluster name request param name page no int page request param int page size throw naco exception service service service manager get service namespace id service name if service null throw new naco exception naco exception not find serivce service name be not find if service get cluster map contain key cluster name throw new naco exception naco exception not find cluster cluster name be not find list instance instance service get cluster map get cluster name all i ps int start page page size int end page page size if start start if start instance size start instance size if end instance size end instance size object node result jackson util create empty json node result replace list jackson util transfer to json node instance sub list start end result put count instance size return result 
catalog controller secure parser name resource parser class action action type read get mapping service public object list detail request param require false boolean with instance request param default value constant default namespace id string namespace id request param require false int page no request param require false int page size request param name service name param default value string util empty string service name request param name group name param default value string util empty string group name request param name instance default value string util empty string contain instance request param require false boolean have ip count string param string util be blank service name string util be blank group name string util empty naming util get group name service name group name if with instance list service detail info service detail info list new array list list service service new array list service manager get page service namespace id page no page size param string util empty service false for service service service service detail info service detail info new service detail info service detail info set service name name util get service name service get name service detail info set group name name util get group name service get name service detail info set metadata service get metadata map string cluster info cluster info map get string cluster info map service service detail info set cluster map cluster info map service detail info list add service detail info return service detail info list object node result jackson util create empty json node list service service new array list final int total service manager get page service namespace id page no page size param contain instance service have ip count if collection util be empty service result replace service list jackson util transfer to json node collection empty list result put count return result list service view service view new link list for service service service service view service view new service view service view set name name util get service name service get name service view set group name name util get group name service get name service view set cluster count service get cluster map size service view set ip count service all i ps size service view set healthy instance count service healthy instance count service view set trigger flag service trigger flag true false service view add service view result replace service list jackson util transfer to json node service view result put count total return result 
cluster controller put mapping secure action action type write public string update http servlet request request throw exception string namespace id web util optional request common param namespace id constant default namespace id string cluster name web util require request common param cluster name string service name web util require request common param service name string check port web util require request check port service service service manager get service namespace id service name if service null throw new naco exception naco exception invalid param service not find service name cluster cluster service get cluster map get cluster name if cluster null logger srv log warn update cluster cluster not exist will create it service cluster name service name cluster new cluster cluster name service cluster set def ckport number util to int check port cluster set use i p port4 check boolean util to boolean web util require request use instance port4 check abstract health checker abstract health checker health checker factory deserialize web util require request health checker cluster set health checker abstract health checker cluster set metadata util and common parse metadata web util optional request metadata string util empty cluster init service get cluster map put cluster name cluster service set last modify millis system current time millis service recalculate checksum service validate service manager add or replace service service return ok 
health controller can distro put mapping value instance secure action action type write public string update http servlet request request string healthy string web util optional request healthy string util empty if string util be blank healthy string healthy string web util optional request valid string util empty if string util be blank healthy string throw new illegal argument exception param healthy be require boolean valid boolean util to boolean healthy string string service name web util require request common param service name string namespace id web util optional request common param namespace id constant default namespace id string cluster name web util optional request common param cluster name util and common default cluster name string ip web util require request ip int port integer parse int web util require request port service service service manager get service namespace id service name only health check none need update health status with api if health check type none name equal service get cluster map get cluster name get health checker get type for instance instance service all i ps list new array list cluster name if instance get ip equal ip instance get port port instance set healthy valid logger evt log info valid ip enable ip disabled ip instance get ip instance get port instance get cluster name service service name msg update think health controller api push service service change service break else throw new illegal argument exception health check be still work service service name return ok 
instance controller can distro post mapping secure parser name resource parser class action action type write public string register http servlet request request throw exception final string service name web util require request common param service name final string namespace id web util optional request common param namespace id constant default namespace id final instance instance parse instance request service manager register instance namespace id service name instance return ok 
instance controller can distro delete mapping secure parser name resource parser class action action type write public string deregister http servlet request request throw exception instance instance get ip address request string namespace id web util optional request common param namespace id constant default namespace id string service name web util require request common param service name service service service manager get service namespace id service name if service null logger srv log warn remove instance from non exist service service name return ok service manager remove instance namespace id service name instance be ephemeral instance return ok 
instance controller can distro put mapping secure parser name resource parser class action action type write public string update http servlet request request throw exception final string service name web util require request common param service name final string namespace id web util optional request common param namespace id constant default namespace id final instance instance parse instance request string agent web util get user agent request client info client info new client info agent if client info type client info client type java client info version compare to version util parse version 1.0 service manager update instance namespace id service name instance else service manager register instance namespace id service name instance return ok 
instance controller can distro patch mapping secure parser name resource parser class action action type write public string patch http servlet request request throw exception string service name web util require request common param service name string namespace id web util optional request common param namespace id constant default namespace id string ip web util require request ip string port web util require request port string cluster web util optional request common param cluster name string util empty if string util be blank cluster cluster web util optional request cluster util and common default cluster name instance instance service manager get instance namespace id service name cluster ip integer parse int port if instance null throw new illegal argument exception instance not find string metadata web util optional request metadata string util empty if string util be not blank metadata instance set metadata util and common parse metadata metadata string app web util optional request app string util empty if string util be not blank app instance set app app string weight web util optional request weight string util empty if string util be not blank weight instance set weight double parse double weight string healthy web util optional request healthy string util empty if string util be not blank healthy instance set healthy boolean util to boolean healthy string enable string web util optional request enable string util empty if string util be not blank enable string instance set enable boolean util to boolean enable string instance set last beat system current time millis instance validate service manager update instance namespace id service name instance return ok 
instance controller get mapping list secure parser name resource parser class action action type read public object node list http servlet request request throw exception string namespace id web util optional request common param namespace id constant default namespace id string service name web util require request common param service name string agent web util get user agent request string cluster web util optional request cluster string util empty string client i p web util optional request client i p string util empty int udp port integer parse int web util optional request udp port string env web util optional request env string util empty boolean be check boolean parse boolean web util optional request be check false string app web util optional request app string util empty string tenant web util optional request tid string util empty boolean healthy only boolean parse boolean web util optional request healthy only false return do srv ipxt namespace id service name agent cluster client i p udp port env be check app tenant healthy only 
instance controller get map secure parser name resource parser class action action type read public object node detail http servlet request request throw exception string namespace id web util optional request common param namespace id constant default namespace id string service name web util require request common param service name string cluster web util optional request common param cluster name util and common default cluster name string ip web util require request ip int port integer parse int web util require request port service service service manager get service namespace id service name if service null throw new naco exception naco exception not find no service service name find list string cluster new array list cluster add cluster list instance ip service all i ps cluster if ips null ip be empty throw new naco exception naco exception not find no ip find for cluster cluster in service service name for instance instance ip if instance get ip equal ip instance get port port object node result jackson util create empty json node result put service service name result put ip ip result put port port result put cluster name cluster result put weight instance get weight result put healthy instance be healthy result put metadata jackson util transfer to json node instance get metadata result put instance id instance get instance id return result throw new naco exception naco exception not find no match ip find 
instance controller can distro put mapping beat secure parser name resource parser class action action type write public object node beat http servlet request request throw exception object node result jackson util create empty json node result put client beat interval switch domain get client beat interval string beat web util optional request beat string util empty rs info client beat null if string util be not blank beat client beat jackson util to obj beat rs info class string cluster name web util optional request common param cluster name util and common default cluster name string ip web util optional request ip string util empty int port integer parse int web util optional request port if client beat null if string util be not blank client beat get cluster cluster name client beat get cluster else fix client beat set cluster cluster name ip client beat get ip port client beat get port string service name web util require request common param service name string namespace id web util optional request common param namespace id constant default namespace id logger srv log debug client beat full argument beat service name client beat service name instance instance service manager get instance namespace id service name cluster name ip port if instance null if client beat null result put common param code name response code resource not find return result logger srv log warn client beat the instance have be remove for health mechanism perform datum compensation operation beat service name client beat service name instance new instance instance set port client beat get port instance set ip client beat get ip instance set weight client beat get weight instance set metadata client beat get metadata instance set cluster name cluster name instance set service name service name instance set instance id instance get instance id instance set ephemeral client beat be ephemeral service manager register instance namespace id service name instance service service service manager get service namespace id service name if service null throw new naco exception naco exception server error service not find service name namespace id if client beat null client beat new rs info client beat set ip ip client beat set port port client beat set cluster cluster name service process client beat client beat result put common param code name response code ok result put client beat interval instance get instance heart beat interval result put switch entry light beat enable switch domain be light beat enable return result 
operator controller secure resource naming switch action action type write put mapping switch public string update switch request param require false boolean debug request param string entry request param string value throw exception switch manager update entry value debug return ok 
operator controller secure resource name metric action action type read get map metric public object node metric http servlet request request object node result jackson util create empty json node int service count service manager get service count int ip count service manager get instance count int responsible dom count service manager get responsible service count int responsible ip count service manager get responsible instance count result put status server status manager get server status name result put service count service count result put instance count ip count result put raft notify task count raft core get notify task count result put responsible service count responsible dom count result put responsible instance count responsible ip count result put cpu application util get c p u result put load application util get load result put mem application util get mem return result 
service controller post mapping secure parser name resource parser class action action type write public string create request param default value constant default namespace id string namespace id request param string service name request param require false float protect threshold request param default value string util empty string metadata request param default value string util empty string selector throw exception if service manager get service namespace id service name null throw new illegal argument exception specify service already exist service name service name map string string metadata map new hash map if string util be not blank metadata metadata map util and common parse metadata metadata service service new service service name service set protect threshold protect threshold service set enable true service set metadata metadata map service set selector parse selector selector service set namespace id namespace id now valid the service if fail exception will be throw service set last modify millis system current time millis service recalculate checksum service validate service manager add or replace service service return ok 
service controller delete mapping secure parser name resource parser class action action type write public string remove request param default value constant default namespace id string namespace id request param string service name throw exception service manager easy remove service namespace id service name return ok 
service controller get map secure parser name resource parser class action action type read public object node detail request param default value constant default namespace id string namespace id request param string service name throw naco exception service service service manager get service namespace id service name if service null throw new naco exception naco exception not find service service name be not find object node re jackson util create empty json node re put name name util get service name service name re put namespace id service get namespace id re put protect threshold service get protect threshold re replace metadata jackson util transfer to json node service get metadata re replace selector jackson util transfer to json node service get selector re put group name name util get group name service name array node cluster jackson util create empty array node for cluster cluster service get cluster map value object node cluster json jackson util create empty json node cluster json put name cluster get name cluster json replace health checker jackson util transfer to json node cluster get health checker cluster json replace metadata jackson util transfer to json node cluster get metadata cluster add cluster json re replace cluster cluster return re 
service controller get mapping list secure parser name resource parser class action action type read public object node list http servlet request request throw exception final int page no number util to int web util require request page no final int page size number util to int web util require request page size string namespace id web util optional request common param namespace id constant default namespace id string group name web util optional request common param group name constant default group string selector string web util optional request selector string util empty list string service name list service manager get all service name list namespace id object node result jackson util create empty json node if service name list null service name list be empty result replace dom jackson util transfer to json node collection empty list result put count return result service name list remove if service name service name start with group name constant service info spliter if string util be not blank selector string json node selector json jackson util to obj selector string selector type selector type selector type value of selector json get type as text string expression selector json get expression as text if selector type label equal selector type string util be not blank expression expression string util delete whitespace expression now we only support the following expression instance metadata xxx yyy or service metadata xxx yyy string term expression split string factor term split switch factor case instance service name list filter instance metadata namespace id service name list factor factor length term replace break case service service name list filter service metadata namespace id service name list factor factor length term replace break default break int start page no page size if start start int end start page size if end service name list size end service name list size for int i start i end i service name list set i service name list get i replace group name constant service info spliter result replace dom jackson util transfer to json node service name list sub list start end result put count service name list size return result 
service controller put mapping secure parser name resource parser class action action type write public string update http servlet request request throw exception string namespace id web util optional request common param namespace id constant default namespace id string service name web util require request common param service name float protect threshold number util to float web util require request protect threshold string metadata web util optional request metadata string util empty service service service manager get service namespace id service name if service null throw new naco exception naco exception invalid param service service name not find service set protect threshold protect threshold map string string metadata map util and common parse metadata metadata service set metadata metadata map service set selector parse selector web util optional request selector string util empty service set last modify millis system current time millis service recalculate checksum service validate service manager add or replace service service return ok 
service controller request mapping name secure parser name resource parser class action action type read public object node search service request param default value string util empty string namespace id request param default value string util empty string expr request param require false boolean responsible only map string list service service new hash map if string util be not blank namespace id service put namespace id service manager search service namespace id constant any pattern expr constant any pattern else for string namespace service manager get all namespace service put namespace service manager search service namespace constant any pattern expr constant any pattern map string set string service name map new hash map for string namespace service key set service name map put namespace new hash set for service service service get namespace if distro mapper responsible service get name responsible only service name map get namespace add name util get service name service get name object node result jackson util create empty json node result replace service jackson util transfer to json node service name map result put count service size return result 
service controller get map subscriber secure parser name resource parser class action action type read public object node subscriber http servlet request request int page no number util to int web util require request page no int page size number util to int web util require request page size string namespace id web util optional request common param namespace id constant default namespace id string service name web util require request common param service name boolean aggregation boolean parse boolean web util optional request aggregation string value of boolean true object node result jackson util create empty json node try list subscriber subscriber subscribe manager get subscriber service name namespace id aggregation int start page no page size if start start int end start page size int count subscriber size if end count end count result replace subscriber jackson util transfer to json node subscriber sub list start end result put count count return result catch exception e logger srv log warn query subscriber fail e result replace subscriber jackson util create empty array node result put count return result 
