home controller controller public class home controller get map public string home model map model map authentication authentication o auth2 authentication oauth2 authentication o auth2 authentication authentication model map put username oauth2 authentication get name model map put authority oauth2 authentication get authority model map put client id oauth2 authentication get o auth2 request get client id o auth2 authentication detail detail o auth2 authentication detail oauth2 authentication get detail model map put token detail get token value return index 
index controller controller public class index controller resource private xxl job service xxl job service request map public string index model model map string object dashboard map xxl job service dashboard info model add all attribute dashboard map return index request mapping chart info response body public return t map string object chart info date start date date end date return t map string object chart info xxl job service chart info start date end date return chart info request mapping to login permession limit limit false public string to login model model http servlet request request if permission interceptor if login request return redirect return login request mapping value login method request method post response body permession limit limit false public return t string login do http servlet request request http servlet response response string user name string password string if remember valid if permission interceptor if login request return return t success param if string util be blank user name string util be blank password return new return t string i18n util get string login param empty boolean if rem string util be not blank if remember on equal if remember true false do login boolean login ret permission interceptor login response user name password if rem if login ret return new return t string i18n util get string login param unvalid return return t success request mapping value logout method request method post response body permession limit limit false public return t string logout http servlet request request http servlet response response if permission interceptor if login request permission interceptor logout request response return return t success request mapping help public string help if permission interceptor if login request return redirect to login return help init binder public void init binder web datum binder binder simple date format date format new simple date format yyyy mm dd hh mm ss date format set lenient false binder register custom editor date class new custom date editor date format true 
job api controller controller public class job api controller implement initialize bean override public void after property set throw exception request mapping admin biz mapping permession limit limit false public void api http servlet request request http servlet response response throw i o exception servlet exception xxl job dynamic scheduler invoke admin service request response 
job code controller controller request mapping jobcode public class job code controller resource private xxl job info dao xxl job info dao resource private xxl job log glue dao xxl job log glue dao request map public string index model model int job id xxl job info job info xxl job info dao load by id job id list xxl job log glue job log glue xxl job log glue dao find by job id job id if job info null throw new runtime exception i18n util get string jobinfo glue jobid unvalid if glue type enum bean glue type enum match job info get glue type throw new runtime exception i18n util get string jobinfo glue gluetype unvalid glue model add attribute glue type enum glue type enum value model add attribute job info job info model add attribute job log glue job log glue return jobcode jobcode index request mapping save response body public return t string save model model int id string glue source string glue remark valid if glue remark null return new return t string i18n util get string system please input i18n util get string jobinfo glue remark if glue remark length glue remark length return new return t string i18n util get string jobinfo glue remark limit xxl job info exist job info xxl job info dao load by id id if exist job info null return new return t string i18n util get string jobinfo glue jobid unvalid update new code exist job info set glue source glue source exist job info set glue remark glue remark exist job info set glue updatetime new date xxl job info dao update exist job info log old code xxl job log glue xxl job log glue new xxl job log glue xxl job log glue set job id exist job info get id xxl job log glue set glue type exist job info get glue type xxl job log glue set glue source glue source xxl job log glue set glue remark glue remark xxl job log glue dao save xxl job log glue remove code backup more than xxl job log glue dao remove old exist job info get id return return t success 
job group controller controller request mapping jobgroup public class job group controller resource public xxl job info dao xxl job info dao resource public xxl job group dao xxl job group dao request map public string index model model job group executor list xxl job group list xxl job group dao find all model add attribute list list return jobgroup jobgroup index request mapping save response body public return t string save xxl job group xxl job group valid if xxl job group get app name null string util be blank xxl job group get app name return new return t string i18n util get string system please input app name if xxl job group get app name length xxl job group get app name length return new return t string i18n util get string jobgroup field app name length if xxl job group get title null string util be blank xxl job group get title return new return t string i18n util get string system please input i18n util get string jobgroup field title if xxl job group get address type if string util be blank xxl job group get address list return new return t string i18n util get string jobgroup field address type limit string addresss xxl job group get address list split for string item addresss if string util be blank item return new return t string i18n util get string jobgroup field registry list unvalid int ret xxl job group dao save xxl job group return ret return t success return t fail request mapping update response body public return t string update xxl job group xxl job group valid if xxl job group get app name null string util be blank xxl job group get app name return new return t string i18n util get string system please input app name if xxl job group get app name length xxl job group get app name length return new return t string i18n util get string jobgroup field app name length if xxl job group get title null string util be blank xxl job group get title return new return t string i18n util get string system please input i18n util get string jobgroup field title if xxl job group get address type list string registry list find registry by app name xxl job group get app name string address list str null if registry list null registry list be empty collection sort registry list address list str string util join registry list xxl job group set address list address list str else if string util be blank xxl job group get address list return new return t string i18n util get string jobgroup field address type limit string addresss xxl job group get address list split for string item addresss if string util be blank item return new return t string i18n util get string jobgroup field registry list unvalid int ret xxl job group dao update xxl job group return ret return t success return t fail private list string find registry by app name string app name param hash map string list string app address map new hash map string list string list xxl job registry list xxl job admin config get admin config get xxl job registry dao find all registry config dead timeout if list null for xxl job registry item list if registry config regist type executor name equal item get registry group string app name item get registry key list string registry list app address map get app name if registry list null registry list new array list string if registry list contain item get registry value registry list add item get registry value app address map put app name registry list return app address map get app name param request mapping remove response body public return t string remove int id valid int count xxl job info dao page list count id null null if count return new return t string i18n util get string jobgroup del limit list xxl job group all list xxl job group dao find all if all list size return new return t string i18n util get string jobgroup del limit int ret xxl job group dao remove id return ret return t success return t fail 
job info controller controller request map jobinfo public class job info controller resource private xxl job group dao xxl job group dao resource private xxl job service xxl job service request map public string index model model request param require false default value int job group model add attribute executor route strategy enum executor route strategy enum value model add attribute glue type enum glue type enum value glue model add attribute executor block strategy enum executor block strategy enum value list xxl job group job group list xxl job group dao find all model add attribute job group list job group list model add attribute job group job group return jobinfo jobinfo index request mapping page list response body public map string object page list request param require false default value int start request param require false default value int length int job group string job desc string executor handler string filter time return xxl job service page list start length job group job desc executor handler filter time request mapping add response body public return t string add xxl job info job info return xxl job service add job info request mapping update response body public return t string update xxl job info job info return xxl job service update job info request mapping remove response body public return t string remove int id return xxl job service remove id request map stop todo pause stop response body public return t string pause int id return xxl job service stop id request mapping start todo resume start response body public return t string start int id return xxl job service start id request mapping trigger response body permession limit limit false public return t string trigger job int id string executor param force cover job param if executor param null executor param job trigger pool helper trigger id trigger type enum manual null executor param return return t success 
job log controller controller request mapping joblog public class job log controller private static logger logger logger factory get logger job log controller class resource private xxl job group dao xxl job group dao resource public xxl job info dao xxl job info dao resource public xxl job log dao xxl job log dao request map public string index model model request param require false default value integer job id list xxl job group job group list xxl job group dao find all model add attribute job group list job group list if job id xxl job info job info xxl job info dao load by id job id model add attribute job info job info return joblog joblog index request mapping get job by group response body public return t list xxl job info get job by group int job group list xxl job info list xxl job info dao get job by group job group return new return t list xxl job info list request mapping page list response body public map string object page list request param require false default value int start request param require false default value int length int job group int job id int log status string filter time parse param date trigger time start null date trigger time end null if string util be not blank filter time string temp filter time split if temp null temp length try trigger time start date util parse date temp new string yyyy mm dd hh mm ss trigger time end date util parse date temp new string yyyy mm dd hh mm ss catch parse exception e page query list xxl job log list xxl job log dao page list start length job group job id trigger time start trigger time end log status int list count xxl job log dao page list count start length job group job id trigger time start trigger time end log status package result map string object map new hash map string object map put record total list count map put record filter list count map put datum list return map request mapping log detail page public string log detail page int id model model base check return t string log statue return t success xxl job log job log xxl job log dao load id if job log null throw new runtime exception i18n util get string joblog logid unvalid model add attribute trigger code job log get trigger code model add attribute handle code job log get handle code model add attribute executor address job log get executor address model add attribute trigger time job log get trigger time get time model add attribute log id job log get id return joblog joblog detail request mapping log detail cat response body public return t log result log detail cat string executor address long trigger time int log id int from line num try executor biz executor biz xxl job dynamic scheduler get executor biz executor address return t log result log result executor biz log trigger time log id from line num be end if log result get content null log result get content get from line num log result get content get to line num xxl job log job log xxl job log dao load log id if job log get handle code log result get content set end true return log result catch exception e logger error e get message e return new return t log result return t fail code e get message request mapping log kill response body public return t string log kill int id base check xxl job log log xxl job log dao load id xxl job info job info xxl job info dao load by id log get job id if job info null return new return t string i18n util get string jobinfo glue jobid unvalid if return t success code log get trigger code return new return t string i18n util get string joblog kill log limit request of kill return t string run result null try executor biz executor biz xxl job dynamic scheduler get executor biz log get executor address run result executor biz kill job info get id catch exception e logger error e get message e run result new return t string e get message if return t success code run result get code log set handle code return t fail code log set handle msg i18n util get string joblog kill log byman run result get msg null run result get msg log set handle time new date xxl job log dao update handle info log return new return t string run result get msg else return new return t string run result get msg request map clear log response body public return t string clear log int job group int job id int type date clear before time null int clear before num if type clear before time date util add month new date else if type clear before time date util add month new date else if type clear before time date util add month new date else if type clear before time date util add year new date else if type clear before num else if type clear before num else if type clear before num else if type clear before num else if type clear before num else return new return t string return t fail code i18n util get string joblog clean type unvalid xxl job log dao clear log job group job id clear before time clear before num return return t success 
validate code controller controller public class validate code controller autowire private i validate code service validate code service throw exception get map security constant default validate code url prefix device id public void create code path variable string device id http servlet response response throw exception assert not null device id captcha util set header response gif captcha gif captcha new gif captcha gif captcha set char type captcha type default validate code service save image code device id gif captcha text to lower case gif captcha out response get output stream param mobile return r response body get map security constant mobile validate code url prefix mobile public result create code path variable string mobile assert not null mobile return validate code service send sm code mobile 
sign in controller controller public class sign in controller get map signin public string login request param value error require false string error request param value logout require false string logout return login html 
sso heartbeat controller controller request mapping sso heartbeat public class sso heartbeat controller private final sso heartbeat handler handler public sso heartbeat controller final sso heartbeat handler handler this handler handler get map public void heartbeat http servlet request request http servlet response response handler do heartbeat request response 
degrade controller controller request mapping value degrade produce media type application json value public class degrade controller private final logger logger logger factory get logger degrade controller class autowire private in mem degrade rule store repository autowire private sentinel api client sentinel api client response body request mapping rule json auth action privilege type read rule public result list degrade rule entity query machine rule string app string ip integer port if string util be empty app return result of fail app can t be null or empty if string util be empty ip return result of fail ip can t be null or empty if port null return result of fail port can t be null try list degrade rule entity rule sentinel api client fetch degrade rule of machine app ip port rule repository save all rule return result of success rule catch throwable throwable logger error query app error throwable return result of throwable throwable response body request map new json auth action privilege type write rule public result degrade rule entity add string app string ip integer port string limit app string resource double count integer time window integer grade if string util be blank app return result of fail app can t be null or empty if string util be blank ip return result of fail ip can t be null or empty if port null return result of fail port can t be null if string util be blank limit app return result of fail limit app can t be null or empty if string util be blank resource return result of fail resource can t be null or empty if count null return result of fail count can t be null if time window null return result of fail time window can t be null if grade null return result of fail grade can t be null if grade rule constant degrade grade rt grade rule constant degrade grade exception count return result of fail invalid grade grade degrade rule entity entity new degrade rule entity entity set app app trim entity set ip ip trim entity set port port entity set limit app limit app trim entity set resource resource trim entity set count count entity set time window time window entity set grade grade date date new date entity set gmt create date entity set gmt modify date try entity repository save entity catch throwable throwable logger error add error throwable return result of throwable throwable if publish rule app ip port logger info publish degrade rule fail after rule add return result of success entity response body request mapping save json auth action privilege type write rule public result degrade rule entity update if not null long id string app string limit app string resource double count integer time window integer grade if id null return result of fail id can t be null if grade null if grade rule constant degrade grade rt grade rule constant degrade grade exception count return result of fail invalid grade grade degrade rule entity entity repository find by id id if entity null return result of fail id id dose not exist if string util be not blank app entity set app app trim if string util be not blank limit app entity set limit app limit app trim if string util be not blank resource entity set resource resource trim if count null entity set count count if time window null entity set time window time window if grade null entity set grade grade date date new date entity set gmt modify date try entity repository save entity catch throwable throwable logger error save error throwable return result of throwable throwable if publish rule entity get app entity get ip entity get port logger info publish degrade rule fail after rule update return result of success entity response body request map delete json auth action privilege type delete rule public result long delete long id if id null return result of fail id can t be null degrade rule entity old entity repository find by id id if old entity null return result of success null try repository delete id catch throwable throwable logger error delete error throwable return result of throwable throwable if publish rule old entity get app old entity get ip old entity get port logger info publish degrade rule fail after rule delete return result of success id private boolean publish rule string app string ip integer port list degrade rule entity rule repository find all by machine machine info of app ip port return sentinel api client set degrade rule of machine app ip port rule 
demo controller controller request mapping value demo produce media type application json value public class demo controller logger logger logger factory get logger machine registry controller class request mapping greet public string greet return index request mapping link response body public string link throw block exception entry entry sph u entry head1 entry type in entry entry1 sph u entry head2 entry type in entry entry2 sph u entry head3 entry type in entry entry3 sph u entry head4 entry type in entry3 exit entry2 exit entry1 exit entry exit return successfully create a call link request mapping loop response body public string loop string name int time throw block exception for int i i i thread timer new thread new run task name time false timer set name false timer start return successfully create a loop thread request mapping slow response body public string slow string name int time throw block exception for int i i i thread timer new thread new run task name time true timer set name false timer start return successfully create a loop thread static class run task implement runnable int time boolean stop false string name boolean slow false public run task string name int time boolean slow super this time time this name name this slow slow override public void run long start time system current time millis context util enter string value of start time while stop long now system current time millis if now start time time stop true entry e1 null try e1 sph u entry name if slow true time unit millisecond sleep catch exception e finally if e1 null e1 exit random random2 new random try time unit millisecond sleep random2 next int catch interrupt exception e todo auto generate catch block e print stack trace context util exit 
machine registry controller controller request mapping value registry produce media type application json value public class machine registry controller private final logger logger logger factory get logger machine registry controller class autowire private app management app management response body request map machine public result receive heart beat string app request param value app type require false default value integer app type long version string v string hostname string ip integer port if app null app machine discovery unknown app name if ip null return result of fail ip can t be null if port null return result of fail port can t be null if port logger info receive heartbeat from ip but port not set yet return result of fail you port not set yet string sentinel version string util be empty v unknown v version version null system current time millis version try machine info machine info new machine info machine info set app app machine info set app type app type machine info set hostname hostname machine info set ip ip machine info set port port machine info set heartbeat version version machine info set last heartbeat system current time millis machine info set version sentinel version app management add machine machine info return result of success msg success catch exception e logger error receive heartbeat error e return result of fail e get message 
metric controller controller request mapping value metric produce media type application json value public class metric controller private static logger logger logger factory get logger metric controller class private static final long max query interval ms autowire private metric repository metric entity metric store response body request mapping query top resource metric json public result query top resource metric final string app integer page index integer page size boolean desc long start time long end time string search key if string util be empty app return result of fail app can t be null or empty if page index null page index page index if page size null page size if page size page size if desc null desc true if end time null end time system current time millis if start time null start time end time if end time start time max query interval ms return result of fail time interval ms be too big must 1h list string resource metric store list resource of app app logger debug query top resource metric resource size resource size if resource null resource be empty return result of success null if desc collection reverse resource if string util be not empty search key list string search new array list for string resource resource if resource contain search key search add resource resource search int total page resource size page size page size list string top resource new array list if page index total page top resource resource sub list page index page size math min page index page size resource size final map string iterable metric vo map new concurrent hash map logger debug top resource top resource long time system current time millis for final string resource top resource list metric entity entity metric store query by app and resource between app resource start time end time logger debug resource entity size resource entity null null entity size list metric vo vos metric vo from metric entity entity resource iterable metric vo vos sort sort metric vo and distinct vos map put resource vos sort logger debug query top resource metric total query time ms system current time millis time map string object result map new hash map result map put total count resource size result map put total page total page result map put page index page index result map put page size page size map string iterable metric vo map2 new link hash map order matter for string identity top resource map2 put identity map get identity result map put metric map2 return result of success result map response body request mapping query by app and resource json public result query by app and resource string app string identity long start time long end time if string util be empty app return result of fail app can t be null or empty if string util be empty identity return result of fail identity can t be null or empty if end time null end time system current time millis if start time null start time end time if end time start time max query interval ms return result of fail time interval ms be too big must 1h list metric entity entity metric store query by app and resource between app identity start time end time list metric vo vos metric vo from metric entity entity identity return result of success sort metric vo and distinct vo private iterable metric vo sort metric vo and distinct list metric vo vos if vos null return null map long metric vo map new tree map for metric vo vo vos metric vo old vo map get vo get timestamp if old vo null vo get gmt create old vo get gmt create map put vo get timestamp vo return map value 
