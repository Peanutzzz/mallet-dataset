gateway api controller test run with spring runner class web mvc test gateway api controller class import fake auth service impl class in mem api definition store class app management class simple machine discovery class authorization interceptor class public class gateway api controller test private static final string test app test app private static final string test ip localhost private static final integer test port autowire private mock mvc mock mvc autowire private in mem api definition store repository mock bean private sentinel api client sentinel api client before public void before repository clear all test public void test query apis throw exception string path gateway api list json list api definition entity entity new array list mock two entity api definition entity entity new api definition entity entity set id 1 l entity set app test app entity set ip test ip entity set port test port entity set api name foo date date new date entity set gmt create date entity set gmt modify date set api predicate item entity item entity new link hash set entity set predicate item item entity api predicate item entity item entity new api predicate item entity item entity set pattern aaa item entity set match strategy url match strategy exact item entity add item entity entity add entity api definition entity entity2 new api definition entity entity2 set id 2 l entity2 set app test app entity2 set ip test ip entity2 set port test port entity2 set api name biz entity set gmt create date entity set gmt modify date set api predicate item entity item entities2 new link hash set entity2 set predicate item item entities2 api predicate item entity item entity2 new api predicate item entity item entity2 set pattern bbb item entity2 set match strategy url match strategy prefix item entities2 add item entity2 entity add entity2 completable future list api definition entity completable future mock completable future class give completable future get will return entity give sentinel api client fetch apis test app test ip test port will return completable future mock http servlet request builder request builder mock mvc request builder get path request builder param app test app request builder param ip test ip request builder param port string value of test port do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the fetch apis method have be call verify sentinel api client fetch apis test app test ip test port verify if two same entity be get result list api definition entity result j s o n object parse object mvc result get response get content as string new type reference result list api definition entity assert true result be success list api definition entity datum result get datum assert equal datum size assert equal entity datum verify the entity be add into memory repository list api definition entity entity in mem repository find all by app test app assert equal entity in mem size assert equal entity entity in mem test public void test add api throw exception string path gateway api new json add api req vo req vo new add api req vo req vo set app test app req vo set ip test ip req vo set port test port req vo set api name customize api list api predicate item vo item vo new array list api predicate item vo item vo new api predicate item vo item vo set match strategy url match strategy exact item vo set pattern product item vos add item vo req vo set predicate item item vos give sentinel api client modify apis eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder content json to j s o n string req vo content type media type application json do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify apis method have be call verify sentinel api client modify apis eq test app eq test ip eq test port any result api definition entity result j s o n object parse object mvc result get response get content as string new type reference result api definition entity assert true result be success verify the result api definition entity entity result get datum assert not null entity assert equal test app entity get app assert equal test ip entity get ip assert equal test port entity get port assert equal customize api entity get api name assert not null entity get id assert not null entity get gmt create assert not null entity get gmt modify set api predicate item entity predicate item entity entity get predicate item assert equal predicate item entity size api predicate item entity predicate item entity predicate item entity iterator next assert equal url match strategy exact predicate item entity get match strategy int value assert equal product predicate item entity get pattern verify the entity which be add in memory repository list api definition entity entity in mem repository find all by app test app assert equal entity in mem size assert equal entity entity in mem get test public void test update api throw exception string path gateway api save json add one entity to memory repository for update api definition entity add entity new api definition entity add entity set app test app add entity set ip test ip add entity set port test port add entity set api name bbb date date new date to make the gmt modify different when do update date date util add seconds date add entity set gmt create date add entity set gmt modify date set api predicate item entity add redicate item entity new hash set add entity set predicate item add redicate item entity api predicate item entity add predicate item entity new api predicate item entity add predicate item entity set match strategy url match strategy exact add predicate item entity set pattern order add entity repository save add entity update api req vo req vo new update api req vo req vo set id add entity get id req vo set app test app list api predicate item vo item vo new array list api predicate item vo item vo new api predicate item vo item vo set match strategy url match strategy prefix item vo set pattern my order item vos add item vo req vo set predicate item item vos give sentinel api client modify apis eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder content json to j s o n string req vo content type media type application json do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify apis method have be call verify sentinel api client modify apis eq test app eq test ip eq test port any result api definition entity result j s o n object parse object mvc result get response get content as string new type reference result api definition entity assert true result be success api definition entity entity result get datum assert not null entity assert equal bbb entity get api name assert equal date entity get gmt create to make sure gmt modify have be set and it be different from gmt create assert not null entity get gmt modify assert not equal entity get gmt create entity get gmt modify set api predicate item entity predicate item entity entity get predicate item assert equal predicate item entity size api predicate item entity predicate item entity predicate item entity iterator next assert equal url match strategy prefix predicate item entity get match strategy int value assert equal my order predicate item entity get pattern verify the entity which be update in memory repository list api definition entity entity in mem repository find all by app test app assert equal entity in mem size assert equal entity entity in mem get test public void test delete api throw exception string path gateway api delete json add one entity into memory repository for delete api definition entity add entity new api definition entity add entity set app test app add entity set ip test ip add entity set port test port add entity set api name ccc date date new date add entity set gmt create date add entity set gmt modify date set api predicate item entity add redicate item entity new hash set add entity set predicate item add redicate item entity api predicate item entity add predicate item entity new api predicate item entity add predicate item entity set match strategy url match strategy exact add predicate item entity set pattern user add add entity repository save add entity give sentinel api client modify apis eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder param id string value of add entity get id do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify apis method have be call verify sentinel api client modify apis eq test app eq test ip eq test port any verify the result result long result j s o n object parse object mvc result get response get content as string new type reference result long assert true result be success assert equal add entity get id result get datum now no entity in memory list api definition entity entity in mem repository find all by app test app assert equal entity in mem size 
gateway flow rule controller test run with spring runner class web mvc test gateway flow rule controller class import fake auth service impl class in mem gateway flow rule store class app management class simple machine discovery class authorization interceptor class public class gateway flow rule controller test private static final string test app test app private static final string test ip localhost private static final integer test port autowire private mock mvc mock mvc autowire private in mem gateway flow rule store repository mock bean private sentinel api client sentinel api client before public void before repository clear all test public void test query flow rule throw exception string path gateway flow list json list gateway flow rule entity entity new array list mock two entity gateway flow rule entity entity new gateway flow rule entity entity set id 1 l entity set app test app entity set ip test ip entity set port test port entity set resource httpbin route entity set resource mode resource mode route id entity set grade flow grade qp entity set count 5 d entity set interval 30 l entity set interval unit gateway flow rule entity interval unit second entity set control behavior control behavior default entity set burst entity set max queue timeout ms gateway param flow item entity item entity new gateway param flow item entity entity set param item item entity item entity set parse strategy param parse strategy client ip entity add entity gateway flow rule entity entity2 new gateway flow rule entity entity2 set id 2 l entity2 set app test app entity2 set ip test ip entity2 set port test port entity2 set resource some customize api entity2 set resource mode resource mode custom api name entity2 set count 30 d entity2 set interval 2 l entity2 set interval unit gateway flow rule entity interval unit minute entity2 set control behavior control behavior default entity2 set burst entity2 set max queue timeout ms gateway param flow item entity item entity2 new gateway param flow item entity entity2 set param item item entity2 item entity2 set parse strategy param parse strategy client ip entity add entity2 completable future list gateway flow rule entity completable future mock completable future class give completable future get will return entity give sentinel api client fetch gateway flow rule test app test ip test port will return completable future mock http servlet request builder request builder mock mvc request builder get path request builder param app test app request builder param ip test ip request builder param port string value of test port do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the fetch gateway flow rule method have be call verify sentinel api client fetch gateway flow rule test app test ip test port verify if two same entity be get result list gateway flow rule entity result j s o n object parse object mvc result get response get content as string new type reference result list gateway flow rule entity assert true result be success list gateway flow rule entity datum result get datum assert equal datum size assert equal entity datum verify the entity be add into memory repository list gateway flow rule entity entity in mem repository find all by app test app assert equal entity in mem size assert equal entity entity in mem test public void test add flow rule throw exception string path gateway flow new json add flow rule req vo req vo new add flow rule req vo req vo set app test app req vo set ip test ip req vo set port test port req vo set resource mode resource mode route id req vo set resource httpbin route req vo set grade flow grade qp req vo set count 5 d req vo set interval 30 l req vo set interval unit gateway flow rule entity interval unit second req vo set control behavior control behavior default req vo set burst req vo set max queue timeout ms give sentinel api client modify gateway flow rule eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder content json to j s o n string req vo content type media type application json do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify gateway flow rule method have be call verify sentinel api client modify gateway flow rule eq test app eq test ip eq test port any result gateway flow rule entity result j s o n object parse object mvc result get response get content as string new type reference result gateway flow rule entity assert true result be success verify the result gateway flow rule entity entity result get datum assert not null entity assert equal test app entity get app assert equal test ip entity get ip assert equal test port entity get port assert equal resource mode route id entity get resource mode int value assert equal httpbin route entity get resource assert not null entity get id assert not null entity get gmt create assert not null entity get gmt modify verify the entity which be add in memory repository list gateway flow rule entity entity in mem repository find all by app test app assert equal entity in mem size assert equal entity entity in mem get test public void test update flow rule throw exception string path gateway flow save json add one entity into memory repository for update gateway flow rule entity add entity new gateway flow rule entity add entity set id 1 l add entity set app test app add entity set ip test ip add entity set port test port add entity set resource httpbin route add entity set resource mode resource mode route id add entity set grade flow grade qp add entity set count 5 d add entity set interval 30 l add entity set interval unit gateway flow rule entity interval unit second add entity set control behavior control behavior default add entity set burst add entity set max queue timeout ms date date new date to make the gmt modify different when do update date date util add seconds date add entity set gmt create date add entity set gmt modify date gateway param flow item entity add item entity new gateway param flow item entity add entity set param item add item entity add item entity set parse strategy param parse strategy client ip repository save add entity update flow rule req vo req vo new update flow rule req vo req vo set id add entity get id req vo set app test app req vo set grade flow grade qp req vo set count 6 d req vo set interval 2 l req vo set interval unit gateway flow rule entity interval unit minute req vo set control behavior control behavior rate limiter req vo set max queue timeout ms gateway param flow item vo item vo new gateway param flow item vo req vo set param item item vo item vo set parse strategy param parse strategy url param item vo set field name pa give sentinel api client modify gateway flow rule eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder content json to j s o n string req vo content type media type application json do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify gateway flow rule method have be call verify sentinel api client modify gateway flow rule eq test app eq test ip eq test port any result gateway flow rule entity result j s o n object parse object mvc result get response get content as string new type reference result gateway flow rule entity assert true result be success gateway flow rule entity entity result get datum assert not null entity assert equal resource mode route id entity get resource mode int value assert equal httpbin route entity get resource assert equal 6 d entity get count double value assert equal 2 l entity get interval long value assert equal gateway flow rule entity interval unit minute entity get interval unit int value assert equal control behavior rate limiter entity get control behavior int value assert equal entity get burst int value assert equal entity get max queueing timeout ms int value assert equal date entity get gmt create to make sure gmt modify have be set and it be different from gmt create assert not null entity get gmt modify assert not equal entity get gmt create entity get gmt modify verify the entity which be update in memory repository gateway param flow item entity item entity entity get param item assert equal param parse strategy url param item entity get parse strategy int value assert equal pa item entity get field name test public void test delete flow rule throw exception string path gateway flow delete json add one entity into memory repository for delete gateway flow rule entity add entity new gateway flow rule entity add entity set id 1 l add entity set app test app add entity set ip test ip add entity set port test port add entity set resource httpbin route add entity set resource mode resource mode route id add entity set grade flow grade qp add entity set count 5 d add entity set interval 30 l add entity set interval unit gateway flow rule entity interval unit second add entity set control behavior control behavior default add entity set burst add entity set max queue timeout ms date date new date date date util add seconds date add entity set gmt create date add entity set gmt modify date gateway param flow item entity add item entity new gateway param flow item entity add entity set param item add item entity add item entity set parse strategy param parse strategy client ip repository save add entity give sentinel api client modify gateway flow rule eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder param id string value of add entity get id do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify gateway flow rule method have be call verify sentinel api client modify gateway flow rule eq test app eq test ip eq test port any verify the result result long result j s o n object parse object mvc result get response get content as string new type reference result long assert true result be success assert equal add entity get id result get datum now no entity in memory list gateway flow rule entity entity in mem repository find all by app test app assert equal entity in mem size 
