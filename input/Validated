commit controller validate rest controller public class commit controller private final commit service commit service private final permission validator permission validator public commit controller final commit service commit service final permission validator permission validator this commit service commit service this permission validator permission validator get mapping app app id env env cluster cluster name namespace namespace name commit public list commit d t o find path variable string app id path variable string env path variable string cluster name path variable string namespace name valid positive or zero message page should be positive or request param default value int page valid positive message size should be positive number request param default value int size if permission validator should hide config to current user app id env namespace name return collection empty list return commit service find app id env value of env cluster name namespace name page size 
release controller validate rest controller public class release controller private final release service release service private final application event publisher publisher private final portal config portal config private final permission validator permission validator private final user info holder user info holder public release controller final release service release service final application event publisher publisher final portal config portal config final permission validator permission validator final user info holder user info holder this release service release service this publisher publisher this portal config portal config this permission validator permission validator this user info holder user info holder pre authorize value permission validator have release namespace permission app id namespace name env post mapping value app app id env env cluster cluster name namespace namespace name release public release d t o create release path variable string app id path variable string env path variable string cluster name path variable string namespace name request body namespace release model model model set app id app id model set env env model set cluster name cluster name model set namespace name namespace name if model be emergency publish portal config be emergency publish allow env value of env throw new bad request exception string format env s be not support emergency publish now env release d t o create release release service publish model config publish event event config publish event instance event with app id app id with cluster cluster name with namespace namespace name with release id create release get id set normal publish event true set env env value of env publisher publish event event return create release pre authorize value permission validator have release namespace permission app id namespace name env post mapping value app app id env env cluster cluster name namespace namespace name branch branch name release public release d t o create gray release path variable string app id path variable string env path variable string cluster name path variable string namespace name path variable string branch name request body namespace release model model model set app id app id model set env env model set cluster name branch name model set namespace name namespace name if model be emergency publish portal config be emergency publish allow env value of env throw new bad request exception string format env s be not support emergency publish now env release d t o create release release service publish model config publish event event config publish event instance event with app id app id with cluster cluster name with namespace namespace name with release id create release get id set gray publish event true set env env value of env publisher publish event event return create release get map value app app id env env cluster cluster name namespace namespace name release all public list release b o find all release path variable string app id path variable string env path variable string cluster name path variable string namespace name valid positive or zero message page should be positive or request param default value int page valid positive message size should be positive number request param default value int size if permission validator should hide config to current user app id env namespace name return collection empty list return release service find all release app id env value of env cluster name namespace name page size get map value app app id env env cluster cluster name namespace namespace name release active public list release d t o find active release path variable string app id path variable string env path variable string cluster name path variable string namespace name valid positive or zero message page should be positive or request param default value int page valid positive message size should be positive number request param default value int size if permission validator should hide config to current user app id env namespace name return collection empty list return release service find active release app id env value of env cluster name namespace name page size get mapping value env env release compare public release compare result compare release path variable string env request param long base release id request param long to compare release id return release service compare env value of env base release id to compare release id put map path env env release release id rollback public void rollback path variable string env path variable long release id release d t o release release service find release by id env value of env release id if release null throw new not find exception release not find if permission validator have release namespace permission release get app id release get namespace name env throw new access deny exception access be deny release service rollback env value of env release id user info holder get user get user id config publish event event config publish event instance event with app id release get app id with cluster release get cluster name with namespace release get namespace name with previous release id release id set rollback event true set env env value of env publisher publish event event 
