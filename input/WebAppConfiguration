abstract spring mvc test web app configuration run with spring j unit4 class runner class context configuration location classpath spring xml public class abstract spring mvc test autowire private web application context application context protect mock mvc mock mvc before public void setup this mock mvc mock mvc builder web app context setup this application context build 
health controller unit test run with spring j unit4 class runner class context configuration class mock servlet context class web app configuration public class health controller unit test inject mock health controller health controller mock datum source service datum source service private mock mvc mockmvc before public void set up throw exception mockmvc mock mvc builder standalone setup health controller build test public void test get health throw exception mockito when datum source service get health then return up mock http servlet request builder builder mock mvc request builder get constant health controller path string actual value mockmvc perform builder and return get response get content as string assert assert equal up actual value 
aggr whitelist test run with spring j unit4 class runner class web app configuration public class aggr whitelist test aggr whitelist service before public void before throw exception service new aggr whitelist test public void test be aggr datum id list string list new array list string list add com taobao jiuren list add ns nacos subscription topic list add com taobao tae app list on grid aggr whitelist compile list assert false aggr whitelist be aggr datum id com abc assert false aggr whitelist be aggr datum id com taobao jiuren assert false aggr whitelist be aggr datum id com taobao jiuren a b c assert true aggr whitelist be aggr datum id com taobao jiuren abc assert true aggr whitelist be aggr datum id n naco subscription topic abc assert true aggr whitelist be aggr datum id com taobao tae app list on grid abc 
client track service test run with spring j unit4 class runner class web app configuration public class client track service test before public void before client track service client record clear test public void test track client md5 string client ip 1.1 1.1 string datum id com taobao session xml string group online string group key group key2 get key datum id group string md5 xxxxxxxxxxxxx config cache service update md5 group key md5 system current time millis client track service track client md5 client ip group key md5 client track service track client md5 client ip group key md5 assert assert equal true client track service be client uptodate client ip get group key assert assert equal client track service subscribe client count assert assert equal client track service subscriber count config cache service update md5 group key md5 system current time milli assert assert equal false client track service be client uptodate client ip get group key 
disk service unit test run with spring j unit4 class runner class web app configuration public class disk service unit test private disk util disk service private file temp file private string path before public void set up throw i o exception this temp file file create temp file disk service test tmp this path temp file get parent this disk service new disk util test public void test create config throw i o exception disk util save to disk test datum id test group test tenant test content string content disk util get config test datum id test group test tenant assert equal content test content after public void tear down throw i o exception temp file delete 
dump service test run with spring j unit4 class runner class spring boot test web app configuration public class dump service test autowire dump service service test public void init throw throwable service init 
group key test run with spring j unit4 class runner class web app configuration public class group key test rule public final expect exception throw expect exception none test public void test parse invalid group key string key 11111 +222Â 333333 +444 try group key2 parse key key assert fail catch illegal argument exception e system out println e to string key try group key2 parse key key assert fail catch illegal argument exception e system out println e to string key 11111 % 29 try group key2 parse key key assert fail catch illegal argument exception e system out println e to string key 11111 % 2 b try group key2 parse key key assert fail catch illegal argument exception e system out println e to string key 11111 % 25 string pair group key2 parse key key assert assert equal pair assert assert equal pair test public void test get key by three param act final string actual group key get key assert result assert assert equal actual test public void test get key by two param act final string actual group key get key assert result assert assert equal actual test public void test get key tenant by plus three param act final string actual group key get key tenant assert result assert assert equal 3 +1 actual test public void test get key tenant by percent three param act final string actual group key get key tenant u0000 u0000 null assert result assert assert equal u0000 u0000 25 % 2 b actual test public void test parse key by single character act final string actual group key parse key assert result assert assert array equal new string null null actual test public void test parse key for plus illegal argument exception act throw expect illegal argument exception class group key parse key method be not expect to return due to exception throw test public void test parse key for percent illegal argument exception act throw expect illegal argument exception class group key parse key u0000 method be not expect to return due to exception throw test public void test parse key for invalid string index out of bound exception act throw expect string index out of bound exception class group key parse key method be not expect to return due to exception throw test public void test url encode plus arrange final string builder sb new string builder act group key url encode sb assert side effect assert assert not null sb assert assert equal 2 b sb to string test public void test url encode by percent arrange final string builder sb new string builder act group key url encode sb assert side effect assert assert not null sb assert assert equal sb to string test public void test url encode for null string builder act throw expect null pointer exception class group key url encode null method be not expect to return due to exception throw 
simple read write lock test run with spring j unit4 class runner class web app configuration public class simple read write lock test test public void test double read lock by all release and write lock simple read write lock lock new simple read write lock assert true lock try read lock assert true lock try read lock lock release read lock lock release read lock assert true lock try write lock test public void test add write lock simple read write lock lock new simple read write lock assert true lock try write lock lock release write lock test public void test double write lock simple read write lock lock new simple read write lock assert true lock try write lock assert false lock try write lock test public void test first read lock then write lock simple read write lock lock new simple read write lock assert true lock try read lock assert false lock try write lock test public void test double read lock and one release one fail simple read write lock lock new simple read write lock assert true lock try read lock assert true lock try read lock lock release read lock assert false lock try write lock 
health controller test run with spring j unit4 class runner class context configuration class mock servlet context class web app configuration public class health controller test inject mock private health controller health controller mock private persist service persist service mock private operator controller api command private mock mvc mockmvc before public void set up mockmvc mock mvc builder standalone setup health controller build test public void test liveness throw exception string url v1 console health liveness mock http servlet request builder builder mock mvc request builder get url assert assert equal mockmvc perform builder and return get response get status test public void test readiness throw exception string url v1 console health readiness mockito when persist service config info count any string class then return mockito when api command metric any http servlet request class then return jackson util create empty json node mock http servlet request builder builder mock mvc request builder get url assert assert equal mockmvc perform builder and return get response get status config and naming be not in readiness mockito when persist service config info count any string class then throw new runtime exception health controller test test readiness mockito when api command metric any http servlet request class then throw new runtime exception health controller test test readiness builder mock mvc request builder get url mock http servlet response response mockmvc perform builder and return get response assert assert equal response get status assert assert equal config and naming be not in readiness response get content as string config be not in readiness mockito when persist service config info count any string class then throw new runtime exception health controller test test readiness mockito when api command metric any http servlet request class then return jackson util create empty json node response mockmvc perform builder and return get response assert assert equal response get status assert assert equal config be not in readiness response get content as string naming be not in readiness mockito when persist service config info count any string class then return mockito when api command metric any http servlet request class then throw new runtime exception health controller test test readiness builder mock mvc request builder get url response mockmvc perform builder and return get response assert assert equal response get status assert assert equal naming be not in readiness response get content as string 
cluster controller test run with spring j unit4 class runner class context configuration class mock servlet context class web app configuration public class cluster controller test extend base test inject mock private cluster controller cluster controller private mock mvc mockmvc before public void before super before mockmvc mock mvc builder standalone setup cluster controller build test public void test update throw exception service service new service test service name service set namespace id test namespace when service manager get service constant default namespace id test service name then return service mock http servlet request builder builder mock mvc request builder put util and common naco name context cluster param cluster name test cluster name param service name test service name param health checker type http param check port param use instance port4 check true assert assert equal ok mockmvc perform builder and return get response get content as string cluster expect cluster new cluster test cluster name service cluster actual cluster service get cluster map get test cluster name assert assert equal expect cluster actual cluster assert assert equal actual cluster get def ckport assert assert true actual cluster be use i p port4 check test public void test update no service throw exception expect exception expect cause be a nacos exception class expect exception expect message service not find test service not find mock http servlet request builder builder mock mvc request builder put util and common naco name context cluster param cluster name test cluster name param service name test service not find param health checker type http param check port param use instance port4 check true mockmvc perform builder test public void test update invalid type throw exception expect exception expect cause be a nacos exception class expect exception expect message unknown health check type type service service new service test service name service set namespace id constant default namespace id when service manager get service constant default namespace id test service name then return service mock http servlet request builder builder mock mvc request builder put util and common naco name context cluster param cluster name test cluster name param service name test service name param health checker type param check port param use instance port4 check true mockmvc perform builder 
instance controller test run with spring j unit4 class runner class context configuration class mock servlet context class web app configuration public class instance controller test extend base test inject mock private instance controller instance controller mock private raft peer set peer set private mock mvc mockmvc before public void before super before mockmvc mock mvc builder standalone setup instance controller build test public void register instance throw exception service service new service service set name test service name cluster cluster new cluster util and common default cluster name service service add cluster cluster instance instance new instance instance set ip 1.1 1.1 instance set port list instance ip list new array list ip list add instance service update i ps ip list false mockito when service manager get service constant default namespace id test service name then return service mock http servlet request builder builder mock mvc request builder put util and common naco name context instance param service name test service name param ip 1.1 1.1 param port string actual value mockmvc perform builder and return get response get content as string assert assert equal ok actual value test public void deregister instance throw exception mock http servlet request builder builder mock mvc request builder delete util and common naco name context instance param service name test service name param ip 1.1 1.1 param port param cluster name util and common default cluster name string actual value mockmvc perform builder and return get response get content as string assert assert equal ok actual value test public void get instance throw exception service service new service service set name test service name cluster cluster new cluster util and common default cluster name service service add cluster cluster instance instance new instance instance set ip 10.10 10.10 instance set port instance set weight 2.0 instance set service name test service name list instance ip list new array list ip list add instance service update i ps ip list false mockito when service manager get service constant default namespace id test service name then return service mock http servlet request builder builder mock mvc request builder get util and common naco name context instance list param service name test service name mock http servlet response response mockmvc perform builder and return get response string actual value response get content as string json node result jackson util to obj actual value assert assert equal test service name result get name as text json node host result get host assert assert not null host assert assert equal host size json node host host get assert assert not null host assert assert equal 10.10 10.10 host get ip as text assert assert equal host get port as int assert assert equal 2.0 host get weight as double 0.001 test public void get null service instance throw exception mockito when service manager get service constant default namespace id test service name then return null mock http servlet request builder builder mock mvc request builder get util and common naco name context instance list param service name test service name mock http servlet response response mockmvc perform builder and return get response string actual value response get content as string json node result jackson util to obj actual value json node host result get host assert assert equal host size 
push service test run with spring j unit4 class runner class context configuration class mock servlet context class web app configuration public class push service test extend base test inject mock private push service push service before public void before super before test public void test get client fuzzy throw exception string namespace id public string cluster default string agent naco java client v1 1.4 string client ip localhost string app naco int udp port string hello service name hello group name hello service name int hello udp port string test service name test group name test service name int test udp port push service add client namespace id hello service name cluster agent new inet socket address client ip hello udp port null namespace id app push service add client namespace id test service name cluster agent new inet socket address client ip test udp port null namespace id app list subscriber fuzzylist push service get client fuzzy hello hello public assert assert equal fuzzylist size assert assert equal fuzzylist get get service name hello group name hello service name list subscriber list push service get client fuzzy hello group name hello service name public assert assert equal list size assert assert equal list get get service name hello group name hello service name list subscriber no datum list push service get client fuzzy bad group name bad service name public assert assert equal no datum list size 
