sy menu service impl transactional rollback for exception class override public void set menu to role long role id set long menu id role menu service delete role id null if collection util be empty menu id list sy role menu role menu new array list menu id size menu id for each menu id role menu add new sy role menu role id menu id role menu service save batch role menu 
sy role service impl transactional rollback for exception class override public void save role sy role sy role throw exception string role code sy role get code super save idempotency sy role lock lock key rolecode role code new query wrapper sy role eq code role code code 
sy role service impl transactional rollback for exception class override public void delete role long id base mapper delete by id id role menu mapper delete id null user role mapper delete user role null id 
sy role service impl override transactional public result save or update role sy role sy role throw exception if sy role get id null this save role sy role else base mapper update by id sy role return result succeed 
sy user service impl transactional rollback for exception class override public void set role to user long id set long role id sy user sy user base mapper select by id id if sy user null throw new illegal argument exception role user service delete user role id null if collection util be empty role id list sy role user role user new array list role id size role id for each role id role user add new sy role user id role id role user service save batch role user 
sy user service impl transactional override public result update password long id string old password string new password sy user sy user base mapper select by id id if str util be not blank old password if password encoder match old password sy user get password return result fail if str util be blank new password new password common constant def user password sy user user new sy user user set id id user set password password encoder encode new password base mapper update by id user return result succeed 
sy user service impl transactional rollback for exception class override public result save or update user sy user sy user throw exception if sy user get id null if string util be blank sy user get type sy user set type user type backend name sy user set password password encoder encode common constant def user password sy user set enable boolean true string username sy user get username boolean result super save or update idempotency sy user lock lock key username username new query wrapper sy user eq username username username if result str util be not empty sy user get role id role user service delete user role sy user get id null list role id array as list sy user get role id split if collection util be empty role id list sy role user role user new array list role id size role id for each role id role user add new sy role user sy user get id long parse long role id to string role user service save batch role user return result result succeed sy user result fail 
sy user service impl transactional rollback for exception class override public boolean del user long id role user service delete user role id null return base mapper delete by id id 
sy user controller test test transactional public void when delete success throw exception mock mvc perform delete user header x userid header header x user header admin header x tenant header web app content type media type application json u t f8 and expect status be ok 
sy user controller test test transactional public void when save or update success throw exception string content id username admin role id 1,2 mock mvc perform post user save or update header x userid header header x user header admin header x tenant header web app content type media type application json u t f8 content content and expect status be ok 
sy user controller test test transactional public void when update success throw exception string content id username admin role id 1,2 mock mvc perform put user header x userid header header x user header admin header x tenant header web app content type media type application json u t f8 content content and expect status be ok 
demo service impl lcn transaction transactional rollback for exception class override public string execute string value string ex flag string flag string d resp service b client rpc value step2 call remote service b string e resp service c client rpc value step3 execute local transaction demo demo new demo demo set group id trace context trace group id demo set demo field value demo set create time new date demo set app name transaction get application id demo mapper save demo dtx if object non null ex flag throw new illegal state exception by ex flag return d resp e resp ok service a 
demo service impl override lcn transaction transactional rollback for exception class public string rpc string value demo demo new demo demo set group id trace context trace group id demo set demo field value demo set app name transaction get application id demo set create time new date demo mapper save demo return ok service b 
demo service impl override lcn transaction transactional rollback for exception class public string rpc string value demo demo new demo demo set demo field value demo set create time new date demo set app name transaction get application id demo set group id trace context trace group id demo mapper save demo if equal value throw new illegal state exception by test return ok service c 
namespace branch controller transactional put mapping app app id cluster cluster name namespace namespace name branch branch name rule public void update branch gray rule path variable string app id path variable string cluster name path variable string namespace name path variable string branch name request body gray release rule d t o new rule dto check branch app id cluster name namespace name branch name gray release rule new rule bean util transform gray release rule class new rule dto new rule set rule gray release rule item transformer batch transform to j s o n new rule dto get rule item new rule set branch status namespace branch status active namespace branch service update branch gray rule app id cluster name namespace name branch name new rule message sender send message release message key generator generate app id cluster name namespace name topic apollo release topic 
namespace branch controller transactional delete mapping app app id cluster cluster name namespace namespace name branch branch name public void delete branch path variable string app id path variable string cluster name path variable string namespace name path variable string branch name request param operator string operator check branch app id cluster name namespace name branch name namespace branch service delete branch app id cluster name namespace name branch name namespace branch status delete operator message sender send message release message key generator generate app id cluster name namespace name topic apollo release topic 
release controller transactional post mapping app app id cluster cluster name namespace namespace name release public release d t o publish path variable app id string app id path variable cluster name string cluster name path variable namespace name string namespace name request param name string release name request param name comment require false string release comment request param operator string operator request param name be emergency publish default value false boolean be emergency publish namespace namespace namespace service find one app id cluster name namespace name if namespace null throw new not find exception string format could not find namespace for s s s app id cluster name namespace name release release release service publish namespace release name release comment operator be emergency publish send release message namespace parent namespace namespace service find parent namespace namespace string message cluster if parent namespace null message cluster parent namespace get cluster name else message cluster cluster name message sender send message release message key generator generate app id message cluster namespace name topic apollo release topic return bean util transform release d t o class release 
release controller transactional post mapping app app id cluster cluster name namespace namespace name update and publish public release d t o update and publish path variable app id string app id path variable cluster name string cluster name path variable namespace name string namespace name request param release name string release name request param branch name string branch name request param value delete branch default value true boolean delete branch request param name release comment require false string release comment request param name be emergency publish default value false boolean be emergency publish request body item change set change set namespace namespace namespace service find one app id cluster name namespace name if namespace null throw new not find exception string format could not find namespace for s s s app id cluster name namespace name release release release service merge branch change set and release namespace branch name release name release comment be emergency publish change set if delete branch namespace branch service delete branch app id cluster name namespace name branch name namespace branch status merge change set get datum change last modify by message sender send message release message key generator generate app id cluster name namespace name topic apollo release topic return bean util transform release d t o class release 
release controller transactional put mapping release release id rollback public void rollback path variable release id long release id request param operator string operator release release release service rollback release id operator string app id release get app id string cluster name release get cluster name string namespace name release get namespace name send release message message sender send message release message key generator generate app id cluster name namespace name topic apollo release topic 
release controller transactional post mapping app app id cluster cluster name namespace namespace name gray del release public release d t o publish path variable app id string app id path variable cluster name string cluster name path variable namespace name string namespace name request param operator string operator request param release name string release name request param name comment require false string release comment request param name be emergency publish default value false boolean be emergency publish request param name gray del key set string gray del key namespace namespace namespace service find one app id cluster name namespace name if namespace null throw new not find exception string format could not find namespace for s s s app id cluster name namespace name release release release service gray deletion publish namespace release name release comment operator be emergency publish gray del key send release message namespace parent namespace namespace service find parent namespace namespace string message cluster if parent namespace null message cluster parent namespace get cluster name else message cluster cluster name message sender send message release message key generator generate app id message cluster namespace name topic apollo release topic return bean util transform release d t o class release 
database message sender override transactional public void send message string message string channel logger info send message to channel message channel if object equal channel topic apollo release topic logger warn channel not support by database message sender return tracer log event apollo admin service release message message transaction transaction tracer new transaction apollo admin service send message try release message new message release message repository save new release message message to clean offer new message get id transaction set status transaction success catch throwable ex logger error send message to database fail ex transaction set status ex throw ex finally transaction complete 
access key service transactional public access key create string app id access key entity long count access key repository count by app id app id if count accesskey count limit throw new bad request exception access key count limit exceed entity set id 0 l entity set app id app id entity set datum change last modify by entity get datum change create by access key access key access key repository save entity audit service audit access key class get simple name access key get id audit op insert access key get datum change create by return access key 
access key service transactional public access key update string app id access key entity long id entity get id string operator entity get datum change last modify by access key access key access key repository find one by app id and id app id id if access key null throw new bad request exception access key not exist access key set enable entity be enable access key set datum change last modify by operator access key repository save access key audit service audit access key class get simple name id audit op update operator return access key 
access key service transactional public void delete string app id long id string operator access key access key access key repository find one by app id and id app id id if access key null throw new bad request exception access key not exist if access key be enable throw new bad request exception access key should disable first access key set delete boolean true access key set datum change last modify by operator access key repository save access key audit service audit access key class get simple name id audit op delete operator 
admin service transactional public app create new app app app string create by app get datum change create by app create app app service save app string app id create app get app id app namespace service create default app namespace app id create by cluster service create default cluster app id create by namespace service instance of app namespace app id config const cluster name default create by return app 
admin service transactional public void delete app app app string operator string app id app get app id logger info be delete app operator app id list cluster manage cluster cluster service find parent cluster app id delete cluster if object non null manage cluster for cluster cluster manage cluster cluster service delete cluster get id operator delete app namespace app namespace service batch delete app id operator delete app app service delete app get id operator 
app namespace service transactional public void create default app namespace string app id string create by if be app namespace name unique app id config const namespace application throw new service exception appnamespace not unique app namespace app n new app namespace app n set app id app id app n set name config const namespace application app n set comment default app namespace app n set format config file format property get value app n set datum change create by create by app n set datum change last modify by create by app namespace repository save app n audit service audit app namespace class get simple name app n get id audit op insert create by 
app namespace service transactional public app namespace create app namespace app namespace app namespace string create by app namespace get datum change create by if be app namespace name unique app namespace get app id app namespace get name throw new service exception appnamespace not unique app namespace set id protection app namespace set datum change create by create by app namespace set datum change last modify by create by app namespace app namespace repository save app namespace create namespace for app namespace in all cluster app namespace get app id app namespace get name create by audit service audit app namespace class get simple name app namespace get id audit op insert create by return app namespace 
app namespace service transactional public void batch delete string app id string operator app namespace repository batch delete by app id app id operator 
app namespace service transactional public void delete app namespace app namespace app namespace string operator string app id app namespace get app id string namespace name app namespace get name logger info be delete app namespace app id namespace operator app id namespace name delete namespace list namespace namespace namespace service find by app id and namespace name app id namespace name if namespace null for namespace namespace namespace namespace service delete namespace namespace operator delete app namespace app namespace repository delete app id namespace name operator 
app service transactional public void delete long id string operator app app app repository find by id id or else null if app null return app set delete true app set datum change last modify by operator app repository save app audit service audit app class get simple name id audit op delete operator 
app service transactional public app save app entity if be app id unique entity get app id throw new service exception app id not unique entity set id protection app app app repository save entity audit service audit app class get simple name app get id audit op insert app get datum change create by return app 
app service transactional public void update app app string app id app get app id app manage app app repository find by app id app id if manage app null throw new bad request exception string format app not exist app id s app id manage app set name app get name manage app set org id app get org id manage app set org name app get org name manage app set owner name app get owner name manage app set owner email app get owner email manage app set datum change last modify by app get datum change last modify by manage app app repository save manage app audit service audit app class get simple name manage app get id audit op update manage app get datum change last modify by 
audit service transactional void audit string entity name long entity id audit op op string owner audit audit new audit audit set entity name entity name audit set entity id entity id audit set op name op name audit set datum change create by owner audit repository save audit 
audit service transactional void audit audit audit audit repository save audit 
cluster service transactional public cluster save with instance of app namespace cluster entity cluster save cluster save without instance of app namespace entity namespace service instance of app namespace save cluster get app id save cluster get name save cluster get datum change create by return save cluster 
cluster service transactional public cluster save without instance of app namespace cluster entity if be cluster name unique entity get app id entity get name throw new bad request exception cluster not unique entity set id protection cluster cluster cluster repository save entity audit service audit cluster class get simple name cluster get id audit op insert cluster get datum change create by return cluster 
cluster service transactional public void delete long id string operator cluster cluster cluster repository find by id id or else null if cluster null throw new bad request exception cluster not exist delete link namespace namespace service delete by app id and cluster name cluster get app id cluster get name operator cluster set delete true cluster set datum change last modify by operator cluster repository save cluster audit service audit cluster class get simple name id audit op delete operator 
cluster service transactional public cluster update cluster cluster cluster manage cluster cluster repository find by app id and name cluster get app id cluster get name bean util copy entity property cluster manage cluster manage cluster cluster repository save manage cluster audit service audit cluster class get simple name manage cluster get id audit op update manage cluster get datum change last modify by return manage cluster 
cluster service transactional public void create default cluster string app id string create by if be cluster name unique app id config const cluster name default throw new service exception cluster not unique cluster cluster new cluster cluster set name config const cluster name default cluster set app id app id cluster set datum change create by create by cluster set datum change last modify by create by cluster repository save cluster audit service audit cluster class get simple name cluster get id audit op insert create by 
commit service transactional public commit save commit commit commit set id protection return commit repository save commit 
commit service transactional public int batch delete string app id string cluster name string namespace name string operator return commit repository batch delete app id cluster name namespace name operator 
instance service transactional public instance create instance instance instance instance set id protection return instance repository save instance 
instance service transactional public instance config create instance config instance config instance config instance config set id protection return instance config repository save instance config 
instance service transactional public instance config update instance config instance config instance config instance config exist instance config instance config repository find by id instance config get id or else null precondition check argument exist instance config null string format instance config d doesn t exist instance config get id exist instance config set config cluster name instance config get config cluster name exist instance config set release key instance config get release key exist instance config set release delivery time instance config get release delivery time exist instance config set datum change last modify time instance config get datum change last modify time return instance config repository save exist instance config 
instance service transactional public int batch delete instance config string config app id string config cluster name string config namespace name return instance config repository batch delete config app id config cluster name config namespace name 
item service transactional public item delete long id string operator item item item repository find by id id or else null if item null throw new illegal argument exception item not exist id id item set delete true item set datum change last modify by operator item delete item item repository save item audit service audit item class get simple name id audit op delete operator return delete item 
item service transactional public int batch delete long namespace id string operator return item repository delete by namespace id namespace id operator 
item service transactional public item save item entity check item key length entity get key check item value length entity get namespace id entity get value entity set id protection if entity get line num item last item find last one entity get namespace id int line num last item null last item get line num entity set line num line num item item item repository save entity audit service audit item class get simple name item get id audit op insert item get datum change create by return item 
item service transactional public item update item item check item value length item get namespace id item get value item manage item item repository find by id item get id or else null bean util copy entity property item manage item manage item item repository save manage item audit service audit item class get simple name manage item get id audit op update manage item get datum change last modify by return manage item 
item set service transactional public item change set update set namespace namespace item change set change set return update set namespace get app id namespace get cluster name namespace get namespace name change set 
item set service transactional public item change set update set string app id string cluster name string namespace name item change set change set string operator change set get datum change last modify by config change content builder config change content builder new config change content builder if collection util be empty change set get create item for item d t o item change set get create item item entity bean util transform item class item entity set datum change create by operator entity set datum change last modify by operator item create item item service save entity config change content builder create item create item audit service audit item set null audit op insert operator if collection util be empty change set get update item for item d t o item change set get update item item entity bean util transform item class item item manage item item service find one entity get id if manage item null throw new not find exception string format item not find key s entity get key item before update item bean util transform item class manage item protect only value comment last modify by line num can be modify manage item set value entity get value manage item set comment entity get comment manage item set line num entity get line num manage item set datum change last modify by operator item update item item service update manage item config change content builder update item before update item update item audit service audit item set null audit op update operator if collection util be empty change set get delete item for item d t o item change set get delete item item delete item item service delete item get id operator config change content builder delete item delete item audit service audit item set null audit op delete operator if config change content builder have content create commit app id cluster name namespace name config change content builder build change set get datum change last modify by return change set 
namespace branch service transactional public namespace create branch string app id string parent cluster name string namespace name string operator namespace child namespace find branch app id parent cluster name namespace name if child namespace null throw new bad request exception namespace already have branch cluster parent cluster cluster service find one app id parent cluster name if parent cluster null parent cluster get parent cluster id throw new bad request exception cluster not exist or illegal cluster create child cluster cluster child cluster create child cluster app id parent cluster namespace name operator cluster create child cluster cluster service save without instance of app namespace child cluster create child namespace child namespace create namespace branch app id create child cluster get name namespace name operator return namespace service save child namespace 
namespace branch service transactional public void update branch gray rule string app id string cluster name string namespace name string branch name gray release rule new rule do update branch gray rule app id cluster name namespace name branch name new rule true release operation apply gray rule 
namespace branch service transactional public gray release rule update rule release id string app id string cluster name string namespace name string branch name long latest release id string operator gray release rule old rule gray release rule repository find top by app id and cluster name and namespace name and branch name order by id desc app id cluster name namespace name branch name if old rule null return null gray release rule new rule new gray release rule new rule set branch status namespace branch status active new rule set release id latest release id new rule set rule old rule get rule new rule set app id old rule get app id new rule set cluster name old rule get cluster name new rule set namespace name old rule get namespace name new rule set branch name old rule get branch name new rule set datum change create by operator new rule set datum change last modify by operator gray release rule repository save new rule gray release rule repository delete old rule return new rule 
namespace branch service transactional public void delete branch string app id string cluster name string namespace name string branch name int branch status string operator cluster to delete cluster cluster service find one app id branch name if to delete cluster null return release latest branch release release service find latest active release app id branch name namespace name long latest branch release id latest branch release null latest branch release get id update branch rule gray release rule delete rule new gray release rule delete rule set rule delete rule set app id app id delete rule set cluster name cluster name delete rule set namespace name namespace name delete rule set branch name branch name delete rule set branch status branch status delete rule set datum change last modify by operator delete rule set datum change create by operator do update branch gray rule app id cluster name namespace name branch name delete rule false delete branch cluster cluster service delete to delete cluster get id operator int release operation branch status namespace branch status merge release operation gray release delete after merge release operation abandon gray release release history service create release history app id cluster name namespace name branch name latest branch release id latest branch release id release operation null operator audit service audit branch to delete cluster get id audit op delete operator 
namespace lock service transactional public namespace lock try lock namespace lock lock return namespace lock repository save lock 
namespace lock service transactional public void unlock long namespace id namespace lock repository delete by namespace id namespace id 
namespace service transactional public void delete by app id and cluster name string app id string cluster name string operator list namespace to delete namespace find namespace app id cluster name for namespace namespace to delete namespace delete namespace namespace operator 
namespace service transactional public namespace delete namespace namespace namespace string operator string app id namespace get app id string cluster name namespace get cluster name string namespace name namespace get namespace name item service batch delete namespace get id operator commit service batch delete app id cluster name namespace get namespace name operator child namespace release should retain as long as the parent namespace exist because parent namespace release history need they if be child namespace namespace release service batch delete app id cluster name namespace get namespace name operator delete child namespace namespace child namespace find child namespace namespace if child namespace null namespace branch service delete branch app id cluster name namespace name child namespace get cluster name namespace branch status delete operator delete child namespace s release notice delete child namespace will not delete child namespace s release release service batch delete app id child namespace get cluster name namespace name operator release history service batch delete app id cluster name namespace name operator instance service batch delete instance config app id cluster name namespace name namespace lock service unlock namespace get id namespace set delete true namespace set datum change last modify by operator audit service audit namespace class get simple name namespace get id audit op delete operator namespace delete namespace repository save namespace publish release message to do some clean up in config service such as update the cache message sender send message release message key generator generate app id cluster name namespace name topic apollo release topic return delete 
namespace service transactional public namespace save namespace entity if be namespace unique entity get app id entity get cluster name entity get namespace name throw new service exception namespace not unique entity set id protection namespace namespace namespace repository save entity audit service audit namespace class get simple name namespace get id audit op insert namespace get datum change create by return namespace 
namespace service transactional public namespace update namespace namespace namespace manage namespace namespace repository find by app id and cluster name and namespace name namespace get app id namespace get cluster name namespace get namespace name bean util copy entity property namespace manage namespace manage namespace namespace repository save manage namespace audit service audit namespace class get simple name manage namespace get id audit op update manage namespace get datum change last modify by return manage namespace 
namespace service transactional public void instance of app namespace string app id string cluster name string create by list app namespace app namespace app namespace service find by app id app id for app namespace app namespace app namespace namespace n new namespace n set app id app id n set cluster name cluster name n set namespace name app namespace get name n set datum change create by create by n set datum change last modify by create by namespace repository save n audit service audit namespace class get simple name n get id audit op insert create by 
release history service transactional public release history create release history string app id string cluster name string namespace name string branch name long release id long previous release id int operation map string object operation context string operator release history release history new release history release history set app id app id release history set cluster name cluster name release history set namespace name namespace name release history set branch name branch name release history set release id release id release history set previous release id previous release id release history set operation operation if operation context null release history set operation context default empty object else release history set operation context gson to json operation context release history set datum change create time new date release history set datum change create by operator release history set datum change last modify by operator release history repository save release history audit service audit release history class get simple name release history get id audit op insert release history get datum change create by return release history 
release history service transactional public int batch delete string app id string cluster name string namespace name string operator return release history repository batch delete app id cluster name namespace name operator 
release service transactional public release merge branch change set and release namespace namespace string branch name string release name string release comment boolean be emergency publish item change set change set check lock namespace be emergency publish change set get datum change last modify by item set service update set namespace change set release branch release find latest active release namespace get app id branch name namespace get namespace name long branch release id branch release null branch release get id map string string operate namespace item get namespace item namespace map string object operation context map new link hash map operation context put release operation context source branch branch name operation context put release operation context base release id branch release id operation context put release operation context be emergency publish be emergency publish return master release namespace release name release comment operate namespace item change set get datum change last modify by release operation gray release merge to master operation context 
release service transactional public release publish namespace namespace string release name string release comment string operator boolean be emergency publish check lock namespace be emergency publish operator map string string operate namespace item get namespace item namespace namespace parent namespace namespace service find parent namespace namespace branch release if parent namespace null return publish branch namespace parent namespace namespace operate namespace item release name release comment operator be emergency publish namespace child namespace namespace service find child namespace namespace release previous release null if child namespace null previous release find latest active release namespace master release map string object operation context map new link hash map operation context put release operation context be emergency publish be emergency publish release release master release namespace release name release comment operate namespace item operator release operation normal release operation context merge to branch and auto release if child namespace null merge from master and publish branch namespace child namespace operate namespace item release name release comment operator previous release release be emergency publish return release 
release service transactional public release gray deletion publish namespace namespace string release name string release comment string operator boolean be emergency publish set string gray del key check lock namespace be emergency publish operator map string string operate namespace item get namespace item namespace namespace parent namespace namespace service find parent namespace namespace branch release if parent namespace null return publish branch namespace parent namespace namespace operate namespace item release name release comment operator be emergency publish gray del key throw new not find exception parent namespace not find 
release service transactional public release rollback long release id string operator release release find one release id if release null throw new not find exception release not find if release be abandon throw new bad request exception release be not active string app id release get app id string cluster name release get cluster name string namespace name release get namespace name page request page page request of list release two latest active release find active release app id cluster name namespace name page if two latest active release null two latest active release size throw new bad request exception string format can t rollback namespace app id s cluster name s namespace name s because there be only one active release app id cluster name namespace name release set abandon true release set datum change last modify by operator release repository save release release history service create release history app id cluster name namespace name cluster name two latest active release get get id release get id release operation rollback null operator publish child namespace if namespace have child rollback child namespace app id cluster name namespace name two latest active release operator return release 
release service transactional public int batch delete string app id string cluster name string namespace name string operator return release repository batch delete app id cluster name namespace name operator 
abstract integration test run with spring j unit4 class runner class rollback transactional spring boot test class biz test configuration class web environment web environment random port public abstract class abstract integration test 
consumer service transactional public list consumer role assign namespace role to consumer string token string app id string namespace name string env long consumer id get consumer id by token token if consumer id null throw new bad request exception token be illegal role namespace modify role role permission service find role by role name role util build modify namespace role name app id namespace name env role namespace release role role permission service find role by role name role util build release namespace role name app id namespace name env if namespace modify role null namespace release role null throw new bad request exception namespace s role do not exist please check whether namespace have create long namespace modify role id namespace modify role get id long namespace release role id namespace release role get id consumer role manage modify role consumer role repository find by consumer id and role id consumer id namespace modify role id consumer role manage release role consumer role repository find by consumer id and role id consumer id namespace release role id if manage modify role null manage release role null return array as list manage modify role manage release role string operator user info holder get user get user id consumer role namespace modify consumer role create consumer role consumer id namespace modify role id operator consumer role namespace release consumer role create consumer role consumer id namespace release role id operator consumer role create modify consumer role consumer role repository save namespace modify consumer role consumer role create release consumer role consumer role repository save namespace release consumer role return array as list create modify consumer role create release consumer role 
consumer service transactional public consumer role assign app role to consumer string token string app id long consumer id get consumer id by token token if consumer id null throw new bad request exception token be illegal role master role role permission service find role by role name role util build app master role name app id if master role null throw new bad request exception app s role do not exist please check whether app have create long role id master role get id consumer role manage modify role consumer role repository find by consumer id and role id consumer id role id if manage modify role null return manage modify role string operator user info holder get user get user id consumer role consumer role create consumer role consumer id role id operator return consumer role repository save consumer role 
consumer service transactional public void create consumer audits iterable consumer audit consumer audits consumer audit repository save all consumer audits 
consumer service transactional public consumer token create consumer token consumer token entity entity set id for protection return consumer token repository save entity 
consumer controller transactional pre authorize value permission validator be super admin post mapping value consumer public consumer token create consumer request body consumer consumer request param value expire require false date time format pattern yyyy m mdd h hmmss date expire if string util be contain empty consumer get app id consumer get name consumer get owner name consumer get org id throw new bad request exception param app id name owner name org id can not be empty consumer create consumer consumer service create consumer consumer if object be null expire expire default expire return consumer service generate and save consumer token create consumer expire 
app namespace service transactional public void create default app namespace string app id if be app namespace name unique app id config const namespace application throw new bad request exception string format app already have application namespace app id s app id app namespace app n new app namespace app n set app id app id app n set name config const namespace application app n set comment default app namespace app n set format config file format property get value string user id user info holder get user get user id app n set datum change create by user id app n set datum change last modify by user id app namespace repository save app n 
app namespace service transactional public app namespace create app namespace in local app namespace app namespace boolean append namespace prefix string app id app namespace get app id add app org id as prefix app app app service load app id if app null throw new bad request exception app not exist app id app id string builder app namespace name new string builder add prefix postfix app namespace name append app namespace be public append namespace prefix app get org id append app namespace get name append app namespace format as enum config file format property app namespace get format app namespace set name app namespace name to string if app namespace get comment null app namespace set comment if config file format be valid format app namespace get format throw new bad request exception invalid namespace format format must be property json yaml yml xml string operator app namespace get datum change create by if string util be empty operator operator user info holder get user get user id app namespace set datum change create by operator app namespace set datum change last modify by operator globally uniqueness check for public app namespace if app namespace be public check app namespace global uniqueness app namespace else check private app namespace if app namespace repository find by app id and name app namespace get app id app namespace get name null throw new bad request exception private app namespace app namespace get name already exist should not have the same with public app namespace check public app namespace global uniqueness app namespace app namespace create app namespace app namespace repository save app namespace role initialization service init namespace role app namespace get app id app namespace get name operator role initialization service init namespace env role app namespace get app id app namespace get name operator return create app namespace 
app namespace service transactional public app namespace delete app namespace string app id string namespace name app namespace app namespace app namespace repository find by app id and name app id namespace name if app namespace null throw new bad request exception string format app namespace not exist app id s namespace name s app id namespace name string operator user info holder get user get user id this operator be pass to com ctrip framework apollo portal listener deletion listener on app namespace deletion event app namespace set datum change last modify by operator delete app namespace in portal db app namespace repository delete app id namespace name operator delete permission and role relate datum role permission service delete role permission by app id and namespace app id namespace name operator return app namespace 
app service transactional public app create app in local app app string app id app get app id app manage app app repository find by app id app id if manage app null throw new bad request exception string format app already exist app id s app id user info owner user service find by user id app get owner name if owner null throw new bad request exception application s owner not exist app set owner email owner get email string operator user info holder get user get user id app set datum change create by operator app set datum change last modify by operator app create app app repository save app app namespace service create default app namespace app id role initialization service init app role create app tracer log event tracer event type create app app id return create app 
app service transactional public app update app in local app app string app id app get app id app manage app app repository find by app id app id if manage app null throw new bad request exception string format app not exist app id s app id manage app set name app get name manage app set org id app get org id manage app set org name app get org name string owner name app get owner name user info owner user service find by user id owner name if owner null throw new bad request exception string format app s owner not exist owner s owner name manage app set owner name owner get user id manage app set owner email owner get email string operator user info holder get user get user id manage app set datum change last modify by operator return app repository save manage app 
app service transactional public app delete app in local string app id app manage app app repository find by app id app id if manage app null throw new bad request exception string format app not exist app id s app id string operator user info holder get user get user id this operator be pass to com ctrip framework apollo portal listener deletion listener on app deletion event manage app set datum change last modify by operator portal app app repository delete app app id operator portal app namespace app namespace service batch delete by app id app id operator portal favorite service batch delete by app id app id operator portal permission role role permission service delete role permission by app id app id operator return manage app 
namespace branch service transactional public namespace d t o create branch string app id env env string parent cluster name string namespace name string operator user info holder get user get user id return create branch app id env parent cluster name namespace name operator 
namespace branch service transactional public namespace d t o create branch string app id env env string parent cluster name string namespace name string operator namespace d t o create branch namespace branch a p i create branch app id env parent cluster name namespace name operator tracer log event tracer event type create gray release string format s s s s app id env parent cluster name namespace name return create branch 
namespace service transactional public void delete namespace string app id env env string cluster name string namespace name app namespace app namespace app namespace service find by app id and name app id namespace name check parent namespace have not instance if namespace have instance app id env cluster name namespace name throw new bad request exception can not delete namespace because namespace have active instance check child namespace have not instance namespace d t o child namespace branch service find branch base info app id env cluster name namespace name if child namespace null namespace have instance app id env child namespace get cluster name namespace name throw new bad request exception can not delete namespace because namespace s branch have active instance check public namespace have not associate namespace if app namespace null app namespace be public public app namespace have associate namespace namespace name env throw new bad request exception can not delete public namespace which have associate namespace string operator user info holder get user get user id namespace a p i delete namespace env app id cluster name namespace name operator 
default role initialization service transactional public void init app role app app string app id app get app id string app master role name role util build app master role name app id have create before if role permission service find role by role name app master role name null return string operator app get datum change create by create app permission create app master role app id operator create manage app master permission create manage app master role app id operator assign master role to user role permission service assign role to user role util build app master role name app id set new hash set app get owner name operator init namespace role app id config const namespace application operator init namespace env role app id config const namespace application operator assign modify release namespace role to user role permission service assign role to user role util build namespace role name app id config const namespace application role type modify namespace set new hash set operator operator role permission service assign role to user role util build namespace role name app id config const namespace application role type release namespace set new hash set operator operator 
default role initialization service transactional public void init namespace role string app id string namespace name string operator string modify namespace role name role util build modify namespace role name app id namespace name if role permission service find role by role name modify namespace role name null create namespace role app id namespace name permission type modify namespace modify namespace role name operator string release namespace role name role util build release namespace role name app id namespace name if role permission service find role by role name release namespace role name null create namespace role app id namespace name permission type release namespace release namespace role name operator 
default role initialization service transactional public void init namespace env role string app id string namespace name string operator list env portal env portal config portal support env for env env portal env init namespace specific env role app id namespace name env to string operator 
default role initialization service transactional public void init namespace specific env role string app id string namespace name string env string operator string modify namespace env role name role util build modify namespace role name app id namespace name env if role permission service find role by role name modify namespace env role name null create namespace env role app id namespace name permission type modify namespace env modify namespace env role name operator string release namespace env role name role util build release namespace role name app id namespace name env if role permission service find role by role name release namespace env role name null create namespace env role app id namespace name permission type release namespace env release namespace env role name operator 
default role initialization service transactional public void init create app role if role permission service find role by role name system role manager service create application role name null return permission create app permission permission repository find top by permission type and target id permission type create application system role manager service system permission target id if create app permission null create application permission init create app permission create permission system role manager service system permission target id permission type create application apollo role permission service create permission create app permission create application role init role create app role create role system role manager service create application role name apollo role permission service create role with permission create app role set new hash set create app permission get id 
default role initialization service transactional private void create manage app master role string app id string operator permission permission create permission app id permission type manage app master operator role permission service create permission permission role role create role role util build app role name app id permission type manage app master operator set long permission id new hash set permission id add permission get id role permission service create role with permission role permission id 
default role initialization service transactional public void init manage app master role string app id string operator string manage app master role name role util build app role name app id permission type manage app master if role permission service find role by role name manage app master role name null return synchronize default role initialization service class create manage app master role app id operator 
default role permission service transactional public role create role with permission role role set long permission id role current find role by role name role get role name precondition check state current null role s already exist role get role name role create role role repository save role if collection util be empty permission id iterable role permission role permission permission id stream map permission id role permission role permission new role permission role permission set role id create role get id role permission set permission id permission id role permission set datum change create by create role get datum change create by role permission set datum change last modify by create role get datum change last modify by return role permission collect collector to list role permission repository save all role permission return create role 
default role permission service transactional public set string assign role to user string role name set string user id string operator user id role role find role by role name role name precondition check state role null role s doesn t exist role name list user role exist user role user role repository find by user id in and role id user id role get id set string exist user id exist user role stream map user role get user id collect collector to set set string to assign user id set difference user id exist user id iterable user role to create to assign user id stream map user id user role user role new user role user role set role id role get id user role set user id user id user role set datum change create by operator user id user role set datum change last modify by operator user id return user role collect collector to list user role repository save all to create return to assign user id 
default role permission service transactional public void remove role from user string role name set string user id string operator user id role role find role by role name role name precondition check state role null role s doesn t exist role name list user role exist user role user role repository find by user id in and role id user id role get id for user role user role exist user role user role set delete true user role set datum change last modify time new date user role set datum change last modify by operator user id user role repository save all exist user role 
default role permission service transactional public permission create permission permission permission string permission type permission get permission type string target id permission get target id permission current permission repository find top by permission type and target id permission type target id precondition check state current null permission with permission type s target id s already exist permission type target id return permission repository save permission 
default role permission service transactional public set permission create permission set permission permission multimap string string target id permission type hash multimap create for permission permission permission target id permission type put permission get target id permission get permission type for string target id target id permission type key set collection string permission type target id permission type get target id list permission current permission repository find by permission type in and target id permission type target id precondition check state collection util be empty current permission with permission type s target id s already exist permission type target id iterable permission result permission repository save all permission return stream support stream result spliterator false collect collector to set 
default role permission service transactional override public void delete role permission by app id string app id string operator list long permission id permission repository find permission id by app id app id if permission id be empty delete permission permission repository batch delete permission id operator delete role permission role permission repository batch delete by permission id permission id operator list long role id role repository find role id by app id app id if role id be empty delete role role repository batch delete role id operator delete user role user role repository batch delete by role id role id operator delete consumer role consumer role repository batch delete by role id role id operator 
default role permission service transactional override public void delete role permission by app id and namespace string app id string namespace name string operator list long permission id permission repository find permission id by app id and namespace app id namespace name if permission id be empty delete permission permission repository batch delete permission id operator delete role permission role permission repository batch delete by permission id permission id operator list long role id role repository find role id by app id and namespace app id namespace name if role id be empty delete role role repository batch delete role id operator delete user role user role repository batch delete by role id role id operator delete consumer role consumer role repository batch delete by role id role id operator 
spring security user service transactional public void create or update user p o user string username user get username user user detail new user username encoder encode user get password authority if user detail manager user exist username user detail manager update user user detail else user detail manager create user user detail user p o manage user user repository find by username username manage user set email user get email user repository save manage user 
