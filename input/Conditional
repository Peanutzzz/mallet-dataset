conditional on miss profile target element type type element type method retention retention policy runtime document conditional on profile condition class public interface conditional on miss profile the profile that should be inactive return string value default 
conditional on profile target element type type element type method retention retention policy runtime document conditional on profile condition class public interface conditional on profile the profile that should be active return string value default 
titan entity manager component conditional titan condition class public class titan entity manager private final titan setting setting public titan entity manager final titan setting setting this setting setting suppress warning rawtype unchecked bean public datum source datasource throw exception class clazz class for name com ctrip datasource configure dal datum source factory object obj clazz new instance method method clazz get method create datum source new class string class string class datum source d datum source method invoke obj new object setting get titan dbname setting get titan url tracer log event apollo datasource titan setting get titan dbname return d 
embed permission persist service impl conditional value condition on embed storage class component public class embed permission persist service impl implement permission persist service autowired private database operate database operate autowired private embed storage persist service impl persist service public page permission info get permission string role int page no int page size pagination helper permission info helper persist service create pagination helper string sql count row select count from permission where string sql fetch row select role resource action from permission where string where role role if string util be blank role where 1 = 1 page permission info page info helper fetch page sql count row where sql fetch row where new array list string to array page no page size permission row mapper if page info null page info new page page info set total count page info set page item new array list return page info execute ddd user permission operation param role role info string value param resource resource info string value param action action info string value public void add permission string role string resource string action string sql insert into permission role resource action value embed storage context util add sql context sql role resource action database operate block update execute delete user permission operation param role role info string value param resource resource info string value param action action info string value public void delete permission string role string resource string action string sql delete from permission where role and resource and action embed storage context util add sql context sql role resource action database operate block update 
embed role persist service impl conditional value condition on embed storage class component public class embed role persist service impl implement role persist service autowired private database operate database operate autowired private embed storage persist service impl persist service public page role info get role int page no int page size pagination helper role info helper persist service create pagination helper string sql count row select count from select distinct role from role role where string sql fetch row select role username from role where string where 1 = 1 page role info page info helper fetch page sql count row where sql fetch row where new array list string to array page no page size role info row mapper if page info null page info new page page info set total count page info set page item new array list return page info public page role info get role by user name string username int page no int page size pagination helper role info helper persist service create pagination helper string sql count row select count from role where string sql fetch row select role username from role where string where username username if string util be blank username where 1 = 1 return helper fetch page sql count row where sql fetch row where new array list string to array page no page size role info row mapper add user role param role role string value param user name username string value public void add role string role string user name string sql insert into role role username value try embed storage context util add sql context sql role user name database operate update embed storage context util get current sql context finally embed storage context util clean all context delete user role param role role string value public void delete role string role string sql delete from role where role try embed storage context util add sql context sql role database operate update embed storage context util get current sql context finally embed storage context util clean all context execute delete role sql operation param role role string value param username user string value public void delete role string role string username string sql delete from role where role and username try embed storage context util add sql context sql role username database operate update embed storage context util get current sql context finally embed storage context util clean all context 
embed user persist service impl conditional value condition on embed storage class component public class embed user persist service impl implement user persist service autowired private database operate database operate autowired private embed storage persist service impl persist service execute create user operation param username username string value param password password string value public void create user string username string password string sql insert into user username password enable value try embed storage context util add sql context sql username password true database operate block update finally embed storage context util clean all context execute delete user operation param username username string value public void delete user string username string sql delete from user where username try embed storage context util add sql context sql username database operate block update finally embed storage context util clean all context execute update user password operation param username username string value param password password string value public void update user password string username string password try embed storage context util add sql context update user set password where username password username database operate block update finally embed storage context util clean all context public user find user by username string username string sql select username password from user where username return database operate query one sql new object username user row mapper public page user get user int page no int page size pagination helper user helper persist service create pagination helper string sql count row select count from user where string sql fetch row select username password from user where string where 1 = 1 page user page info helper fetch page sql count row where sql fetch row where new array list string to array page no page size user row mapper if page info null page info new page page info set total count page info set page item new array list return page info 
external permission persist service impl conditional value condition on external storage class component public class external permission persist service impl implement permission persist service autowired private external storage persist service impl persist service private jdbc template jt post construct protect void init jt persist service get jdbc template public page permission info get permission string role int page no int page size pagination helper permission info helper persist service create pagination helper string sql count row select count from permission where string sql fetch row select role resource action from permission where string where role role if string util be blank role where 1 = 1 try page permission info page info helper fetch page sql count row where sql fetch row where new array list string to array page no page size permission row mapper if page info null page info new page page info set total count page info set page item new array list return page info catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e execute add permission operation param role role string value param resource resource string value param action action string value public void add permission string role string resource string action string sql insert into permission role resource action value try jt update sql role resource action catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e execute delete permission operation param role role string value param resource resource string value param action action string value public void delete permission string role string resource string action string sql delete from permission where role and resource and action try jt update sql role resource action catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e 
external role persist service impl conditional value condition on external storage class component public class external role persist service impl implement role persist service autowired private external storage persist service impl persist service private jdbc template jt post construct protect void init jt persist service get jdbc template public page role info get role int page no int page size pagination helper role info helper persist service create pagination helper string sql count row select count from select distinct role from role role where string sql fetch row select role username from role where string where 1 = 1 try page role info page info helper fetch page sql count row where sql fetch row where new array list string to array page no page size role info row mapper if page info null page info new page page info set total count page info set page item new array list return page info catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e public page role info get role by user name string username int page no int page size pagination helper role info helper persist service create pagination helper string sql count row select count from role where string sql fetch row select role username from role where string where username username if string util be blank username where 1 = 1 try return helper fetch page sql count row where sql fetch row where new array list string to array page no page size role info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e execute add role operation param role role string value param user name username string value public void add role string role string user name string sql insert into role role username value try jt update sql role user name catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e execute delete role operation param role role string value public void delete role string role string sql delete from role where role try jt update sql role catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e execute delete role operation param role role string value param username username string value public void delete role string role string username string sql delete from role where role and username try jt update sql role username catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e private static final class role info row mapper implement row mapper role info override public role info map row result set rs int row num throw s q l exception role info role info new role info role info set role rs get string role role info set username rs get string username return role info 
external user persist service impl conditional value condition on external storage class component public class external user persist service impl implement user persist service autowired private external storage persist service impl persist service private jdbc template jt post construct protect void init jt persist service get jdbc template execute create user operation param username username string value param password password string value public void create user string username string password string sql insert into user username password enable value try jt update sql username password true catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e execute delete user operation param username username string value public void delete user string username string sql delete from user where username try jt update sql username catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e execute update user password operation param username username string value param password password string value public void update user password string username string password try jt update update user set password where username password username catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e execute find user by username operation param username username string value return user model public user find user by username string username string sql select username password from user where username try return this jt query for object sql new object username user row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e catch empty result datum access exception e return null catch exception e log util fatal log error db other error e get message e throw new runtime exception e public page user get user int page no int page size pagination helper user helper persist service create pagination helper string sql count row select count from user where string sql fetch row select username password from user where string where 1 = 1 try page user page info helper fetch page sql count row where sql fetch row where new array list string to array page no page size user row mapper if page info null page info new page page info set total count page info set page item new array list return page info catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e 
naco config configuration conditional condition distribute embed storage class bean public filter registration bean transfer to leader registration filter registration bean curcuit filter registration new filter registration bean registration set filter transfer to leader registration add url pattern v1 c registration set name curcuit filter registration set order return registration 
naco config configuration conditional condition distribute embed storage class bean public curcuit filter transfer to leader return new curcuit filter 
embed dump service conditional condition on embed storage class component public class embed dump service extend dump service private final protocol manager protocol manager if it be just a normal reading failure it can be resolve by retry final string retry message new string the conformance protocol be temporarily unavailable for read if the read fail due to a internal problem in the raft state machine it can not be remedy by retry final string error message new string f s m caller be overload state error here you inject the dependent object constructively ensure that some of the dependent functionality be initialize ahead of time param persist service link persist service param member manager link server member manager param protocol manager link protocol manager public embed dump service persist service persist service server member manager member manager protocol manager protocol manager super persist service member manager this protocol manager protocol manager post construct override protect void init throw throwable if application util get standalone mode dump operate processor dump all processor dump all beta processor dump all tag processor return c p protocol protocol protocol manager get cp protocol atomic reference throwable error reference new atomic reference null count down latch wait dump finish new count down latch watch path naco config leader have value observer observer new observer override public void update observable o object arg global executor execute by common must make sure that there be a value here to perform the correct operation that follow if object be null arg return identify without a timeout mechanism embed storage context util put extend info constant extend need read until have datum true remove you own listening to avoid task accumulation boolean can end false for try dump operate processor dump all processor dump all beta processor dump all tag processor protocol protocol meta datum un subscribe constant config model raft group metadata key leader meta datum this can end true catch throwable ex if should retry ex error reference set ex can end true if can end thread util count down wait dump finish break thread util sleep l embed storage context util clean all context protocol protocol meta datum subscribe constant config model raft group metadata key leader meta datum observer we must wait for the dump task to complete the callback operation before continue with the initialization thread util latch await wait dump finish if a exception occur during the execution of the dump task the exception need to be throw trigger the node to start the failed process final throwable ex error reference get if object non null ex throw ex private boolean should retry throwable ex final string err msg ex get message for string fail msg error message if string util contain ignore case err msg fail msg return false for final string retry msg retry message if string util contain ignore case err msg retry msg return true return false override protect boolean can execute if application util get standalone mode return true if be derby raft mode only leader can execute c p protocol protocol protocol manager get cp protocol return protocol be leader constant config model raft group 
external dump service conditional condition on external storage class component public class external dump service extend dump service here you inject the dependent object constructively ensure that some of the dependent functionality be initialize ahead of time param persist service link persist service param member manager link server member manager public external dump service persist service persist service server member manager member manager super persist service member manager post construct override protect void init throw throwable dump operate processor dump all processor dump all beta processor dump all tag processor override protect boolean can execute return member manager be first ip 
distribute database operate impl conditional condition distribute embed storage class component suppress warning unchecked public class distribute database operate impl extend log processor4 c p implement base database operate the datum import operation be dedicated key which act as a identifier private static final string datum import key datum import private server member manager member manager private c p protocol protocol private local datum source service impl datum source service private jdbc template jdbc template private transaction template transaction template private serializer serializer serialize factory get default private reentrant read write lock lock new reentrant read write lock private reentrant read write lock read lock read lock lock read lock private reentrant read write lock write lock write lock lock write lock public distribute database operate impl server member manager member manager protocol manager protocol manager throw exception this member manager member manager this protocol protocol manager get cp protocol init protect void init throw exception this data source service local datum source service impl dynamic datum source get instance get datum source because in raft derby mode ensure datum consistency depend on the raft s log playback and snapshot recovery capability and the last datum must be clear this data source service clean and reopen derby this jdbc template datum source service get jdbc template this transaction template datum source service get transaction template register a derby raft state machine failure event for node degradation processing notify center register to share publisher raft db error event class register the snapshot load event notify center register to share publisher derby load event class notify center register subscriber new subscriber raft db error event override public void on event raft db error event event datum source service set health status down override public class extend event subscribe type return raft db error event class notify center register to publisher config dump event class notify center ring buffer size notify center register subscriber new dump config handler this protocol add log processor collection singleton list this log util default log info use distribute transaction service impl just for test public void mock consistency protocol c p protocol protocol this protocol protocol override public r r query one string sql class r cl try logger util print if debug enable log util default log query one info sql sql byte datum serializer serialize select request builder query type query type query one no mapper no arg sql sql class name cl get canonical name build final boolean block read embed storage context util contain extend info constant extend need read until have datum response response inner read get request new builder set group group set datum byte string copy from datum build block read if response get success return serializer deserialize response get datum to byte array cl throw new n jdbc exception response get err msg response get err msg catch exception e log util fatal log error a exception occur during the query operation e to string throw new naco runtime exception naco exception server error e to string override public r r query one string sql object arg class r cl try logger util print if debug enable log util default log query one info sql arg sql arg byte datum serializer serialize select request builder query type query type query one no mapper with arg sql sql arg args class name cl get canonical name build final boolean block read embed storage context util contain extend info constant extend need read until have datum response response inner read get request new builder set group group set datum byte string copy from datum build block read if response get success return serializer deserialize response get datum to byte array cl throw new n jdbc exception response get err msg response get err msg catch exception e log util fatal log error a exception occur during the query operation e to string throw new naco runtime exception naco exception server error e to string override public r r query one string sql object arg row mapper r mapper try logger util print if debug enable log util default log query one info sql arg sql arg byte datum serializer serialize select request builder query type query type query one with mapper with arg sql sql arg args class name mapper get class get canonical name build final boolean block read embed storage context util contain extend info constant extend need read until have datum response response inner read get request new builder set group group set datum byte string copy from datum build block read if response get success return serializer deserialize response get datum to byte array class util resolve generic type by interface mapper get class throw new n jdbc exception response get err msg response get err msg catch exception e log util fatal log error a exception occur during the query operation e to string throw new naco runtime exception naco exception server error e to string override public r list r query many string sql object arg row mapper r mapper try logger util print if debug enable log util default log query many info sql arg sql arg byte datum serializer serialize select request builder query type query type query many with mapper with arg sql sql arg args class name mapper get class get canonical name build final boolean block read embed storage context util contain extend info constant extend need read until have datum response response inner read get request new builder set group group set datum byte string copy from datum build block read if response get success return serializer deserialize response get datum to byte array list class throw new n jdbc exception response get err msg catch exception e log util fatal log error a exception occur during the query operation e to string throw new naco runtime exception naco exception server error e to string override public r list r query many string sql object arg class be r class try logger util print if debug enable log util default log query many info sql arg sql arg byte datum serializer serialize select request builder query type query type query many no mapper with arg sql sql arg args class name r class get canonical name build final boolean block read embed storage context util contain extend info constant extend need read until have datum response response inner read get request new builder set group group set datum byte string copy from datum build block read if response get success return serializer deserialize response get datum to byte array list class throw new n jdbc exception response get err msg catch exception e log util fatal log error a exception occur during the query operation e to string throw new naco runtime exception naco exception server error e to string override public list map string object query many string sql object arg try logger util print if debug enable log util default log query many info sql arg sql arg byte datum serializer serialize select request builder query type query type query many with list with arg sql sql arg arg build final boolean block read embed storage context util contain extend info constant extend need read until have datum response response inner read get request new builder set group group set datum byte string copy from datum build block read if response get success return serializer deserialize response get datum to byte array list class throw new n jdbc exception response get err msg catch exception e log util fatal log error a exception occur during the query operation e to string throw new naco runtime exception naco exception server error e to string in some business situation you need to avoid the timeout issue so block read be use to determine this param request link get request param block read be async read operation return link response throw exception exception private response inner read get request request boolean block read throw exception if block read return response protocol a get datum request join return protocol get datum request override public completable future rest result string datum import file file return completable future supply async try disk util line iterator iterator disk util line iterator file int batch size list string batch update new array list batch size list completable future response future new array list while iterator have next string sql iterator next if string util be not blank sql batch update add sql boolean submit batch update size batch size iterator have next if submit list modify request request batch update stream map modify request new collect collector to list completable future response future protocol submit async log new builder set group group set datum byte string copy from serializer serialize request put extend info datum import key boolean true to string build future add future batch update clear completable future all of future to array new completable future join for completable future response future future response response future get if response get success return rest result util fail response get err msg return rest result util success catch throwable ex log util default log error datum import have error ex return rest result util fail ex get message override public boolean update list modify request sql context bi consumer boolean throwable consumer try since the sql parameter be object in order to ensure that the type of array element be not lose the serialization here be do use the java specific serialization framework rather than continue with the protobuff logger util print if debug enable log util default log modify request info sql context timestamp group ip port signature final string key system current time millis group member manager get self get address m d5 util md5 hex sql context to string constant encode log log log new builder set group group set key key set datum byte string copy from serializer serialize sql context put all extend info embed storage context util get current extend info set type sql context get class get canonical name build if object be null consumer response response this protocol submit log if response get success return true log util default log error execute sql modify operation fail response get err msg return false else this protocol submit async log when complete bi consumer response throwable response ex string err msg object be null ex response get err msg exception util get cause ex get message consumer accept response get success string util be blank err msg null new n jdbc exception err msg return true catch timeout exception e log util fatal log error a timeout exception occur during the update operation throw new naco runtime exception naco exception server error e to string catch throwable e log util fatal log error a exception occur during the update operation e throw new naco runtime exception naco exception server error e to string override public list snapshot operation load snapshot operate return collection singleton list new derby snapshot operation write lock suppress warning all override public response on request final get request request final select request select request serializer deserialize request get datum to byte array select request class logger util print if debug enable log util default log get datum info select request select request final row mapper object mapper row mapper manager get row mapper select request get class name final byte type select request get query type read lock lock object datum try switch type case query type query one with mapper with arg datum query one jdbc template select request get sql select request get arg mapper break case query type query one no mapper no arg datum query one jdbc template select request get sql class util find class by name select request get class name break case query type query one no mapper with arg datum query one jdbc template select request get sql select request get arg class util find class by name select request get class name break case query type query many with mapper with arg datum query many jdbc template select request get sql select request get arg mapper break case query type query many with list with arg datum query many jdbc template select request get sql select request get arg break case query type query many no mapper with arg datum query many jdbc template select request get sql select request get arg class util find class by name select request get class name break default throw new illegal argument exception unsupported datum query category byte string byte datum null byte string empty byte string copy from serializer serialize datum return response new builder set success true set datum byte build catch exception e log util fatal log error there be a error query the datum request error select request e to string return response new builder set success false set err msg class util get simpla name e exception util get cause e get message build finally read lock unlock override public response on apply log log logger util print if debug enable log util default log on apply info log log final byte string byte string log get datum precondition check argument byte string null log get datum must not null list modify request sql context serializer deserialize byte string to byte array list class final lock lock read lock lock lock try boolean be ok false if log contain extend info datum import key be ok do datum import jdbc template sql context else sql context sort comparator compare int modify request get execute no be ok update transaction template jdbc template sql context if there be additional information post processing put into the asynchronous thread pool for processing to avoid block the normal execution of the state machine config executor execute embed dump handle extend info log get extend info map return response new builder set success be ok build we do not believe that a error cause by a problem with a sql error should trigger the stop operation of the raft state machine catch bad sql grammar exception datum integrity violation exception e return response new builder set success false set err msg e to string build catch data access exception e throw new consistency exception e to string catch throwable t throw t finally lock unlock override public void on error throwable throwable trigger reversion strategy notify center publish event new raft db error event throwable override public string group return constant config model raft group private void handle extend info map string string extend info if extend info contain key constant extend info config dump event string json val extend info get constant extend info config dump event if string util be not blank json val notify center publish event jackson util to obj json val config dump event class return if extend info contain key constant extend info config dump event string json val extend info get constant extend info config dump event if string util be not blank json val list config dump event list jackson util to obj json val new generic type list config dump event get type list stream filter object non null for each notify center publish event 
embed storage persist service impl suppress warning pmd method return wrapper type rule checkstyle linelength conditional value condition on embed storage class component public class embed storage persist service impl implement persist service private static final string resource config info id config info id private static final string resource config history id config history id private static final string resource config tag relation id config tag relation id private static final string resource app configdata relation sub app configdata relation sub private static final string resource config beta id config beta id private static final string resource namespace id namespace id private static final string resource user id user id private static final string resource role id role id private static final string resource permission id permission id private datum source service datum source service private final database operate database operate private final id generator manager id generator manager the constructor set the dependency injection order param database operate link embed storage persist service impl param id generator manager link id generator manager public embed storage persist service impl database operate database operate id generator manager id generator manager this database operate database operate this id generator manager id generator manager notify center register to share publisher derby import event class init datum source service and id generator manager post construct public void init datum source service dynamic datum source get instance get datum source id generator manager register resource config info id resource config history id resource config tag relation id resource app configdata relation sub resource config beta id resource namespace id resource user id resource role id resource permission id public boolean check master writable return datum source service check master writable public void set basic datum source service datum source service datum source service this data source service datum source service public synchronize void reload throw i o exception this data source service reload config info table insert update delete for unit test public jdbc template get jdbc template return this data source service get jdbc template public transaction template get transaction template return this data source service get transaction template suppress warning checkstyle abbreviation as word in name public string get current d b url return this data source service get current db url public database operate get database operate return database operate override public e pagination helper e create pagination helper return new embed pagination helper impl e database operate override public void add config info final string src ip final string src user final config info config info final timestamp time final map string object config advance info final boolean notify try final string tenant tmp string util be blank config info get tenant string util empty config info get tenant config info set tenant tenant tmp long config id id generator manager next id resource config info id long he id id generator manager next id resource config history id add config info atomic config id src ip src user config info time config advance info string config tag config advance info null null string config advance info get config tag add config tag relation config id config tag config info get datum id config info get group config info get tenant insert config history atomic he id config info src ip src user time i embed storage context util on modify config info config info src ip time database operate block update finally embed storage context util clean all context override public void add config info4 beta config info config info string beta ip string src ip string src user timestamp time boolean notify string app name tmp string util be blank config info get app name string util empty config info get app name string tenant tmp string util be blank config info get tenant string util empty config info get tenant config info set tenant tenant tmp try string md5 m d5 util md5 hex config info get content constant encode final string sql insert into config info beta datum id group id tenant id app name content md5 beta ip src ip src user gmt create gmt modify value final object arg new object config info get datum id config info get group tenant tmp app name tmp config info get content md5 beta ip src ip src user time time embed storage context util on modify config beta info config info beta ip src ip time embed storage context util add sql context sql arg database operate block update finally embed storage context util clean all context override public void add config info4 tag config info config info string tag string src ip string src user timestamp time boolean notify string app name tmp string util be blank config info get app name string util empty config info get app name string tenant tmp string util be blank config info get tenant string util empty config info get tenant string tag tmp string util be blank tag string util empty tag trim config info set tenant tenant tmp try string md5 m d5 util md5 hex config info get content constant encode final string sql insert into config info tag datum id group id tenant id tag id app name content md5 src ip src user gmt create gmt modify value final object arg new object config info get datum id config info get group tenant tmp tag tmp app name tmp config info get content md5 src ip src user time time embed storage context util on modify config tag info config info tag tmp src ip time embed storage context util add sql context sql arg database operate block update finally embed storage context util clean all context override public void update config info final config info config info final string src ip final string src user final timestamp time final map string object config advance info final boolean notify try config info old config info find config info config info get datum id config info get group config info get tenant final string tenant tmp string util be blank config info get tenant string util empty config info get tenant old config info set tenant tenant tmp string app name tmp old config info get app name if the app name pass by the user be not empty the app name of the user be persist otherwise the app name of db be use empty string be require to clear app name if config info get app name null config info set app name app name tmp update config info atomic config info src ip src user time config advance info string config tag config advance info null null string config advance info get config tag if config tag null delete all tag and recreate they remove tag by id atomic old config info get id add config tag relation old config info get id config tag config info get datum id config info get group config info get tenant insert config history atomic old config info get id old config info src ip src user time u embed storage context util on modify config info config info src ip time database operate block update finally embed storage context util clean all context override public void update config info4 beta config info config info string beta ip string src ip string src user timestamp time boolean notify string app name tmp string util be blank config info get app name string util empty config info get app name string tenant tmp string util be blank config info get tenant string util empty config info get tenant config info set tenant tenant tmp try string md5 m d5 util md5 hex config info get content constant encode final string sql update config info beta set content md5 src ip src user gmt modify app name where datum id and group id and tenant id final object arg new object config info get content md5 src ip src user time app name tmp config info get datum id config info get group tenant tmp embed storage context util on modify config beta info config info beta ip src ip time embed storage context util add sql context sql arg database operate block update finally embed storage context util clean all context override public void update config info4 tag config info config info string tag string src ip string src user timestamp time boolean notify string app name tmp string util be blank config info get app name string util empty config info get app name string tenant tmp string util be blank config info get tenant string util empty config info get tenant string tag tmp string util be blank tag string util empty tag trim config info set tenant tenant tmp try string md5 m d5 util md5 hex config info get content constant encode final string sql update config info tag set content md5 src ip src user gmt modify app name where datum id and group id and tenant id and tag id final object arg new object config info get content md5 src ip src user time app name tmp config info get datum id config info get group tenant tmp tag tmp embed storage context util on modify config tag info config info tag tmp src ip time embed storage context util add sql context sql arg database operate block update finally embed storage context util clean all context override public void insert or update beta final config info config info final string beta ip final string src ip final string src user final timestamp time final boolean notify if find config info4 beta config info get datum id config info get group config info get tenant null add config info4 beta config info beta ip src ip null time notify else update config info4 beta config info beta ip src ip null time notify override public void insert or update tag final config info config info final string tag final string src ip final string src user final timestamp time final boolean notify if find config info4 tag config info get datum id config info get group config info get tenant tag null add config info4 tag config info tag src ip null time notify else update config info4 tag config info tag src ip null time notify override public void update md5 string datum id string group string tenant string md5 timestamp last time string tenant tmp string util be blank tenant string util empty tenant try final string sql update config info set md5 where datum id and group id and tenant id and gmt modify final object arg new object md5 datum id group tenant tmp last time embed storage context util add sql context sql arg boolean result database operate update embed storage context util get current sql context if result throw new naco config exception fail to config the m d5 modification finally embed storage context util clean all context override public void insert or update string src ip string src user config info config info timestamp time map string object config advance info insert or update src ip src user config info time config advance info true override public void insert or update string src ip string src user config info config info timestamp time map string object config advance info boolean notify if object be null find config info config info get datum id config info get group config info get tenant add config info src ip src user config info time config advance info notify else update config info config info src ip src user time config advance info notify override public void insert or update sub sub info sub info if be already exist sub info update config sub atomic sub info get datum id sub info get group sub info get app name sub info get date else add config sub atomic sub info get datum id sub info get group sub info get app name sub info get date private boolean be already exist sub info sub info final string sql select from app configdata relation sub where dara id and group id and app name map obj database operate query one sql new object sub info get datum id sub info get group sub info get app name map class return obj null override public void remove config info final string data id final string group final string tenant final string src ip final string src user final timestamp time new timestamp system current time millis config info config info find config info datum id group tenant if object non null config info try string tenant tmp string util be blank tenant string util empty tenant remove config info atomic datum id group tenant tmp src ip src user remove tag by id atomic config info get id insert config history atomic config info get id config info src ip src user time d embed storage context util on delete config info tenant tmp group datum id src ip time boolean result database operate update embed storage context util get current sql context if result throw new naco config exception config deletion fail finally embed storage context util clean all context override public list config info remove config info by id final list long id final string src ip final string src user if collection util be empty id return null id remove all collection singleton null final timestamp time new timestamp system current time millis try string id str joiner on join id list config info config info list find config info by id id str if collection util be not empty config info list remove config info by id atomic id str for config info config info config info list remove tag by id atomic config info get id insert config history atomic config info get id config info src ip src user time d embed storage context util on batch delete config info config info list boolean result database operate update embed storage context util get current sql context if result throw new naco config exception fail to config batch deletion return config info list finally embed storage context util clean all context override public void remove config info4 beta final string data id final string group final string tenant final string tenant tmp string util be blank tenant string util empty tenant config info config info find config info4 beta datum id group tenant if config info null try final string sql delete from config info beta where datum id and group id and tenant id final object arg new object datum id group tenant tmp embed storage context util on delete config beta info tenant tmp group datum id system current time millis embed storage context util add sql context sql arg boolean result database operate update embed storage context util get current sql context if result throw new naco config exception tag configuration deletion fail finally embed storage context util clean all context override public boolean add aggr config info final string data id final string group string tenant final string datum id string app name final string content string app name tmp string util be blank app name string util empty app name string tenant tmp string util be blank tenant string util empty tenant string content tmp string util be blank content string util empty content final timestamp now new timestamp system current time millis final string select select content from config info aggr where datum id and group id and tenant id and datum id final string insert insert into config info aggr datum id group id tenant id datum id app name content gmt modify value final string update update config info aggr set content gmt modify where datum id and group id and tenant id and datum id string db content database operate query one select new object datum id group tenant tmp datum id string class if object be null db content final object arg new object datum id group tenant tmp datum id app name tmp content tmp now embed storage context util add sql context insert arg else if db content equal content final object arg new object content tmp now data id group tenant tmp datum id embed storage context util add sql context update arg try boolean result database operate update embed storage context util get current sql context if result throw new naco config exception merge configuration release fail return true finally embed storage context util clean all context override public void remove single aggr config info final string data id final string group final string tenant final string datum id final string tenant tmp string util be blank tenant string util empty tenant final string sql delete from config info aggr where datum id and group id and tenant id and datum id final object arg new object datum id group tenant tmp datum id embed storage context util add sql context sql arg try boolean result database operate update embed storage context util get current sql context if result throw new naco config exception aggregation with single configuration deletion fail finally embed storage context util clean all context override public void remove aggr config info final string data id final string group final string tenant final string tenant tmp string util be blank tenant string util empty tenant final string sql delete from config info aggr where datum id and group id and tenant id final object arg new object datum id group tenant tmp embed storage context util add sql context sql arg try boolean result database operate update embed storage context util get current sql context if result throw new naco config exception aggregation with all configuration deletion fail finally embed storage context util clean all context override public boolean batch remove aggr final string data id final string group final string tenant final list string datum list final string tenant tmp string util be blank tenant string util empty tenant final string builder datum string new string builder for string datum datum list datum string append append datum append datum string delete char at datum string length final string sql delete from config info aggr where datum id and group id and tenant id and datum id in datum string to string final object arg new object datum id group tenant tmp embed storage context util add sql context sql arg try boolean result database operate update embed storage context util get current sql context if result throw new naco config exception aggregation fail to configure batch deletion return true finally embed storage context util clean all context override public void remove config history final timestamp start time final int limit size string sql delete from he config info where gmt modify limit pagination helper config info helper create pagination helper helper update limit sql new object start time limit size override public int find config history count by time final timestamp start time string sql select count from he config info where gmt modify integer result database operate query one sql new object start time integer class if result null throw new illegal argument exception config info beta count error return result override public long find config max id string sql select max id from config info return optional of nullable database operate query one sql long class or else 0 l override public boolean batch publish aggr final string data id final string group final string tenant final map string string datum map final string app name try boolean be publish ok false for entry string string entry datum map entry set add aggr config info datum id group tenant entry get key app name entry get value be publish ok database operate update embed storage context util get current sql context if be publish ok null return false return be publish ok finally embed storage context util clean all context override public boolean replace aggr final string data id final string group final string tenant final map string string datum map final string app name boolean be replace ok false string app name tmp app name null app name remove aggr config info datum id group tenant string tenant tmp string util be blank tenant string util empty tenant final string sql insert into config info aggr datum id group id tenant id datum id app name content gmt modify value for entry string string datum entry datum map entry set final object arg new object datum id group tenant tmp datum entry get key app name tmp datum entry get value new timestamp system current time millis embed storage context util add sql context sql arg try be replace ok database operate update embed storage context util get current sql context if be replace ok null return false return be replace ok finally embed storage context util clean all context override public list config info find all datum id and group string sql select distinct datum id group id from config info return database operate query many sql empty array config info row mapper override public config info4 beta find config info4 beta final string data id final string group final string tenant string tenant tmp string util be blank tenant string util empty tenant final string sql select id datum id group id tenant id app name content beta ip from config info beta where datum id and group id and tenant id return database operate query one sql new object datum id group tenant tmp config i n f o4 b e t a row mapper override public config info4 tag find config info4 tag final string data id final string group final string tenant final string tag string tenant tmp string util be blank tenant string util empty tenant string tag tmp string util be blank tag string util empty tag trim final string sql select id datum id group id tenant id tag id app name content from config info tag where datum id and group id and tenant id and tag id return database operate query one sql new object datum id group tenant tmp tag tmp config i n f o4 t a g row mapper override public config info find config info app final string data id final string group final string tenant final string app name string tenant tmp string util be blank tenant string util empty tenant final string sql select id datum id group id tenant id app name content from config info where datum id and group id and tenant id and app name return database operate query one sql new object datum id group tenant tmp app name config info row mapper override public config info find config info advance info final string data id final string group final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant final string app name config advance info null null string config advance info get app name final string config tag config advance info null null string config advance info get config tag list string param list new array list string param list add datum id param list add group param list add tenant tmp string builder sql new string builder select id datum id group id tenant id app name content from config info where datum id and group id and tenant id if string util be not blank config tag sql new string builder select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where a data id and a group id and a tenant id sql append and b tag name in string tag arr config tag split for int i i tag arr length i if i sql append sql append param list add tag arr i sql append if string util be not blank app name sql append and a app name param list add app name else if string util be not blank app name sql append and app name param list add app name return database operate query one sql to string param list to array config info row mapper override public config info base find config info base final string data id final string group final string sql select id datum id group id content from config info where datum id and group id and tenant id return database operate query one sql new object datum id group string util empty config info base row mapper override public config info find config info long id final string sql select id datum id group id tenant id app name content from config info where id return database operate query one sql new object id config info row mapper override public config info find config info final string data id final string group final string tenant final string tenant tmp string util be blank tenant string util empty tenant final string sql select id datum id group id tenant id app name content md5 type from config info where datum id and group id and tenant id final object arg new object datum id group tenant tmp return database operate query one sql arg config info row mapper override public page config info find config info by datum id final int page no final int page size final string data id final string tenant string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper return helper fetch page select count from config info where datum id and tenant id select id datum id group id tenant id app name content from config info where datum id and tenant id new object datum id tenant tmp page no page size config info row mapper override public page config info find config info by datum id and app final int page no final int page size final string data id final string tenant final string app name string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper return helper fetch page select count from config info where datum id and tenant id and app name select id datum id group id tenant id app name content from config info where datum id and tenant id and app name new object datum id tenant tmp app name page no page size config info row mapper override public page config info find config info by datum id and advance final int page no final int page size final string data id final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant final string app name config advance info null null string config advance info get app name final string config tag config advance info null null string config advance info get config tag string builder sql count new string builder select count from config info where datum id and tenant id string builder sql new string builder select id datum id group id tenant id app name content from config info where datum id and tenant id list string param list new array list string param list add datum id param list add tenant tmp if string util be not blank config tag sql count new string builder select count from config info a left join config tag relation b on a id b id where a data id and a tenant id sql new string builder select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where a data id and a tenant id sql count append and b tag name in sql append and b tag name in string tag arr config tag split for int i i tag arr length i if i sql count append sql append sql count append sql append param list add tag arr i sql count append sql append if string util be not blank app name sql count append and a app name sql append and a app name param list add app name else if string util be not blank app name sql count append and app name sql append and app name param list add app name pagination helper config info helper create pagination helper return helper fetch page sql count to string sql to string param list to array page no page size config info row mapper override public page config info find config info4 page final int page no final int page size final string data id final string group final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant final string app name config advance info null null string config advance info get app name final string config tag config advance info null null string config advance info get config tag string sql count select count from config info string sql select id datum id group id tenant id app name content type from config info string builder where new string builder where list string param list new array list string param list add tenant tmp if string util be not blank config tag sql count select count from config info a left join config tag relation b on a id b id sql select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where append a tenant id if string util be not blank datum id where append and a data id param list add datum id if string util be not blank group where append and a group id param list add group if string util be not blank app name where append and a app name param list add app name where append and b tag name in string tag arr config tag split for int i i tag arr length i if i where append where append param list add tag arr i where append else where append tenant id if string util be not blank datum id where append and datum id param list add datum id if string util be not blank group where append and group id param list add group if string util be not blank app name where append and app name param list add app name pagination helper config info helper create pagination helper return helper fetch page sql count where to string sql where to string param list to array page no page size config info row mapper override public page config info base find config info base by datum id final int page no final int page size final string datum id pagination helper config info base helper create pagination helper return helper fetch page select count from config info where datum id and tenant id select id datum id group id content from config info where datum id and tenant id new object datum id string util empty page no page size config info base row mapper override public page config info find config info by group final int page no final int page size final string group final string tenant string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper return helper fetch page select count from config info where group id and tenant id select id datum id group id tenant id app name content from config info where group id and tenant id new object group tenant tmp page no page size config info row mapper override public page config info find config info by group and app final int page no final int page size final string group final string tenant final string app name string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper return helper fetch page select count from config info where group id and tenant id and app name select id datum id group id tenant id app name content from config info where group id and tenant id and app name new object group tenant tmp app name page no page size config info row mapper override public page config info find config info by group and advance final int page no final int page size final string group final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant final string app name config advance info null null string config advance info get app name final string config tag config advance info null null string config advance info get config tag string builder sql count new string builder select count from config info where group id and tenant id string builder sql new string builder select id datum id group id tenant id app name content from config info where group id and tenant id list string param list new array list string param list add group param list add tenant tmp if string util be not blank config tag sql count new string builder select count from config info a left join config tag relation b on a id b id where a group id and a tenant id sql new string builder select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where a group id and a tenant id sql count append and b tag name in sql append and b tag name in string tag arr config tag split for int i i tag arr length i if i sql count append sql append sql count append sql append param list add tag arr i sql count append sql append if string util be not blank app name sql count append and a app name sql append and a app name param list add app name else if string util be not blank app name sql count append and app name sql append and app name param list add app name pagination helper config info helper create pagination helper return helper fetch page sql count to string sql to string param list to array page no page size config info row mapper override public page config info find config info by app final int page no final int page size final string tenant final string app name string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper return helper fetch page select count from config info where tenant id like and app name select id datum id group id tenant id app name content from config info where tenant id like and app name new object generate like argument tenant tmp app name page no page size config info row mapper override public page config info find config info by advance final int page no final int page size final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant final string app name config advance info null null string config advance info get app name final string config tag config advance info null null string config advance info get config tag string builder sql count new string builder select count from config info where tenant id like string builder sql new string builder select id datum id group id tenant id app name content from config info where tenant id like list string param list new array list string param list add tenant tmp if string util be not blank config tag sql count new string builder select count from config info a left join config tag relation b on a id b id where a tenant id sql new string builder select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where a tenant id sql count append and b tag name in sql append and b tag name in string tag arr config tag split for int i i tag arr length i if i sql count append sql append sql count append sql append param list add tag arr i sql count append sql append if string util be not blank app name sql count append and a app name sql append and a app name param list add app name else if string util be not blank app name sql count append and app name sql append and app name param list add app name pagination helper config info helper create pagination helper return helper fetch page sql count to string sql to string param list to array page no page size config info row mapper override public page config info base find config info base by group final int page no final int page size final string group pagination helper config info base helper create pagination helper return helper fetch page select count from config info where group id and tenant id select id datum id group id content from config info where group id and tenant id new object group string util empty page no page size config info base row mapper override public int config info count string sql select count id from config info integer result database operate query one sql integer class if result null throw new illegal argument exception config info count error return result override public int config info count string tenant string sql select count id from config info where tenant id like tenant integer result database operate query one sql integer class if result null throw new illegal argument exception config info count error return result override public int config info beta count string sql select count id from config info beta integer result database operate query one sql integer class if result null throw new illegal argument exception config info beta count error return result override public int config info tag count string sql select count id from config info tag integer result database operate query one sql integer class if result null throw new illegal argument exception config info beta count error return result override public list string get tenant id list int page int page size string sql select tenant id from config info where tenant id group by tenant id limit int from page page size return database operate query many sql new object from page size string class override public list string get group id list int page int page size string sql select group id from config info where tenant id group by group id limit int from page page size return database operate query many sql new object from page size string class override public int aggr config info count string datum id string group string tenant string tenant tmp string util be blank tenant string util empty tenant string sql select count id from config info aggr where datum id and group id and tenant id integer result database operate query one sql new object datum id group tenant tmp integer class if result null throw new illegal argument exception aggr config info count error return result override public int aggr config info count string datum id string group string tenant list string datum id boolean be in if datum id null datum id be empty return final string tenant tmp string util be blank tenant string util empty tenant string builder sql new string builder select count from config info aggr where datum id and group id and tenant id and datum id if be in sql append in else sql append not in for int i size datum id size i size i if i sql append sql append sql append list object object list list object new array list datum id group tenant tmp object list add all datum id integer result database operate query one sql to string object list to array integer class if result null throw new illegal argument exception aggr config info count error return result override public int aggr config info count in string datum id string group string tenant list string datum id return aggr config info count datum id group tenant datum id true override public int aggr config info count not in string datum id string group string tenant list string datum id return aggr config info count datum id group tenant datum id false override public page config info find all config info final int page no final int page size final string tenant string tenant tmp string util be blank tenant string util empty tenant string sql count row select count from config info string sql fetch row select t id datum id group id tenant id app name content md5 from select id from config info where tenant id like order by id limit g config info t where g id t id pagination helper config info helper create pagination helper return helper fetch page limit sql count row sql fetch row new object generate like argument tenant tmp page no page size page size page no page size config info row mapper override public page config key find all config key final int page no final int page size final string tenant final string tenant tmp string util be blank tenant string util empty tenant final string select select datum id group id app name from select id from config info where tenant id like order by id limit g config info t where g id t id final int total count config info count tenant int page count total count page size if total count page size page count page count if page no page count return null final page config key page new page config key page set page number page no page set page available page count page set total count total count list config key result database operate query many select new object generate like argument tenant tmp page no page size page size new object config key row mapper for config key item result page get page item add item return page override public page config info base find all config info base final int page no final int page size string sql count row select count from config info string sql fetch row select t id datum id group id content md5 from select id from config info order by id limit g config info t where g id t id pagination helper config info base helper create pagination helper return helper fetch page limit sql count row sql fetch row new object page no page size page size page no page size config info base row mapper override public page config info wrapper find all config info for dump all final int page no final int page size string sql count row select count from config info string sql fetch row select t id datum id group id tenant id app name content type md5 gmt modify from select id from config info order by id limit g config info t where g id t id pagination helper config info wrapper helper create pagination helper return helper fetch page limit sql count row sql fetch row empty array page no page size config info wrapper row mapper override public page config info wrapper find all config info fragment final long last max id final int page size string select select id datum id group id tenant id app name content md5 gmt modify type from config info where id order by id asc limit pagination helper config info wrapper helper create pagination helper return helper fetch page limit select new object last max id page size page size config info wrapper row mapper override public page config info beta wrapper find all config info beta for dump all final int page no final int page size string sql count row select count from config info beta string sql fetch row select t id datum id group id tenant id app name content md5 gmt modify beta ip from select id from config info beta order by id limit g config info beta t where g id t id pagination helper config info beta wrapper helper create pagination helper return helper fetch page limit sql count row sql fetch row new object page no page size page size page no page size config info beta wrapper row mapper override public page config info tag wrapper find all config info tag for dump all final int page no final int page size string sql count row select count from config info tag string sql fetch row select t id datum id group id tenant id tag id app name content md5 gmt modify from select id from config info tag order by id limit g config info tag t where g id t id pagination helper config info tag wrapper helper create pagination helper return helper fetch page limit sql count row sql fetch row new object page no page size page size page no page size config info tag wrapper row mapper override public list config info find config info by batch final list string data id final string group final string tenant int sub query limit assert dataid group not null string tenant tmp string util be blank tenant string util empty tenant if dataid empty return empty list if collection util be empty datum id return collection empty list volume query upper limit the number of in be within the shorter the sql statement the better if sub query limit query limit size sub query limit list config info result new array list config info datum id size string sql start select datum id group id tenant id app name content from config info where group id and tenant id and data id in string sql end string builder sub query sql new string builder for int i i datum id size i sub query limit dataid list string param new array list string datum id sub list i math min i sub query limit datum id size for int j j param size j sub query sql append if j param size sub query sql append group param add group param add tenant tmp final string sql sql start sub query sql to string sql end list config info r database operate query many sql param to array config info row mapper assert not null if r null r size result add all r return result override public page config info find config info like final int page no final int page size final string data id final string group final string tenant final string app name final string content string tenant tmp string util be blank tenant string util empty tenant if string util be blank datum id string util be blank group if string util be blank app name return this find all config info page no page size tenant tmp else return this find config info by app page no page size tenant tmp app name final string sql count row select count from config info where final string sql fetch row select id datum id group id tenant id app name content from config info where string where 1 = 1 list string param new array list string if string util be blank datum id where and datum id like param add generate like argument datum id if string util be blank group where and group id like param add generate like argument group where and tenant id like param add generate like argument tenant tmp if string util be blank app name where and app name param add app name if string util be blank content where and content like param add generate like argument content pagination helper config info helper create pagination helper return helper fetch page sql count row where sql fetch row where param to array page no page size config info row mapper override public page config info find config info like final int page no final int page size final config key config key final boolean blacklist string sql count row select count from config info where string sql fetch row select id datum id group id tenant id app name content from config info where string builder where new string builder 1 = 1 white list please synchronize the condition be empty there be no qualified configuration if config key length blacklist page config info page new page config info page set total count return page list string param new array list string boolean be first true for config key config info config key string data id config info get datum id string group config info get group string app name config info get app name if string util be blank datum id string util be blank group string util be blank app name break if blacklist if be first be first false where append and else where append and where append boolean be first sub true if string util be blank datum id where append datum id not like param add generate like argument datum id be first sub false if string util be blank group if be first sub where append or where append group id not like param add generate like argument group be first sub false if string util be blank app name if be first sub where append or where append app name param add app name be first sub false where append else if be first be first false where append and else where append or where append boolean be first sub true if string util be blank datum id where append datum id like param add generate like argument datum id be first sub false if string util be blank group if be first sub where append and where append group id like param add generate like argument group be first sub false if string util be blank app name if be first sub where append and where append app name param add app name be first sub false where append pagination helper config info helper create pagination helper return helper fetch page sql count row where to string sql fetch row where to string param to array page no page size config info row mapper override public page config info find config info like4 page final int page no final int page size final string data id final string group final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant final string app name config advance info null null string config advance info get app name final string content config advance info null null string config advance info get content final string config tag config advance info null null string config advance info get config tag string sql count row select count from config info string sql fetch row select id datum id group id tenant id app name content from config info string builder where new string builder where list string param new array list string param add generate like argument tenant tmp if string util be not blank config tag sql count row select count from config info a left join config tag relation b on a id b id sql fetch row select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where append a tenant id like if string util be blank datum id where append and a data id like param add generate like argument datum id if string util be blank group where append and a group id like param add generate like argument group if string util be blank app name where append and a app name param add app name if string util be blank content where append and a content like param add generate like argument content where append and b tag name in string tag arr config tag split for int i i tag arr length i if i where append where append param add tag arr i where append else where append tenant id like if string util be blank datum id where append and datum id like param add generate like argument datum id if string util be blank group where append and group id like param add generate like argument group if string util be blank app name where append and app name param add app name if string util be blank content where append and content like param add generate like argument content pagination helper config info helper create pagination helper return helper fetch page sql count row where sql fetch row where param to array page no page size config info row mapper override public page config info base find config info base like final int page no final int page size final string data id final string group final string content throw i o exception if string util be blank datum id string util be blank group throw new i o exception invalid param final string sql count row select count from config info where final string sql fetch row select id datum id group id tenant id content from config info where string where 1 = 1 and tenant id list string param new array list string if string util be blank datum id where and datum id like param add generate like argument datum id if string util be blank group where and group id like param add generate like argument group if string util be blank content where and content like param add generate like argument content pagination helper config info base helper create pagination helper return helper fetch page sql count row where sql fetch row where param to array page no page size config info base row mapper override public config info aggr find single config info aggr string datum id string group string tenant string datum id string tenant tmp string util be blank tenant string util empty tenant string sql select id datum id group id tenant id datum id app name content from config info aggr where datum id and group id and tenant id and datum id return database operate query one sql new object datum id group tenant tmp datum id config info aggr row mapper override public list config info aggr find config info aggr string datum id string group string tenant string tenant tmp string util be blank tenant string util empty tenant string sql select datum id group id tenant id datum id app name content from config info aggr where datum id and group id and tenant id order by datum id return database operate query many sql new object datum id group tenant tmp config info aggr row mapper override public page config info aggr find config info aggr by page string datum id string group string tenant final int page no final int page size string tenant tmp string util be blank tenant string util empty tenant string sql count row select count from config info aggr where datum id and group id and tenant id string sql fetch row select datum id group id tenant id datum id app name content from config info aggr where datum id and group id and tenant id order by datum id limit pagination helper config info aggr helper create pagination helper return helper fetch page limit sql count row new object datum id group tenant tmp sql fetch row new object datum id group tenant tmp page no page size page size page no page size config info aggr row mapper override public page config info aggr find config info aggr like final int page no final int page size config key config key boolean blacklist string sql count row select count from config info aggr where string sql fetch row select datum id group id tenant id datum id app name content from config info aggr where string builder where new string builder 1 = 1 white list please synchronize the condition be empty there be no qualified configuration if config key length blacklist false page config info aggr page new page config info aggr page set total count return page list string param new array list string boolean be first true for config key config info aggr config key string data id config info aggr get datum id string group config info aggr get group string app name config info aggr get app name if string util be blank datum id string util be blank group string util be blank app name break if blacklist if be first be first false where append and else where append and where append boolean be first sub true if string util be blank datum id where append datum id not like param add generate like argument datum id be first sub false if string util be blank group if be first sub where append or where append group id not like param add generate like argument group be first sub false if string util be blank app name if be first sub where append or where append app name param add app name be first sub false where append else if be first be first false where append and else where append or where append boolean be first sub true if string util be blank datum id where append datum id like param add generate like argument datum id be first sub false if string util be blank group if be first sub where append and where append group id like param add generate like argument group be first sub false if string util be blank app name if be first sub where append and where append app name param add app name be first sub false where append pagination helper config info aggr helper create pagination helper return helper fetch page sql count row where to string sql fetch row where to string param to array page no page size config info aggr row mapper override public list config info change find all aggr group string sql select distinct datum id group id tenant id from config info aggr return database operate query many sql empty array config info change row mapper override public list string find datum id by content string datum id string group id string content string sql select datum id from config info aggr where datum id and group id and content return database operate query many sql new object datum id group id content string class override public list config info wrapper find change config final timestamp start time final timestamp end time list map string object list database operate query many select datum id group id tenant id app name content gmt modify from config info where gmt modify and gmt modify new object start time end time return convert change config list override public page config info wrapper find change config final string data id final string group final string tenant final string app name final timestamp start time final timestamp end time final int page no final int page size final long last max id string tenant tmp string util be blank tenant string util empty tenant final string sql count row select count from config info where final string sql fetch row select id datum id group id tenant id app name content type md5 gmt modify from config info where string where 1 = 1 list object param new array list object if string util be blank datum id where and datum id like param add generate like argument datum id if string util be blank group where and group id like param add generate like argument group if string util be blank tenant tmp where and tenant id param add tenant tmp if string util be blank app name where and app name param add app name if start time null where and gmt modify param add start time if end time null where and gmt modify param add end time pagination helper config info wrapper helper create pagination helper return helper fetch page sql count row where sql fetch row where param to array page no page size last max id config info wrapper row mapper override public list config info find delete config final timestamp start time final timestamp end time list map string object list database operate query many select distinct datum id group id tenant id from he config info where op type d and gmt modify and gmt modify new object start time end time return convert delete config list override public long add config info atomic final long id final string src ip final string src user final config info config info final timestamp time map string object config advance info final string app name tmp string util be blank config info get app name string util empty config info get app name final string tenant tmp string util be blank config info get tenant string util empty config info get tenant final string desc config advance info null null string config advance info get desc final string use config advance info null null string config advance info get use final string effect config advance info null null string config advance info get effect final string type config advance info null null string config advance info get type final string schema config advance info null null string config advance info get schema final string md5 tmp m d5 util md5 hex config info get content constant encode final string sql insert into config info id datum id group id tenant id app name content md5 src ip src user gmt create gmt modify c desc c use effect type c schema value final object arg new object id config info get datum id config info get group tenant tmp app name tmp config info get content md5 tmp src ip src user time time desc use effect type schema embed storage context util add sql context sql arg return id override public void add config tag relation atomic long config id string tag name string datum id string group string tenant final string sql insert into config tag relation id tag name tag type datum id group id tenant id value final object arg new object config id tag name null datum id group tenant embed storage context util add sql context sql arg override public void add config tag relation long config id string config tag string data id string group string tenant if string util be not blank config tag string tag arr config tag split for int i i tag arr length i add config tag relation atomic config id tag arr i datum id group tenant override public void remove tag by id atomic long id final string sql delete from config tag relation where id final object arg new object id embed storage context util add sql context sql arg override public list string get config tag by tenant string tenant string sql select tag name from config tag relation where tenant id return database operate query many sql new object tenant string class override public list string select tag by config string datum id string group string tenant string sql select tag name from config tag relation where datum id and group id and tenant id return database operate query many sql new object datum id group tenant string class override public void remove config info atomic final string data id final string group final string tenant final string src ip final string src user string tenant tmp string util be blank tenant string util empty tenant final string sql delete from config info where datum id and group id and tenant id final object arg new object datum id group tenant tmp embed storage context util add sql context sql arg override public void remove config info by id atomic final string id if string util be blank id return string builder sql new string builder sql delete config info by id sql append id in list long param list new array list string tag arr id split for int i i tag arr length i if i sql append sql append param list add long parse long tag arr i sql append embed storage context util add sql context sql to string param list to array override public void remove config info tag final string data id final string group final string tenant final string tag final string src ip final string src user string tenant tmp string util be blank tenant string util empty tenant string tag tmp string util be blank tag string util empty tag final string sql delete from config info tag where datum id and group id and tenant id and tag id final object arg new object datum id group tenant tmp tag tmp embed storage context util on delete config tag info tenant tmp group data id tag tmp src ip embed storage context util add sql context sql arg try database operate update embed storage context util get current sql context finally embed storage context util clean all context override public void update config info atomic final config info config info final string src ip final string src user final timestamp time map string object config advance info final string app name tmp string util be blank config info get app name string util empty config info get app name final string tenant tmp string util be blank config info get tenant string util empty config info get tenant final string md5 tmp m d5 util md5 hex config info get content constant encode final string desc config advance info null null string config advance info get desc final string use config advance info null null string config advance info get use final string effect config advance info null null string config advance info get effect final string type config advance info null null string config advance info get type final string schema config advance info null null string config advance info get schema final string sql update config info set content md5 src ip src user gmt modify app name c desc c use effect type c schema where datum id and group id and tenant id final object arg new object config info get content md5 tmp src ip src user time app name tmp desc use effect type schema config info get datum id config info get group tenant tmp embed storage context util add sql context sql arg override public list config info find config info by id final string id if string util be blank id return null string builder sql new string builder sql find config info by id sql append id in list long param list new array list string tag arr id split for int i i tag arr length i if i sql append sql append param list add long parse long tag arr i sql append return database operate query many sql to string param list to array config info row mapper override public config advance info find config advance info final string data id final string group final string tenant final string tenant tmp string util be blank tenant string util empty tenant list string config tag list this select tag by config datum id group tenant config advance info config advance database operate query one select gmt create gmt modify src user src ip c desc c use effect type c schema from config info where datum id and group id and tenant id new object datum id group tenant tmp config advance info row mapper if collection util be not empty config tag list string builder config tag tmp new string builder for string config tag config tag list if config tag tmp length config tag tmp append config tag else config tag tmp append append config tag config advance set config tag config tag tmp to string return config advance override public config all info find config all info final string data id final string group final string tenant final string tenant tmp string util be blank tenant string util empty tenant final string sql select id datum id group id tenant id app name content md5 gmt create gmt modify src user src ip c desc c use effect type c schema from config info where datum id and group id and tenant id list string config tag list select tag by config datum id group tenant config all info config advance database operate query one sql new object datum id group tenant tmp config all info row mapper if config tag list null config tag list be empty string builder config tag tmp new string builder for string config tag config tag list if config tag tmp length config tag tmp append config tag else config tag tmp append append config tag config advance set config tag config tag tmp to string return config advance override public void insert config history atomic long config history id config info config info string src ip string src user final timestamp time string op string app name tmp string util be blank config info get app name string util empty config info get app name string tenant tmp string util be blank config info get tenant string util empty config info get tenant final string md5 tmp m d5 util md5 hex config info get content constant encode final string sql insert into he config info id datum id group id tenant id app name content md5 src ip src user gmt modify op type value final object arg new object config history id config info get datum id config info get group tenant tmp app name tmp config info get content md5 tmp src ip src user time op embed storage context util add sql context sql arg override public page config history info find config history string datum id string group string tenant int page no int page size string tenant tmp string util be blank tenant string util empty tenant string sql count row select count from he config info where datum id and group id and tenant id string sql fetch row select nid datum id group id tenant id app name src ip op type gmt create gmt modify from he config info where datum id and group id and tenant id order by nid desc pagination helper config history info helper create pagination helper return helper fetch page sql count row sql fetch row new object datum id group tenant tmp page no page size history list row mapper override public void add config sub atomic final string data id final string group final string app name final timestamp date final string app name tmp app name null app name final long id id generator manager next id resource app configdata relation sub final string sql insert into app configdata relation sub id datum id group id app name gmt modify value final object arg new object id datum id group app name tmp date embed storage context util add sql context sql arg try database operate update embed storage context util get current sql context finally embed storage context util clean all context override public void update config sub atomic final string data id final string group final string app name final timestamp time final string app name tmp app name null app name final string sql update app configdata relation sub set gmt modify where datum id and group id and app name final object arg new object time datum id group app name tmp embed storage context util add sql context sql arg try database operate update embed storage context util get current sql context finally embed storage context util clean all context override public config history info detail config history long nid string sql fetch row select nid datum id group id tenant id app name content md5 src user src ip op type gmt create gmt modify from he config info where nid return database operate query one sql fetch row new object nid history detail row mapper override public void insert tenant info atomic string kp string tenant id string tenant name string tenant desc string create resoure final long time final string sql insert into tenant info kp tenant id tenant name tenant desc create source gmt create gmt modify value final object arg new object kp tenant id tenant name tenant desc create resoure time time embed storage context util add sql context sql arg try boolean result database operate update embed storage context util get current sql context if result throw new naco config exception namespace creation fail finally embed storage context util clean all context override public void update tenant name atomic string kp string tenant id string tenant name string tenant desc final string sql update tenant info set tenant name tenant desc gmt modify where kp and tenant id final object arg new object tenant name tenant desc system current time millis kp tenant id embed storage context util add sql context sql arg try boolean result database operate update embed storage context util get current sql context if result throw new naco config exception namespace update fail finally embed storage context util clean all context override public list tenant info find tenant by kp string kp string sql select tenant id tenant name tenant desc from tenant info where kp return database operate query many sql new object kp tenant info row mapper override public tenant info find tenant by kp string kp string tenant id string sql select tenant id tenant name tenant desc from tenant info where kp and tenant id return database operate query one sql new object kp tenant id tenant info row mapper override public void remove tenant info atomic final string kp final string tenant id embed storage context util add sql context delete from tenant info where kp and tenant id kp tenant id try database operate update embed storage context util get current sql context finally embed storage context util clean all context override public list config info convert delete config list map string object list list config info config new array list config info for map string object map list string datum id string map get datum id string group string map get group id string tenant string map get tenant id config info config new config info config set datum id data id config set group group config set tenant tenant config add config return config override public list config info wrapper convert change config list map string object list list config info wrapper config new array list config info wrapper for map string object map list string datum id string map get datum id string group string map get group id string tenant string map get tenant id string content string map get content long m time timestamp map get gmt modify get time config info wrapper config new config info wrapper config set datum id data id config set group group config set tenant tenant config set content content config set last modify m time config add config return config override public list config info wrapper list all group key md5 final int page size int total count config info count int page count int math ceil total count 1.0 page size list config info wrapper all config info new array list config info wrapper for int page no page no page count page no list config info wrapper config info list list group key md5 by page page no page size all config info add all config info list return all config info override public list config info wrapper list group key md5 by page int page no int page size string sql count row select count from config info string sql fetch row select t id datum id group id tenant id app name type md5 gmt modify from select id from config info order by id limit g config info t where g id t id pagination helper config info wrapper helper create pagination helper page config info wrapper page helper fetch page limit sql count row sql fetch row new object page no page size page size page no page size config info wrapper row mapper return page get page item override public string generate like argument string s string fuzzy search sign string sql like percent sign if s contain pattern str return s replace all fuzzy search sign sql like percent sign else return s override public config info wrapper query config info final string data id final string group final string tenant string tenant tmp string util be blank tenant string util empty tenant final string sql select id datum id group id tenant id app name content type gmt modify md5 from config info where datum id and group id and tenant id return database operate query one sql new object datum id group tenant tmp config info wrapper row mapper override public boolean be exist table string table name string sql string format select from s limit table name try database operate query one sql integer class return true catch throwable e return false override public boolean complete md5 default log info start complete md5 int per page size int row count config info count int page count int math ceil row count 1.0 per page size int actual row count for int page no page no page count page no page config info wrapper page find all config info for dump all page no per page size if page null for config info wrapper cf page get page item string md5 in db cf get md5 final string content cf get content final string tenant cf get tenant final string md5 m d5 util md5 hex content constant encode if string util be blank md5 in db try update md5 cf get datum id cf get group tenant md5 new timestamp cf get last modify catch throwable e log util default log error complete md5 error dat id group last modify cf get datum id cf get group new timestamp cf get last modify else if md5 in db equal md5 try update md5 cf get datum id cf get group tenant md5 new timestamp cf get last modify catch throwable e log util default log error complete md5 error dat id group last modify cf get datum id cf get group new timestamp cf get last modify actual row count page get page item size default log info complete md5 actual row count row count return true override public list config all info find all config info4 export final string data id final string group final string tenant final string app name final list long id string tenant tmp string util be blank tenant string util empty tenant string builder where new string builder where list object param list new array list if collection util be empty id where append id in for int i i id size i if i where append where append param list add id get i where append else where append tenant id param list add tenant tmp if string util be blank datum id where append and datum id like param list add generate like argument datum id if string util be not blank group where append and group id param list add group if string util be not blank app name where append and app name param list add app name return database operate query many sql find all config info where param list to array config all info row mapper override public map string object batch insert or update list config all info config info list string src user string src ip map string object config advance info timestamp time boolean notify same config policy policy throw naco exception int succ count int skip count list map string string fail datum null list map string string skip datum null for int i i config info list size i config all info config info config info list get i try param util check param config info get datum id config info get group datum id config info get content catch throwable e default log error datum verification fail e throw e config info config info2 save new config info config info get datum id config info get group config info get tenant config info get app name config info get content string type config info get type if string util be blank type simple judgment of file type base on suffix if config info get datum id contain spot string ext name config info get datum id substr config info get datum id last index of spot to upper case try type file type enum value of ext name to upper case get file type catch throwable ex type file type enum text get file type if config advance info null config advance info new hash map config advance info put type type try add config info src ip src user config info2 save time config advance info notify succ count catch throwable e if string util contain duplicate key exception e to string throw e uniqueness constraint conflict if same config policy abort equal policy fail datum new array list skip datum new array list map string string faileditem new hash map faileditem put datum id config info2 save get datum id faileditem put group config info2 save get group fail datum add faileditem for int j i j config info list size j config info skip config info config info list get j map string string skipitem new hash map skipitem put datum id skip config info get datum id skipitem put group skip config info get group skip datum add skipitem break else if same config policy skip equal policy skip count if skip datum null skip datum new array list map string string skipitem new hash map skipitem put datum id config info2 save get datum id skipitem put group config info2 save get group skip datum add skipitem else if same config policy overwrite equal policy succ count update config info config info2 save src ip src user time config advance info notify map string object result new hash map result put succ count succ count result put skip count skip count if fail datum null fail datum be empty result put fail datum fail datum if skip datum null skip datum be empty result put skip datum skip datum return result override public int tenant info count by tenant id string tenant id assert have text tenant id tenant id can not be null integer result database operate query one sql tenant info count by tenant id new string tenant id integer class if result null return return result 
standalone database operate impl conditional condition standalone embed storage class component public class standalone database operate impl implement base database operate private jdbc template jdbc template private transaction template transaction template post construct protect void init datum source service datum source service dynamic datum source get instance get datum source jdbc template datum source service get jdbc template transaction template datum source service get transaction template log util default log info use standalone database operate impl override public r r query one string sql class r cl return query one jdbc template sql cl override public r r query one string sql object arg class r cl return query one jdbc template sql args cl override public r r query one string sql object arg row mapper r mapper return query one jdbc template sql arg mapper override public r list r query many string sql object arg row mapper r mapper return query many jdbc template sql arg mapper override public r list r query many string sql object arg class be r class return query many jdbc template sql arg be class override public list map string object query many string sql object arg return query many jdbc template sql arg override public completable future rest result string datum import file file return completable future supply async try disk util line iterator iterator disk util line iterator file int batch size list string batch update new array list batch size list completable future void future new array list list boolean result new copy on write array list while iterator have next string sql iterator next if string util be not blank sql batch update add sql if batch update size batch size iterator have next list modify request sql batch update stream map s modify request request new modify request request set sql s return request collect collector to list future add completable future run async result add do datum import jdbc template sql batch update clear completable future all of future to array new completable future join return rest result string builder with code boolean util and result to array new boolean with datum build catch throwable ex log util default log error a exception occur when external datum be import into derby ex return rest result util fail ex get message override public boolean update list modify request modify request bi consumer boolean throwable consumer return update modify request override public boolean update list modify request request list return update transaction template jdbc template request list 
external storage persist service impl suppress warning value pmd method return wrapper type rule checkstyle linelength conditional value condition on external storage class component public class external storage persist service impl implement persist service private datum source service datum source service private static final string sql find all config info select id datum id group id tenant id app name content type md5 gmt create gmt modify src user src ip c desc c use effect c schema from config info private static final string sql tenant info count by tenant id select count from tenant info where tenant id private static final string sql find config info by id select id datum id group id tenant id app name content md5 from config info where private static final string sql delete config info by id delete from config info where private static final string pattern str private static final int query limit size protect jdbc template jt protect transaction template tjt constant variable public static final string spot init datasource post construct public void init datum source service dynamic datum source get instance get datum source jt get jdbc template tjt get transaction template public boolean check master writable return datum source service check master writable public void set basic datum source service datum source service datum source service this data source service datum source service public synchronize void reload throw i o exception this data source service reload for unit test public jdbc template get jdbc template return this data source service get jdbc template public transaction template get transaction template return this data source service get transaction template suppress warning checkstyle abbreviation as word in name public string get current d b url return this data source service get current db url override public e pagination helper e create pagination helper return new external storage pagination helper impl e jt config info table insert update delete override public void add config info final string src ip final string src user final config info config info final timestamp time final map string object config advance info final boolean notify boolean result tjt execute status try long config id add config info atomic src ip src user config info time config advance info string config tag config advance info null null string config advance info get config tag add config tag relation config id config tag config info get datum id config info get group config info get tenant insert config history atomic config info src ip src user time i catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e return boolean true override public void add config info4 beta config info config info string beta ip string src ip string src user timestamp time boolean notify string app name tmp string util be blank config info get app name string util empty config info get app name string tenant tmp string util be blank config info get tenant string util empty config info get tenant string md5 m d5 util md5 hex config info get content constant encode try jt update insert into config info beta datum id group id tenant id app name content md5 beta ip src ip src user gmt create gmt modify value config info get datum id config info get group tenant tmp app name tmp config info get content md5 beta ip src ip src user time time catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void add config info4 tag config info config info string tag string src ip string src user timestamp time boolean notify string app name tmp string util be blank config info get app name string util empty config info get app name string tenant tmp string util be blank config info get tenant string util empty config info get tenant string tag tmp string util be blank tag string util empty tag trim string md5 m d5 util md5 hex config info get content constant encode try jt update insert into config info tag datum id group id tenant id tag id app name content md5 src ip src user gmt create gmt modify value config info get datum id config info get group tenant tmp tag tmp app name tmp config info get content md5 src ip src user time time catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void update config info final config info config info final string src ip final string src user final timestamp time final map string object config advance info final boolean notify boolean result tjt execute status try config info old config info find config info config info get datum id config info get group config info get tenant string app name tmp old config info get app name if the app name pass by the user be not empty use the persistent user s app name otherwise use db when empty app name you need to pass a empty string if config info get app name null config info set app name app name tmp update config info atomic config info src ip src user time config advance info string config tag config advance info null null string config advance info get config tag if config tag null delete all tag and then recreate remove tag by id atomic old config info get id add config tag relation old config info get id config tag config info get datum id config info get group config info get tenant insert config history atomic old config info get id old config info src ip src user time u catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e return boolean true override public void update config info4 beta config info config info string beta ip string src ip string src user timestamp time boolean notify string app name tmp string util be blank config info get app name string util empty config info get app name string tenant tmp string util be blank config info get tenant string util empty config info get tenant string md5 m d5 util md5 hex config info get content constant encode try jt update update config info beta set content md5 src ip src user gmt modify app name where datum id and group id and tenant id config info get content md5 src ip src user time app name tmp config info get datum id config info get group tenant tmp catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void update config info4 tag config info config info string tag string src ip string src user timestamp time boolean notify string app name tmp string util be blank config info get app name string util empty config info get app name string tenant tmp string util be blank config info get tenant string util empty config info get tenant string tag tmp string util be blank tag string util empty tag trim try string md5 m d5 util md5 hex config info get content constant encode jt update update config info tag set content md5 src ip src user gmt modify app name where datum id and group id and tenant id and tag id config info get content md5 src ip src user time app name tmp config info get datum id config info get group tenant tmp tag tmp catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void insert or update beta final config info config info final string beta ip final string src ip final string src user final timestamp time final boolean notify try add config info4 beta config info beta ip src ip null time notify catch datum integrity violation exception ive unique constraint conflict update config info4 beta config info beta ip src ip null time notify override public void insert or update tag final config info config info final string tag final string src ip final string src user final timestamp time final boolean notify try add config info4 tag config info tag src ip null time notify catch datum integrity violation exception ive unique constraint conflict update config info4 tag config info tag src ip null time notify override public void update md5 string datum id string group string tenant string md5 timestamp last time string tenant tmp string util be blank tenant string util empty tenant try jt update update config info set md5 where datum id and group id and tenant id and gmt modify md5 datum id group tenant tmp last time catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void insert or update string src ip string src user config info config info timestamp time map string object config advance info insert or update src ip src user config info time config advance info true override public void insert or update string src ip string src user config info config info timestamp time map string object config advance info boolean notify try add config info src ip src user config info time config advance info notify catch datum integrity violation exception ive unique constraint conflict update config info config info src ip src user time config advance info notify override public void insert or update sub sub info sub info try add config sub atomic sub info get datum id sub info get group sub info get app name sub info get date catch data integrity violation exception ive unique constraint conflict update config sub atomic sub info get datum id sub info get group sub info get app name sub info get date override public void remove config info final string data id final string group final string tenant final string src ip final string src user tjt execute new transaction callback boolean final timestamp time new timestamp system current time milli override public boolean do in transaction transaction status status try config info config info find config info datum id group tenant if config info null remove config info atomic datum id group tenant src ip src user remove tag by id atomic config info get id insert config history atomic config info get id config info src ip src user time d catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e return boolean true override public list config info remove config info by id final list long id final string src ip final string src user if collection util be empty id return null id remove all collection singleton null list config info result tjt execute new transaction callback list config info final timestamp time new timestamp system current time milli override public list config info do in transaction transaction status status try string id str joiner on join id list config info config info list find config info by id id str if collection util be empty config info list remove config info by id atomic id str for config info config info config info list remove tag by id atomic config info get id insert config history atomic config info get id config info src ip src user time d return config info list catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e return result override public void remove config info4 beta final string data id final string group final string tenant final string tenant tmp string util be blank tenant string util empty tenant tjt execute status try config info config info find config info4 beta datum id group tenant if config info null jt update delete from config info beta where datum id and group id and tenant id datum id group tenant tmp catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e return boolean true config aggr info table insert update delete override public boolean add aggr config info final string data id final string group string tenant final string datum id string app name final string content string app name tmp string util be blank app name string util empty app name string tenant tmp string util be blank tenant string util empty tenant final timestamp now new timestamp system current time millis string select select content from config info aggr where datum id and group id and tenant id and datum id string insert insert into config info aggr datum id group id tenant id datum id app name content gmt modify value string update update config info aggr set content gmt modify where datum id and group id and tenant id and datum id try try string db content jt query for object select new object datum id group tenant tmp datum id string class if db content null db content equal content return true else return jt update update content now data id group tenant tmp datum id catch empty result datum access exception ex no datum insert return jt update insert datum id group tenant tmp datum id app name tmp content now catch datum access exception e log util fatal log error db error e to string e throw e override public void remove single aggr config info final string data id final string group final string tenant final string datum id final string tenant tmp string util be blank tenant string util empty tenant string sql delete from config info aggr where datum id and group id and tenant id and datum id try this jt update sql new prepared statement setter override public void set value prepared statement ps throw s q l exception int index ps set string index datum id ps set string index group ps set string index tenant tmp ps set string index datum id catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void remove aggr config info final string data id final string group final string tenant final string tenant tmp string util be blank tenant string util empty tenant string sql delete from config info aggr where datum id and group id and tenant id try this jt update sql new prepared statement setter override public void set value prepared statement ps throw s q l exception int index ps set string index datum id ps set string index group ps set string index tenant tmp catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public boolean batch remove aggr final string data id final string group final string tenant final list string datum list final string tenant tmp string util be blank tenant string util empty tenant final string builder datum string new string builder for string datum datum list datum string append append datum append datum string delete char at datum string length final string sql delete from config info aggr where datum id and group id and tenant id and datum id in datum string to string try jt update sql datum id group tenant tmp catch can not get jdbc connection exception e log util fatal log error db error e to string e return false return true override public void remove config history final timestamp start time final int limit size string sql delete from he config info where gmt modify limit pagination helper config info helper create pagination helper try helper update limit sql new object start time limit size catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public int find config history count by time final timestamp start time string sql select count from he config info where gmt modify integer result jt query for object sql integer class new object start time if result null throw new illegal argument exception config info beta count error return result int value override public long find config max id string sql select max id from config info try return jt query for object sql long class catch null pointer exception e return override public boolean batch publish aggr final string data id final string group final string tenant final map string string datum map final string app name try boolean be publish ok tjt execute new transaction callback boolean override public boolean do in transaction transaction status status for map entry string string entry datum map entry set try if add aggr config info datum id group tenant entry get key app name entry get value throw new transaction system exception error in add aggr config info catch throwable e throw new transaction system exception error in add aggr config info return boolean true if be publish ok null return false return be publish ok catch transaction exception e log util fatal log error db error e to string e return false override public boolean replace aggr final string data id final string group final string tenant final map string string datum map final string app name try boolean be replace ok tjt execute new transaction callback boolean override public boolean do in transaction transaction status status try string app name tmp app name null app name remove aggr config info datum id group tenant string tenant tmp string util be blank tenant string util empty tenant string sql insert into config info aggr datum id group id tenant id datum id app name content gmt modify value for map entry string string datum entry datum map entry set jt update sql datum id group tenant tmp datum entry get key app name tmp datum entry get value new timestamp system current time milli catch throwable e throw new transaction system exception error in add aggr config info return boolean true if be replace ok null return false return be replace ok catch transaction exception e log util fatal log error db error e to string e return false deprecate override public list config info find all datum id and group string sql select distinct datum id group id from config info try return jt query sql new object config info row mapper catch empty result datum access exception e return collection empty list catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e catch exception e log util fatal log error db other error e get message e throw new runtime exception e override public config info4 beta find config info4 beta final string data id final string group final string tenant string tenant tmp string util be blank tenant string util empty tenant try return this jt query for object select id datum id group id tenant id app name content beta ip from config info beta where datum id and group id and tenant id new object datum id group tenant tmp config i n f o4 b e t a row mapper catch empty result datum access exception e indicate that the datum do not exist return null return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public config info4 tag find config info4 tag final string data id final string group final string tenant final string tag string tenant tmp string util be blank tenant string util empty tenant string tag tmp string util be blank tag string util empty tag trim try return this jt query for object select id datum id group id tenant id tag id app name content from config info tag where datum id and group id and tenant id and tag id new object datum id group tenant tmp tag tmp config i n f o4 t a g row mapper catch empty result datum access exception e indicate that the datum do not exist return null return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public config info find config info app final string data id final string group final string tenant final string app name string tenant tmp string util be blank tenant string util empty tenant try return this jt query for object select id datum id group id tenant id app name content from config info where datum id and group id and tenant id and app name new object datum id group tenant tmp app name config info row mapper catch empty result datum access exception e indicate that the datum do not exist return null return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public config info find config info advance info final string data id final string group final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant final string app name config advance info null null string config advance info get app name final string config tag config advance info null null string config advance info get config tag list string param list new array list string param list add datum id param list add group param list add tenant tmp string builder sql new string builder select id datum id group id tenant id app name content from config info where datum id and group id and tenant id if string util be not blank config tag sql new string builder select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where a data id and a group id and a tenant id sql append and b tag name in string tag arr config tag split for int i i tag arr length i if i sql append sql append param list add tag arr i sql append if string util be not blank app name sql append and a app name param list add app name else if string util be not blank app name sql append and app name param list add app name try return this jt query for object sql to string param list to array config info row mapper catch empty result datum access exception e indicate that the datum do not exist return null return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public config info base find config info base final string data id final string group try return this jt query for object select id datum id group id content from config info where datum id and group id and tenant id new object datum id group string util empty config info base row mapper catch empty result datum access exception e indicate that the datum do not exist return null return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public config info find config info long id try return this jt query for object select id datum id group id tenant id app name content from config info where id new object id config info row mapper catch empty result datum access exception e indicate that the datum do not exist return null return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public config info find config info final string data id final string group final string tenant final string tenant tmp string util be blank tenant string util empty tenant try return this jt query for object select id datum id group id tenant id app name content md5 type from config info where datum id and group id and tenant id new object datum id group tenant tmp config info row mapper catch empty result datum access exception e indicate that the datum do not exist return null return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info find config info by datum id final int page no final int page size final string data id final string tenant string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper try return helper fetch page select count from config info where datum id and tenant id select id datum id group id tenant id app name content from config info where datum id and tenant id new object datum id tenant tmp page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info find config info by datum id and app final int page no final int page size final string data id final string tenant final string app name string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper try return helper fetch page select count from config info where datum id and tenant id and app name select id datum id group id tenant id app name content from config info where datum id and tenant id and app name new object datum id tenant tmp app name page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info find config info by datum id and advance final int page no final int page size final string data id final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper final string app name config advance info null null string config advance info get app name final string config tag config advance info null null string config advance info get config tag string builder sql count new string builder select count from config info where datum id and tenant id string builder sql new string builder select id datum id group id tenant id app name content from config info where datum id and tenant id list string param list new array list string param list add datum id param list add tenant tmp if string util be not blank config tag sql count new string builder select count from config info a left join config tag relation b on a id b id where a data id and a tenant id sql new string builder select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where a data id and a tenant id sql count append and b tag name in sql append and b tag name in string tag arr config tag split for int i i tag arr length i if i sql count append sql append sql count append sql append param list add tag arr i sql count append sql append if string util be not blank app name sql count append and a app name sql append and a app name param list add app name else if string util be not blank app name sql count append and app name sql append and app name param list add app name try return helper fetch page sql count to string sql to string param list to array page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info find config info4 page final int page no final int page size final string data id final string group final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper final string app name config advance info null null string config advance info get app name final string config tag config advance info null null string config advance info get config tag string sql count select count from config info string sql select id datum id group id tenant id app name content type from config info string builder where new string builder where list string param list new array list string param list add tenant tmp if string util be not blank config tag sql count select count from config info a left join config tag relation b on a id b id sql select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where append a tenant id if string util be not blank datum id where append and a data id param list add datum id if string util be not blank group where append and a group id param list add group if string util be not blank app name where append and a app name param list add app name where append and b tag name in string tag arr config tag split for int i i tag arr length i if i where append where append param list add tag arr i where append else where append tenant id if string util be not blank datum id where append and datum id param list add datum id if string util be not blank group where append and group id param list add group if string util be not blank app name where append and app name param list add app name try return helper fetch page sql count where sql where param list to array page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info base find config info base by datum id final int page no final int page size final string datum id pagination helper config info base helper create pagination helper try return helper fetch page select count from config info where datum id and tenant id select id datum id group id content from config info where datum id and tenant id new object datum id string util empty page no page size config info base row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info find config info by group final int page no final int page size final string group final string tenant string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper try return helper fetch page select count from config info where group id and tenant id select id datum id group id tenant id app name content from config info where group id and tenant id new object group tenant tmp page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info find config info by group and app final int page no final int page size final string group final string tenant final string app name string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper try return helper fetch page select count from config info where group id and tenant id and app name select id datum id group id tenant id app name content from config info where group id and tenant id and app name new object group tenant tmp app name page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info find config info by group and advance final int page no final int page size final string group final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper final string app name config advance info null null string config advance info get app name final string config tag config advance info null null string config advance info get config tag string builder sql count new string builder select count from config info where group id and tenant id string builder sql new string builder select id datum id group id tenant id app name content from config info where group id and tenant id list string param list new array list string param list add group param list add tenant tmp if string util be not blank config tag sql count new string builder select count from config info a left join config tag relation b on a id b id where a group id and a tenant id sql new string builder select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where a group id and a tenant id sql count append and b tag name in sql append and b tag name in string tag arr config tag split for int i i tag arr length i if i sql count append sql append sql count append sql append param list add tag arr i sql count append sql append if string util be not blank app name sql count append and a app name sql append and a app name param list add app name else if string util be not blank app name sql count append and app name sql append and app name param list add app name try return helper fetch page sql count to string sql to string param list to array page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info find config info by app final int page no final int page size final string tenant final string app name string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper try return helper fetch page select count from config info where tenant id like and app name select id datum id group id tenant id app name content from config info where tenant id like and app name new object generate like argument tenant tmp app name page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info find config info by advance final int page no final int page size final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant pagination helper config info helper create pagination helper final string app name config advance info null null string config advance info get app name final string config tag config advance info null null string config advance info get config tag string builder sql count new string builder select count from config info where tenant id like string builder sql new string builder select id datum id group id tenant id app name content from config info where tenant id like list string param list new array list string param list add tenant tmp if string util be not blank config tag sql count new string builder select count from config info a left join config tag relation b on a id b id where a tenant id sql new string builder select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where a tenant id sql count append and b tag name in sql append and b tag name in string tag arr config tag split for int i i tag arr length i if i sql count append sql append sql count append sql append param list add tag arr i sql count append sql append if string util be not blank app name sql count append and a app name sql append and a app name param list add app name else if string util be not blank app name sql count append and app name sql append and app name param list add app name try return helper fetch page sql count to string sql to string param list to array page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info base find config info base by group final int page no final int page size final string group pagination helper config info base helper create pagination helper try return helper fetch page select count from config info where group id and tenant id select id datum id group id content from config info where group id and tenant id new object group string util empty page no page size config info base row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public int config info count string sql select count id from config info integer result jt query for object sql integer class if result null throw new illegal argument exception config info count error return result int value override public int config info count string tenant string sql select count id from config info where tenant id like tenant integer result jt query for object sql integer class if result null throw new illegal argument exception config info count error return result int value override public int config info beta count string sql select count id from config info beta integer result jt query for object sql integer class if result null throw new illegal argument exception config info beta count error return result int value override public int config info tag count string sql select count id from config info tag integer result jt query for object sql integer class if result null throw new illegal argument exception config info beta count error return result int value override public list string get tenant id list int page int page size string sql select tenant id from config info where tenant id group by tenant id limit int from page page size return jt query for list sql string class from page size override public list string get group id list int page int page size string sql select group id from config info where tenant id group by group id limit int from page page size return jt query for list sql string class from page size override public int aggr config info count string datum id string group string tenant string tenant tmp string util be blank tenant string util empty tenant string sql select count id from config info aggr where datum id and group id and tenant id integer result jt query for object sql integer class new object datum id group tenant tmp if result null throw new illegal argument exception aggr config info count error return result int value override public int aggr config info count string datum id string group string tenant list string datum id boolean be in if datum id null datum id be empty return final string tenant tmp string util be blank tenant string util empty tenant string builder sql new string builder select count from config info aggr where datum id and group id and tenant id and datum id if be in sql append in else sql append not in for int i size datum id size i size i if i sql append sql append sql append list object object list list object new array list datum id group tenant tmp object list add all datum id integer result jt query for object sql to string integer class object list to array if result null throw new illegal argument exception aggr config info count error return result int value override public int aggr config info count in string datum id string group string tenant list string datum id return aggr config info count datum id group tenant datum id true override public int aggr config info count not in string datum id string group string tenant list string datum id return aggr config info count datum id group tenant datum id false override public page config info find all config info final int page no final int page size final string tenant string tenant tmp string util be blank tenant string util empty tenant string sql count row select count from config info string sql fetch row select t id datum id group id tenant id app name content md5 from select id from config info where tenant id like order by id limit g config info t where g id t id pagination helper config info helper create pagination helper try return helper fetch page limit sql count row sql fetch row new object generate like argument tenant tmp page no page size page size page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config key find all config key final int page no final int page size final string tenant string tenant tmp string util be blank tenant string util empty tenant string select select datum id group id app name from select id from config info where tenant id like order by id limit g config info t where g id t id final int total count config info count tenant int page count total count page size if total count page size page count page count if page no page count return null final page config key page new page config key page set page number page no page set page available page count page set total count total count try list config key result jt query select new object generate like argument tenant tmp page no page size page size new object config key row mapper for config key item result page get page item add item return page catch empty result datum access exception e return page catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override deprecate public page config info base find all config info base final int page no final int page size string sql count row select count from config info string sql fetch row select t id datum id group id content md5 from select id from config info order by id limit g config info t where g id t id pagination helper config info base helper create pagination helper try return helper fetch page limit sql count row sql fetch row new object page no page size page size page no page size config info base row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info wrapper find all config info for dump all final int page no final int page size string sql count row select count from config info string sql fetch row select t id type datum id group id tenant id app name content md5 gmt modify from select id from config info order by id limit g config info t where g id t id pagination helper config info wrapper helper create pagination helper list string param new array list string try return helper fetch page limit sql count row sql fetch row param to array page no page size config info wrapper row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info wrapper find all config info fragment final long last max id final int page size string select select id datum id group id tenant id app name content md5 gmt modify type from config info where id order by id asc limit pagination helper config info wrapper helper create pagination helper try return helper fetch page limit select new object last max id page size page size config info wrapper row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info beta wrapper find all config info beta for dump all final int page no final int page size string sql count row select count from config info beta string sql fetch row select t id datum id group id tenant id app name content md5 gmt modify beta ip from select id from config info beta order by id limit g config info beta t where g id t id pagination helper config info beta wrapper helper create pagination helper try return helper fetch page limit sql count row sql fetch row new object page no page size page size page no page size config info beta wrapper row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info tag wrapper find all config info tag for dump all final int page no final int page size string sql count row select count from config info tag string sql fetch row select t id datum id group id tenant id tag id app name content md5 gmt modify from select id from config info tag order by id limit g config info tag t where g id t id pagination helper config info tag wrapper helper create pagination helper try return helper fetch page limit sql count row sql fetch row new object page no page size page size page no page size config info tag wrapper row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public list config info find config info by batch final list string data id final string group final string tenant int sub query limit assert dataid group not null string tenant tmp string util be blank tenant string util empty tenant if dataid empty return empty list if collection util be empty datum id return collection empty list batch query limit the number of in be control within the shorter the length of the sql statement the better if sub query limit query limit size sub query limit list config info result new array list config info datum id size string sql start select datum id group id tenant id app name content from config info where group id and tenant id and data id in string sql end string builder sub query sql new string builder for int i i datum id size i sub query limit dataid list string param new array list string datum id sub list i i sub query limit datum id size i sub query limit datum id size for int j j param size j sub query sql append if j param size sub query sql append group param add group param add tenant tmp list config info be this jt query sql start sub query sql to string sql end param to array config info row mapper assert not null if r null r size result add all r return result override public page config info find config info like final int page no final int page size final string data id final string group final string tenant final string app name final string content string tenant tmp string util be blank tenant string util empty tenant if string util be blank datum id string util be blank group if string util be blank app name return this find all config info page no page size tenant tmp else return this find config info by app page no page size tenant tmp app name pagination helper config info helper create pagination helper string sql count row select count from config info where string sql fetch row select id datum id group id tenant id app name content from config info where string where 1 = 1 list string param new array list string if string util be blank datum id where and datum id like param add generate like argument datum id if string util be blank group where and group id like param add generate like argument group where and tenant id like param add generate like argument tenant tmp if string util be blank app name where and app name param add app name if string util be blank content where and content like param add generate like argument content try return helper fetch page sql count row where sql fetch row where param to array page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info find config info like final int page no final int page size final config key config key final boolean blacklist string sql count row select count from config info where string sql fetch row select id datum id group id tenant id app name content from config info where string builder where new string builder 1 = 1 whitelist please leave the synchronization condition empty there be no configuration that meet the condition if config key length blacklist false page config info page new page config info page set total count return page pagination helper config info helper create pagination helper list string param new array list string boolean be first true for config key config info config key string data id config info get datum id string group config info get group string app name config info get app name if string util be blank datum id string util be blank group string util be blank app name break if blacklist if be first be first false where append and else where append and where append boolean be first sub true if string util be blank datum id where append datum id not like param add generate like argument datum id be first sub false if string util be blank group if be first sub where append or where append group id not like param add generate like argument group be first sub false if string util be blank app name if be first sub where append or where append app name param add app name be first sub false where append else if be first be first false where append and else where append or where append boolean be first sub true if string util be blank datum id where append datum id like param add generate like argument datum id be first sub false if string util be blank group if be first sub where append and where append group id like param add generate like argument group be first sub false if string util be blank app name if be first sub where append and where append app name param add app name be first sub false where append try return helper fetch page sql count row where to string sql fetch row where to string param to array page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info find config info like4 page final int page no final int page size final string data id final string group final string tenant final map string object config advance info string tenant tmp string util be blank tenant string util empty tenant final string app name config advance info null null string config advance info get app name final string content config advance info null null string config advance info get content final string config tag config advance info null null string config advance info get config tag pagination helper config info helper create pagination helper string sql count row select count from config info string sql fetch row select id datum id group id tenant id app name content from config info string builder where new string builder where list string param new array list string param add generate like argument tenant tmp if string util be not blank config tag sql count row select count from config info a left join config tag relation b on a id b id sql fetch row select a id a data id a group id a tenant id a app name a content from config info a left join config tag relation b on a id b id where append a tenant id like if string util be blank datum id where append and a data id like param add generate like argument datum id if string util be blank group where append and a group id like param add generate like argument group if string util be blank app name where append and a app name param add app name if string util be blank content where append and a content like param add generate like argument content where append and b tag name in string tag arr config tag split for int i i tag arr length i if i where append where append param add tag arr i where append else where append tenant id like if string util be blank datum id where append and datum id like param add generate like argument datum id if string util be blank group where append and group id like param add generate like argument group if string util be blank app name where append and app name param add app name if string util be blank content where append and content like param add generate like argument content try return helper fetch page sql count row where sql fetch row where param to array page no page size config info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info base find config info base like final int page no final int page size final string data id final string group final string content throw i o exception if string util be blank datum id string util be blank group throw new i o exception invalid param pagination helper config info base helper create pagination helper string sql count row select count from config info where string sql fetch row select id datum id group id tenant id content from config info where string where 1 = 1 and tenant id list string param new array list string if string util be blank datum id where and datum id like param add generate like argument datum id if string util be blank group where and group id like param add generate like argument group if string util be blank content where and content like param add generate like argument content try return helper fetch page sql count row where sql fetch row where param to array page no page size config info base row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public config info aggr find single config info aggr string datum id string group string tenant string datum id string tenant tmp string util be blank tenant string util empty tenant string sql select id datum id group id tenant id datum id app name content from config info aggr where datum id and group id and tenant id and datum id try return this jt query for object sql new object datum id group tenant tmp datum id config info aggr row mapper catch empty result datum access exception e empty result datum access exception indicate that the datum do not exist return null return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e catch exception e log util fatal log error db other error e get message e throw new runtime exception e override public list config info aggr find config info aggr string datum id string group string tenant string tenant tmp string util be blank tenant string util empty tenant string sql select datum id group id tenant id datum id app name content from config info aggr where datum id and group id and tenant id order by datum id try return this jt query sql new object datum id group tenant tmp config info aggr row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e catch empty result datum access exception e return collection empty list catch exception e log util fatal log error db other error e get message e throw new runtime exception e override public page config info aggr find config info aggr by page string datum id string group string tenant final int page no final int page size string tenant tmp string util be blank tenant string util empty tenant string sql count row select count from config info aggr where datum id and group id and tenant id string sql fetch row select datum id group id tenant id datum id app name content from config info aggr where datum id and group id and tenant id order by datum id limit pagination helper config info aggr helper create pagination helper try return helper fetch page limit sql count row new object datum id group tenant tmp sql fetch row new object datum id group tenant tmp page no page size page size page no page size config info aggr row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public page config info aggr find config info aggr like final int page no final int page size config key config key boolean blacklist string sql count row select count from config info aggr where string sql fetch row select datum id group id tenant id datum id app name content from config info aggr where string builder where new string builder 1 = 1 whitelist please leave the synchronization condition empty there be no configuration that meet the condition if config key length blacklist false page config info aggr page new page config info aggr page set total count return page pagination helper config info aggr helper create pagination helper list string param new array list string boolean be first true for config key config info aggr config key string data id config info aggr get datum id string group config info aggr get group string app name config info aggr get app name if string util be blank datum id string util be blank group string util be blank app name break if blacklist if be first be first false where append and else where append and where append boolean be first sub true if string util be blank datum id where append datum id not like param add generate like argument datum id be first sub false if string util be blank group if be first sub where append or where append group id not like param add generate like argument group be first sub false if string util be blank app name if be first sub where append or where append app name param add app name be first sub false where append else if be first be first false where append and else where append or where append boolean be first sub true if string util be blank datum id where append datum id like param add generate like argument datum id be first sub false if string util be blank group if be first sub where append and where append group id like param add generate like argument group be first sub false if string util be blank app name if be first sub where append and where append app name param add app name be first sub false where append try page config info aggr result helper fetch page sql count row where to string sql fetch row where to string param to array page no page size config info aggr row mapper return result catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public list config info change find all aggr group string sql select distinct datum id group id tenant id from config info aggr try return jt query sql new object config info change row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e catch empty result datum access exception e return null catch exception e log util fatal log error db other error e get message e throw new runtime exception e override public list string find datum id by content string datum id string group id string content string sql select datum id from config info aggr where datum id and group id and content try return this jt query for list sql new object datum id group id content string class catch empty result datum access exception e return null catch incorrect result size datum access exception e return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public list config info wrapper find change config final timestamp start time final timestamp end time try list map string object list jt query for list select datum id group id tenant id app name content gmt modify from config info where gmt modify and gmt modify new object start time end time return convert change config list catch data access exception e log util fatal log error db error e to string e throw e override public page config info wrapper find change config final string data id final string group final string tenant final string app name final timestamp start time final timestamp end time final int page no final int page size final long last max id string tenant tmp string util be blank tenant string util empty tenant string sql count row select count from config info where string sql fetch row select id datum id group id tenant id app name content type md5 gmt modify from config info where string where 1 = 1 list object param new array list object if string util be blank datum id where and datum id like param add generate like argument datum id if string util be blank group where and group id like param add generate like argument group if string util be blank tenant tmp where and tenant id param add tenant tmp if string util be blank app name where and app name param add app name if start time null where and gmt modify param add start time if end time null where and gmt modify param add end time pagination helper config info wrapper helper create pagination helper try return helper fetch page sql count row where sql fetch row where param to array page no page size last max id config info wrapper row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public list config info find delete config final timestamp start time final timestamp end time try list map string object list jt query for list select distinct datum id group id tenant id from he config info where op type d and gmt modify and gmt modify new object start time end time return convert delete config list catch data access exception e log util fatal log error db error e to string e throw e override public long add config info atomic final long config id final string src ip final string src user final config info config info final timestamp time map string object config advance info final string app name tmp string util be blank config info get app name string util empty config info get app name final string tenant tmp string util be blank config info get tenant string util empty config info get tenant final string desc config advance info null null string config advance info get desc final string use config advance info null null string config advance info get use final string effect config advance info null null string config advance info get effect final string type config advance info null null string config advance info get type final string schema config advance info null null string config advance info get schema final string md5 tmp m d5 util md5 hex config info get content constant encode key holder key holder new generate key holder final string sql insert into config info datum id group id tenant id app name content md5 src ip src user gmt create gmt modify c desc c use effect type c schema value try jt update new prepared statement creator override public prepared statement create prepared statement connection connection throw s q l exception prepared statement ps connection prepare statement sql statement return generate key ps set string config info get datum id ps set string config info get group ps set string tenant tmp ps set string app name tmp ps set string config info get content ps set string md5 tmp ps set string src ip ps set string src user ps set timestamp time ps set timestamp time ps set string desc ps set string use ps set string effect ps set string type ps set string schema return ps key holder number nu key holder get key if nu null throw new illegal argument exception insert config info fail return nu long value catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void add config tag relation long config id string config tag string data id string group string tenant if string util be not blank config tag string tag arr config tag split for int i i tag arr length i add config tag relation atomic config id tag arr i datum id group tenant override public void add config tag relation atomic long config id string tag name string datum id string group string tenant try jt update insert into config tag relation id tag name tag type datum id group id tenant id value config id tag name null datum id group tenant catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void remove tag by id atomic long id try jt update delete from config tag relation where id id catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public list string get config tag by tenant string tenant string sql select tag name from config tag relation where tenant id try return jt query for list sql new object tenant string class catch empty result datum access exception e return null catch incorrect result size datum access exception e return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public list string select tag by config string datum id string group string tenant string sql select tag name from config tag relation where datum id and group id and tenant id try return jt query for list sql new object datum id group tenant string class catch empty result datum access exception e return null catch incorrect result size datum access exception e return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void remove config info atomic final string data id final string group final string tenant final string src ip final string src user string tenant tmp string util be blank tenant string util empty tenant try jt update delete from config info where datum id and group id and tenant id datum id group tenant tmp catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void remove config info by id atomic final string id if string util be blank id return string builder sql new string builder sql delete config info by id sql append id in list long param list new array list string tag arr id split for int i i tag arr length i if i sql append sql append param list add long parse long tag arr i sql append try jt update sql to string param list to array catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void remove config info tag final string data id final string group final string tenant final string tag final string src ip final string src user string tenant tmp string util be blank tenant string util empty tenant string tag tmp string util be blank tag string util empty tag try jt update delete from config info tag where datum id and group id and tenant id and tag id datum id group tenant tmp tag tmp catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void update config info atomic final config info config info final string src ip final string src user final timestamp time map string object config advance info string app name tmp string util be blank config info get app name string util empty config info get app name string tenant tmp string util be blank config info get tenant string util empty config info get tenant final string md5 tmp m d5 util md5 hex config info get content constant encode string desc config advance info null null string config advance info get desc string use config advance info null null string config advance info get use string effect config advance info null null string config advance info get effect string type config advance info null null string config advance info get type string schema config advance info null null string config advance info get schema try jt update update config info set content md5 src ip src user gmt modify app name c desc c use effect type c schema where datum id and group id and tenant id config info get content md5 tmp src ip src user time app name tmp desc use effect type schema config info get datum id config info get group tenant tmp catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public list config info find config info by id final string id if string util be blank id return null string builder sql new string builder sql find config info by id sql append id in list long param list new array list string tag arr id split for int i i tag arr length i if i sql append sql append param list add long parse long tag arr i sql append try return this jt query sql to string param list to array config info row mapper catch empty result datum access exception e indicate that the datum do not exist return null return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public config advance info find config advance info final string data id final string group final string tenant final string tenant tmp string util be blank tenant string util empty tenant try list string config tag list this select tag by config datum id group tenant config advance info config advance this jt query for object select gmt create gmt modify src user src ip c desc c use effect type c schema from config info where datum id and group id and tenant id new object datum id group tenant tmp config advance info row mapper if config tag list null config tag list be empty string builder config tag tmp new string builder for string config tag config tag list if config tag tmp length config tag tmp append config tag else config tag tmp append append config tag config advance set config tag config tag tmp to string return config advance catch empty result datum access exception e indicate that the datum do not exist return null return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public config all info find config all info final string data id final string group final string tenant final string tenant tmp string util be blank tenant string util empty tenant try list string config tag list this select tag by config datum id group tenant config all info config advance this jt query for object select id datum id group id tenant id app name content md5 gmt create gmt modify src user src ip c desc c use effect type c schema from config info where datum id and group id and tenant id new object datum id group tenant tmp config all info row mapper if config tag list null config tag list be empty string builder config tag tmp new string builder for string config tag config tag list if config tag tmp length config tag tmp append config tag else config tag tmp append append config tag config advance set config tag config tag tmp to string return config advance catch empty result datum access exception e indicate that the datum do not exist return null return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void insert config history atomic long id config info config info string src ip string src user final timestamp time string op string app name tmp string util be blank config info get app name string util empty config info get app name string tenant tmp string util be blank config info get tenant string util empty config info get tenant final string md5 tmp m d5 util md5 hex config info get content constant encode try jt update insert into he config info id datum id group id tenant id app name content md5 src ip src user gmt modify op type value id config info get datum id config info get group tenant tmp app name tmp config info get content md5 tmp src ip src user time op catch data access exception e log util fatal log error db error e to string e throw e override public page config history info find config history string datum id string group string tenant int page no int page size pagination helper config history info helper create pagination helper string tenant tmp string util be blank tenant string util empty tenant string sql count row select count from he config info where datum id and group id and tenant id string sql fetch row select nid datum id group id tenant id app name src ip op type gmt create gmt modify from he config info where datum id and group id and tenant id order by nid desc page config history info page null try page helper fetch page sql count row sql fetch row new object datum id group tenant tmp page no page size history list row mapper catch data access exception e log util fatal log error list config history error datum id group new object datum id group e throw e return page override public void add config sub atomic final string data id final string group final string app name final timestamp date final string app name tmp app name null app name try jt update insert into app configdata relation sub datum id group id app name gmt modify value datum id group app name tmp date catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public void update config sub atomic final string data id final string group final string app name final timestamp time final string app name tmp app name null app name try jt update update app configdata relation sub set gmt modify where datum id and group id and app name time datum id group app name tmp catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public config history info detail config history long nid string sql fetch row select nid datum id group id tenant id app name content md5 src user src ip op type gmt create gmt modify from he config info where nid try config history info history info jt query for object sql fetch row new object nid history detail row mapper return history info catch data access exception e log util fatal log error list config history error nid new object nid e throw e override public void insert tenant info atomic string kp string tenant id string tenant name string tenant desc string create resoure final long time try jt update insert into tenant info kp tenant id tenant name tenant desc create source gmt create gmt modify value kp tenant id tenant name tenant desc create resoure time time catch data access exception e log util fatal log error db error e to string e throw e override public void update tenant name atomic string kp string tenant id string tenant name string tenant desc try jt update update tenant info set tenant name tenant desc gmt modify where kp and tenant id tenant name tenant desc system current time millis kp tenant id catch data access exception e log util fatal log error db error e to string e throw e override public list tenant info find tenant by kp string kp string sql select tenant id tenant name tenant desc from tenant info where kp try return this jt query sql new object kp tenant info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e catch empty result datum access exception e return collection empty list catch exception e log util fatal log error db other error e get message e throw new runtime exception e override public tenant info find tenant by kp string kp string tenant id string sql select tenant id tenant name tenant desc from tenant info where kp and tenant id try return jt query for object sql new object kp tenant id tenant info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e catch empty result datum access exception e return null catch exception e log util fatal log error db other error e get message e throw new runtime exception e override public void remove tenant info atomic final string kp final string tenant id try jt update delete from tenant info where kp and tenant id kp tenant id catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public list config info convert delete config list map string object list list config info config new array list config info for map string object map list string datum id string map get datum id string group string map get group id string tenant string map get tenant id config info config new config info config set datum id data id config set group group config set tenant tenant config add config return config override public list config info wrapper convert change config list map string object list list config info wrapper config new array list config info wrapper for map string object map list string datum id string map get datum id string group string map get group id string tenant string map get tenant id string content string map get content long m time timestamp map get gmt modify get time config info wrapper config new config info wrapper config set datum id data id config set group group config set tenant tenant config set content content config set last modify m time config add config return config override public list config info wrapper list all group key md5 final int page size int total count config info count int page count int math ceil total count 1.0 page size list config info wrapper all config info new array list config info wrapper for int page no page no page count page no list config info wrapper config info list list group key md5 by page page no page size all config info add all config info list return all config info override public list config info wrapper list group key md5 by page int page no int page size string sql count row select count from config info string sql fetch row select t id datum id group id tenant id app name md5 type gmt modify from select id from config info order by id limit g config info t where g id t id pagination helper config info wrapper helper create pagination helper try page config info wrapper page helper fetch page limit sql count row sql fetch row new object page no page size page size page no page size config info wrapper row mapper return page get page item catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public string generate like argument string s string fuzzy search sign string sql like percent sign if s contain pattern str return s replace all fuzzy search sign sql like percent sign else return s override public config info wrapper query config info final string data id final string group final string tenant string tenant tmp string util be blank tenant string util empty tenant try return this jt query for object select id datum id group id tenant id app name content type gmt modify md5 from config info where datum id and group id and tenant id new object datum id group tenant tmp config info wrapper row mapper catch empty result datum access exception e return null catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public boolean be exist table string table name string sql string format select from s limit table name try jt query for object sql integer class return true catch throwable e return false override public boolean complete md5 log util default log info start complete md5 int per page size int row count config info count int page count int math ceil row count 1.0 per page size int actual row count for int page no page no page count page no page config info wrapper page find all config info for dump all page no per page size if page null for config info wrapper cf page get page item string md5 in db cf get md5 final string content cf get content final string tenant cf get tenant final string md5 m d5 util md5 hex content constant encode if string util be blank md5 in db try update md5 cf get datum id cf get group tenant md5 new timestamp cf get last modify catch exception e log util default log error complete md5 error dat id group last modify new object cf get datum id cf get group new timestamp cf get last modify else if md5 in db equal md5 try update md5 cf get datum id cf get group tenant md5 new timestamp cf get last modify catch exception e log util default log error complete md5 error dat id group last modify new object cf get datum id cf get group new timestamp cf get last modify actual row count page get page item size log util default log info complete md5 actual row count row count return true override public list config all info find all config info4 export final string data id final string group final string tenant final string app name final list long id string tenant tmp string util be blank tenant string util empty tenant string builder where new string builder where list object param list new array list if collection util be empty id where append id in for int i i id size i if i where append where append param list add id get i where append else where append tenant id param list add tenant tmp if string util be blank datum id where append and datum id like param list add generate like argument datum id if string util be not blank group where append and group id param list add group if string util be not blank app name where append and app name param list add app name try return this jt query sql find all config info where param list to array config all info row mapper catch can not get jdbc connection exception e log util fatal log error db error e to string e throw e override public map string object batch insert or update list config all info config info list string src user string src ip map string object config advance info timestamp time boolean notify same config policy policy throw naco exception int succ count int skip count list map string string fail datum null list map string string skip datum null for int i i config info list size i config all info config info config info list get i try param util check param config info get datum id config info get group datum id config info get content catch nacos exception e log util default log error datum verification fail e throw e config info config info2 save new config info config info get datum id config info get group config info get tenant config info get app name config info get content string type config info get type if string util be blank type simple judgment of file type base on suffix if config info get datum id contain spot string ext name config info get datum id substr config info get datum id last index of spot to upper case try type file type enum value of ext name to upper case get file type catch exception ex type file type enum text get file type if config advance info null config advance info new hash map config advance info put type type try add config info src ip src user config info2 save time config advance info notify succ count catch data integrity violation exception ive uniqueness constraint conflict if same config policy abort equal policy fail datum new array list skip datum new array list map string string faileditem new hash map faileditem put datum id config info2 save get datum id faileditem put group config info2 save get group fail datum add faileditem for int j i j config info list size j config info skip config info config info list get j map string string skipitem new hash map skipitem put datum id skip config info get datum id skipitem put group skip config info get group skip datum add skipitem break else if same config policy skip equal policy skip count if skip datum null skip datum new array list map string string skipitem new hash map skipitem put datum id config info2 save get datum id skipitem put group config info2 save get group skip datum add skipitem else if same config policy overwrite equal policy succ count update config info config info2 save src ip src user time config advance info notify map string object result new hash map result put succ count succ count result put skip count skip count if fail datum null fail datum be empty result put fail datum fail datum if skip datum null skip datum be empty result put skip datum skip datum return result override public int tenant info count by tenant id string tenant id assert have text tenant id tenant id can not be null integer result this jt query for object sql tenant info count by tenant id new string tenant id integer class if result null return return result int value 
