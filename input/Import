enable search client target element type type retention retention policy runtime enable feign client base package com central import search service fallback factory class query service impl class public interface enable search client 
default resource server conf import default security handler config class public class default resource server conf extend resource server configurer adapter autowire private token store token store resource private authentication entry point authentication entry point resource private o auth2 web security expression handler expression handler resource private o auth2 access deny handler o auth2 access deny handler autowire private security property security property override public void configure resource server security configurer resource resource token store token store stateless true authentication entry point authentication entry point expression handler expression handler access deny handler o auth2 access deny handler override public void configure http security http throw exception expression url authorization configurer http security authorize url authorize url set http http authorize request ant matcher security property get ignore get url permit all ant matcher http method option permit all any request set authenticate authorize url http session management session creation policy session creation policy if require and http basic disable header frame option disable and csrf disable url param authorize url public http security set authenticate expression url authorization configurer http security authorize url authorize url return authorize url authenticate and param http public http security set http http security http return http 
enable base feign interceptor target element type type retention retention policy runtime import feign interceptor config class public interface enable base feign interceptor 
enable feign interceptor target element type type retention retention policy runtime import feign interceptor config class feign http interceptor config class public interface enable feign interceptor 
swagger2 configuration conditional on property name zlt swagger enable match if missing true import swagger2 documentation configuration class public class swagger2 configuration 
swagger auto configuration import swagger2 configuration class public class swagger auto configuration implement bean factory aware private static final string auth key authorization private bean factory bean factory bean conditional on miss bean public swagger property swagger property return new swagger property bean conditional on miss bean conditional on property name zlt swagger enable match if missing true public list docket create rest api swagger property swagger property configurable bean factory configurable bean factory configurable bean factory bean factory list docket docket list new link list if swagger property get docket size final docket docket create docket swagger property configurable bean factory register singleton default docket docket docket list add docket return docket list for string group name swagger property get docket key set swagger property docket info docket info swagger property get docket get group name api info api info new api info builder title docket info get title be empty swagger property get title docket info get title description docket info get description be empty swagger property get description docket info get description version docket info get version be empty swagger property get version docket info get version license docket info get license be empty swagger property get license docket info get license license url docket info get license url be empty swagger property get license url docket info get license url contact new contact docket info get contact get name be empty swagger property get contact get name docket info get contact get name docket info get contact get url be empty swagger property get contact get url docket info get contact get url docket info get contact get email be empty swagger property get contact get email docket info get contact get email term of service url docket info get term of service url be empty swagger property get term of service url docket info get term of service url build base path path if docket info get base path be empty docket info get base path add list predicate string base path new array list docket info get base path size for string path docket info get base path base path add path selector ant path exclude path list predicate string exclude path new array list docket info get exclude path size for string path docket info get exclude path exclude path add path selector ant path docket docket new docket documentation type swagger host swagger property get host api info api info global operation parameter assembly global operation parameter swagger property get global operation parameter docket info get global operation parameter group name group name select apis request handler selector base package docket info get base package path predicate and predicate not predicate or exclude path predicate or base path build security scheme security scheme security context security context configurable bean factory register singleton group name docket docket list add docket return docket list docket param swagger property swagger return docket private docket create docket final swagger property swagger property api info api info new api info builder title swagger property get title description swagger property get description version swagger property get version license swagger property get license license url swagger property get license url contact new contact swagger property get contact get name swagger property get contact get url swagger property get contact get email term of service url swagger property get term of service url build base path path if swagger property get base path be empty swagger property get base path add list predicate string base path new array list for string path swagger property get base path base path add path selector ant path exclude path list predicate string exclude path new array list for string path swagger property get exclude path exclude path add path selector ant path return new docket documentation type swagger host swagger property get host api info api info global operation parameter build global operation parameter from swagger property swagger property get global operation parameter select api request handler selector base package swagger property get base package path predicate and predicate not predicate or exclude path predicate or base path build security scheme security scheme security context security context override public void set bean factory bean factory bean factory this bean factory bean factory private list security context security context list security context context new array list security context security context security context builder security reference default auth for path path selector regex auth build context add security context return context private list security reference default auth authorization scope authorization scope new authorization scope global access everything authorization scope authorization scope new authorization scope authorization scope authorization scope list security reference reference new array list reference add new security reference auth key authorization scope return reference private list api key security scheme list api key api key new array list api key api key new api key auth key auth key header api key add api key return api key private list parameter build global operation parameter from swagger property list swagger property global operation parameter global operation parameter list parameter parameter list new array list if object be null global operation parameter return parameter for swagger property global operation parameter global operation parameter global operation parameter parameter add new parameter builder name global operation parameter get name description global operation parameter get description model ref new model ref global operation parameter get model ref parameter type global operation parameter get parameter type require boolean parse boolean global operation parameter get require build return parameter name param global operation parameter param docket operation parameter return private list parameter assembly global operation parameter list swagger property global operation parameter global operation parameter list swagger property global operation parameter docket operation parameter if object be null docket operation parameter docket operation parameter be empty return build global operation parameter from swagger property global operation parameter set string docket name docket operation parameter stream map swagger property global operation parameter get name collect collector to set list swagger property global operation parameter result operation parameter list new array list if object non null global operation parameter for swagger property global operation parameter parameter global operation parameter if docket name contain parameter get name result operation parameter add parameter result operation parameter add all docket operation parameter return build global operation parameter from swagger property result operation parameter 
resource server configuration configuration enable resource server import default password config class public class resource server configuration extend default resource server conf override public http security set authenticate expression url authorization configurer http security authorize url authorize url return authorize url access permission service have permission request authentication and 
security config configuration import default password config class public class security config extend web security configurer adapter autowire private authentication success handler authentication success handler autowire required false private authentication entry point authentication entry point resource private user detail service user detail service autowire private password encoder password encoder resource private logout handler oauth logout handler autowire private open id authentication security config open id authentication security config autowire private mobile authentication security config mobile authentication security config autowire private authentication manager authentication manager autowire private tenant authentication security config tenant authentication security config autowire private tenant property tenant property spring boot authentication manager return bean override public authentication manager authentication manager bean throw exception return super authentication manager bean bean public tenant username password authentication filter tenant authentication filter authentication manager authentication manager tenant username password authentication filter filter new tenant username password authentication filter filter set authentication manager authentication manager filter set filter process url security constant oauth login pro url filter set authentication success handler authentication success handler filter set authentication failure handler new simple url authentication failure handler security constant login failure page return filter override protect void configure http security http throw exception http authorize request any request basic permit all and logout logout url security constant logout url logout success handler new oauth logout success handler add logout handler oauth logout handler clear authentication true and apply open id authentication security config and apply mobile authentication security config and add filter before new login process set tenant filter username password authentication filter class csrf disable iframe header frame option disable cache control if tenant property get enable http form login login page security constant login page and add filter at tenant authentication filter authentication manager username password authentication filter class apply tenant authentication security config else http form login login page security constant login page login processing url security constant oauth login pro url success handler authentication success handler session if authentication entry point null http exception handle authentication entry point authentication entry point http session management session creation policy session creation policy stateless else session oauth2 http session management session creation policy session creation policy if require autowire public void global user detail authentication manager builder auth throw exception auth user detail service user detail service password encoder password encoder 
enable apollo config retention retention policy runtime target element type type document import apollo config registrar class public interface enable apollo config apollo namespace to inject configuration into spring property source string value default config const namespace application the order of the apollo config default be link order lowest precedence which be integer max value if there be property with the same name in different apollo config the apollo config with smaller order win return int order default order lowest precedence 
abstract base integration test configuration import config service test configuration class protect static class test configuration bean public biz config biz config final biz d b property source biz d b property source return new test biz config biz d b property source 
gateway api controller test run with spring runner class web mvc test gateway api controller class import fake auth service impl class in mem api definition store class app management class simple machine discovery class authorization interceptor class public class gateway api controller test private static final string test app test app private static final string test ip localhost private static final integer test port autowire private mock mvc mock mvc autowire private in mem api definition store repository mock bean private sentinel api client sentinel api client before public void before repository clear all test public void test query apis throw exception string path gateway api list json list api definition entity entity new array list mock two entity api definition entity entity new api definition entity entity set id 1 l entity set app test app entity set ip test ip entity set port test port entity set api name foo date date new date entity set gmt create date entity set gmt modify date set api predicate item entity item entity new link hash set entity set predicate item item entity api predicate item entity item entity new api predicate item entity item entity set pattern aaa item entity set match strategy url match strategy exact item entity add item entity entity add entity api definition entity entity2 new api definition entity entity2 set id 2 l entity2 set app test app entity2 set ip test ip entity2 set port test port entity2 set api name biz entity set gmt create date entity set gmt modify date set api predicate item entity item entities2 new link hash set entity2 set predicate item item entities2 api predicate item entity item entity2 new api predicate item entity item entity2 set pattern bbb item entity2 set match strategy url match strategy prefix item entities2 add item entity2 entity add entity2 completable future list api definition entity completable future mock completable future class give completable future get will return entity give sentinel api client fetch apis test app test ip test port will return completable future mock http servlet request builder request builder mock mvc request builder get path request builder param app test app request builder param ip test ip request builder param port string value of test port do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the fetch apis method have be call verify sentinel api client fetch apis test app test ip test port verify if two same entity be get result list api definition entity result j s o n object parse object mvc result get response get content as string new type reference result list api definition entity assert true result be success list api definition entity datum result get datum assert equal datum size assert equal entity datum verify the entity be add into memory repository list api definition entity entity in mem repository find all by app test app assert equal entity in mem size assert equal entity entity in mem test public void test add api throw exception string path gateway api new json add api req vo req vo new add api req vo req vo set app test app req vo set ip test ip req vo set port test port req vo set api name customize api list api predicate item vo item vo new array list api predicate item vo item vo new api predicate item vo item vo set match strategy url match strategy exact item vo set pattern product item vos add item vo req vo set predicate item item vos give sentinel api client modify apis eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder content json to j s o n string req vo content type media type application json do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify apis method have be call verify sentinel api client modify apis eq test app eq test ip eq test port any result api definition entity result j s o n object parse object mvc result get response get content as string new type reference result api definition entity assert true result be success verify the result api definition entity entity result get datum assert not null entity assert equal test app entity get app assert equal test ip entity get ip assert equal test port entity get port assert equal customize api entity get api name assert not null entity get id assert not null entity get gmt create assert not null entity get gmt modify set api predicate item entity predicate item entity entity get predicate item assert equal predicate item entity size api predicate item entity predicate item entity predicate item entity iterator next assert equal url match strategy exact predicate item entity get match strategy int value assert equal product predicate item entity get pattern verify the entity which be add in memory repository list api definition entity entity in mem repository find all by app test app assert equal entity in mem size assert equal entity entity in mem get test public void test update api throw exception string path gateway api save json add one entity to memory repository for update api definition entity add entity new api definition entity add entity set app test app add entity set ip test ip add entity set port test port add entity set api name bbb date date new date to make the gmt modify different when do update date date util add seconds date add entity set gmt create date add entity set gmt modify date set api predicate item entity add redicate item entity new hash set add entity set predicate item add redicate item entity api predicate item entity add predicate item entity new api predicate item entity add predicate item entity set match strategy url match strategy exact add predicate item entity set pattern order add entity repository save add entity update api req vo req vo new update api req vo req vo set id add entity get id req vo set app test app list api predicate item vo item vo new array list api predicate item vo item vo new api predicate item vo item vo set match strategy url match strategy prefix item vo set pattern my order item vos add item vo req vo set predicate item item vos give sentinel api client modify apis eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder content json to j s o n string req vo content type media type application json do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify apis method have be call verify sentinel api client modify apis eq test app eq test ip eq test port any result api definition entity result j s o n object parse object mvc result get response get content as string new type reference result api definition entity assert true result be success api definition entity entity result get datum assert not null entity assert equal bbb entity get api name assert equal date entity get gmt create to make sure gmt modify have be set and it be different from gmt create assert not null entity get gmt modify assert not equal entity get gmt create entity get gmt modify set api predicate item entity predicate item entity entity get predicate item assert equal predicate item entity size api predicate item entity predicate item entity predicate item entity iterator next assert equal url match strategy prefix predicate item entity get match strategy int value assert equal my order predicate item entity get pattern verify the entity which be update in memory repository list api definition entity entity in mem repository find all by app test app assert equal entity in mem size assert equal entity entity in mem get test public void test delete api throw exception string path gateway api delete json add one entity into memory repository for delete api definition entity add entity new api definition entity add entity set app test app add entity set ip test ip add entity set port test port add entity set api name ccc date date new date add entity set gmt create date add entity set gmt modify date set api predicate item entity add redicate item entity new hash set add entity set predicate item add redicate item entity api predicate item entity add predicate item entity new api predicate item entity add predicate item entity set match strategy url match strategy exact add predicate item entity set pattern user add add entity repository save add entity give sentinel api client modify apis eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder param id string value of add entity get id do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify apis method have be call verify sentinel api client modify apis eq test app eq test ip eq test port any verify the result result long result j s o n object parse object mvc result get response get content as string new type reference result long assert true result be success assert equal add entity get id result get datum now no entity in memory list api definition entity entity in mem repository find all by app test app assert equal entity in mem size 
gateway flow rule controller test run with spring runner class web mvc test gateway flow rule controller class import fake auth service impl class in mem gateway flow rule store class app management class simple machine discovery class authorization interceptor class public class gateway flow rule controller test private static final string test app test app private static final string test ip localhost private static final integer test port autowire private mock mvc mock mvc autowire private in mem gateway flow rule store repository mock bean private sentinel api client sentinel api client before public void before repository clear all test public void test query flow rule throw exception string path gateway flow list json list gateway flow rule entity entity new array list mock two entity gateway flow rule entity entity new gateway flow rule entity entity set id 1 l entity set app test app entity set ip test ip entity set port test port entity set resource httpbin route entity set resource mode resource mode route id entity set grade flow grade qp entity set count 5 d entity set interval 30 l entity set interval unit gateway flow rule entity interval unit second entity set control behavior control behavior default entity set burst entity set max queue timeout ms gateway param flow item entity item entity new gateway param flow item entity entity set param item item entity item entity set parse strategy param parse strategy client ip entity add entity gateway flow rule entity entity2 new gateway flow rule entity entity2 set id 2 l entity2 set app test app entity2 set ip test ip entity2 set port test port entity2 set resource some customize api entity2 set resource mode resource mode custom api name entity2 set count 30 d entity2 set interval 2 l entity2 set interval unit gateway flow rule entity interval unit minute entity2 set control behavior control behavior default entity2 set burst entity2 set max queue timeout ms gateway param flow item entity item entity2 new gateway param flow item entity entity2 set param item item entity2 item entity2 set parse strategy param parse strategy client ip entity add entity2 completable future list gateway flow rule entity completable future mock completable future class give completable future get will return entity give sentinel api client fetch gateway flow rule test app test ip test port will return completable future mock http servlet request builder request builder mock mvc request builder get path request builder param app test app request builder param ip test ip request builder param port string value of test port do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the fetch gateway flow rule method have be call verify sentinel api client fetch gateway flow rule test app test ip test port verify if two same entity be get result list gateway flow rule entity result j s o n object parse object mvc result get response get content as string new type reference result list gateway flow rule entity assert true result be success list gateway flow rule entity datum result get datum assert equal datum size assert equal entity datum verify the entity be add into memory repository list gateway flow rule entity entity in mem repository find all by app test app assert equal entity in mem size assert equal entity entity in mem test public void test add flow rule throw exception string path gateway flow new json add flow rule req vo req vo new add flow rule req vo req vo set app test app req vo set ip test ip req vo set port test port req vo set resource mode resource mode route id req vo set resource httpbin route req vo set grade flow grade qp req vo set count 5 d req vo set interval 30 l req vo set interval unit gateway flow rule entity interval unit second req vo set control behavior control behavior default req vo set burst req vo set max queue timeout ms give sentinel api client modify gateway flow rule eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder content json to j s o n string req vo content type media type application json do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify gateway flow rule method have be call verify sentinel api client modify gateway flow rule eq test app eq test ip eq test port any result gateway flow rule entity result j s o n object parse object mvc result get response get content as string new type reference result gateway flow rule entity assert true result be success verify the result gateway flow rule entity entity result get datum assert not null entity assert equal test app entity get app assert equal test ip entity get ip assert equal test port entity get port assert equal resource mode route id entity get resource mode int value assert equal httpbin route entity get resource assert not null entity get id assert not null entity get gmt create assert not null entity get gmt modify verify the entity which be add in memory repository list gateway flow rule entity entity in mem repository find all by app test app assert equal entity in mem size assert equal entity entity in mem get test public void test update flow rule throw exception string path gateway flow save json add one entity into memory repository for update gateway flow rule entity add entity new gateway flow rule entity add entity set id 1 l add entity set app test app add entity set ip test ip add entity set port test port add entity set resource httpbin route add entity set resource mode resource mode route id add entity set grade flow grade qp add entity set count 5 d add entity set interval 30 l add entity set interval unit gateway flow rule entity interval unit second add entity set control behavior control behavior default add entity set burst add entity set max queue timeout ms date date new date to make the gmt modify different when do update date date util add seconds date add entity set gmt create date add entity set gmt modify date gateway param flow item entity add item entity new gateway param flow item entity add entity set param item add item entity add item entity set parse strategy param parse strategy client ip repository save add entity update flow rule req vo req vo new update flow rule req vo req vo set id add entity get id req vo set app test app req vo set grade flow grade qp req vo set count 6 d req vo set interval 2 l req vo set interval unit gateway flow rule entity interval unit minute req vo set control behavior control behavior rate limiter req vo set max queue timeout ms gateway param flow item vo item vo new gateway param flow item vo req vo set param item item vo item vo set parse strategy param parse strategy url param item vo set field name pa give sentinel api client modify gateway flow rule eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder content json to j s o n string req vo content type media type application json do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify gateway flow rule method have be call verify sentinel api client modify gateway flow rule eq test app eq test ip eq test port any result gateway flow rule entity result j s o n object parse object mvc result get response get content as string new type reference result gateway flow rule entity assert true result be success gateway flow rule entity entity result get datum assert not null entity assert equal resource mode route id entity get resource mode int value assert equal httpbin route entity get resource assert equal 6 d entity get count double value assert equal 2 l entity get interval long value assert equal gateway flow rule entity interval unit minute entity get interval unit int value assert equal control behavior rate limiter entity get control behavior int value assert equal entity get burst int value assert equal entity get max queueing timeout ms int value assert equal date entity get gmt create to make sure gmt modify have be set and it be different from gmt create assert not null entity get gmt modify assert not equal entity get gmt create entity get gmt modify verify the entity which be update in memory repository gateway param flow item entity item entity entity get param item assert equal param parse strategy url param item entity get parse strategy int value assert equal pa item entity get field name test public void test delete flow rule throw exception string path gateway flow delete json add one entity into memory repository for delete gateway flow rule entity add entity new gateway flow rule entity add entity set id 1 l add entity set app test app add entity set ip test ip add entity set port test port add entity set resource httpbin route add entity set resource mode resource mode route id add entity set grade flow grade qp add entity set count 5 d add entity set interval 30 l add entity set interval unit gateway flow rule entity interval unit second add entity set control behavior control behavior default add entity set burst add entity set max queue timeout ms date date new date date date util add seconds date add entity set gmt create date add entity set gmt modify date gateway param flow item entity add item entity new gateway param flow item entity add entity set param item add item entity add item entity set parse strategy param parse strategy client ip repository save add entity give sentinel api client modify gateway flow rule eq test app eq test ip eq test port any will return true mock http servlet request builder request builder mock mvc request builder post path request builder param id string value of add entity get id do controller logic mvc result mvc result mock mvc perform request builder and expect mock mvc result matcher status be ok and do mock mvc result handler print and return verify the modify gateway flow rule method have be call verify sentinel api client modify gateway flow rule eq test app eq test ip eq test port any verify the result result long result j s o n object parse object mvc result get response get content as string new type reference result long assert true result be success assert equal add entity get id result get datum now no entity in memory list gateway flow rule entity entity in mem repository find all by app test app assert equal entity in mem size 
