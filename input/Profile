biz log customizer component profile ctrip public class biz log customizer extend log customizer private final biz config biz config public biz log customizer final biz config biz config this biz config biz config override protect string clog url return biz config clog url override protect string clog port return biz config clog port 
auth configuration configuration profile ctrip static class ctrip auth auto configuration private final portal config portal config public ctrip auth auto configuration final portal config portal config this portal config portal config bean public servlet listener registration bean redis app set listner servlet listener registration bean redis app set listener new servlet listener registration bean redis app set listener set listener listener org jasig cas client credi c redis app set listner return redis app set listener bean public servlet listener registration bean single sign out http session listener servlet listener registration bean single sign out http session listener new servlet listener registration bean single sign out http session listener set listener listener org jasig cas client session single sign out http session listener return single sign out http session listener bean public filter registration bean ca filter filter registration bean single sign out filter new filter registration bean single sign out filter set filter filter org jasig cas client session single sign out filter single sign out filter add url pattern single sign out filter set order return single sign out filter bean public filter registration bean authentication filter filter registration bean ca filter new filter registration bean map string string filter init param map new hash map filter init param put redis cluster name ca client principal filter init param put server name portal config portal server name filter init param put cas server login url portal config cas server login url we don t want to use session to store login information since we will be deploy to a cluster not a single instance filter init param put use session false filter init param put openapus exclude ca filter set init parameter filter init param ca filter set filter filter com ctrip framework apollo sso filter apollo authentication filter ca filter add url pattern ca filter set order return ca filter bean public filter registration bean cas validation filter filter registration bean cas validation filter new filter registration bean map string string filter init param map new hash map filter init param put cas server url prefix portal config cas server url prefix filter init param put server name portal config portal server name filter init param put encode utf we don t want to use session to store login information since we will be deploy to a cluster not a single instance filter init param put use session false filter init param put use redis true filter init param put redis cluster name ca client principal cas validation filter set filter filter org jasig cas client validation cas20 proxy receive ticket validation filter cas validation filter set init parameter filter init param cas validation filter add url pattern ca validation filter set order return ca validation filter bean public filter registration bean assertion holder filter registration bean assertion holder filter new filter registration bean map string string filter init param map new hash map filter init param put openapus exclude assertion holder filter set init parameter filter init param assertion holder filter set filter filter com ctrip framework apollo sso filter apollo assertion thread local filter assertion holder filter add url pattern assertion holder filter set order return assertion holder filter bean public ctrip user info holder ctrip user info holder return new ctrip user info holder bean public ctrip logout handler logout handler return new ctrip logout handler private filter filter string class name class clazz null try clazz class for name class name object obj clazz new instance return filter obj catch exception e throw new runtime exception instance filter fail e private event listener listener string class name class clazz null try clazz class for name class name object obj clazz new instance return event listener obj catch exception e throw new runtime exception instance listener fail e bean public user service ctrip user service portal config portal config return new ctrip user service portal config bean public sso heartbeat handler ctrip sso heartbeat handler return new ctrip sso heartbeat handler 
auth configuration configuration profile auth static class spring security auth auto configuration bean conditional on miss bean sso heartbeat handler class public sso heartbeat handler default sso heartbeat handler return new default sso heartbeat handler bean conditional on miss bean user info holder class public user info holder spring security user info holder return new spring security user info holder bean conditional on miss bean logout handler class public logout handler logout handler return new default logout handler bean public jdbc user detail manager jdbc user detail manager authentication manager builder auth datum source datasource throw exception jdbc user detail manager jdbc user detail manager auth jdbc authentication password encoder new b crypt password encoder datum source datasource user by username query select username password enable from user where username authority by username query select username authority from authority where username get user detail service jdbc user detail manager set user exist sql select username from user where username jdbc user detail manager set create user sql insert into user username password enable value jdbc user detail manager set update user sql update user set password enable where id select u id from select id from user where username as u jdbc user detail manager set delete user sql delete from user where id select u id from select id from user where username as u jdbc user detail manager set create authority sql insert into authority username authority value jdbc user detail manager set delete user authority sql delete from authority where id in select a id from select id from authority where username as a jdbc user detail manager set change password sql update user set password where id select u id from select id from user where username as u return jdbc user detail manager bean conditional on miss bean user service class public user service spring security user service return new spring security user service 
auth configuration order profile auth configuration enable web security enable global method security pre post enable true static class spring security configurer extend web security configurer adapter public static final string user role user override protect void configure http security http throw exception http csrf disable http header frame option same origin http authorize request ant matcher prometheus metric openapi vendor style script view img i18n prefix path permit all ant matcher have any role user role http form login login page signin default success url true permit all failure url signin error and http basic http logout logout url user logout invalidate http session true clear authentication true logout success url signin logout http exception handle authentication entry point new login url authentication entry point signin 
auth configuration configuration profile ldap enable configuration property ldap property class ldap extend property class static class spring security l d a p auth auto configuration private final ldap property property private final environment environment public spring security l d a p auth auto configuration final ldap property property final environment environment this property property this environment environment bean conditional on miss bean sso heartbeat handler class public sso heartbeat handler default sso heartbeat handler return new default sso heartbeat handler bean conditional on miss bean user info holder class public user info holder spring security user info holder return new spring security user info holder bean conditional on miss bean logout handler class public logout handler logout handler return new default logout handler bean conditional on miss bean user service class public user service spring security user service return new ldap user service bean conditional on miss bean public context source ldap context source ldap context source source new ldap context source source set user dn this property get username source set password this property get password source set anonymous read only this property get anonymous read only source set base this property get base source set url this property determine url this environment source set base environment property collection unmodifiable map this property get base environment return source bean conditional on miss bean ldap operation class public ldap template ldap template context source context source ldap template ldap template new ldap template context source ldap template set ignore partial result exception true return ldap template 
auth configuration order profile ldap configuration enable web security enable global method security pre post enable true static class spring security l d a p configurer extend web security configurer adapter private final ldap property ldap property private final ldap context source ldap context source private final ldap extend property ldap extend property public spring security l d a p configurer final ldap property ldap property final ldap context source ldap context source final ldap extend property ldap extend property this ldap property ldap property this ldap context source ldap context source this ldap extend property ldap extend property bean public filter base ldap user search user search if ldap extend property get group null string util be blank ldap extend property get group get group search filter base ldap user search filter base ldap user search new filter base ldap user search ldap property get search filter ldap context source filter base ldap user search set search subtree true return filter base ldap user search filter ldap by group user search filter ldap by group user search new filter ldap by group user search ldap property get base ldap property get search filter ldap extend property get group get group base ldap context source ldap extend property get group get group search ldap extend property get map get rdn key ldap extend property get group get group membership ldap extend property get map get login id filter ldap by group user search set search subtree true return filter ldap by group user search bean public ldap authentication provider ldap auth provider bind authenticator bind authenticator new bind authenticator ldap context source bind authenticator set user search user search default ldap authority populator default auth auto configuration new default ldap authority populator ldap context source null default auth auto configuration set ignore partial result exception true default auth auto configuration set search subtree true rewrite the logic of ldap authentication provider with apollo ldap authentication provider use user id in ldap system instead of user id input by user return new apollo ldap authentication provider bind authenticator default auth auto configuration ldap extend property override protect void configure http security http throw exception http csrf disable http header frame option same origin http authorize request ant matcher prometheus metric openapi vendor style script view img i18n prefix path permit all ant matcher authenticate http form login login page signin default success url true permit all failure url signin error and http basic http logout logout url user logout invalidate http session true clear authentication true logout success url signin logout http exception handle authentication entry point new login url authentication entry point signin override protect void configure authentication manager builder auth throw exception auth authentication provider ldap auth provider 
email configuration configuration profile ctrip public static class ctrip email configuration bean public email service ctrip email service return new ctrip email service bean public ctrip email request builder email request builder return new ctrip email request builder 
m q configuration configuration profile ctrip public static class ctrip m q configuration bean public ctrip m q service mq service return new ctrip m q service 
biz log customizer component profile ctrip public class biz log customizer extend log customizer private final portal config portal config public biz log customizer final portal config portal config this portal config portal config override protect string clog url return portal config clog url override protect string clog port return portal config clog port 
web context configuration configuration profile ctrip public class web context configuration private final portal config portal config private final user info holder user info holder public web context configuration final portal config portal config final user info holder user info holder this portal config portal config this user info holder user info holder bean public servlet context initializer servlet context initializer return servlet context string log server i p portal config clog url string log server port portal config clog port string credis service url portal config credis service url servlet context set init parameter log server i p string be null or empty log server i p log server i p servlet context set init parameter log server port string be null or empty log server port log server port servlet context set init parameter credis service url string be null or empty credis service url credis service url bean public filter registration bean user access filter filter registration bean filter new filter registration bean filter set filter new user access filter user info holder filter add url pattern return filter 
