api controller can distro request mapping client beat public object node client beat http servlet request request throw exception override parameter request wrapper request wrapper override parameter request wrapper build request request request wrapper add parameter common param service name constant default group constant service info spliter web util require request dom return beat request wrapper 
health controller can distro put mapping value instance secure action action type write public string update http servlet request request string healthy string web util optional request healthy string util empty if string util be blank healthy string healthy string web util optional request valid string util empty if string util be blank healthy string throw new illegal argument exception param healthy be require boolean valid boolean util to boolean healthy string string service name web util require request common param service name string namespace id web util optional request common param namespace id constant default namespace id string cluster name web util optional request common param cluster name util and common default cluster name string ip web util require request ip int port integer parse int web util require request port service service service manager get service namespace id service name only health check none need update health status with api if health check type none name equal service get cluster map get cluster name get health checker get type for instance instance service all i ps list new array list cluster name if instance get ip equal ip instance get port port instance set healthy valid logger evt log info valid ip enable ip disabled ip instance get ip instance get port instance get cluster name service service name msg update think health controller api push service service change service break else throw new illegal argument exception health check be still work service service name return ok 
instance controller can distro post mapping secure parser name resource parser class action action type write public string register http servlet request request throw exception final string service name web util require request common param service name final string namespace id web util optional request common param namespace id constant default namespace id final instance instance parse instance request service manager register instance namespace id service name instance return ok 
instance controller can distro delete mapping secure parser name resource parser class action action type write public string deregister http servlet request request throw exception instance instance get ip address request string namespace id web util optional request common param namespace id constant default namespace id string service name web util require request common param service name service service service manager get service namespace id service name if service null logger srv log warn remove instance from non exist service service name return ok service manager remove instance namespace id service name instance be ephemeral instance return ok 
instance controller can distro put mapping secure parser name resource parser class action action type write public string update http servlet request request throw exception final string service name web util require request common param service name final string namespace id web util optional request common param namespace id constant default namespace id final instance instance parse instance request string agent web util get user agent request client info client info new client info agent if client info type client info client type java client info version compare to version util parse version 1.0 service manager update instance namespace id service name instance else service manager register instance namespace id service name instance return ok 
instance controller can distro patch mapping secure parser name resource parser class action action type write public string patch http servlet request request throw exception string service name web util require request common param service name string namespace id web util optional request common param namespace id constant default namespace id string ip web util require request ip string port web util require request port string cluster web util optional request common param cluster name string util empty if string util be blank cluster cluster web util optional request cluster util and common default cluster name instance instance service manager get instance namespace id service name cluster ip integer parse int port if instance null throw new illegal argument exception instance not find string metadata web util optional request metadata string util empty if string util be not blank metadata instance set metadata util and common parse metadata metadata string app web util optional request app string util empty if string util be not blank app instance set app app string weight web util optional request weight string util empty if string util be not blank weight instance set weight double parse double weight string healthy web util optional request healthy string util empty if string util be not blank healthy instance set healthy boolean util to boolean healthy string enable string web util optional request enable string util empty if string util be not blank enable string instance set enable boolean util to boolean enable string instance set last beat system current time millis instance validate service manager update instance namespace id service name instance return ok 
instance controller can distro put mapping beat secure parser name resource parser class action action type write public object node beat http servlet request request throw exception object node result jackson util create empty json node result put client beat interval switch domain get client beat interval string beat web util optional request beat string util empty rs info client beat null if string util be not blank beat client beat jackson util to obj beat rs info class string cluster name web util optional request common param cluster name util and common default cluster name string ip web util optional request ip string util empty int port integer parse int web util optional request port if client beat null if string util be not blank client beat get cluster cluster name client beat get cluster else fix client beat set cluster cluster name ip client beat get ip port client beat get port string service name web util require request common param service name string namespace id web util optional request common param namespace id constant default namespace id logger srv log debug client beat full argument beat service name client beat service name instance instance service manager get instance namespace id service name cluster name ip port if instance null if client beat null result put common param code name response code resource not find return result logger srv log warn client beat the instance have be remove for health mechanism perform datum compensation operation beat service name client beat service name instance new instance instance set port client beat get port instance set ip client beat get ip instance set weight client beat get weight instance set metadata client beat get metadata instance set cluster name cluster name instance set service name service name instance set instance id instance get instance id instance set ephemeral client beat be ephemeral service manager register instance namespace id service name instance service service service manager get service namespace id service name if service null throw new naco exception naco exception server error service not find service name namespace id if client beat null client beat new rs info client beat set ip ip client beat set port port client beat set cluster cluster name service process client beat client beat result put common param code name response code ok result put client beat interval instance get instance heart beat interval result put switch entry light beat enable switch domain be light beat enable return result 
