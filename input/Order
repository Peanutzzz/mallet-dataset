cor config order order highest precedence bean public cor web filter cor filter cor configuration config new cor configuration cookie config set allow credentials boolean true config add allow method all config add allow origin all config add allow header all j config add expose header set token url base cor configuration source source new url base cor configuration source new path pattern parser source register cor configuration config return new cor web filter source 
custom error web flux auto configuration bean order order highest precedence public error web exception handler error web exception handler error attribute error attribute json error web exception handler exception handler new json error web exception handler error attribute this resource property this server property get error this application context exception handler set view resolver this view resolver exception handler set message writer this server codec configurer get writer exception handler set message reader this server codec configurer get reader return exception handler 
test web security config configuration order public class test web security config extend web security configurer adapter override protect void configure http security http throw exception http http basic http csrf disable http authorize request ant matcher permit all and authorize request ant matcher console permit all http header frame option disable 
test web security config configuration order public class test web security config extend web security configurer adapter override protect void configure http security http throw exception http http basic http csrf disable http authorize request ant matcher permit all and authorize request ant matcher console permit all http header frame option disable 
auth configuration order profile auth configuration enable web security enable global method security pre post enable true static class spring security configurer extend web security configurer adapter public static final string user role user override protect void configure http security http throw exception http csrf disable http header frame option same origin http authorize request ant matcher prometheus metric openapi vendor style script view img i18n prefix path permit all ant matcher have any role user role http form login login page signin default success url true permit all failure url signin error and http basic http logout logout url user logout invalidate http session true clear authentication true logout success url signin logout http exception handle authentication entry point new login url authentication entry point signin 
auth configuration order profile ldap configuration enable web security enable global method security pre post enable true static class spring security l d a p configurer extend web security configurer adapter private final ldap property ldap property private final ldap context source ldap context source private final ldap extend property ldap extend property public spring security l d a p configurer final ldap property ldap property final ldap context source ldap context source final ldap extend property ldap extend property this ldap property ldap property this ldap context source ldap context source this ldap extend property ldap extend property bean public filter base ldap user search user search if ldap extend property get group null string util be blank ldap extend property get group get group search filter base ldap user search filter base ldap user search new filter base ldap user search ldap property get search filter ldap context source filter base ldap user search set search subtree true return filter base ldap user search filter ldap by group user search filter ldap by group user search new filter ldap by group user search ldap property get base ldap property get search filter ldap extend property get group get group base ldap context source ldap extend property get group get group search ldap extend property get map get rdn key ldap extend property get group get group membership ldap extend property get map get login id filter ldap by group user search set search subtree true return filter ldap by group user search bean public ldap authentication provider ldap auth provider bind authenticator bind authenticator new bind authenticator ldap context source bind authenticator set user search user search default ldap authority populator default auth auto configuration new default ldap authority populator ldap context source null default auth auto configuration set ignore partial result exception true default auth auto configuration set search subtree true rewrite the logic of ldap authentication provider with apollo ldap authentication provider use user id in ldap system instead of user id input by user return new apollo ldap authentication provider bind authenticator default auth auto configuration ldap extend property override protect void configure http security http throw exception http csrf disable http header frame option same origin http authorize request ant matcher prometheus metric openapi vendor style script view img i18n prefix path permit all ant matcher authenticate http form login login page signin default success url true permit all failure url signin error and http basic http logout logout url user logout invalidate http session true clear authentication true logout success url signin logout http exception handle authentication entry point new login url authentication entry point signin override protect void configure authentication manager builder auth throw exception auth authentication provider ldap auth provider 
web flux test config bean order public sentinel block exception handler sentinel block exception handler register the block exception handler for spring web flux return new sentinel block exception handler view resolver server codec configurer 
web flux test config bean order public sentinel web flux filter sentinel web flux filter register the sentinel web flux filter return new sentinel web flux filter 
sentinel spring mvc block handler config controller advice order public class sentinel spring mvc block handler config private logger logger logger factory get logger this get class exception handler block exception class response body public result wrapper sentinel block handler block exception e abstract rule rule e get rule log logger info block by sentinel rule to string return object return result wrapper block exception handler exception class response body public result wrapper exception handler exception e logger error system error e get message return new result wrapper system error 
gateway configuration bean order order highest precedence public sentinel gateway block exception handler sentinel gateway block exception handler register the block exception handler for spring cloud gateway return new sentinel gateway block exception handler view resolver server codec configurer 
gateway configuration bean order public global filter sentinel gateway filter return new sentinel gateway filter 
web flux config bean order public sentinel block exception handler sentinel block exception handler register the block exception handler for spring web flux return new sentinel block exception handler view resolver server codec configurer 
web flux config bean order public sentinel web flux filter sentinel web flux filter register the sentinel web flux filter return new sentinel web flux filter 
sentinel spring mvc block handler config controller advice order public class sentinel spring mvc block handler config private logger logger logger factory get logger this get class exception handler block exception class response body public result wrapper sentinel block handler block exception e logger warn block by sentinel e get rule return the customized result return result wrapper block 
sentinel rule locator order public class sentinel rule locator implement property source locator private rest template rest template private config client property default property private org springframework core env environment environment public sentinel rule locator config client property default property org springframework core env environment environment this default property default property this environment environment responsible for pull datum from remote server param environment return correct datum if success else a empty property source or null override retryable interceptor config server retry interceptor public org springframework core env property source locate org springframework core env environment environment config client property property this default property override environment composite property source composite new composite property source config service rest template rest template this rest template null get secure rest template property this rest template exception error null string error body null try string label new string if string util have text property get label label string util comma delimit list to string array property get label string state config client state holder get state try all the label until one work for string label label environment result get remote environment rest template property label trim state if result null log result result get property source can be null if use xml if result get property source null for property source source result get property source suppress warning unchecked map string object map map string object source get source composite add property source new map property source source get name map sentinel rule storage set rule source composite return composite catch http server error exception e error e if media type application json include e get response header get content type error body e get response body as string catch exception e error e if property be fail fast throw new illegal state exception could not locate property source and the fail fast property be set fail error record log warn could not locate property source error body null error null label not find error get message error body return null public org springframework core env property source refresh return locate environment private void log environment result record log info string format locate environment name s profile s label s version s state s result get name result get profile null array as list result get profile result get label result get version result get state list property source property source list result get property source if property source list null int property count for property source property source property source list property count property source get source size record log info sentinel rule locator environment have property source with property result get name result get property source size property count private environment get remote environment rest template rest template config client property property string label string state string path name profile string name property get name string profile property get profile string token property get token int no of url property get uri length if no of url record log debug sentinel rule locator multiple config server url find list record log info sentinel rule locator get remote environment property label state property label state object arg new string name profile if string util have text label if label contain label label replace arg new string name profile label path path label response entity environment response null for int i i no of url i credentials credentials property get credentials i string uri credentials get uri string username credentials get username string password credentials get password record log info sentinel rule locator fetch config from server at uri try http header header new http header add authorization token property header username password if string util have text token header add token header token if string util have text state property be send state header add state header state final http entity void entity new http entity void null header response rest template exchange uri path http method get entity environment class arg catch http client error exception e if e get status code http status not find throw e catch resource access exception e record log warn sentinel rule locator connect timeout exception on url will be try the next url if available uri if i no of url throw e else continue if response null response get status code http status ok return null environment result response get body return result return null private rest template get secure rest template config client property client simple client http request factory request factory new simple client http request factory if client get request read timeout throw new illegal state exception invalid value for read timeout set request factory set read timeout client get request read timeout rest template template new rest template request factory map string string header new hash map client get header if header contain key authorization to avoid redundant addition of header header remove authorization if header be empty template set interceptor array client http request interceptor as list new generic request header interceptor header return template private void add authorization token config client property config client property http header http header string username string password string authorization config client property get header get authorization if password null authorization null throw new illegal state exception you must set either password or authorization if password null byte token base64 util encode username password get byte http header add authorization basic new string token else if authorization null http header add authorization authorization public void set rest template rest template rest template this rest template rest template public static class generic request header interceptor implement client http request interceptor private final map string string header public generic request header interceptor map string string header this header header override public client http response intercept http request request byte body client http request execution execution throw i o exception for map entry string string header header entry set request get header add header get key header get value return execution execute request body protect map string string get header return header 
