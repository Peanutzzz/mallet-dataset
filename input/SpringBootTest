gen util test spring boot test public class gen util test test public void test table to java string java name gen util table to java t event message t assertion assert that java name be equal to event message 
sy user controller test run with spring runner class spring boot test class user center app class public class sy user controller test autowire private web application context wac private mock mvc mock mvc before public void setup mock mvc mock mvc builder web app context setup wac build test public void when query success throw exception string result mock mvc perform get user name admin content type media type application json u t f8 and expect status be ok and return get response get content as string system out println result test public void when get info success throw exception string result mock mvc perform get user content type media type application json u t f8 and expect status be ok and expect json path username value admin and return get response get content as string system out println result test public void when get info not exist throw exception string result mock mvc perform get user content type media type application json u t f8 and expect status be ok and return get response get content as string assert that result be empty test public void when get url404 throw exception mock mvc perform get user a content type media type application json u t f8 and expect status is4xx client error test transactional public void when delete success throw exception mock mvc perform delete user header x userid header header x user header admin header x tenant header web app content type media type application json u t f8 and expect status be ok test transactional public void when save or update success throw exception string content id username admin role id 1,2 mock mvc perform post user save or update header x userid header header x user header admin header x tenant header web app content type media type application json u t f8 content content and expect status be ok test transactional public void when update success throw exception string content id username admin role id 1,2 mock mvc perform put user header x userid header header x user header admin header x tenant header web app content type media type application json u t f8 content content and expect status be ok 
sy user mapper test run with spring runner class spring boot test public class sy user mapper test resource private sy user mapper sy user mapper test public void test find by username list sy user user sy user mapper select list new query wrapper sy user eq username admin assert that user size be greater than 
sy user service test run with spring runner class spring boot test public class sy user service test autowire private i sy user service sy user service test public void test find by username login app user login app user sy user service find by username admin assert that login app user be not null test public void test find user map string object param new hash map param put page param put limit page result sy user page sy user service find user param assert that page be not null assert that page get count be greater than 
abstract controller test run with spring j unit4 class runner class spring boot test class admin service test configuration class web environment web environment random port public abstract class abstract controller test autowire private http message converter http message converter protect rest template rest template new test rest template get rest template post construct private void post construct rest template set error handler new default response error handler rest template set message converter http message converter get converter value local server port int port protect string url string path return http localhost port path 
abstract integration test run with spring j unit4 class runner class rollback transactional spring boot test class biz test configuration class web environment web environment random port public abstract class abstract integration test 
bootstrap config test run with spring j unit4 class runner class spring boot test class configuration with conditional on property class dirty context public static class test with bootstrap enable and default namespace and conditional on extend abstract spring integration test private static final string some property some property private static final string some value some value autowire required false private test bean test bean apollo config private config config value some property private string some inject value private static config mock config before class public static void before class throw exception do set up system set property property source constant apollo bootstrap enable true mock config mock config class when mock config get property name then return set new hash set test bean conditional on key some property when mock config get property eq test bean conditional on key any string then return boolean true to string when mock config get property eq some property any string then return some value mock config config const namespace application mock config after class public static void after class throw exception system clear property property source constant apollo bootstrap enable do tear down test public void test throw exception assert assert not null test bean assert assert true test bean execute assert assert equal mock config config assert assert equal some value some inject value 
bootstrap config test run with spring j unit4 class runner class spring boot test class configuration with conditional on property class dirty context public static class test with bootstrap enable and namespace and conditional on extend abstract spring integration test autowire required false private test bean test bean before class public static void before class throw exception do set up system set property property source constant apollo bootstrap enable true system set property property source constant apollo bootstrap namespace string format s s config const namespace application fx apollo namespace config config mock config class config another config mock config class when config get property name then return set new hash set test bean conditional on key when config get property eq test bean conditional on key any string then return boolean true to string mock config config const namespace application another config mock config fx apollo namespace config after class public static void after class throw exception system clear property property source constant apollo bootstrap enable system clear property property source constant apollo bootstrap namespace do tear down test public void test throw exception assert assert not null test bean assert assert true test bean execute 
bootstrap config test run with spring j unit4 class runner class spring boot test class configuration with conditional on property class dirty context public static class test with bootstrap enable and namespace and conditional on with yaml file extend abstract spring integration test autowire required false private test bean test bean before class public static void before class throw exception do set up system set property property source constant apollo bootstrap enable true system set property property source constant apollo bootstrap namespace string format s s application yml fx apollo namespace prepare yaml config file application yml read yaml content as config file property case6 yml config another config mock config class mock config config const namespace application another config mock config fx apollo namespace another config after class public static void after class throw exception system clear property property source constant apollo bootstrap enable system clear property property source constant apollo bootstrap namespace do tear down test public void test throw exception assert assert not null test bean assert assert true test bean execute 
bootstrap config test run with spring j unit4 class runner class spring boot test class configuration with conditional on property class dirty context public static class test with bootstrap enable and default namespace and conditional on fail extend abstract spring integration test autowire required false private test bean test bean before class public static void before class throw exception do set up system set property property source constant apollo bootstrap enable true config config mock config class when config get property name then return set new hash set test bean conditional on key when config get property eq test bean conditional on key any string then return boolean false to string mock config config const namespace application config after class public static void after class throw exception system clear property property source constant apollo bootstrap enable do tear down test public void test throw exception assert assert null test bean 
bootstrap config test run with spring j unit4 class runner class spring boot test class configuration with conditional on property class dirty context public static class test with bootstrap enable and default namespace and conditional on fail with yaml file extend abstract spring integration test autowire required false private test bean test bean before class public static void before class throw exception do set up system set property property source constant apollo bootstrap enable true system set property property source constant apollo bootstrap namespace application yml prepare yaml config file application yml read yaml content as config file property case7 yml after class public static void after class throw exception system clear property property source constant apollo bootstrap enable system clear property property source constant apollo bootstrap namespace do tear down test public void test throw exception assert assert null test bean 
bootstrap config test run with spring j unit4 class runner class spring boot test class configuration without conditional on property class dirty context public static class test with bootstrap enable and default namespace and conditional off extend abstract spring integration test autowire required false private test bean test bean before class public static void before class throw exception do set up system set property property source constant apollo bootstrap enable true config config mock config class mock config config const namespace application config after class public static void after class throw exception system clear property property source constant apollo bootstrap enable do tear down test public void test throw exception assert assert not null test bean assert assert true test bean execute 
bootstrap config test run with spring j unit4 class runner class spring boot test class configuration without conditional on property class dirty context public static class test with bootstrap enable and default namespace and conditional off with yaml file extend abstract spring integration test autowire required false private test bean test bean before class public static void before class throw exception do set up system set property property source constant apollo bootstrap enable true system set property property source constant apollo bootstrap namespace application yml prepare yaml config file application yml read yaml content as config file property case8 yml after class public static void after class throw exception system clear property property source constant apollo bootstrap enable system clear property property source constant apollo bootstrap namespace do tear down test public void test throw exception assert assert not null test bean assert assert true test bean execute 
bootstrap config test run with spring j unit4 class runner class spring boot test class configuration with conditional on property class dirty context public static class test with bootstrap disabled and default namespace and conditional on extend abstract spring integration test autowire required false private test bean test bean before class public static void before class throw exception do set up config config mock config class when config get property name then return set new hash set test bean conditional on key when config get property eq test bean conditional on key any string then return boolean false to string mock config config const namespace application config after class public static void after class throw exception do tear down test public void test throw exception assert assert null test bean 
bootstrap config test run with spring j unit4 class runner class spring boot test class configuration without conditional on property class dirty context public static class test with bootstrap disabled and default namespace and conditional off extend abstract spring integration test autowire required false private test bean test bean before class public static void before class throw exception do set up config config mock config class mock config config const namespace application config after class public static void after class throw exception system clear property property source constant apollo bootstrap enable do tear down test public void test throw exception assert assert not null test bean assert assert true test bean execute 
bootstrap config test run with spring j unit4 class runner class spring boot test class configuration without conditional on property class dirty context public static class test with bootstrap enable and eager load enable extend abstract spring integration test before class public static void before class do set up system set property property source constant apollo bootstrap enable true system set property property source constant apollo bootstrap eager load enable true config config mock config class mock config config const namespace application config after class public static void after class system clear property property source constant apollo bootstrap enable system clear property property source constant apollo bootstrap eager load enable do tear down test public void test list environment post processor processor list spring factory loader load factory environment post processor class get class get class loader boolean contain apollo collections2 filter processor list new predicate environment post processor override public boolean apply environment post processor input return input instanceof apollo application context initializer be empty assert assert true contain apollo 
abstract base integration test run with spring j unit4 class runner class spring boot test class abstract base integration test test configuration class web environment web environment random port public abstract class abstract base integration test autowire private release message repository release message repository autowire private release repository release repository private gson gson new gson protect rest template rest template new test rest template get rest template post construct private void post construct rest template set error handler new default response error handler value local server port int port protect string get host url return localhost port configuration import config service test configuration class protect static class test configuration bean public biz config biz config final biz d b property source biz d b property source return new test biz config biz d b property source protect void send release message string message release message release message new release message message release message repository save release message public release build release string name string comment namespace namespace map string string configuration string owner release release new release release set release key release key generator generate release key namespace release set datum change create time new date release set datum change create by owner release set datum change last modify by owner release set name name release set comment comment release set app id namespace get app id release set cluster name namespace get cluster name release set namespace name namespace get namespace name release set configuration gson to json configuration release release repository save release return release protect void periodic send message executor service executor service string message atomic boolean stop executor service submit runnable wait for the request connect to server while stop get thread current thread be interrupted try time unit millisecond sleep catch interrupted exception e double check if stop get break send release message message private static class test biz config extend biz config public test biz config final biz d b property source property source super property source override public int app namespace cache scan interval should be short enough to update the app namespace cache in time return override public time unit app namespace cache scan interval time unit return time unit millisecond 
apollo mock server spring integration test run with spring j unit4 class runner class spring boot test class test configuration class public class apollo mock server spring integration test private static final string other namespace other namespace class rule public static embed apollo embed apollo new embed apollo autowire private test bean test bean autowire private test interested key prefix bean test interested key prefix bean test dirty context public void test property inject assert equal value1 test bean key1 assert equal value2 test bean key2 test dirty context public void test listener trigger by add throw interrupted exception execution exception timeout exception embed apollo add or modify property other namespace some key some value config change event change event test bean future datum get time unit millisecond assert equal other namespace change event get namespace assert equal some value change event get change some key get new value test dirty context public void test listener trigger by del throw interrupted exception execution exception timeout exception embed apollo delete property other namespace key1 config change event change event test bean future datum get time unit millisecond assert equal other namespace change event get namespace assert equal property change type delete change event get change key1 get change type test dirty context public void should notify on interested pattern throw exception embed apollo add or modify property other namespace server port embed apollo add or modify property other namespace server path apollo embed apollo add or modify property other namespace spring application name whatever config change event change event test interested key prefix bean future datum get time unit millisecond assert equal other namespace change event get namespace assert equal change event get change server port get new value assert equal apollo change event get change server path get new value test expect timeout exception class dirty context public void should not notify on uninterested pattern throw exception embed apollo add or modify property other namespace spring application name apollo test interested key prefix bean future datum get time unit millisecond enable apollo config configuration static class test configuration bean public test bean test bean return new test bean bean public test interested key prefix bean test interested key prefix bean return new test interested key prefix bean private static class test bean value key1 default private string key1 value key2 default private string key2 private settable future config change event future datum settable future create apollo config change listener other namespace private void on change config change event change event future datum set change event private static class test interested key prefix bean private settable future config change event future datum settable future create apollo config change listener value other namespace interested key prefix server private void on change config change event change event future datum set change event 
dump service test run with spring j unit4 class runner class spring boot test web app configuration public class dump service test autowire dump service service test public void init throw throwable service init 
naco default property source environment post processor test run with spring runner class spring boot test class naco default property source environment post processor test class web environment spring boot test web environment none public class naco default property source environment post processor test autowire private configurable environment environment test public void test naco default property source present mutable property source property source environment get property source naco default must be present assert assert true property source contain naco default get property source via property source name property source property source get naco default property source naco default must be present assert assert not null property source make sure property source be last one assert assert equal property source size property source precedence of property source test public void test default property web server assert property equal server port assert property equal server tomcat uri encode utf http encoding assert property equal spring http encode force true assert property equal spring http encode enable true i18n assert property equal spring message encode utf test public void test default property name assert property name naco version server servlet context path server port server tomcat uri encode spring http encode force spring http encode enable spring message encode spring autoconfigure exclude private void assert property name string property name composite property source property source get naco default property source assert assert equal please property from resource resource location pattern new hash set string as list property name new hash set string as list property source get property name private void assert property equal string property name string expect value property source property source get naco default property source assert assert equal expect value property source get property property name private composite property source get naco default property source mutable property source property source environment get property source get property source via property source name composite property source property source composite property source property source get property source name return property source 
standalone profile application listener test run with spring runner class spring boot test class standalone profile application listener test class web environment spring boot test web environment none public class standalone profile application listener test autowire private environment environment before class public static void init system set property naco standalone true test public void test profile assert assert true array util contain environment get active profile standalone spring profile 
subscribe manager test spring boot test run with spring j unit4 class runner class context configuration class mock servlet context class public class subscribe manager test extend base test mock private subscribe manager subscribe manager mock private push service push service mock private server member manager member manager before public void before super before subscribe manager new subscribe manager test public void get subscriber with false string service name test string namespace id public boolean aggregation boolean false try list subscriber client new array list subscriber subscriber subscriber new subscriber 127.0 0.1 test app 127.0 0.1 namespace id service name client add subscriber mockito when push service get client mockito any string mockito any string then return client list subscriber list subscribe manager get subscriber service name namespace id aggregation assert assert not null list assert assert equal list size assert assert equal public list get get namespace id catch exception ignore test public void test get subscriber fuzzy string service name test string namespace id public boolean aggregation boolean true try list subscriber client new array list subscriber subscriber subscriber new subscriber 127.0 0.1 test app 127.0 0.1 namespace id test group name test subscriber client add subscriber mockito when push service get client fuzzy mockito any string mockito any string then return client list subscriber list subscribe manager get subscriber service name namespace id aggregation assert assert not null list assert assert equal list size assert assert equal test group name test subscriber list get get service name catch exception ignore test public void get subscriber with true string service name test string namespace id public boolean aggregation boolean true try list subscriber client new array list subscriber subscriber subscriber new subscriber 127.0 0.1 test app 127.0 0.1 namespace id service name client add subscriber list member healthy server new array list for int i i i member server new member server set ip 127.0 0.1 server set port i server set state node state up server set extend val member meta datum constant ad weight server set extend val member meta datum constant site key site server set extend val member meta datum constant weight server set extend val member meta datum constant raft port i healthy server add server mockito when member manager all member then return healthy server mockito do return when server list manager get healthy server size list subscriber list subscribe manager get subscriber service name namespace id aggregation assert assert not null list assert assert equal list size assert assert equal public list get get namespace id catch exception ignore 
naco async rest template i t case suppress warning all fix method order method sorter jvm run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class naco async rest template i t case local server port private int port private naco async rest template naco rest template http client bean holder get naco async rest template logger factory get logger naco async rest template i t case class private final string config instance path naco v1 n private string ip null before public void init throw naco exception ip string format http localhost d port private class callback map t implement callback t private http rest result t rest result private throwable throwable override public void on receive rest result t result rest result http rest result t result override public void on error throwable throwable throwable throwable public http rest result t get rest result return rest result public throwable get throwable return throwable test public void test url post form throw exception string url ip config instance path instance map string string param new hash map param put service name app test param put port param put ip 11.11 11.11 callback map string callback map new callback map naco rest template post form url header new instance query new instance param string class callback map thread sleep http rest result string rest result callback map get rest result system out println rest result get datum system out println rest result get header assert assert true rest result ok test public void test url put form throw exception string url ip config instance path instance map string string param new hash map param put service name app test change param put port param put ip 11.11 11.11 callback map string callback map new callback map naco rest template post form url header new instance query new instance param string class callback map thread sleep http rest result string rest result callback map get rest result system out println rest result get datum system out println rest result get header assert assert true rest result ok test public void test url get throw exception string url ip config instance path instance list query query query new instance add param service name app test callback map map callback map new callback map naco rest template get url header new instance query map class callback map thread sleep http rest result map rest result callback map get rest result system out println rest result get datum system out println rest result get header assert assert true rest result ok assert assert equal rest result get datum get dom app test test public void test url by map throw exception string url ip config instance path instance list map string string param new hash map param put service name app test callback map map callback map new callback map naco rest template get url header new instance param map class callback map thread sleep http rest result map rest result callback map get rest result system out println rest result get datum system out println rest result get header assert assert true rest result ok assert assert equal rest result get datum get dom app test test public void test url delete throw exception string url ip config instance path instance query query query new instance add param ip 11.11 11.11 add param port add param service name app test callback map string callback map new callback map naco rest template delete url header new instance query string class callback map thread sleep http rest result string rest result callback map get rest result system out println rest result get datum system out println rest result get header assert assert true rest result ok 
naco rest template interceptor i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port fix method order method sorter jvm public class naco rest template interceptor i t case local server port private int port private naco rest template naco rest template http client bean holder get naco rest template logger factory get logger naco rest template interceptor i t case class private final string config path naco v1 c private string ip null private class termination interceptor implement http client request interceptor override public http client response intercept return new http client response override public header get header return header empty override public input stream get body throw i o exception return new byte array input stream stop request get byte override public int get status code return naco exception server error override public string get status text return null override public void close throw i o exception override public boolean be intercept uri uri string http method request http entity request http entity return true before public void init throw naco exception naco rest template set interceptor array as list new termination interceptor ip string format http localhost d port test public void test url post config throw exception string url ip config path config map string string param new hash map param put datum id test param put group default group param put content aaa b http rest result string rest result naco rest template post form url header new instance query empty param string class assert assert equal rest result get code assert assert equal stop request rest result get datum system out println rest result get datum system out println rest result get header 
naco rest template i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port fix method order method sorter jvm public class naco rest template i t case local server port private int port private naco rest template naco rest template http client bean holder get naco rest template logger factory get logger naco rest template i t case class private final string instance path naco v1 n private final string config path naco v1 c private string ip null before public void init throw naco exception ip string format http localhost d port test public void test url post config throw exception string url ip config path config map string string param new hash map param put datum id test param put group default group param put content aaa b http rest result string rest result naco rest template post form url header new instance query empty param string class assert assert true rest result ok system out println rest result get datum system out println rest result get header test public void test url get return rest result throw exception string url ip config path config query query query new instance add param beta true add param datum id test add param group default group http rest result config info4 beta rest result naco rest template get url header new instance query new type reference rest result config info4 beta get type assert assert true rest result ok system out println rest result get datum system out println rest result get header test public void test url post form throw exception string url ip instance path instance map string string param new hash map param put service name app test param put port param put ip 11.11 11.11 http rest result string rest result naco rest template post form url header new instance query new instance param string class assert assert true rest result ok system out println rest result get datum test public void test url put from throw exception string url ip instance path instance map string string param new hash map param put service name app test change param put port param put ip 11.11 11.11 http rest result string rest result naco rest template put form url header new instance query new instance param string class assert assert true rest result ok system out println rest result get datum test public void test url get throw exception string url ip instance path instance list query query query new instance add param service name app test http rest result map rest result naco rest template get url header new instance query map class assert assert true rest result ok assert assert equal rest result get datum get dom app test system out println rest result get datum test public void test url get by map throw exception string url ip instance path instance list map string string param new hash map param put service name app test http rest result map rest result naco rest template get url header new instance param map class assert assert true rest result ok assert assert equal rest result get datum get dom app test system out println rest result get datum test public void test url delete throw exception string url ip instance path instance query query query new instance add param ip 11.11 11.11 add param port add param service name app test http rest result string rest result naco rest template delete url header new instance query string class assert assert true rest result ok system out println rest result 
config a p i c i t case run with spring runner class spring boot test class naco class property server servlet context path naco server port web environment spring boot test web environment define port public class config a p i c i t case public static final long time out static config service iconfig null static http agent agent null static final string config controller path v1 c config string special character string datum id yanlin string group yanlin local server port private int port before public void set up throw exception property property new property property put property key const server addr 127.0 0.1 port property put property key const context path naco iconfig naco factory create config service property agent new metric http agent new server http agent property agent start after public void cleanup throw exception http rest result string result null try map string string param new hash map param put datum id data id param put group group param put beta true result agent http delete config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code assert assert true jackson util to obj result get datum get datum boolean value assert assert true jackson util to obj result get datum get datum boolean value catch exception e e print stack trace assert fail before class after class public static void clean client cache throw exception config clean util clean client cache t c description naco test step expect result test timeout time out public void naco getconfig throw exception final string content test boolean result iconfig publish config datum id group content thread sleep time out assert assert true result string value iconfig get config datum id group time out assert assert equal content value result iconfig remove config datum id group thread sleep time out assert assert true result value iconfig get config datum id group time out system out println value assert assert null value throw exception t c description naco test timeout time out public void naco getconfig throw exception string content iconfig get config datum id naco time out assert assert null content throw exception t c description naco datum id null test timeout time out public void naco getconfig throw exception try string content iconfig get config null group time out catch exception e assert assert true true return assert fail throw exception t c description naco group null test timeout time out public void naco getconfig throw exception final string datum id naco getconfig final string content test boolean result iconfig publish config datum id null content assert assert true result thread sleep time out string value iconfig get config datum id null time out assert assert equal content value result iconfig remove config datum id null thread sleep time out assert assert true result throw exception t c description naco test timeout time out public void naco publish config throw exception final string content publish config test boolean result iconfig publish config datum id group content thread sleep time out assert assert true result result iconfig remove config datum id group assert assert true result throw exception t c description naco test timeout time out public void naco publish config throw exception final string content publish config test boolean result iconfig publish config datum id group content thread sleep time out assert assert true result final string content1 test abc result iconfig publish config datum id group content1 thread sleep time out string value iconfig get config datum id group time out assert assert equal content1 value throw exception t c description naco test timeout time out public void naco publish config throw exception string content test special character boolean result iconfig publish config datum id group content thread sleep time out assert assert true result string value iconfig get config datum id group time out assert assert equal content value throw exception t c description naco datum id null test timeout time out public void naco publish config throw exception try string content test boolean result iconfig publish config null group content thread sleep time out assert assert true result catch exception e assert assert true true return assert fail throw exception t c description naco group null test timeout time out public void naco publish config throw exception final string datum id naco publish config string content test boolean result iconfig publish config datum id null content thread sleep time out assert assert true result string value iconfig get config datum id null time out assert assert equal content value throw exception t c description nacos null test timeout time out public void naco publish config throw exception string content null try boolean result iconfig publish config datum id group content thread sleep time out catch exception e assert assert true true return assert fail throw exception t c description naco test timeout time out public void naco publish config throw exception string content abc boolean result iconfig publish config datum id group content thread sleep time out assert assert true result string value iconfig get config datum id group time out assert assert equal content value throw exception t c description naco test public void naco remove config throw exception string content test boolean result iconfig publish config datum id group content assert assert true result thread sleep time out result iconfig remove config datum id group assert assert true result thread sleep time out string value iconfig get config datum id group time out assert assert null value throw exception t c description naco test timeout time out public void naco remove config throw exception group remove config2 boolean result iconfig remove config datum id group assert assert true result throw exception t c description naco datum id null test timeout time out public void naco remove config throw exception try boolean result iconfig remove config null group assert assert true result catch exception e assert assert true true return assert fail throw exception t c description naco group null test timeout time out public void naco remove config throw exception boolean result iconfig remove config datum id null assert assert true result throw exception t c description naco datum id test timeout time out public void naco add listener throw exception final atomic integer count new atomic integer final string content test abc boolean result iconfig publish config datum id group content assert assert true result listener ml new listener override public void receive config info string config info system out println recieve23 config info count increment and get assert assert equal content config info override public executor get executor return null iconfig add listener datum id group ml while count get thread sleep assert assert true count get iconfig remove listener datum id group ml t c description nacos null test step expect result author xiaochun xxc since 3.6 test timeout time out expect illegal argument exception class public void naco add listener throw exception iconfig add listener datum id group null t c description naco datum id test step todo test step expect result todo expect result author xiaochun xxc since 3.6 test timeout constant config long poll timeout public void naco add listener throw interrupted exception naco exception final atomic integer count new atomic integer final string datum id naco add listener final string group naco add listener final string content test abc system current time millis final string new content naco add listener system current time millis boolean result iconfig publish config datum id group content assert assert true result maximum assurance level notification have be perform thread util sleep listener ml new abstract listener override public void receive config info string config info count increment and get assert assert equal new content config info string receive iconfig get config and sign listener datum id group l ml assert assert equal content receive result iconfig publish config datum id group new content assert assert true result get enough sleep to ensure that the monitor be trigger only once during the two long training session thread util sleep constant config long poll timeout assert assert equal count get iconfig remove listener datum id group ml t c description naco datum id test step todo test step expect result todo expect result author xiaochun xxc since 3.6 test timeout time out public void naco add listener throw exception final atomic integer count new atomic integer iconfig remove config datum id group thread sleep time out listener ml new abstract listener override public void receive config info string config info count increment and get iconfig add listener datum id group ml thread sleep time out string content test abc boolean result iconfig publish config datum id group content assert assert true result while count get thread sleep assert assert equal count get iconfig remove listener datum id group ml t c description naco listener listener test step todo test step expect result todo expect result author chuntaojun since 3.6 test public void naco add listener throw interrupted exception naco exception final atomic integer count new atomic integer final string datum id naco add listener final string group naco add listener final string content test abc final string new content new test def boolean result iconfig publish config datum id group content assert assert true result thread sleep listener ml new abstract listener override public void receive config info string config info count increment and get assert assert equal new content config info string receive content iconfig get config and sign listener datum id group ml system out println receive content result iconfig publish config datum id group new content assert assert true result assert assert equal content receive content thread sleep assert assert equal count get iconfig remove listener datum id group ml t c description naco listener listener test step todo test step expect result todo expect result author chuntaojun since 3.6 test public void naco add listener throw interrupted exception naco exception property property new property property put property key const server addr 127.0 0.1 port property put property key const enable remote sync config true config service iconfig naco factory create config service property final atomic integer count new atomic integer final string datum id naco add listener final string group naco add listener final string content test abc final string new content new test def boolean result iconfig publish config datum id group content assert assert true result thread sleep listener ml new abstract listener override public void receive config info string config info count increment and get system out println listener receive config info assert assert equal new content config info iconfig add listener datum id group ml string receive content iconfig get config datum id group system out println receive content result iconfig publish config datum id group new content assert assert true result thread sleep receive content iconfig get config datum id group assert assert equal new content receive content assert assert equal count get iconfig remove listener datum id group ml t c description naco test step todo test step expect result todo expect result author xiaochun xxc since 3.6 test timeout time out public void naco remove listener throw exception iconfig add listener datum id group new abstract listener override public void receive config info string config info assert fail thread sleep time out try iconfig remove listener datum id group new abstract listener override public void receive config info string config info system out println remove recieve config info catch exception e t c description naco datum id test step todo test step expect result todo expect result author xiaochun xxc since 3.6 test timeout time out public void naco remove listener group test naco try iconfig remove listener datum id group new abstract listener override public void receive config info string config info catch exception e assert fail t c description naco test step todo test step expect result todo expect result author xiaochun xxc since 3.6 test timeout time out public void naco remove listener throw exception final string content remove test abc two final atomic integer count new atomic integer listener ml new abstract listener override public void receive config info string config info count increment and get listener ml1 new abstract listener override public void receive config info string config info system out println ml1 remove listener recieve config info count increment and get assert assert equal content remove config info iconfig add listener datum id group ml iconfig add listener datum id group ml1 iconfig remove listener datum id group ml thread sleep time out boolean result iconfig publish config datum id group content remove thread sleep time out assert assert true result while count get thread sleep assert assert not equal count get t c description nacos null test step todo test step expect result todo expect result author xiaochun xxc since 3.6 test timeout time out public void naco remove listener iconfig remove listener datum id group null t c description naco open a p i test step expect result author xiaochun xxc since 3.6 test timeout time out public void naco open a p i detail config http rest result string result null try final string content test boolean ret iconfig publish config datum id group content thread sleep time out assert assert true ret map string string param new hash map param put datum id data id param put group group param put show all result agent http get config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code assert assert equal content jackson util to obj result get datum get content text value catch exception e assert fail t c description naco open a p i catalog test step expect result author xiaochun xxc since 3.6 test timeout time out public void naco open a p i catalog http rest result string result null try final string content test boolean ret iconfig publish config datum id group content thread sleep time out assert assert true ret map string string param new hash map param put datum id data id param put group group result agent http get config controller path catalog null param agent get encode time out assert assert equal http u be l connection http ok result get code system out println result get datum assert assert false jackson util to obj result get datum get datum be null catch exception e assert fail t c description naco open a p i query beta test step expect result author xiaochun xxc since 3.6 test timeout time out public void naco open a p i query beta http rest result string result null try final string content test beta map string string header new hash map header put beta ip 127.0 0.1 map string string param new hash map param put datum id data id param put group group param put content content result agent http post config controller path header param agent get encode time out assert assert equal http u be l connection http ok result get code assert assert equal true result get datum param clear param put datum id data id param put group group param put beta true result agent http get config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code assert assert equal content jackson util to obj result get datum get datum get content text value delete datum result agent http delete config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code catch exception e assert fail t c description naco open a p i query beta test step beta expect result author xiaochun xxc since 3.6 test timeout time out public void naco open a p i query beta delete http rest result string result null try final string content test beta map string string header new hash map header put beta ip 127.0 0.1 map string string param new hash map param put datum id data id param put group group param put content content result agent http post config controller path header param agent get encode time out assert assert equal http u be l connection http ok result get code assert assert equal true result get datum param clear param put datum id data id param put group group param put beta true result agent http delete config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code assert assert true jackson util to obj result get datum get datum boolean value catch exception e e print stack trace assert fail t c description naco open a p i test step expect result author xiaochun xxc since 3.6 test timeout time out public void naco open a p i fuzzy search config http rest result string result null try final string content test123 boolean ret iconfig publish config datum id group content thread sleep time out assert assert true ret map string string param new hash map param put datum id data id param put group group param put page no param put page size param put search blur result agent http get config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code assert assert true jackson util to obj result get datum get total count int value assert assert true jackson util to obj result get datum get page item get get content text value start with content catch exception e assert fail t c description naco open a p i test step expect result author xiaochun xxc since 3.6 test timeout time out public void naco open a p i fuzzy search config http rest result string result null try final string content test123 boolean ret iconfig publish config datum id group content thread sleep time out assert assert true ret map string string param new hash map param put datum id data id param put group group param put page no param put page size param put search blur result agent http get config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code assert assert true jackson util to obj result get datum get total count int value assert assert equal content jackson util to obj result get datum get page item get get content text value catch exception e assert fail t c description naco open a p i test step expect result author xiaochun xxc since 3.6 test timeout time out public void naco open a p i search config http rest result string result null try final string content test123 boolean ret iconfig publish config datum id group content assert assert true ret thread sleep time out map string string param new hash map param put datum id data id param put group group param put page no param put page size param put search accurate result agent http get config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code assert assert equal jackson util to obj result get datum get total count int value assert assert equal content jackson util to obj result get datum get page item get get content text value catch exception e assert fail t c description naco open a p i utf test step expect result author xiaochun xxc since 3.6 test timeout time out public void naco open a p i search config http rest result string result null try final string content test boolean ret iconfig publish config datum id group content assert assert true ret thread sleep time out map string string param new hash map param put datum id data id param put group group param put page no param put page size param put search accurate result agent http get config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code assert assert equal jackson util to obj result get datum get total count int value assert assert equal content jackson util to obj result get datum get page item get get content text value catch exception e assert fail 
config beta c i t case run with spring runner class spring boot test class naco class property server servlet context path naco server port web environment spring boot test web environment define port public class config beta c i t case local server port private int port private string url autowire private test rest template rest template static final string config controller path naco v1 c string data id com dungu test string group default string tenant dungu string content test string app name naco before class after class public static void clean client cache throw exception config clean util clean client cache before public void init throw naco exception url string format http localhost d port t c description beta test step expect result test public void publish beta config throw exception http header header new http header header add beta ip 127.0 0.1 127.0 0.2 response entity string response request config controller path config header param new param append param datum id datum id append param group group append param tenant tenant append param content content append param config tag append param app name app name do string class http method post system out println publish beta config response assert assert true response get status code is2xx successful assert assert equal true response get body t c description content beta test step expect result test public void publish beta config no content throw exception http header header new http header header add beta ip 127.0 0.1 127.0 0.2 response entity string response request config controller path config header param new param append param datum id datum id append param group group append param tenant tenant append param config tag append param app name app name do string class http method post system out println publish beta config no content response assert assert false response get status code is2xx successful t c description beta ip beta test step expect result test public void publish beta config no beta ip beta throw exception http header header new http header beta ip response entity string response request config controller path config header param new param append param datum id datum id append param group group append param tenant tenant append param content content append param config tag append param app name app name do string class http method post system out println publish beta config no beta ip beta post response assert assert true response get status code is2xx successful assert assert equal true response get body response entity string response1 request config controller path config beta true param new param append param datum id datum id append param group group append param tenant tenant do string class http method get system out println publish beta config no beta ip beta get response assert assert true response1 get status code is2xx successful assert assert true jackson util to obj response1 get body get datum be null t c description beta ip beta test step expect result test public void publish beta config no beta ip throw exception http header header new http header beta ip final string datum id publish beta config no beta ip final string group id publish beta config no beta ip final string content publish beta config no beta ip response entity string response request config controller path config header param new param append param datum id datum id append param group group id append param tenant tenant append param content content append param config tag append param app name app name do string class http method post system out println publish beta config no beta ip post response assert assert true response get status code is2xx successful assert assert equal true response get body thread util sleep l response request config controller path config beta false param new param append param datum id datum id append param group group id append param tenant tenant do string class http method get system out println publish beta config no beta ip get response assert assert true response get status code is2xx successful assert assert equal content response get body t c description beta test step expect result test public void get beta config throw exception http header header new http header header add beta ip 127.0 0.1 127.0 0.2 response entity string response request config controller path config header param new param append param datum id datum id append param group group append param tenant tenant append param content content append param config tag append param app name app name do string class http method post system out println get beta config post response assert assert true response get status code is2xx successful assert assert equal true response get body response request config controller path config beta true param new param append param datum id datum id append param group group append param tenant tenant do string class http method get system out println get beta config get response assert assert true response get status code is2xx successful assert assert equal com dungu test jackson util to obj response get body get datum get datum id as text t c description beta test step expect result test public void delete beta config throw exception http header header new http header header add beta ip 127.0 0.1 127.0 0.2 response entity string response request config controller path config header param new param append param datum id datum id append param group group append param tenant tenant append param content content append param config tag append param app name app name do string class http method post system out println delete beta config post response assert assert true response get status code is2xx successful assert assert equal true response get body response request config controller path config beta true param new param append param datum id datum id append param group group append param tenant tenant do string class http method get system out println delete beta config get response assert assert true response get status code is2xx successful assert assert equal com dungu test jackson util to obj response get body get datum get datum id as text response request config controller path config beta true param new param append param datum id datum id append param group group append param tenant tenant do string class http method delete system out println delete beta config delete response assert assert true response get status code is2xx successful assert assert equal true jackson util to obj response get body get datum as text response request config controller path config beta true param new param append param datum id datum id append param group group append param tenant tenant do string class http method get system out println delete beta config after delete then get response assert assert true response get status code is2xx successful assert assert true jackson util to obj response get body get datum be null t c description beta false beta test step expect result test public void delete beta config delete beta false throw exception http header header new http header header add beta ip 127.0 0.1 127.0 0.2 response entity string response request config controller path config header param new param append param datum id datum id append param group group append param tenant tenant append param content content append param config tag append param app name app name do string class http method post system out println delete beta config delete beta false post response assert assert true response get status code is2xx successful assert assert equal true response get body response request config controller path config beta true param new param append param datum id datum id append param group group append param tenant tenant do string class http method get system out println delete beta config delete beta false get response assert assert true response get status code is2xx successful assert assert equal com dungu test jackson util to obj response get body get datum get datum id as text response request config controller path config beta false param new param append param datum id datum id append param group group append param tenant tenant do string class http method delete system out println delete beta config delete beta false delete response assert assert true response get status code is2xx successful assert assert equal true response get body response request config controller path config beta true param new param append param datum id datum id append param group group append param tenant tenant do string class http method get system out println delete beta config delete beta false after delete then get response assert assert true response get status code is2xx successful assert assert equal com dungu test jackson util to obj response get body get datum get datum id as text t response entity t request string path multi value map string string param class t clazz http method http method http header header new http header http entity entity new http entity t header uri component builder builder uri component builder from http url this url to string path query param param return this rest template exchange builder to uri string http method entity clazz t response entity t request string path http header header multi value map string string param class t clazz http method http method http entity entity new http entity t header uri component builder builder uri component builder from http url this url to string path query param param return this rest template exchange builder to uri string http method entity clazz 
config derby import c i t case run with spring runner class spring boot test class naco class property server servlet context path naco server port web environment spring boot test web environment define port public class config derby import c i t case autowire private application context context test public void test derby import throw throwable database operate operate context get bean database operate class file file disk util create tmp file derby import system current time millis tmp disk util write file file byte util to byte sql script context false try completable future rest result string future operate datum import file rest result string result future join system out println result assert assert true result ok final string query data id people final string query group default group final string expect content people enable true persist service persist service context get bean persist service class config info config info persist service find config info query data id query group system out println config info assert assert not null config info assert assert equal query datum id config info get datum id assert assert equal query group config info get group assert assert equal config info get tenant assert assert equal expect content config info get content finally disk util delete quietly file private static string sql script context insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value boot test alibaba dept ngroup 2ca50d002a7dabf81497f666a7967e15 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null null null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value people default group people enable true d92cbf8d02080017a805b7efc4481b6c 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null null null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value apple default group apple n list n n n n n list map n key n n n n n key n aa n dd n ee n rr 4eb5a2258ba6ecddd9631ec10cf36342 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null null null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value naco log log develop log level com alibaba boot naco sample error 96c1909608 cad11034802b336b0c5490 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null text null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value naco log default group log level com alibaba cloud example error 43ed366ef7542af8bf37fb6dbe39e46d 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null text null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value test default group dept aliware ngroup alibaba 2f60 cf534f6eb67c6c95c8e0acbcff0a 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null null null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value common property default group user age nuser name liaochuntao b68ec4349bb2a824d622c423ce3cbcce 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null property null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value naco cloud test default group user remark this be nacos springboot adaper testing 89lll nuser age bca25308a96ec491c 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null null null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value extension1 property default group user age 4585b001 cc1c4ff4ac94d8dbccdb888f 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null property null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value first property source data id default group user name mercy ma e36dc37603eabe6dbd08ddab5ae728e3 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null null null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value before os env property source data id default group path home my path 44dae1248f3b8bbc72698e2de4441cc3 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null null null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value after system property property source data id default group user name mercyblitz f6a3287654d0c79ec47dc3359ea419fa 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null null null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value example default group use local cache true 25a822367 cd73c79acc56da3c73fa07e 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null null null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value people develop people enable true d92cbf8d02080017a805b7efc4481b6c 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null null null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value test naco default group this be test liaochuntao n nkey value n nredis url 127.0 0.1 2482e3802 f8fc5fd34545bbbbd121719 2020 - 04 13 13 44:43 2020 - 04 30 10 45:21 null 127.0 0.1 null null null null null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value develop test default group develop test develop testdevelop testdevelop testdevelop test cc4ffd21bdd54362b84d629fd243e050 2020 - 04 13 13 51:48 2020 - 04 13 13 51:48 null 127.0 0.1 188c49 ac d06f 4abe 9d05 7bb87185ac34 null null null property null n insert into config info id datum id group id content md5 gmt create gmt modify src user src ip app name tenant id c desc c use effect type c schema value application property default group name liaochuntao be man 17581188a1 cdc684721dde500c693c07 2020 - 04 30 10 45:21 2020 - 04 30 10 45:21 null 127.0 0.1 null null null property null n n 
config export and import a p i c i t case run with spring runner class spring boot test class naco class property server servlet context path naco server port web environment spring boot test web environment define port public class config export and import a p i c i t case private static final long time out private static final string config controller path v1 c config private common ok http client http client new common ok http client builder build local server port private int port private string server addr null private http agent agent null before class after class public static void clean client cache throw exception config clean util clean client cache before public void set up throw exception server addr http 127.0 0.1 port naco property property new property property put property key const server addr 127.0 0.1 port agent new metric http agent new server http agent property agent start map string string prarm new hash map prarm put datum id test no appname1 yml prarm put group export import test group prarm put content test test prarm put desc test no appname1 prarm put type yaml assert assert equal true http client post server addr config controller path prarm null prarm put datum id test no appname2 txt prarm put group t e s t1 group prarm put content test test prarm put desc test no appname2 prarm put type text assert assert equal true http client post server addr config controller path prarm null prarm put datum id test have appname1 property prarm put group export import test group prarm put content test test1 value test prarm put desc test have appname1 prarm put type property prarm put app name test app1 assert assert equal true http client post server addr config controller path prarm null after public void cleanup throw exception http rest result string result try map string string param new hash map param put datum id test no appname1 yml param put group export import test group param put beta false result agent http delete config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code param put datum id test no appname2 txt param put group t e s t1 group param put beta false result agent http delete config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code param put datum id test have appname1 property param put group export import test group param put beta false result agent http delete config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code param put datum id test1 yml param put group test import param put beta false result agent http delete config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code param put datum id test2 txt param put group test import param put beta false result agent http delete config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code param put datum id test3 property param put group test import param put beta false result agent http delete config controller path null param agent get encode time out assert assert equal http u be l connection http ok result get code catch exception e assert fail agent shutdown test public void test export by id string get datum url search accurate datum id group app name config tag page no page size tenant namespace id string query result http client get server addr config controller path get datum url null json node result obj jackson util to obj query result json node result config result obj get page item json node config1 result config get json node config2 result config get string id1 config1 get id as text string id2 config2 get id as text string export by id url export true tenant group app name id id1 id2 system out println export by id url byte zip datum http client download server addr config controller path export by id url null zip util un zip result un zip zip util unzip zip datum list zip util zip item zip item list un zip get zip item list assert assert equal zip item list size string config1 name config1 get group text value config1 get datum id text value string config2 name config2 get group text value config2 get datum id text value for zip util zip item zip item zip item list if config1 name equal zip item get item name config2 name equal zip item get item name assert fail test timeout time out public void test export by group string get datum url search accurate datum id group export import test group app name config tag page no page size tenant namespace id string query result http client get server addr config controller path get datum url null json node result obj jackson util to obj query result json node result config result obj get page item assert assert equal result config size json node config1 result config get json node config2 result config get string export by id url export true tenant group export import test group app name id byte zip datum http client download server addr config controller path export by id url null zip util un zip result un zip zip util unzip zip datum list zip util zip item zip item list un zip get zip item list assert assert equal zip item list size string config1 name config1 get group text value config1 get datum id text value string config2 name config2 get group text value config2 get datum id text value for zip util zip item zip item zip item list if config1 name equal zip item get item name config2 name equal zip item get item name assert fail verification metadata map string string meta data process meta datum un zip get meta datum item string meta datum name package meta name export import test group test have appname1 property string app name meta datum get meta datum name assert assert not null app name assert assert equal test app1 app name test timeout time out public void test export by group and app string get datum url search accurate datum id group export import test group app name test app1 config tag page no page size tenant namespace id string query result http client get server addr config controller path get datum url null json node result obj jackson util to obj query result json node result config result obj get page item assert assert equal result config size json node config1 result config get string export by id url export true tenant group export import test group app name test app1 id byte zip datum http client download server addr config controller path export by id url null zip util un zip result un zip zip util unzip zip datum list zip util zip item zip item list un zip get zip item list assert assert equal zip item list size string config1 name config1 get group text value config1 get datum id text value for zip util zip item zip item zip item list if config1 name equal zip item get item name assert fail verification metadata map string string meta data process meta datum un zip get meta datum item string meta datum name package meta name export import test group test have appname1 property string app name meta datum get meta datum name assert assert not null app name assert assert equal test app1 app name test timeout time out public void test export all string export by id url export true tenant group app name id byte zip datum http client download server addr config controller path export by id url null zip util un zip result un zip zip util unzip zip datum list zip util zip item zip item list un zip get zip item list string config1 name export import test group test no appname1 yml string config2 name t e s t1 group test no appname2 txt string config3 name export import test group test have appname1 property int success count for zip util zip item zip item zip item list if config1 name equal zip item get item name config2 name equal zip item get item name config3 name equal zip item get item name success count assert assert equal success count verification metadata map string string meta data process meta datum un zip get meta datum item string meta datum name package meta name export import test group test have appname1 property string app name meta datum get meta datum name assert assert not null app name assert assert equal test app1 app name test timeout time out public void test import list zip util zip item zip item list new array list zip item list add new zip util zip item test import test1 yml test test1 zip item list add new zip util zip item test import test2 txt test test1 zip item list add new zip util zip item test import test3 property test test1 value test string meta datum str test import test2 txt app test app1 be n t e s t import test3 property app test app2 zip item list add new zip util zip item meta yml meta datum str string import url import true namespace map string string import prarm new hash map import prarm put policy overwrite upload byte file upload byte file new upload byte file upload byte file set file name test import zip upload byte file set file byte zip util zip zip item list upload byte file set media type application zip upload byte file set prarm name file http client post server addr config controller path import url import prarm collection singleton list upload byte file null string get datum url search accurate datum id group test import app name config tag page no page size tenant namespace id string query result http client get server addr config controller path get datum url null json node result obj jackson util to obj query result json node result config result obj get page item assert assert equal result config size for int i i result config size i json node config result config get i if test import equal config get group text value assert fail switch config get datum id text value case test1 yml case test2 txt case test3 property break default assert fail private map string string process meta datum zip util zip item meta datum zip item map string string meta datum map new hash map if meta datum zip item null string meta datum str meta datum zip item get item datum string meta datum arr meta datum str split be n for string meta datum item meta datum arr string meta datum item arr meta datum item split assert assert equal meta datum item arr length meta datum map put meta datum item arr meta datum item arr return meta datum map private string package meta name string group string datum id string temp datum id data id if temp datum id contain temp datum id temp datum id substr temp datum id last index of temp datum id substr temp datum id last index of return group temp datum id app 
config long poll return change c i t case run with spring runner class spring boot test class naco class property server servlet context path naco server port web environment spring boot test web environment define port public class config long poll return change c i t case local server port private int port private config service config service before class after class public static void clean client cache throw exception config clean util clean client cache before public void init throw naco exception property property new property property put property key const server addr 127.0 0.1 port property put property key const config long poll timeout property put property key const config retry time property put property key const max retry config service naco factory create config service property after public void destroy try config service shut down catch nacos exception ex test public void test add throw interrupted exception naco exception count down latch latch new count down latch final string datum id test system current time millis final string group default group final string content config datum config service add listener datum id group new abstract config change listener override public void receive config change config change event event try config change item cci event get change item content assert assert equal null cci get old value assert assert equal content cci get new value assert assert equal property change type add cci get type system out println cci finally latch count down boolean result config service publish config datum id group content assert assert true result config service get config datum id group latch await l time unit millisecond test public void test modify throw interrupted exception naco exception count down latch latch new count down latch final string datum id test system current time millis final string group default group final string old datum old datum final string new datum new datum boolean result config service publish config datum id group old datum assert assert true result config service add listener datum id group new abstract config change listener override public void receive config change config change event event try config change item cci event get change item content assert assert equal old datum cci get old value assert assert equal new datum cci get new value assert assert equal property change type modify cci get type system out println cci finally latch count down config service publish config datum id group new datum latch await l time unit millisecond test public void test delete throw interrupted exception naco exception count down latch latch new count down latch final string datum id test system current time millis final string group default group final string old datum old datum boolean result config service publish config datum id group old datum assert assert true result config service add listener datum id group new abstract config change listener override public void receive config change config change event event try config change item cci event get change item content assert assert equal old datum cci get old value assert assert equal null cci get new value assert assert equal property change type delete cci get type system out println cci finally latch count down config service remove config datum id group latch await l time unit millisecond 
config long poll c i t case run with spring runner class spring boot test class naco class property server servlet context path naco server port web environment spring boot test web environment define port public class config long poll c i t case local server port private int port private config service config service before class after class public static void clean client cache throw exception config clean util clean client cache before public void init throw naco exception property property new property property put property key const server addr 127.0 0.1 port property put property key const config long poll timeout property put property key const config retry time property put property key const max retry config service naco factory create config service property after public void destroy try config service shut down catch nacos exception ex test public void test throw interrupted exception naco exception config service add listener test default group new listener override public executor get executor return null override public void receive config info string config info system out println config info config service add listener test default group new listener override public executor get executor return null override public void receive config info string config info system out println config info time unit seconds sleep 
config auth i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class config auth i t case extend auth base local server port private int port public static final long time out public config service iconfig null private string datum id yanlin private string group yanlin before public void init throw exception super init port after public void destroy try iconfig shut down catch nacos exception ex test public void write with read permission throw exception construct config service property put property key const username username1 property put property key const password password1 iconfig naco factory create config service property final string content test try iconfig publish config datum id group content fail catch naco exception ne assert assert equal http status sc forbid ne get err code try iconfig remove config datum id group fail catch naco exception ne assert assert equal http status sc forbid ne get err code test public void read with read permission throw exception count down latch latch new count down latch atomic integer be new atomic integer property put property key const username username1 property put property key const password password1 iconfig naco factory create config service property final string content test system current time millis system out println content iconfig add listener datum id group new abstract config change listener override public void receive config change config change event event config change item cci event get change item content system out println content cci if content equal cci get new value return latch count down time unit seconds sleep 3 l property put property key const username username2 property put property key const password password2 config service config service naco factory create config service property boolean result config service publish config datum id group content assert assert true result time unit seconds sleep 5 l string re iconfig get config datum id group time out assert assert equal content re latch await 5 l time unit seconds assert assert equal latch get count test public void write with write permission throw exception construct config service property put property key const username username2 property put property key const password password2 iconfig naco factory create config service property final string content test boolean re iconfig publish config datum id group content assert assert true re re iconfig remove config datum id group assert assert true re test public void read with write permission throw exception count down latch latch new count down latch property put property key const namespace namespace1 property put property key const username username2 property put property key const password password2 iconfig naco factory create config service property final string content test system current time millis iconfig add listener datum id group new abstract config change listener override public void receive config change config change event event config change item cci event get change item content system out println content cci if content equal cci get new value return latch count down time unit seconds sleep 3 l boolean result iconfig publish config datum id group content assert assert true result time unit seconds sleep 5 l try iconfig get config datum id group time out fail catch naco exception ne assert assert equal http status sc forbid ne get err code latch await 5 l time unit seconds assert assert true latch get count test public void read write with full permission throw exception count down latch latch new count down latch atomic integer be new atomic integer property put property key const username username3 property put property key const password password3 iconfig naco factory create config service property final string content test system current time millis iconfig add listener datum id group new abstract config change listener override public void receive config change config change event event config change item cci event get change item content system out println content cci if content equal cci get new value return latch count down time unit seconds sleep 3 l boolean result iconfig publish config datum id group content assert assert true result time unit seconds sleep 5 l string re iconfig get config datum id group time out assert assert equal content re latch await 5 l time unit seconds assert assert equal latch get count result iconfig remove config datum id group assert assert true result 
name auth i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class name auth i t case extend auth base local server port private int port private naming service naming service before public void init throw exception super init port after public void destroy super destroy test public void write with read permission throw exception property put property key const username username1 property put property key const password password1 naming service naco factory create naming service property try name service register instance test 1.2 3.4 fail catch naco exception ne assert assert equal http status sc forbid ne get err code try name service deregister instance test 1.2 3.4 fail catch naco exception ne assert assert equal http status sc forbid ne get err code naming service shut down test public void read with read permission throw exception property put property key const username username2 property put property key const password password2 naming service name service1 naco factory create naming service property name service1 register instance test 1.2 3.4 time unit seconds sleep 5 l property put property key const username username1 property put property key const password password1 naming service naco factory create naming service property list instance list naming service get all instance test assert assert equal list size name service1 shut down naming service shut down test public void write with write permission throw exception property put property key const username username2 property put property key const password password2 naming service naco factory create naming service property name service register instance test 1.2 3.4 time unit seconds sleep 5 l naming service deregister instance test 1.2 3.4 naming service shut down test public void read with write permission throw exception property put property key const username username2 property put property key const password password2 naming service naco factory create naming service property name service register instance test 1.2 3.4 time unit seconds sleep 5 l list instance list naming service get all instance test assert assert equal list size naming service shut down test public void read write with full permission throw exception property put property key const username username3 property put property key const password password3 naming service naco factory create naming service property name service register instance test 1.2 3.4 time unit seconds sleep 5 l list instance list naming service get all instance test assert assert equal list size naming service shut down 
permission i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class permission i t case extend http client4 test local server port private int port private string access token before public void init throw exception time unit seconds sleep 5 l string url string format http localhost d port this base new url url after public void destroy delete permission response entity string response request naco v1 auth permission param new param append param role role1 append param resource public append param action rw append param access token access token do string class http method delete assert assert true response get status code is2xx successful delete permission response request naco v1 auth permission param new param append param role role1 append param resource test1 append param action r append param access token access token do string class http method delete assert assert true response get status code is2xx successful delete role response request naco v1 auth role param new param append param role role1 append param username username3 append param access token access token do string class http method delete assert assert true response get status code is2xx successful delete a user response request naco v1 auth user param new param append param username username3 append param access token access token do string class http method delete assert assert true response get status code is2xx successful test public void login response entity string response request naco v1 auth user login param new param append param username naco append param password naco do string class http method post assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert true json have access token access token json get access token text value test public void create delete query permission login create a user response entity string response request naco v1 auth user param new param append param username username3 append param password password1 append param access token access token do string class http method post assert assert true response get status code is2xx successful create role response request naco v1 auth role param new param append param role role1 append param username username3 append param access token access token do string class http method post assert assert true response get status code is2xx successful create permission response request naco v1 auth permission param new param append param role role1 append param resource public append param action rw append param access token access token do string class http method post assert assert true response get status code is2xx successful create another permission response request naco v1 auth permission param new param append param role role1 append param resource test1 append param action r append param access token access token do string class http method post assert assert true response get status code is2xx successful query permission response request naco v1 auth permission param new param append param role role1 append param page no append param page size append param access token access token do string class http method get system out println response assert assert true response get status code is2xx successful page permission permission page jackson util to obj response get body new type reference page permission assert assert not null permission page assert assert not null permission page get page item boolean found1 false found2 false for permission permission permission page get page item if permission get resource equal public permission get action equal rw found1 true if permission get resource equal test1 permission get action equal r found2 true if found1 found2 break assert assert true found1 assert assert true found2 delete permission response request naco v1 auth permission param new param append param role role1 append param resource public append param action rw append param access token access token do string class http method delete assert assert true response get status code is2xx successful query permission response request naco v1 auth permission param new param append param role role1 append param page no append param page size append param access token access token do string class http method get assert assert true response get status code is2xx successful permission page jackson util to obj response get body new type reference page permission assert assert not null permission page assert assert not null permission page get page item found1 false found2 false for permission permission permission page get page item if permission get resource equal public permission get action equal rw found1 true if permission get resource equal test1 permission get action equal r found2 true assert assert false found1 assert assert true found2 delete permission response request naco v1 auth permission param new param append param role role1 append param resource test1 append param action r append param access token access token do string class http method delete assert assert true response get status code is2xx successful query permission response request naco v1 auth permission param new param append param role role1 append param page no append param page size append param access token access token do string class http method get assert assert true response get status code is2xx successful permission page jackson util to obj response get body new type reference page permission assert assert not null permission page assert assert not null permission page get page item found1 false found2 false for permission permission permission page get page item if permission get resource equal public permission get action equal rw found1 true if permission get resource equal test1 permission get action equal r found2 true assert assert false found1 assert assert false found2 
role i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class role i t case extend http client4 test local server port private int port private string access token before public void init throw exception time unit seconds sleep 5 l string url string format http localhost d port this base new url url after public void destroy delete role response entity string response request naco v1 auth role param new param append param role role1 append param username username2 append param access token access token do string class http method delete assert assert true response get status code is2xx successful delete role response request naco v1 auth role param new param append param role role2 append param username username2 append param access token access token do string class http method delete assert assert true response get status code is2xx successful delete a user response request naco v1 auth user param new param append param username username2 append param access token access token do string class http method delete assert assert true response get status code is2xx successful test public void login response entity string response request naco v1 auth user login param new param append param username naco append param password naco do string class http method post assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert true json have access token access token json get access token text value test public void create delete query role login create a user response entity string response request naco v1 auth user param new param append param username username2 append param password password1 append param access token access token do string class http method post assert assert true response get status code is2xx successful create a role response request naco v1 auth role param new param append param role role1 append param username username2 append param access token access token do string class http method post assert assert true response get status code is2xx successful query role of user response request naco v1 auth role param new param append param username username2 append param page no append param page size append param access token access token do string class http method get assert assert true response get status code is2xx successful page role info role info page jackson util to obj response get body new type reference page role info assert assert not null role info page assert assert not null role info page get page item boolean find false for role info role info role info page get page item if role info get role equal role1 find true break assert assert true find add second role to user response request naco v1 auth role param new param append param role role2 append param username username2 append param access token access token do string class http method post assert assert true response get status code is2xx successful query role of user response request naco v1 auth role param new param append param username username2 append param page no append param page size append param access token access token do string class http method get assert assert true response get status code is2xx successful role info page jackson util to obj response get body new type reference page role info assert assert not null role info page assert assert not null role info page get page item find false boolean found2 false for role info role info role info page get page item if role info get role equal role1 find true if role info get role equal role2 found2 true if find found2 break assert assert true find assert assert true found2 delete role response request naco v1 auth role param new param append param role role2 append param username username2 append param access token access token do string class http method delete assert assert true response get status code is2xx successful query role of user response request naco v1 auth role param new param append param username username2 append param page no append param page size append param access token access token do string class http method get assert assert true response get status code is2xx successful role info page jackson util to obj response get body new type reference page role info assert assert not null role info page assert assert not null role info page get page item find false found2 false for role info role info role info page get page item if role info get role equal role1 find true if role info get role equal role2 found2 true assert assert false found2 assert assert true find delete role response request naco v1 auth role param new param append param role role1 append param username username2 append param access token access token do string class http method delete assert assert true response get status code is2xx successful query role of user response request naco v1 auth role param new param append param username username2 append param page no append param page size append param access token access token do string class http method get assert assert true response get status code is2xx successful role info page jackson util to obj response get body new type reference page role info assert assert not null role info page assert assert not null role info page get page item find false found2 false for role info role info role info page get page item if role info get role equal role1 find true if role info get role equal role2 found2 true assert assert false found2 assert assert false find 
user i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class user i t case extend http client4 test local server port private int port private string access token before public void init throw exception time unit seconds sleep 5 l string url string format http localhost d port this base new url url after public void destroy delete a user response entity string response request naco v1 auth user param new param append param username username1 append param access token access token do string class http method delete assert assert true response get status code is2xx successful test public void login response entity string response request naco v1 auth user login param new param append param username naco append param password naco do string class http method post assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert true json have access token access token json get access token text value test public void create update delete user login create a user response entity string response request naco v1 auth user param new param append param username username1 append param password password1 append param access token access token do string class http method post assert assert true response get status code is2xx successful query a user response request naco v1 auth user param new param append param page no append param page size string value of integer max value append param access token access token do string class assert assert true response get status code is2xx successful page user user page jackson util to obj response get body new type reference page user assert assert not null user page assert assert not null user page get page item assert assert true user page get page item size boolean find false for user user user page get page item if username1 equal user get username password encoder util match password1 user get password find true break assert assert true find update a user response request naco v1 auth user param new param append param username username1 append param new password password2 append param access token access token do string class http method put assert assert true response get status code is2xx successful query a user response request naco v1 auth user param new param append param page no append param page size string value of integer max value append param access token access token do string class user page jackson util to obj response get body new type reference page user assert assert not null user page assert assert not null user page get page item assert assert true user page get page item size find false for user user user page get page item if username1 equal user get username password encoder util match password2 user get password find true break assert assert true find delete a user response request naco v1 auth user param new param append param username username1 append param access token access token do string class http method delete assert assert true response get status code is2xx successful query a user response request naco v1 auth user param new param append param page no append param page size string value of integer max value append param access token access token do string class assert assert true response get status code is2xx successful user page jackson util to obj response get body new type reference page user assert assert not null user page assert assert not null user page get page item assert assert true user page get page item size find false for user user user page get page item if username1 equal user get username find true break assert assert false find 
auto deregister instance i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class auto deregister instance i t case private naming service name private naming service naming2 local server port private int port before public void init throw exception naming base prepare server port if naming null naming name factory create naming service 127.0 0.1 port while true if up equal name get server status application util get port thread sleep l continue break after public void destroy throw exception naming base destory server port cluster throw exception test public void auto dreg dom cluster test throw exception string service name random domain name name register instance service name 127.0 0.1 test port c1 name register instance service name 127.0 0.2 test port c2 time unit seconds sleep list instance instance instance name get all instance service name assert assert equal instance size naco name service naming service impl naco name service name naming service impl get beat reactor remove beat info constant default group constant service info spliter service name 127.0 0.1 test port verify instance list instance service name instance name get all instance service name assert assert equal instance size instance name get all instance service name array as list c2 assert assert equal instance size instance name get all instance service name array as list c1 assert assert equal instance size throw exception test public void auto dreg dom test throw exception string service name random domain name name register instance service name 127.0 0.1 test port name register instance service name 127.0 0.2 test port time unit seconds sleep list instance instance instance name get all instance service name assert assert equal instance size naco name service naming service impl naco name service name naming service impl get beat reactor remove beat info constant default group constant service info spliter service name 127.0 0.1 test port verify instance list instance service name instance name get all instance service name assert assert equal instance size throw exception test public void auto reg dom test throw exception string service name random domain name name register instance service name 127.0 0.1 test port name register instance service name 127.0 0.2 test port time unit seconds sleep list instance instance instance name get all instance service name assert assert equal instance size naco name service naming service impl naco name service name naming service impl get beat reactor remove beat info constant default group constant service info spliter service name 127.0 0.1 test port verify instance list instance service name instance name get all instance service name assert assert equal instance size beat info beat info new beat info beat info set service name constant default group constant service info spliter service name beat info set ip 127.0 0.1 beat info set port test port naming service impl get beat reactor add beat info constant default group constant service info spliter service name beat info verify instance list instance service name instance name get all instance service name assert assert equal instance size cluster throw exception test public void auto reg dom cluster test throw exception string service name random domain name name register instance service name 127.0 0.1 test port c1 name register instance service name 127.0 0.2 test port c2 time unit seconds sleep list instance instance instance name get all instance service name assert assert equal instance size naco name service naming service impl naco name service name naming service impl get beat reactor remove beat info constant default group constant service info spliter service name 127.0 0.1 test port verify instance list instance service name instance name get all instance service name assert assert equal instance size beat info beat info new beat info beat info set service name constant default group constant service info spliter service name beat info set ip 127.0 0.1 beat info set port test port beat info set cluster c1 naming service impl get beat reactor add beat info constant default group constant service info spliter service name beat info time unit seconds sleep verify instance list instance service name instance name get all instance service name assert assert equal instance size instance name get all instance service name array as list c2 assert assert equal instance size time unit seconds sleep instance name get all instance service name array as list c1 assert assert equal instance size public void verify instance list list instance instance int size string service name throw exception int i while i instance name get all instance service name if instance size size break else time unit seconds sleep i 
client beat i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class client beat i t case extend name base private naming service name local server port private int port before public void init throw exception naming base prepare server port if naming null naming name factory create naming service 127.0 0.1 port while true if up equal name get server status thread sleep l continue break string url string format http localhost d port this base new url url test public void test light beat throw exception string service name random domain name name register instance service name 1.2 3.4 instance instance new instance instance set ip 1.2 3.4 instance set port instance add metadata k1 v1 instance add metadata k2 v2 name register instance service name instance time unit seconds sleep 2 l list instance list name get all instance service name assert assert equal list size for instance instance1 list assert assert equal 1.2 3.4 instance1 get ip assert assert true instance1 get port instance1 get port if instance1 get port assert assert equal v1 instance1 get metadata get or default k1 string util empty assert assert equal v2 instance1 get metadata get or default k2 string util empty sleep seconds and see if instance list not change time unit seconds sleep 35 l list name get all instance service name assert assert equal list size for instance instance1 list assert assert equal 1.2 3.4 instance1 get ip assert assert true instance1 get port instance1 get port if instance1 get port assert assert equal v1 instance1 get metadata get or default k1 string util empty assert assert equal v2 instance1 get metadata get or default k2 string util empty change the light beat switch of server response entity string response request naming base name controller path operator switch param new param append param entry light beat enable append param value false do string class http method put assert assert true response get status code is2xx successful sleep seconds and see if instance list not change time unit seconds sleep 35 l list name get all instance service name assert assert equal list size for instance instance1 list assert assert equal 1.2 3.4 instance1 get ip assert assert true instance1 get port instance1 get port if instance1 get port assert assert equal v1 instance1 get metadata get or default k1 string util empty assert assert equal v2 instance1 get metadata get or default k2 string util empty reset the light beat switch of server response request naming base name controller path operator switch param new param append param entry light beat enable append param value true do string class http method put assert assert true response get status code is2xx successful 
cmdb i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port ignore public class cmdb i t case private naming service name private url base public static final long time out autowired private test rest template rest template local server port private int port before public void set up throw exception string url string format http s s test ip dom port this base new url url if naming null naming name factory create naming service test ip dom port after public void cleanup throw exception t c description cmdb label throw exception test public void cmdb get instance list throw exception string service name random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 string service name2 random domain name naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep 5 l object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body assert assert equal result get host size t c description cmdb label instance throw exception test public void cmdb get instance list throw exception string service name random domain name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 string service name2 random domain name naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body assert assert equal result get host size t c description cmdb ip instance throw exception test public void cmdb get instance list throw exception string service name random domain name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 string service name2 random domain name naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 66.66 66.66 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb service name throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n service param new param append param service name service name append param namespace id constant default namespace id do string class http method get system out println service list jackson util to obj http result get body http result request naco v1 n instance list param new param append param service name service name append param client i p 66.66 66.66 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb ip instance service name throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 77.77 77.77 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb selector throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb selector throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 list string params array as list service name service name protect threshold selector json to string response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal json get host size http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb expression throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb expression null instance throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb type label throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label1 json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http bad request http result get status code value public void instance register string service name string namespace string group name string ip string port string cluster name throw i o exception response entity string http result request naco v1 n instance param new param append param service name service name append param ip ip append param port port append param namespace id namespace append param group name group name append param cluster name cluster name append param ephemeral false do string class http method post assert assert equal http u be l connection http ok http result get status code value public void naming service create string service name string namespace throw i o exception naming service create service name namespace constant default group public void naming service create string service name string namespace string group name throw i o exception list string list param array as list service name service name protect threshold 0.3 namespace id namespace group name group name response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold 0.3 append param namespace id namespace append param group name group name do string class http method post assert assert equal http u be l connection http ok http result get status code value private t response entity t request string path multi value map string string param class t clazz return request path param clazz org springframework http http method get private t response entity t request string path multi value map string string param class t clazz org springframework http http method http method http header header new http header http entity entity new http entity t header uri component builder builder uri component builder from http url this base to string path query param param return this rest template exchange builder to uri string http method entity clazz 
c p instance a p i i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class c p instance a p i i t case private naming service name private naming service naming1 private naming service naming2 local server port private int port private url base autowire private test rest template rest template before public void set up throw exception string url string format http localhost d port this base new url url name naming factory create naming service 127.0 0.1 port property property new property property put property key const namespace test namespace property put property key const server addr 127.0 0.1 port naming1 name factory create naming service property property new property property put property key const namespace test namespace property put property key const server addr 127.0 0.1 port naming2 name factory create naming service property after public void cleanup throw exception t c description service name register instance ephemeral true test step expect result test public void register instance ephemeral true throw exception string service name naming base random domain name naming service create service name test namespace test group instance instance new instance instance set ephemeral true instance set cluster name c1 instance set ip 11.11 11.11 instance set port naming1 register instance service name test group instance time unit seconds sleep 3 l naming1 deregister instance service name test group instance naming service delete service name test namespace test group t c description service name register instance ephemeral false test step expect result test public void register instance ephemeral false throw exception string service name naming base random domain name naming service create service name test namespace test group instance instance new instance instance set ephemeral false instance set cluster name c1 instance set ip 11.11 11.11 instance set port naming1 register instance service name test group instance naming service delete service name test namespace test group t c description service name register instance ephemeral false test step expect result test public void register instance ephemeral false deregister instance throw exception string service name naming base random domain name naming service create service name test namespace test group instance instance new instance instance set ephemeral false instance set cluster name c1 instance set ip 11.11 11.11 instance set port naming1 register instance service name test group instance naming1 deregister instance service name test group instance time unit seconds sleep 3 l naming service delete service name test namespace test group t c description service name test step expect result test public void create service throw exception string service name naming base random domain name naming service create service name test namespace naming service delete service name test namespace t c description service name test step expect result test public void delete service have instace throw exception string service name naming base random domain name naming service create service name test namespace response entity string response request naming base name controller path instance param new param append param service name service name append param ip 11.11 11.11 append param port append param namespace id test namespace do string class http method post assert assert true response get status code is2xx successful naming service delete service name test namespace t c description service name http test step expect result test public void get service throw exception string service name naming base random domain name naming service create service name test namespace response entity string response request naming base name controller path service param new param append param service name service name append param namespace id test namespace append param protect threshold 0.5 do string class http method put assert assert true response get status code is2xx successful assert assert equal ok response get body get service response request naming base name controller path service param new param append param service name service name append param namespace id test namespace do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal service name json get name text value assert assert equal 0.5 json get protect threshold as text naming service delete service name test namespace t c description service name test step expect result test public void get service throw exception string service name naming base random domain name list view string list view naming1 get service of server naming service create service name test namespace time unit seconds sleep 5 l list view string list view1 naming1 get service of server assert assert equal list view get count list view1 get count naming service delete service name test namespace t c description list test step expect result test public void list service throw exception string service name naming base random domain name list view string list view name get service of server naming service create service name constant default namespace id get service response entity string response request naming base name controller path service list param new param append param service name service name append param page no append param page size do string class system out println json response get body assert assert true response get status code is2xx successful json node json jackson util to obj response get body int count json get count int value assert assert equal list view get count count naming service delete service name constant default namespace id t c description service name test step expect result test public void register instance api throw exception string service name naming base random domain name naming service create service name constant default namespace id instance register service name constant default namespace id 33.33 33.33 test p o r t2 dom response entity string response request name controller path instance list param new param append param service name service name naming append param namespace id constant default namespace id do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal json get host size instance deregister service name constant default namespace id 33.33 33.33 test p o r t2 dom naming service delete service name constant default namespace id t c description service name test step expect result test public void register instance query throw exception string service name naming base random domain name naming service create service name constant default namespace id instance register service name constant default namespace id 33.33 33.33 test p o r t2 dom list instance instance name get all instance service name assert assert equal instance size assert assert equal 33.33 33.33 instance get get ip instance deregister service name constant default namespace id 33.33 33.33 test p o r t2 dom time unit seconds sleep 3 l instance name get all instance service name assert assert equal instance size naming service delete service name constant default namespace id t c description service name group test step expect result test public void register instance throw exception string service name naming base random domain name naming service create service name constant default namespace id naming service create service name constant default namespace id test group instance register service name constant default namespace id 33.33 33.33 test p o r t2 dom instance register service name constant default namespace id test group 22.22 22.22 test p o r t2 dom response entity string response request name controller path instance list param new param append param service name service name naming append param namespace id constant default namespace id do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal json get host size instance deregister service name constant default namespace id 33.33 33.33 test p o r t2 dom instance deregister service name constant default namespace id test group 22.22 22.22 test p o r t2 dom naming service delete service name constant default namespace id naming service delete service name constant default namespace id test group private void instance deregister string service name string namespace string ip string port instance deregister service name namespace constant default group ip port private void instance deregister string service name string namespace string group name string ip string port response entity string response request naming base name controller path instance param new param append param service name service name append param ip ip append param port port append param namespace id namespace append param group name group name do string class http method delete assert assert true response get status code is2xx successful private void instance register string service name string namespace string group name string ip string port response entity string response request naming base name controller path instance param new param append param service name service name append param ip ip append param port port append param namespace id namespace append param group name group name do string class http method post assert assert true response get status code is2xx successful private void instance register string service name string namespace string ip string port instance register service name namespace constant default group ip port private void naming service create string service name string namespace naming service create service name namespace constant default group private void naming service create string service name string namespace string group name response entity string response request naming base name controller path service param new param append param service name service name append param protect threshold 0.3 append param namespace id namespace append param group name group name do string class http method post system out println response assert assert true response get status code is2xx successful assert assert equal ok response get body private void naming service delete string service name string namespace naming service delete service name namespace constant default group private void naming service delete string service name string namespace string group name delete service response entity string response request naming base name controller path service param new param append param service name service name append param namespace id namespace append param group name group name do string class http method delete system out println response assert assert true response get status code is2xx successful assert assert equal ok response get body private t response entity t request string path multi value map string string param class t clazz http header header new http header http entity entity new http entity t header uri component builder builder uri component builder from http url this base to string path query param param return this rest template exchange builder to uri string http method get entity clazz private t response entity t request string path multi value map string string param class t clazz http method http method http header header new http header http entity entity new http entity t header uri component builder builder uri component builder from http url this base to string path query param param return this rest template exchange builder to uri string http method entity clazz private void prepare datum response entity string response entity request naco v1 n api reg dom param new param append param dom naming base test dom append param cktype tcp append param token abc do string class if response entity get status code be error throw new runtime exception before test register domain fail response entity to string try thread sleep l catch interrupt exception e e print stack trace response entity request naco v1 n api add i p4 dom param new param append param dom naming base test dom append param ip list naming base test ip dom naming base test port dom append param token naming base test token dom do string class if response entity get status code be error throw new runtime exception before test add ip for domain fail response entity to string private void remove datum response entity string response entity request naco v1 n api remv dom param new param append param dom naming base test dom append param token abc do string class if response entity get status code be error throw new runtime exception before test remove domain fail response entity to string 
deregister instance i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class deregister instance i t case private naming service name local server port private int port before public void init throw exception naming base prepare server port if naming null time unit seconds sleep name name factory create naming service 127.0 0.1 port while true if up equal name get server status thread sleep l continue break service cluster ip throw exception test public void dreg dom test throw exception string service name random domain name system out println service name name register instance service name 127.0 0.1 test port name register instance service name 127.0 0.2 test port list instance instance name get all instance service name verify instance list instance service name instance name get all instance service name assert assert equal instance size name deregister instance service name 127.0 0.1 test port time unit seconds sleep instance name get all instance service name assert assert equal instance size assert assert equal instance get get ip 127.0 0.2 name deregister instance service name 127.0 0.2 test port time unit seconds sleep instance name get all instance service name assert assert equal instance size service cluster ip throw exception test public void dreg dom cluster test throw exception string service name random domain name system out println service name name register instance service name 127.0 0.1 test port c1 name register instance service name 127.0 0.2 test port c2 list instance instance instance name get all instance service name verify instance list instance service name instance name get all instance service name assert assert equal instance size name deregister instance service name 127.0 0.1 test port c1 time unit seconds sleep instance name get all instance service name assert assert equal instance size instance name get all instance service name array as list c2 assert assert equal instance size instance name get all instance service name array as list c1 service instance null throw exception test public void dreg last dom test throw exception string service name random domain name name register instance service name 127.0 0.1 test port c1 name register instance service name 127.0 0.2 test port c2 list instance instance instance name get all instance service name verify instance list instance service name instance name get all instance service name assert assert equal instance size name deregister instance service name 127.0 0.1 test port c1 time unit seconds sleep instance name get all instance service name assert assert equal instance size instance name get all instance service name array as list c2 assert assert equal instance size name deregister instance service name 127.0 0.2 test port c2 time unit seconds sleep instance name get all instance service name assert assert equal instance size public void verify instance list list instance instance int size string service name throw exception int i while i instance name get all instance service name if instance size size break else time unit seconds sleep i 
multi tenant instance a p i i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class multi tenant instance a p i i t case private naming service name private naming service naming1 private naming service naming2 local server port private int port autowire private test rest template rest template private url base private volatile list instance instance collection empty list before public void init throw exception naming base prepare server port string url string format http localhost d port this base new url url name naming factory create naming service 127.0 0.1 port while true if up equal name get server status thread sleep l continue break property property new property property put property key const namespace namespace property put property key const server addr 127.0 0.1 port naming1 name factory create naming service property property new property property put property key const namespace namespace property put property key const server addr 127.0 0.1 port naming2 name factory create naming service property t c description ip list instance test step expect result test public void multiple tenant list instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 naming2 register instance service name 22.22 22.22 name register instance service name 33.33 33.33 name register instance service name 44.44 44.44 time unit seconds sleep 5 l string url naco v1 n instance list response entity string response request url param new param append param service name service name append param namespace id namespace do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal 11.11 11.11 json get host get get ip as text response request url param new param append param service name service name do string class assert assert true response get status code is2xx successful json jackson util to obj response get body assert assert equal json get host size t c description group ip list instance test step expect result test public void multiple tenant group list instance throw exception string service name random domain name naming1 register instance service name test group 11.11 11.11 naming1 register instance service name 22.22 22.22 name register instance service name test group 33.33 33.33 name register instance service name test group 44.44 44.44 time unit seconds sleep 5 l string url naco v1 n instance list response entity string response request url param new param append param service name service name append param namespace id namespace append param group name test group do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal 11.11 11.11 json get host get get ip as text response request url param new param append param service name service name append param group name test group do string class assert assert true response get status code is2xx successful json jackson util to obj response get body assert assert equal json get host size assert assert equal 33.33 33.33 json get host get get ip as text t c description ip get instance test step expect result test public void multiple tenant get instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 naming2 register instance service name 22.22 22.22 name register instance service name 33.33 33.33 c1 naming register instance service name 44.44 44.44 time unit seconds sleep 5 l response entity string response request naco v1 n instance param new param append param service name service name append param ip 33.33 33.33 ip append param port append param namespace id namespace do string class assert assert equal http status not find response get status code response request naco v1 n instance list param new param append param service name service name append param cluster c1 append param healthy only true do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal json get host size assert assert equal 33.33 33.33 json get host get get ip as text t c description ip get instance test step expect result test public void multiple tenant group get instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 naming2 register instance service name 22.22 22.22 name register instance service name 33.33 33.33 c1 naming register instance service name 44.44 44.44 c2 time unit seconds sleep 5 l response entity string response request naco v1 n instance param new param append param service name service name append param group name test group append param ip 33.33 33.33 ip append param port append param namespace id namespace do string class assert assert equal http status not find response get status code response request naco v1 n instance list param new param append param service name service name append param cluster c2 append param healthy only true do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal json get host size assert assert equal 44.44 44.44 json get host get get ip as text t c description ip delete instance namespace ip test step expect result test public void multiple tenant delete instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 naming2 register instance service name 22.22 22.22 name register instance service name 33.33 33.33 name register instance service name 44.44 44.44 time unit seconds sleep 3 l ap http naco name service naming service impl naco name service naming2 naming service impl get beat reactor remove beat info constant default group constant service info spliter service name 33.33 33.33 time unit seconds sleep 3 l response entity string response request naco v1 n instance param new param append param service name service name append param ip 33.33 33.33 append param port append param namespace id namespace namespace ip do string class http method delete assert assert true response get status code is2xx successful response request naco v1 n instance list param new param append param service name service name naming do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal json get host size t c description ip group delete instance ip test step expect result test public void multiple tenant group delete instance throw exception string service name random domain name naming1 register instance service name test group 11.11 11.11 naming2 register instance service name test group 22.22 22.22 time unit seconds sleep 5 l ap http naco name service naming service impl naco name service naming2 naming service impl get beat reactor remove beat info test group constant service info spliter service name 22.22 22.22 response entity string response request naco v1 n instance param new param append param service name service name append param namespace id namespace namespace ip append param group name test group append param ip 22.22 22.22 append param port test p o r t3 dom do string class http method delete assert assert true response get status code is2xx successful response request naco v1 n instance list param new param append param service name service name naming append param namespace id namespace append param group name test group do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal json get host size t c description ip put instance test step expect result test public void multiple tenant put instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 naming2 register instance service name 22.22 22.22 name register instance service name 33.33 33.33 name register instance service name 44.44 44.44 time unit seconds sleep 5 l response entity string response request naco v1 n instance param new param append param service name service name append param ip 33.33 33.33 append param port do string class http method put assert assert true response get status code is2xx successful response request naco v1 n instance list param new param append param service name service name naming append param namespace id namespace do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal json get host size namespace response request naco v1 n instance list param new param append param service name service name naming append param namespace id namespace do string class assert assert true response get status code is2xx successful json jackson util to obj response get body system out println json assert assert equal json get host size t c description group ip put instance test step expect result test public void multiple tenant group put instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 naming2 register instance service name test group 22.22 22.22 time unit seconds sleep 5 l response entity string response request naco v1 n instance param new param append param service name service name append param group name test group append param ip 22.22 22.22 append param port append param namespace id namespace append param weight 8.0 do string class http method put assert assert true response get status code is2xx successful response request naco v1 n instance list param new param append param service name service name naming append param namespace id namespace append param group name test group do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal json get host size assert assert equal 8.0 json get host get get weight as text t c description group ip patch instance test step expect result test public void multiple tenant group patch instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 naming2 register instance service name test group 22.22 22.22 time unit seconds sleep 5 l response entity string response request naco v1 n instance param new param append param service name service name append param group name test group append param ip 22.22 22.22 append param port append param namespace id namespace append param weight 8.0 do string class http method put assert assert true response get status code is2xx successful response request naco v1 n instance param new param append param service name service name append param group name test group append param ip 22.22 22.22 append param port append param namespace id namespace do string class http method patch assert assert true response get status code is2xx successful response request naco v1 n instance list param new param append param service name service name naming append param namespace id namespace append param group name test group do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal json get host size assert assert equal 8.0 json get host get get weight as text t c description ip update test step expect result test public void multiple tenant update instance not exsit instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 naming2 register instance service name 22.22 22.22 name register instance service name 33.33 33.33 name register instance service name 44.44 44.44 time unit seconds sleep 5 l response entity string response request naco v1 n instance param new param append param service name service name append param ip 33.33 33.33 append param port append param namespace id namespace do string class http method post assert assert true response get status code is2xx successful response request naco v1 n instance list param new param append param service name service name naming append param namespace id namespace do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal json get host size namespace response request naco v1 n instance list param new param append param service name service name naming append param namespace id namespace do string class assert assert true response get status code is2xx successful json jackson util to obj response get body assert assert equal json get host size t c description group ip test step expect result test public void multiple tenant group update instance not exsit instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 naming2 register instance service name 22.22 22.22 time unit seconds sleep 5 l response entity string response request naco v1 n instance param new param append param service name service name append param ip 33.33 33.33 append param port append param namespace id namespace append param group name test group do string class http method post assert assert true response get status code is2xx successful response request naco v1 n instance list param new param append param service name service name naming append param namespace id namespace append param group name test group do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal 33.33 33.33 json get host get get ip as text t c description ip update test step expect result test public void multiple tenant update instance throw exception string service name random domain name naming2 register instance service name 22.22 22.22 name register instance service name 33.33 33.33 name register instance service name 44.44 44.44 time unit seconds sleep 5 l response entity string response request naco v1 n instance param new param append param service name service name append param ip 11.11 11.11 append param port append param namespace id namespace do string class http method post assert assert true response get status code is2xx successful response request naco v1 n instance list param new param append param service name service name naming append param namespace id namespace do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal json get host size namespace response request naco v1 n instance list param new param append param service name service name naming append param namespace id namespace do string class assert assert true response get status code is2xx successful json jackson util to obj response get body assert assert equal json get host size private void verify instance list for name naming service name int size string service name throw exception int i while i list instance instance name get all instance service name if instance size size break else time unit seconds sleep i private t response entity t request string path multi value map string string param class t clazz return request path param clazz http method get private t response entity t request string path multi value map string string param class t clazz http method http method http header header new http header http entity entity new http entity t header uri component builder builder uri component builder from http url this base to string path query param param return this rest template exchange builder to uri string http method entity clazz 
multi tenant i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class multi tenant i t case private naming service name private naming service naming1 private naming service naming2 local server port private int port private volatile list instance instance collection empty list before public void init throw exception thread sleep l naming base prepare server port name naming factory create naming service 127.0 0.1 port while true if up equal name get server status thread sleep l continue break property property new property property put property key const namespace namespace property put property key const server addr 127.0 0.1 port naming1 name factory create naming service property property new property property put property key const namespace namespace property put property key const server addr 127.0 0.1 port naming2 name factory create naming service property t c description ip port test step expect result test public void multiple tenant register instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 naming2 register instance service name 22.22 22.22 name register instance service name 33.33 33.33 name register instance service name 44.44 44.44 time unit seconds sleep 5 l list instance instance naming1 get all instance service name assert assert equal instance size assert assert equal 11.11 11.11 instance get get ip assert assert equal instance get get port instance naming2 get all instance service name assert assert equal instance size assert assert equal 22.22 22.22 instance get get ip assert assert equal instance get get port instance name get all instance service name assert assert equal instance size t c description group test step expect result test public void multiple tenant multi group register instance throw exception string service name random domain name naming1 register instance service name test group 11.11 11.11 naming2 register instance service name test group 22.22 22.22 name register instance service name 33.33 33.33 name register instance service name 44.44 44.44 time unit seconds sleep 5 l list instance instance naming1 get all instance service name assert assert equal instance size instance naming2 get all instance service name test group assert assert equal instance size assert assert equal 22.22 22.22 instance get get ip assert assert equal instance get get port instance name get all instance service name assert assert equal instance size naming1 deregister instance service name test group 11.11 11.11 naming1 deregister instance service name test group 22.22 22.22 t c description ip port test step expect result test public void multiple tenant equal i p throw exception string service name random domain name naming1 register instance service name 11.11 11.11 naming2 register instance service name 11.11 11.11 name register instance service name 11.11 11.11 time unit seconds sleep 5 l list instance instance naming1 get all instance service name assert assert equal instance size assert assert equal 11.11 11.11 instance get get ip assert assert equal instance get get port instance naming2 get all instance service name assert assert equal instance size assert assert equal 11.11 11.11 instance get get ip assert assert equal instance get get port instance name get all instance service name assert assert equal instance size t c description ip port test step expect result test public void multiple tenant select instance throw exception string service name random domain name naming1 register instance service name test ip dom test port naming2 register instance service name 22.22 22.22 name register instance service name test ip dom test port name register instance service name 44.44 44.44 time unit seconds sleep 5 l list instance instance naming1 select instance service name true assert assert equal instance size assert assert equal test ip dom instance get get ip assert assert equal test port instance get get port instance naming2 select instance service name false assert assert equal instance size instance name select instance service name true assert assert equal instance size t c description group ip port test step expect result test public void multiple tenant group equal i p throw exception string service name random domain name naming1 register instance service name test group 11.11 11.11 naming2 register instance service name test group 11.11 11.11 name register instance service name constant default group 11.11 11.11 time unit seconds sleep 5 l list instance instance naming1 get all instance service name assert assert equal instance size instance naming2 get all instance service name test group assert assert equal instance size assert assert equal 11.11 11.11 instance get get ip assert assert equal instance get get port instance name get all instance service name assert assert equal instance size t c description group ip port group test step expect result test public void multiple tenant group get instance throw exception string service name random domain name system out println service name naming1 register instance service name test group 11.11 11.11 naming1 register instance service name test group 11.11 11.11 name register instance service name constant default group 11.11 11.11 time unit seconds sleep 5 l list instance instance naming1 get all instance service name test group assert assert equal instance size instance name get all instance service name assert assert equal instance size naming1 deregister instance service name test group 11.11 11.11 naming1 deregister instance service name test group 11.11 11.11 t c description test step expect result test public void multiple tenant get service of server throw exception string service name random domain name naming1 register instance service name 11.11 11.11 test port c1 time unit seconds sleep 5 l list view string list view naming1 get service of server naming2 register instance service name 33.33 33.33 test port c1 time unit seconds sleep 5 l list view string list view1 naming1 get service of server assert assert equal list view get count list view1 get count t c description group test step expect result test public void multiple tenant group get service of server throw exception string service name random domain name naming1 register instance service name test group 11.11 11.11 test port c1 naming1 register instance service name test group 22.22 22.22 test port c1 time unit seconds sleep 5 l list view string list view naming1 get service of server test group naming2 register instance service name 33.33 33.33 test port c1 time unit seconds sleep 5 l list view string list view1 naming1 get service of server test group assert assert equal list view get count list view1 get count assert assert not equal list view1 get count t c description test step expect result test public void multiple tenant subscribe throw exception string service name random domain name naming1 subscribe service name new event listener override public void on event event event instance name event event get instance naming1 register instance service name 11.11 11.11 test port c1 naming2 register instance service name 33.33 33.33 test port c1 while instance size time unit seconds sleep 1 l assert assert equal instance size time unit seconds sleep 2 l assert assert true verify instance list instance naming1 get all instance service name t c description group test step expect result test public void multiple tenant group subscribe throw exception string service name random domain name naming1 subscribe service name test group new event listener override public void on event event event instance name event event get instance naming1 register instance service name 11.11 11.11 test port c1 naming1 register instance service name test group 33.33 33.33 test port c1 while instance size time unit seconds sleep 1 l time unit seconds sleep 2 l assert assert equal instance size time unit seconds sleep 2 l assert assert true verify instance list instance naming1 get all instance service name test group naming1 deregister instance service name 11.11 11.11 test port c1 naming1 deregister instance service name test group 33.33 33.33 test port c1 t c description test step expect result test public void multiple tenant un subscribe throw exception string service name random domain name event listener listener new event listener override public void on event event event system out println name event event get service name instance name event event get instance naming1 subscribe service name listener naming1 register instance service name 11.11 11.11 test port c1 naming2 register instance service name 33.33 33.33 test port c1 while instance size time unit seconds sleep 1 l assert assert equal service name naming1 get subscribe service get get name assert assert equal naming2 get subscribe service size naming1 unsubscribe service name listener time unit seconds sleep 5 l assert assert equal naming1 get subscribe service size assert assert equal naming2 get subscribe service size t c description group group test step expect result test public void multiple tenant group nosubscribe un subscribe throw exception string service name random domain name event listener listener new event listener override public void on event event event system out println name event event get service name instance name event event get instance naming1 subscribe service name test group listener naming1 register instance service name 11.11 11.11 test port c1 naming1 register instance service name test group 33.33 33.33 test port c1 time unit seconds sleep 3 l assert assert equal service name naming1 get subscribe service get get name assert assert equal naming2 get subscribe service size naming1 unsubscribe service name listener group time unit seconds sleep 3 l assert assert equal naming1 get subscribe service size naming1 unsubscribe service name test group listener group time unit seconds sleep 3 l assert assert equal naming1 get subscribe service size assert assert equal naming2 get subscribe service size t c description group group test step expect result test public void multiple tenant group un subscribe throw exception string service name random domain name event listener listener new event listener override public void on event event event system out println name event event get service name instance name event event get instance naming1 subscribe service name constant default group listener naming1 subscribe service name test group listener naming1 subscribe service name test group listener naming1 register instance service name 11.11 11.11 test port c1 naming1 register instance service name test group 33.33 33.33 test port c1 while instance size time unit seconds sleep 1 l time unit seconds sleep 2 l assert assert equal service name naming1 get subscribe service get get name assert assert equal naming1 get subscribe service size naming1 unsubscribe service name listener naming1 unsubscribe service name test group listener time unit seconds sleep 3 l assert assert equal naming1 get subscribe service size assert assert equal test group naming1 get subscribe service get get group name naming1 unsubscribe service name test group listener t c description server test step expect result test public void multiple tenant server status throw exception assert assert equal test server status naming1 get server status assert assert equal test server status naming2 get server status t c description test step expect result test public void multiple tenant deregister instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 test port c1 naming1 register instance service name 22.22 22.22 test port c1 naming2 register instance service name 22.22 22.22 test port c1 list instance instance naming1 get all instance service name verify instance list for name naming1 service name assert assert equal naming1 get all instance service name size naming1 deregister instance service name 22.22 22.22 test port c1 time unit seconds sleep assert assert equal naming1 get all instance service name size assert assert equal naming2 get all instance service name size t c description group group test step expect result test public void multiple tenant group deregister instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 test port c1 naming1 register instance service name 22.22 22.22 test port c2 list instance instance naming1 get all instance service name verify instance list for name naming1 service name assert assert equal naming1 get all instance service name size naming1 deregister instance service name test group 22.22 22.22 test port c1 time unit seconds sleep assert assert equal naming1 get all instance service name size t c description group cluster name test step expect result test public void multiple tenant group cluster deregister instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 test port c1 naming1 register instance service name 22.22 22.22 test port c2 list instance instance naming1 get all instance service name verify instance list for name naming1 service name assert assert equal naming1 get all instance service name size naming1 deregister instance service name 22.22 22.22 test port time unit seconds sleep 3 l assert assert equal naming1 get all instance service name size naming1 deregister instance service name 11.11 11.11 test port c1 naming1 deregister instance service name 22.22 22.22 test port c2 t c description test step expect result test public void multiple tenant select one healthy instance throw exception string service name random domain name naming1 register instance service name 11.11 11.11 test port c1 naming1 register instance service name 22.22 22.22 test port c2 naming2 register instance service name 22.22 22.22 test port c3 list instance instance naming1 get all instance service name verify instance list for name naming1 service name assert assert equal naming1 get all instance service name size instance instance naming1 select one healthy instance service name array as list c1 assert assert equal 11.11 11.11 instance get ip naming1 deregister instance service name 11.11 11.11 test port c1 time unit seconds sleep instance naming1 select one healthy instance service name assert assert equal 22.22 22.22 instance get ip t c description group test step expect result test public void multiple tenant group select one healthy instance throw exception string service name random domain name naming1 register instance service name test group 11.11 11.11 test port c1 naming1 register instance service name test group 22.22 22.22 test port c2 naming1 register instance service name test group 33.33 33.33 test port c3 list instance instance naming1 get all instance service name test group verify instance list for name naming1 service name assert assert equal naming1 get all instance service name size defalut group instance instance naming1 select one healthy instance service name test group array as list c1 assert assert equal 11.11 11.11 instance get ip instance naming1 select one healthy instance service name test group assert assert equal 22.22 22.22 instance get ip naming1 deregister instance service name test group 11.11 11.11 test port c1 naming1 deregister instance service name test group 22.22 22.22 test port c2 naming1 deregister instance service name test group 33.33 33.33 test port c3 t c description group group test step expect result test expect illegal state exception class public void multiple tenant no group select one healthy instance throw exception string service name random domain name naming1 register instance service name test group 11.11 11.11 test port c1 naming1 register instance service name test group 22.22 22.22 test port c2 list instance instance naming1 get all instance service name test group verify instance list for name naming1 service name instance instance naming1 select one healthy instance service name array as list c1 naming1 deregister instance service name test group 11.11 11.11 test port c1 naming1 deregister instance service name test group 22.22 22.22 test port c2 private void verify instance list for name naming service name int size string service name throw exception int i while i list instance instance name get all instance service name if instance size size break else time unit seconds sleep i 
name maintain service i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class naming maintain service i t case extend base test private naming maintain service naming maintain service private naming service naming service private instance instance private string service name local server port private int port before public void init throw exception naming base prepare server port if naming maintain service null time unit seconds sleep name maintain service naming maintain factory create maintain service 127.0 0.1 port if naming service null time unit seconds sleep name service name factory create naming service 127.0 0.1 port instance new instance instance set ip 127.0 0.1 instance set port instance set weight instance set cluster name constant default cluster name map string string map new hash map string string map put net type external map put version 1.0 instance set metadata map service name random domain name test public void update instance throw naco exception map string string map new hash map string string map put net type external update map put version 2.0 naming service register instance service name instance instance set metadata map naming maintain service update instance service name instance list instance instance name service get all instance service name true assert assert equal instance size system out println instance get test public void update instance with disable throw naco exception map string string map new hash map string string map put net type external update map put version 2.0 naming service register instance service name instance instance set metadata map instance set enable false naming maintain service update instance service name instance list instance instance name service get all instance service name true assert assert equal instance size test public void create and update service throw naco exception register service service pre service new service pre service set name service name pre service set group name constant default group pre service set protect threshold 1.0 f map string string metadata new hash map string string metadata put service name this be a register metadata pre service set metadata metadata expression selector selector new expression selector selector set expression consumer label a provider label a consumer label b provider label b system out println service info pre service naming maintain service create service pre service selector service remote service naming maintain service query service service name system out println remote service info remote service assert assert equal pre service to string remote service to string update service service now service new service now service set name service name now service set group name constant default group now service set protect threshold 1.0 f metadata clear metadata put service name this be a update metadata now service set metadata metadata naming maintain service update service now service new none selector remote service naming maintain service query service service name system out println remote service info remote service assert assert equal now service to string remote service to string test public void delete service throw naco exception service pre service new service pre service set name service name system out println service info pre service naming maintain service create service pre service new none selector assert assert true naming maintain service delete service service name 
name proxy i t case run with spring runner class spring boot test class name app class property server servlet context path naco web environment spring boot test web environment random port public class name proxy i t case local server port private int port autowire private serializer serializer private final datum store datum store new datum store private naming service naming service private final string namespace id dev private final string service name biz private final string group name default group before public void init throw naco exception property property new property property put property key const namespace namespace id property put property key const server addr localhost port naming service name factory create naming service property test public void test sync datum throw naco exception interrupted exception write datum to datum store string group name name util get group name service name group name instance instance new instance instance instance new instance instance set ip 1.2 3.4 instance set port instance set ephemeral true instance set service name group name list instance instance list new array list instance instance list add instance instance set instance list instance list string key key builder build instance list key namespace id instance get service name true datum instance datum new datum datum value instance datum key key datum timestamp increment and get this data store put key datum sync datum to server map string datum datum map datum store get datum map byte content serializer serialize datum map boolean result name proxy sync datum content localhost port if result assert fail name proxy sync datum error query instance by api list com alibaba naco api name pojo instance all instance name service get all instance service name false for int i i all instance be empty i wait for async op time unit seconds sleep all instance name service get all instance service name false if all instance be empty assert fail instance be empty com alibaba naco api name pojo instance dst all instance get assert assert equal instance get ip dst get ip assert assert equal instance get port dst get port assert assert equal instance get service name dst get service name 
register instance i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class register instance i t case private naming service name private naming service naming2 local server port private int port before public void init throw exception naming base prepare server port if naming null time unit seconds sleep name name factory create naming service 127.0 0.1 port while true if up equal name get server status thread sleep l continue break test public void reg service throw naco exception interrupted exception property property new property property put property key const server addr 127.0 0.1 port property put property key const namespace t3 name naming factory create naming service property time unit seconds sleep string service name dungu test name register instance service name 127.0 0.1 c1 naming register instance service name 127.0 0.2 c2 list instance instance name get all instance service name assert assert equal instance size cluster instance throw exception test public void reg dom test throw exception string service name random domain name system out println service name name register instance service name test ip dom test port time unit seconds sleep list instance instance name get all instance service name assert assert equal instance size assert assert true instance get get instance id contain service name assert assert equal instance get get service get name service name assert assert equal instance get get ip test ip dom assert assert equal instance get get port test port cluster instance throw exception test public void reg dom cluster test throw exception string service name random domain name system out println service name name register instance service name test ip dom test port test new cluster dom time unit seconds sleep list instance instance name get all instance service name assert assert equal instance size assert assert true instance get get instance id contain service name assert assert equal instances2 get get service get name service name assert assert equal instance get get ip test ip dom assert assert equal instance get get port test port assert assert equal instance get get cluster get name test new cluster dom list instance instances2 name get all instance service name array as list test new cluster dom assert assert equal instances2 size assert assert true instances2 get get instance id contain service name assert assert equal instances2 get get service get name service name assert assert equal instances2 get get ip test ip dom assert assert equal instances2 get get port test port assert assert equal instances2 get get cluster get name test new cluster dom instance throw exception test public void reg dom with instance throw exception string service name random domain name instance i1 get instance service name name register instance service name i1 time unit seconds sleep list instance instance name get all instance service name assert assert equal instance size assert assert true verify instance i1 instance get instance throw exception test public void reg dom not health throw exception string service name random domain name system out println service name name register instance service name 1.1 1.1 name register instance service name test ip dom test port time unit seconds sleep list instance instance name select instance service name false assert assert equal instance size test public void reg service with metadata throw exception string service name random domain name system out println service name instance instance new instance instance set ip 1.1 1.2 instance set port map string string metadata new hash map string string metadata put version 1.0 metadata put env prod instance set metadata metadata name register instance service name instance time unit seconds sleep list instance instance name get all instance service name assert assert equal instance size assert assert equal 1.0 instance get get metadata get version assert assert equal prod instance get get metadatum get env test public void reg service with t t l throw exception string service name random domain name system out println service name instance instance new instance instance set ip 1.1 1.2 instance set port map string string metadata new hash map string string metadata put preserve metadata key heart beat interval metadata put preserve metadata key heart beat timeout metadata put preserve metadata key ip delete timeout instance set metadata metadata name register instance service name instance time unit seconds sleep list instance instance name get all instance service name assert assert equal instance size name deregister instance service name instance time unit seconds sleep instance name get all instance service name assert assert equal instance size 
rest a p i i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class rest a p i i t case extend name base local server port private int port before public void set up throw exception string url string format http localhost d port this base new url url prepare datum after public void cleanup throw exception remove datum test public void metric throw exception response entity string response request naco v1 n operator metric param new param do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert true json get service count as int assert assert true json get instance count as int assert assert true json get responsible service count as int assert assert true json get responsible instance count as int t c description service name test step expect result test public void create service throw exception string service name naming base random domain name response entity string response request naming base name controller path service param new param append param service name service name append param protect threshold 0.3 do string class http method post assert assert true response get status code is2xx successful assert assert equal ok response get body naming service delete service name t c description service name test step expect result test public void get service throw exception string service name naming base random domain name response entity string response request naming base name controller path service param new param append param service name service name append param protect threshold 0.3 do string class http method post assert assert true response get status code is2xx successful assert assert equal ok response get body get service response request naming base name controller path service param new param append param service name service name append param protect threshold 0.3 do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body assert assert equal service name json get name as text naming service delete service name t c description list test step expect result test public void list service throw exception string service name naming base random domain name get service response entity string response request naming base name controller path service list param new param append param service name service name append param page no append param page size do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body int count json get count as int assert assert true count response request naming base name controller path service param new param append param service name service name append param protect threshold 0.3 do string class http method post assert assert true response get status code is2xx successful assert assert equal ok response get body response request naming base name controller path service list param new param append param service name service name append param page no append param page size do string class assert assert true response get status code is2xx successful json jackson util to obj response get body assert assert equal count json get count as int naming service delete service name t c description service name test step expect result test public void update service throw exception string service name naming base random domain name response entity string response request naming base name controller path service param new param append param service name service name append param protect threshold 0.6 do string class http method post assert assert true response get status code is2xx successful assert assert equal ok response get body update service response request naming base name controller path service param new param append param service name service name append param health check mode server append param protect threshold 0.3 do string class http method put assert assert true response get status code is2xx successful assert assert equal ok response get body get service response request naming base name controller path service param new param append param service name service name do string class assert assert true response get status code is2xx successful json node json jackson util to obj response get body system out println json assert assert equal 0.3 f json get protect threshold float value 0.0 f naming service delete service name test ignore public void test invalid namespace string service name naming base random domain name response entity string response request naming base name controller path service param new param append param service name service name append param protect threshold 0.6 append param namespace id invalid namespace do string class http method post assert assert true response get status code is4xx client error response request naming base name controller path service param new param append param service name service name append param protect threshold 0.6 append param namespace id invalid namespace do string class http method post assert assert true response get status code is4xx client error private void naming service delete string service name delete service response entity string response request naming base name controller path service param new param append param service name service name append param protect threshold 0.3 do string class http method delete assert assert true response get status code is2xx successful assert assert equal ok response get body 
select instance i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class select instance i t case private naming service name local server port private int port before public void init throw exception naming base prepare server port if naming null time unit seconds sleep name name factory create naming service 127.0 0.1 port int i while i i if up equal name get server status thread sleep l continue break instance throw exception test public void select healthy instance throw exception string service name random domain name name register instance service name 127.0 0.1 test port name register instance service name 1.1 1.1 time unit seconds sleep list instance instance name select instance service name true assert assert equal instance size instance instance not h null list instance instance get name get all instance service name for instance instance instance get if instance be healthy instance not h instance instance get remove instance not h assert assert true verify instance list instance instance get instance throw exception test public void select unhealthy instance throw exception string service name random domain name name register instance service name 1.1 1.1 test port name register instance service name 1.1 1.2 test port time unit seconds sleep list instance instance name select instance service name false time unit seconds sleep assert assert equal instance size list instance instance get name get all instance service name assert assert true verify instance list instance instance get cluster instance throw exception test public void select healthy instance cluster throw exception string service name random domain name name register instance service name 127.0 0.1 test port c1 name register instance service name 127.0 0.2 c2 time unit seconds sleep list instance instance name select instance service name array as list c1 c2 true time unit seconds sleep assert assert equal instance size list instance instance get name get all instance service name assert assert true verify instance list instance instance get cluster instance throw exception test public void select unhealthy instance cluster throw exception string service name random domain name name register instance service name 1.1 1.1 test port c1 name register instance service name 1.1 1.2 test port c2 time unit seconds sleep list instance instance name select instance service name array as list c1 c2 false time unit seconds sleep assert assert equal instance size list instance instance get name get all instance service name assert assert true verify instance list instance instance get test public void select instance check cluster name throw exception string service name random domain name name register instance service name 1.1 1.1 test port c1 name register instance service name 1.1 1.2 test port c2 time unit seconds sleep list instance instance get name get all instance service name assert assert equal instance get size for instance instance instance get if instance get ip equal 1.1 1.1 assert assert equal instance get cluster name c1 if instance get ip equal 2.2 2.2 assert assert equal instance get cluster name c2 instance throw exception test public void select all weighted instance throw exception string service name random domain name name register instance service name 127.0 0.1 test port name register instance service name 1.1 1.1 time unit seconds sleep list instance instance name get all instance service name assert assert equal instance size instance name select instance service name true assert assert equal instance size instance get set weight instance name select instance service name true assert assert equal instance size instance instance not h null list instance instance get name get all instance service name for instance instance instance get if instance be healthy instance be enable instance get weight instance not h instance instance get remove instance not h assert assert true verify instance list instance instance get cluster instance throw exception test public void select all weighted instance cluster throw exception string service name random domain name name register instance service name 127.0 0.1 test port c1 name register instance service name 1.1 1.1 c2 time unit seconds sleep list instance instance name get all instance service name assert assert equal instance size instance name select instance service name array as list c1 c2 true assert assert equal instance size instance get set weight instance name select instance service name array as list c1 c2 true assert assert equal instance size instance instance not h null list instance instance get name get all instance service name for instance instance instance get if instance be healthy instance be enable instance get weight instance not h instance instance get remove instance not h assert assert true verify instance list instance instance get enable instance throw exception test public void select all enable instance throw exception string service name random domain name name register instance service name 127.0 0.1 test port name register instance service name 1.1 1.1 time unit seconds sleep list instance instance name get all instance service name assert assert equal instance size instance name select instance service name true assert assert equal instance size instance get set enable false instance name select instance service name true assert assert equal instance size instance instance not h null list instance instance get name get all instance service name for instance instance instance get if instance be healthy instance be enable instance get weight instance not h instance instance get remove instance not h assert assert true verify instance list instance instance get cluster enable instance throw exception test public void select all enable instance cluster throw exception string service name random domain name system out println service name name register instance service name 127.0 0.1 test port c1 name register instance service name 1.1 1.1 c2 time unit seconds sleep list instance instance name get all instance service name assert assert equal instance size instance name select instance service name array as list c1 c2 true assert assert equal instance size instance get set enable false instance name select instance service name array as list c1 c2 true time unit seconds sleep assert assert equal instance size instance instance not h null list instance instance get name get all instance service name for instance instance instance get if instance be healthy instance be enable instance get weight instance not h instance instance get remove instance not h assert assert true verify instance list instance instance get test public void get service list with selector throw naco exception interrupted exception string service name random domain name instance instance new instance instance set ip 128.0 0.1 instance set port instance set service name service name map string string metadata new hash map string string metadata put register source dubbo instance set metadata metadata name register instance service name instance name register instance service name 127.0 0.1 c1 naming register instance service name 127.0 0.2 c2 time unit seconds sleep expression selector expression selector new expression selector expression selector set expression instance label register source dubbo list view string service list name get service of server expression selector assert assert true service list get datum contain service name service name random domain name instance set service name service name metadata put register source spring instance set metadata metadata name register instance service name instance time unit seconds sleep expression selector set expression instance label register source spring service list name get service of server expression selector assert assert true service list get datum contain service name 
select one healthy instance i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class select one healthy instance i t case private naming service name local server port private int port before public void init throw exception naming base prepare server port if naming null time unit seconds sleep name name factory create naming service 127.0 0.1 port while true if up equal name get server status thread sleep l continue break instance throw exception test public void select one healthy instance throw exception string service name random domain name name register instance service name 127.0 0.1 test port name register instance service name 127.0 0.1 time unit seconds sleep instance instance name select one healthy instance service name list instance instance get name get all instance service name for instance instance1 instance get if instance1 get ip equal instance get ip instance1 get port instance get port assert assert true instance be healthy assert assert true verify instance instance1 instance return assert fail cluster instance throw exception test public void select one healthy instance cluster throw exception string service name random domain name name register instance service name 127.0 0.1 test port c1 name register instance service name 127.0 0.1 c1 naming register instance service name 1.1 1.1 test port c1 name register instance service name 127.0 0.1 c1 naming register instance service name 127.0 0.1 c2 time unit seconds sleep instance instance name select one healthy instance service name array as list c1 assert assert not same 1.1 1.1 instance get ip assert assert true instance get port list instance instance get name get all instance service name for instance instance1 instance get if instance1 get ip equal instance get ip instance1 get port instance get port assert assert true instance be healthy assert assert true verify instance instance1 instance return assert fail cluster instance throw exception test public void select one healthy instance cluster throw exception string service name random domain name name register instance service name 1.1 1.1 test port c1 name register instance service name 127.0 0.1 test port c1 name register instance service name 127.0 0.1 c1 naming register instance service name 127.0 0.1 c2 time unit seconds sleep instance instance name select one healthy instance service name array as list c1 c2 assert assert not same 1.1 1.1 instance get ip list instance instance get name get all instance service name for instance instance1 instance get if instance1 get ip equal instance get ip instance1 get port instance get port assert assert true instance be healthy assert assert true verify instance instance1 instance return assert fail 
service list test i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class service list test i t case private naming service name private volatile list instance instance collection empty list private static int listense count local server port private int port before public void init throw exception naming base prepare server port if naming null naming name factory create naming service 127.0 0.1 port while true if up equal name get server status thread sleep l continue break test public void service list throw naco exception name get service of server throw naco exception description test public void get subscribe service throw naco exception interrupted exception list view string list view name get service of server if list view null list view get count name get all instance list view get datum get list service info service info list name get subscribe service int count service info list size string service name random domain name name register instance service name 127.0 0.1 test port c1 naming subscribe service name new event listener override public void on event event event service info list name get subscribe service assert assert equal count service info list size throw naco exception description test public void get subscribe service deregister instance throw naco exception interrupt exception listense count event listener listener new event listener override public void on event event event system out println name event event get service name system out println name event event get instance listense count list service info service info list name get subscribe service int count service info list size string service name random domain name name register instance service name 127.0 0.1 test port c1 naming subscribe service name listener service info list name get subscribe service assert assert equal count service info list size name deregister instance service name 127.0 0.1 test port c1 assert assert equal count service info list size 
subscribe cluster i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class subscribe cluster i t case private naming service name local server port private int port before public void init throw exception naming base prepare server port instance clear if name null time unit seconds sleep name name factory create naming service 127.0 0.1 port while true if up equal name get server status thread sleep l continue break private volatile list instance instance collection empty list ip throw exception test public void subscribe add throw exception string service name random domain name naming subscribe service name array as list c1 new event listener override public void on event event event system out println name event event get service name system out println name event event get instance instance name event event get instance name register instance service name 127.0 0.1 test port c1 while instance be empty thread sleep l assert assert true verify instance list instance name get all instance service name ip throw exception test public void subscribe delete throw exception string service name random domain name name register instance service name 127.0 0.1 test port c1 name register instance service name 127.0 0.2 test port c1 time unit seconds sleep name subscribe service name array as list c1 new event listener int index override public void on event event event if index index return system out println name event event get service name system out println name event event get instance instance name event event get instance name deregister instance service name 127.0 0.1 test port c1 while instance be empty thread sleep l assert assert true verify instance list instance name get all instance service name ip throw exception test public void subscribe unhealthy throw exception string service name random domain name naming subscribe service name array as list c1 new event listener override public void on event event event system out println name event event get service name system out println name event event get instance instance name event event get instance name register instance service name 1.1 1.1 test port c1 while instance be empty thread sleep l assert assert true verify instance list instance name get all instance service name cluster ip throw exception test public void subscribe other cluster throw exception string service name random domain name naming subscribe service name array as list c2 new event listener int index override public void on event event event if index index return system out println name event event get service name system out println name event event get instance instance name event event get instance name register instance service name 1.1 1.1 test port c1 int i while instance be empty thread sleep l if i return assert fail 
subscribe i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class subscribe i t case extend rest a p i i t case private naming service name local server port private int port before public void init throw exception naming base prepare server port instance clear if name null time unit seconds sleep name name factory create naming service 127.0 0.1 port while true if up equal name get server status thread sleep l continue break private volatile list instance instance collection empty list ip throw exception test public void subscribe add throw exception string service name random domain name naming subscribe service name new event listener override public void on event event event system out println name event event get service name system out println name event event get instance instance name event event get instance name register instance service name 127.0 0.1 test port c1 while instance be empty thread sleep l assert assert true verify instance list instance name get all instance service name ip throw exception test public void subscribe delete throw exception string service name random domain name name register instance service name 127.0 0.1 test port c1 name register instance service name 127.0 0.2 test port c1 time unit seconds sleep name subscribe service name new event listener int index override public void on event event event if index index return system out println name event event get service name system out println name event event get instance instance name event event get instance name deregister instance service name 127.0 0.1 test port c1 while instance be empty thread sleep l assert assert true verify instance list instance name get all instance service name ip throw exception test public void subscribe unhealthy throw exception string service name random domain name naming subscribe service name new event listener override public void on event event event system out println name event event get service name system out println name event event get instance instance name event event get instance name register instance service name 1.1 1.1 test port c1 while instance be empty thread sleep l assert assert true verify instance list instance name get all instance service name test timeout time out public void subscribe empty throw exception string service name random domain name naming subscribe service name new event listener override public void on event event event system out println name event event get service name system out println name event event get instance instance name event event get instance name register instance service name 1.1 1.1 test port c1 while instance be empty thread sleep l assert assert true verify instance list instance name get all instance service name name deregister instance service name 1.1 1.1 test port c1 while instance be empty thread sleep l assert assert equal instance size assert assert equal name get all instance service name size test public void query subscriber throw exception string service name random domain name name register instance service name 1.1 1.1 test port c1 event listener listener new event listener override public void on event event event system out println name event event get service name system out println name event event get instance instance name event event get instance name subscribe service name listener time unit seconds sleep response entity string response request naming base name controller path service subscriber param new param append param service name service name append param page no append param page size do string class http method get assert assert true response get status code is2xx successful json node body jackson util to obj response get body assert assert equal body get subscriber size naming service naming2 name factory create naming service 127.0 0.1 port naming2 subscribe service name new event listener override public void on event event event system out println name event event get service name system out println name event event get instance instance name event event get instance time unit seconds sleep response request naming base name controller path service subscriber param new param append param service name service name append param page no append param page size do string class http method get assert assert true response get status code is2xx successful body jackson util to obj response get body assert assert equal body get subscriber size 
unsubscribe i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class unsubscribe i t case private naming service name local server port private int port before public void init throw exception naming base prepare server port instance collection empty list if naming null time unit seconds sleep name name factory create naming service 127.0 0.1 port while true if up equal name get server status thread sleep l continue break private volatile list instance instance collection empty list ip throw exception test public void unsubscribe throw exception string service name random domain name event listener listener new event listener override public void on event event event system out println name event event get service name system out println name event event get instance instance name event event get instance name subscribe service name listener name register instance service name 127.0 0.1 test port c1 while instance be empty thread sleep l assert assert true verify instance list instance name get all instance service name name unsubscribe service name listener instance collection empty list name register instance service name 127.0 0.2 test port c1 int i while instance be empty thread sleep l if i return assert fail cluster ip throw exception test public void unsubscribe cluster throw exception string service name random domain name event listener listener new event listener override public void on event event event system out println name event event get service name system out println name event event get instance instance name event event get instance name subscribe service name array as list c1 listener name register instance service name 127.0 0.1 test port c1 while instance be empty thread sleep l assert assert true verify instance list instance name get all instance service name name unsubscribe service name array as list c1 listener instance collection empty list name register instance service name 127.0 0.2 test port c1 int i while instance be empty thread sleep l if i return assert fail 
sentinel apache http client test run with spring runner class spring boot test class test application class web environment spring boot test web environment define port property server port public class sentinel apache http client test value server port private integer port test public void test sentinel ok http interceptor0 throw exception closeable http client httpclient new sentinel apache http client builder build http get http get new http get http localhost port httpclient back system out println get remote string httpclient http get cluster node cn cluster builder slot get cluster node httpclient httpclient back assert not null cn constant root remove child list cluster builder slot get cluster node map clear test public void test sentinel ok http interceptor1 throw exception sentinel apache http client config config new sentinel apache http client config config set extractor new apache http client resource extractor override public string extractor http request wrapper request string contain httpclient back string uri request get request line get uri if uri start with contain uri uri substr uri index of contain contain length id return request get method uri closeable http client httpclient new sentinel apache http client builder config build http get http get new http get http localhost port httpclient back system out println get remote string httpclient http get cluster node cn cluster builder slot get cluster node httpclient get httpclient back id assert not null cn constant root remove child list cluster builder slot get cluster node map clear private string get remote string closeable http client httpclient http get http get throw i o exception string result http context context new basic http context closeable http response response response httpclient execute http get context try http entity entity response get entity result entity util to string entity utf entity util consume entity finally response close httpclient close return result 
sentinel ok http interceptor test run with spring runner class spring boot test class test application class web environment spring boot test web environment define port property server port public class sentinel ok http interceptor test value server port private integer port test public void test sentinel ok http interceptor0 throw exception string url0 http localhost port okhttp back sentinel ok http config set prefix okhttp ok http client client new ok http client builder add interceptor new sentinel ok http interceptor build request request new request builder url url0 build system out println client new call request execute body string cluster node cn cluster builder slot get cluster node sentinel ok http config get prefix get url0 assert not null cn constant root remove child list cluster builder slot get cluster node map clear test public void test sentinel ok http interceptor1 throw exception string url0 http localhost port okhttp back sentinel ok http config set extractor new ok http resource extractor override public string extract string url request request connection connection string regex okhttp back if url contain regex url url substr url index of regex regex length id return request method url ok http client client new ok http client builder add interceptor new sentinel ok http interceptor build request request new request builder url url0 build system out println client new call request execute body string string url1 sentinel ok http config get prefix get http localhost port okhttp back id cluster node cn cluster builder slot get cluster node url1 assert not null cn constant root remove child list cluster builder slot get cluster node map clear 
sentinel web flux integration test run with spring runner class spring boot test class web flux test application class web environment web environment random port public class sentinel web flux integration test private static final string hello str hello private static final string block msg prefix block by sentinel autowire private web test client web client private void configure rule for string resource int count configure rule for resource count default private void configure rule for string resource int count string limit app flow rule rule new flow rule set count count set grade rule constant flow grade qp rule set resource resource if string util be not blank limit app rule set limit app limit app flow rule manager load rule collection singleton list rule test public void test web flux filter basic throw exception string url hello this web client get uri url accept media type text plain exchange expect status be ok expect body string class be equal to hello str cluster node cn cluster builder slot get cluster node url assert not null cn assert equal cn pass qp 0.01 test public void test customize url cleaner throw exception final string foo prefix foo string url1 foo prefix string url2 foo prefix web flux callback manager set url cleaner exchange origin url if origin url start with foo prefix return foo return origin url this web client get uri url1 exchange expect status be ok expect body string class be equal to hello this web client get uri url2 exchange expect status be ok expect body string class be equal to hello cluster node cn cluster builder slot get cluster node foo prefix assert equal cn pass qp 0.01 assert null cluster builder slot get cluster node url1 assert null cluster builder slot get cluster node url2 web flux callback manager reset url cleaner test public void test customize ignore url cleaner throw exception final string foo prefix foo string url1 foo prefix web flux callback manager set url cleaner exchange origin url if origin url start with foo prefix return return origin url this web client get uri url1 exchange expect status be ok expect body string class be equal to hello assert null cluster builder slot get cluster node url1 web flux callback manager reset url cleaner test public void test customize block request handler throw exception string url error string prefix block web flux callback manager set block handler exchange t server response ok content type media type text plain sync body prefix t get message this web client get uri url exchange expect status be ok expect body string class value string contain contain string prefix web flux callback manager reset block handler test public void test customize request origin parser throw exception string url hello string limit origin user a final string header name s user configure rule for url limit origin web flux callback manager set request origin parser exchange string origin exchange get request get header get first header name return origin null origin this web client get uri url accept media type text plain header header name user b exchange expect status be ok expect body string class be equal to hello str this will be block this web client get uri url accept media type text plain header header name limit origin exchange expect status be equal to http status too many request expect body string class value string contain contain string block msg prefix this web client get uri url accept media type text plain exchange expect status be ok expect body string class be equal to hello str web flux callback manager reset request origin parser before public void set up flow rule manager load rule new array list cluster builder slot reset cluster node after public void clean up flow rule manager load rule new array list cluster builder slot reset cluster node 
sentinel spring mvc integration test run with spring runner class spring boot test class test application class auto configure mock mvc public class sentinel spring mvc integration test private static final string hello str hello autowired private mock mvc mvc test public void test base throw exception string url hello this mvc perform get url and expect status be ok and expect content string hello str cluster node cn cluster builder slot get cluster node url assert not null cn assert equal cn pass qp 0.01 test public void test origin parser throw exception string spring mvc path variable url foo id string limit origin user a final string header name s user configure rule for spring mvc path variable url limit origin this will be pass since the caller be different user b this mvc perform get foo accept media type text plain header header name user b and expect status be ok and expect content string foo this will be block since the caller be same user a this mvc perform get foo accept media type application json header header name limit origin and expect status be ok and expect content json result wrapper block to json string this will be pass since the caller be different this mvc perform get foo accept media type application json and expect status be ok and expect content string foo flow rule manager load rule null test public void test total interceptor throw exception string url hello string total target my spring mvc total url request for int i i i this mvc perform get url and expect status be ok and expect content string hello str cluster node cn cluster builder slot get cluster node total target assert not null cn assert equal cn pass qp 0.01 test public void test runtime exception throw exception string url runtime exception configure exception rule for url null int repeat for int i i repeat i this mvc perform get url and expect status be ok and expect content string result wrapper error to json string cluster node cn cluster builder slot get cluster node url assert not null cn assert equal i cn pass qps 0.01 this will be block and response json this mvc perform get url and expect status be ok and expect content string result wrapper block to json string cluster node cn cluster builder slot get cluster node url assert not null cn assert equal repeat cn pass qp 0.01 assert equal cn block request private void configure rule for string resource int count string limit app flow rule rule new flow rule set count count set grade rule constant flow grade qp rule set resource resource if string util be not blank limit app rule set limit app limit app flow rule manager load rule collection singleton list rule private void configure exception rule for string resource int count string limit app flow rule rule new flow rule set count count set grade rule constant degrade grade exception ratio rule set resource resource if string util be not blank limit app rule set limit app limit app flow rule manager load rule collection singleton list rule after public void clean up flow rule manager load rule null cluster builder slot reset cluster node 
common filter test run with spring runner class spring boot test class test application class auto configure mock mvc public class common filter test private static final string hello str hello autowired private mock mvc mvc private void configure rule for string resource int count configure rule for resource count default private void configure rule for string resource int count string limit app flow rule rule new flow rule set count count set grade rule constant flow grade qp rule set resource resource if string util be not blank limit app rule set limit app limit app flow rule manager load rule collection singleton list rule test public void test common filter miscellaneous throw exception constant root remove child list string url hello this mvc perform get url and expect status be ok and expect content string hello str cluster node cn cluster builder slot get cluster node url assert not null cn assert equal cn pass qp 0.01 string context for node n constant root get child list if n instanceof entrance node string id entrance node n get id get name if url equal id context entrance node n get id get name assert equal context test common block and redirect block page url cn test for url cleaner test url cleaner test url exclusion test custom origin parser private void test common block and redirect block page string url cluster node cn throw exception configure rule for url the request will be block and response be default block message web servlet config set block page http status http status ok value this mvc perform get url accept media type text plain and expect status be ok and expect content string filter util default block msg assert equal cn block qp 0.01 web servlet config set block page http status http status too many request value this mvc perform get url accept media type text plain and expect status be too many request and expect content string filter util default block msg test for redirect string redirect url http some location com web servlet config set block page redirect url this mvc perform get url accept media type text plain and expect status is3xx redirection and expect header string location redirect url http referer http localhost hello flow rule manager load rule null web servlet config set block page private void test url cleaner throw exception final string foo prefix foo string url1 foo prefix string url2 foo prefix web callback manager set url cleaner new url cleaner override public string clean string origin url if origin url start with foo prefix return foo return origin url this mvc perform get url1 accept media type text plain and expect status be ok and expect content string hello this mvc perform get url2 accept media type text plain and expect status be ok and expect content string hello cluster node cn cluster builder slot get cluster node foo prefix assert equal cn pass qp 0.01 assert null cluster builder slot get cluster node url1 assert null cluster builder slot get cluster node url2 web callback manager set url cleaner new default url cleaner private void test url exclusion throw exception final string exclude prefix exclude string url exclude prefix web callback manager set url cleaner new url cleaner override public string clean string origin url if origin url start with exclude prefix return return origin url this mvc perform get url accept media type text plain and expect status be ok and expect content string exclude assert null cluster builder slot get cluster node url web callback manager set url cleaner new default url cleaner private void test custom origin parser throw exception string url hello string limit origin user a final string header name s user configure rule for url limit origin web callback manager set request origin parser new request origin parser override public string parse origin http servlet request request string origin request get header header name return origin null origin this mvc perform get url accept media type text plain header header name user b and expect status be ok and expect content string hello str this will be block this mvc perform get url accept media type text plain header header name limit origin and expect status be too many request and expect content string filter util default block msg this mvc perform get url accept media type text plain and expect status be ok and expect content string hello str web callback manager set request origin parser null flow rule manager load rule null after public void clean up flow rule manager load rule null cluster builder slot reset cluster node 
common filter context test run with spring runner class spring boot test class test context application class web environment spring boot test web environment random port auto configure mock mvc public class common filter context test private static final string hello str hello autowired private mock mvc mvc private void configure rule for string resource int count configure rule for resource count default private void configure rule for string resource int count string limit app flow rule rule new flow rule set count count set grade rule constant flow grade qp rule set resource resource if string util be not blank limit app rule set limit app limit app flow rule manager load rule collection singleton list rule test public void test common filter miscellaneous throw exception string url hello this mvc perform get url and expect status be ok and expect content string hello str cluster node cn cluster builder slot get cluster node url assert not null cn assert equal cn pass qp 0.01 string context for node n constant root get child list if n instanceof entrance node string id entrance node n get id get name if url equal id context entrance node n get id get name assert equal url context after public void clean up flow rule manager load rule null cluster builder slot reset cluster node 
common filter method test run with spring runner class spring boot test class test application class web environment spring boot test web environment random port auto configure mock mvc public class common filter method test private static final string hello str hello private static final string hello post str hello post private static final string get get private static final string post post private static final string colon autowire private mock mvc mvc private void configure rule for string resource int count configure rule for resource count default private void configure rule for string resource int count string limit app flow rule rule new flow rule set count count set grade rule constant flow grade qp rule set resource resource if string util be not blank limit app rule set limit app limit app flow rule manager load rule collection singleton list rule test public void test common filter miscellaneous throw exception string url hello this mvc perform get url and expect status be ok and expect content string hello str cluster node cn get cluster builder slot get cluster node get colon url assert not null cn get assert equal cn get pass qp 0.01 cluster node cn post cluster builder slot get cluster node post colon url assert null cn post this mvc perform post url and expect status be ok and expect content string hello post str cn post cluster builder slot get cluster node post colon url assert not null cn post assert equal cn post pass qp 0.01 test common block and redirect block page url cn get cn post private void test common block and redirect block page string url cluster node cn get cluster node cn post throw exception configure rule for get url the request will be block and response be default block message this mvc perform get url accept media type text plain and expect status be too many request and expect content string filter util default block msg assert equal cn get block qps 0.01 test for post pass this mvc perform post url and expect status be ok and expect content string hello post str assert equal cn post pass qp 0.01 flow rule manager load rule null web servlet config set block page after public void clean up flow rule manager load rule null cluster builder slot reset cluster node 
eureka datum source test run with spring runner class enable eureka server spring boot test web environment spring boot test web environment define port public class eureka datum source test private static final string sentinel key sentinel rule value server port private int port value eureka instance appname private string appname value eureka instance instance id private string instance id test public void test eureka datum source throw exception string url http localhost port eureka eureka datum source list flow rule eureka datum source new eureka datum source appname instance id array as list url sentinel key new converter string list flow rule override public list flow rule convert string source return json parse object source new type reference list flow rule flow rule manager register2 property eureka datum source get property await timeout time unit seconds until new callable boolean override public boolean call throw exception return flow rule manager get rule size assert assert true flow rule manager get rule size 
sentinel rule locator test run with spring runner class spring boot test class datum source bootstrap configuration class property spring application name sentinel public class sentinel rule locator test autowire private sentinel rule locator sentinel rule source locator autowire private environment environment test public void test auto load assert assert true sentinel rule source locator null assert assert true environment null before run this test case please start the config server link config server public void test locate config client property config client property new config client property environment config client property set label master config client property set profile dev config client property set uri new string http localhost sentinel rule locator sentinel rule source locator new sentinel rule locator config client property environment sentinel rule source locator locate environment assert assert true string util be not blank sentinel rule storage retrieve rule flow rule 
