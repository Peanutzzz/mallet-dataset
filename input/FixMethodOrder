notify center test fix method order value method sorter name ascend public class notify center test private static class test slow event extend slow event private static class test event extend event override public long sequence return system current time millis static system set property naco core notify share buffer size test public void test event can be subscribe throw exception notify center register to share publisher test slow event class notify center register to publisher test event class final count down latch latch new count down latch final atomic integer count new atomic integer notify center register subscriber new subscriber test slow event override public void on event test slow event event try count increment and get finally latch count down override public class extend event subscribe type return test slow event class notify center register subscriber new subscriber test event override public void on event test event event try count increment and get finally latch count down override public class extend event subscribe type return test event class assert assert true notify center publish event new test event assert assert true notify center publish event new test slow event thread util sleep l latch await l time unit millisecond assert assert equal count get static count down latch latch new count down latch static class expire event extend event static atomic long sequence new atomic long private long no sequence get and decrement override public long sequence latch count down return no test public void test can ignore expire event throw exception notify center register to publisher expire event class final atomic integer count new atomic integer notify center register subscriber new subscriber expire event override public void on event expire event event count increment and get override public class extend event subscribe type return expire event class public boolean ignore expire event return true for int i i i assert assert true notify center publish event new expire event latch await l time unit millisecond assert assert equal count get static count down latch latch2 new count down latch static class no expire event extend event static atomic long sequence new atomic long private long no sequence get and decrement override public long sequence return no test public void test no ignore expire event throw exception notify center register to publisher no expire event class final atomic integer count new atomic integer notify center register subscriber new subscriber override public void on event event event count increment and get latch2 count down override public class extend event subscribe type return no expire event class for int i i i assert assert true notify center publish event new no expire event latch2 await l time unit millisecond assert assert equal count get private static class slow e1 extend slow event private string info slow e1 public string get info return info public void set info string info this info info private static class slow e2 extend slow event private string info slow e2 public string get info return info public void set info string info this info info test public void test share publish two slow event throw exception notify center register to share publisher slow e1 class notify center register to share publisher slow e2 class final count down latch latch1 new count down latch final count down latch latch2 new count down latch final string value new string null null notify center register subscriber new subscriber slow e1 override public void on event slow e1 event thread util sleep l value event info latch1 count down override public class extend event subscribe type return slow e1 class notify center register subscriber new subscriber slow e2 override public void on event slow e2 event value event info latch2 count down override public class extend event subscribe type return slow e2 class for int i i i notify center publish event new slow e1 notify center publish event new slow e2 latch1 await latch2 await assert assert equal slow e1 value assert assert equal slow e2 value static class smart event1 extend event override public long sequence return system current time millis static class smart event2 extend event override public long sequence return system current time millis test public void test several event publish by single publisher throw exception final atomic integer count1 new atomic integer final atomic integer count2 new atomic integer final count down latch latch1 new count down latch final count down latch latch2 new count down latch notify center register to publisher smart event1 class notify center register to publisher smart event2 class notify center register subscriber new smart subscriber override public list class extend event subscribe type list class extend event list new array list class extend event list add smart event1 class list add smart event2 class return list override public void on event event event if event instanceof smart event1 count1 increment and get latch1 count down if event instanceof smart event2 count2 increment and get latch2 count down for int i i i assert assert true notify center publish event new smart event1 assert assert true notify center publish event new smart event2 latch1 await l time unit millisecond latch2 await l time unit millisecond assert assert equal count1 get assert assert equal count2 get private static class test slow event1 extend slow event private static class test slow event2 extend slow event test public void test mutiple slow event listen by subscriber throw exception notify center register to share publisher test slow event1 class notify center register to share publisher test slow event2 class final atomic integer count1 new atomic integer final atomic integer count2 new atomic integer final count down latch latch1 new count down latch final count down latch latch2 new count down latch notify center register subscriber new subscriber test slow event1 override public void on event test slow event1 event count1 increment and get latch1 count down override public class extend event subscribe type return test slow event1 class notify center register subscriber new subscriber test slow event2 override public void on event test slow event2 event count2 increment and get latch2 count down override public class extend event subscribe type return test slow event2 class for int i i i assert assert true notify center publish event new test slow event1 assert assert true notify center publish event new test slow event2 thread util sleep l latch1 await l time unit millisecond latch2 await l time unit millisecond assert assert equal count1 get assert assert equal count2 get private static class test slow event3 extend slow event private static class test slow event4 extend slow event test public void test mutiple slow event listen by smartsubscriber throw exception notify center register to share publisher test slow event3 class notify center register to share publisher test slow event4 class final atomic integer count1 new atomic integer final atomic integer count2 new atomic integer final count down latch latch1 new count down latch final count down latch latch2 new count down latch notify center register subscriber new smart subscriber override public void on event event event if event instanceof test slow event3 count1 increment and get latch1 count down if event instanceof test slow event4 count2 increment and get latch2 count down override public list class extend event subscribe type list class extend event sub type new array list class extend event sub type add test slow event3 class sub type add test slow event4 class return sub type for int i i i assert assert true notify center publish event new test slow event3 assert assert true notify center publish event new test slow event4 thread util sleep l latch1 await l time unit millisecond latch2 await l time unit millisecond assert assert equal count1 get assert assert equal count2 get private static class test slow event5 extend slow event private static class test event6 extend event test public void test mutiple kind event can listen by smartsubscriber throw exception notify center register to share publisher test slow event5 class notify center register to publisher test event6 class final atomic integer count1 new atomic integer final atomic integer count2 new atomic integer final count down latch latch1 new count down latch final count down latch latch2 new count down latch notify center register subscriber new smart subscriber override public void on event event event if event instanceof test slow event5 count1 increment and get latch1 count down if event instanceof test event6 count2 increment and get latch2 count down override public list class extend event subscribe type list class extend event sub type new array list class extend event sub type add test slow event5 class sub type add test event6 class return sub type for int i i i assert assert true notify center publish event new test slow event5 assert assert true notify center publish event new test event6 thread util sleep l latch1 await l time unit millisecond latch2 await l time unit millisecond assert assert equal count1 get assert assert equal count2 get private static class test event7 extend event test public void test publish event by no subscriber for int i i i assert assert false notify center publish event new test event7 
naco async rest template i t case suppress warning all fix method order method sorter jvm run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port public class naco async rest template i t case local server port private int port private naco async rest template naco rest template http client bean holder get naco async rest template logger factory get logger naco async rest template i t case class private final string config instance path naco v1 n private string ip null before public void init throw naco exception ip string format http localhost d port private class callback map t implement callback t private http rest result t rest result private throwable throwable override public void on receive rest result t result rest result http rest result t result override public void on error throwable throwable throwable throwable public http rest result t get rest result return rest result public throwable get throwable return throwable test public void test url post form throw exception string url ip config instance path instance map string string param new hash map param put service name app test param put port param put ip 11.11 11.11 callback map string callback map new callback map naco rest template post form url header new instance query new instance param string class callback map thread sleep http rest result string rest result callback map get rest result system out println rest result get datum system out println rest result get header assert assert true rest result ok test public void test url put form throw exception string url ip config instance path instance map string string param new hash map param put service name app test change param put port param put ip 11.11 11.11 callback map string callback map new callback map naco rest template post form url header new instance query new instance param string class callback map thread sleep http rest result string rest result callback map get rest result system out println rest result get datum system out println rest result get header assert assert true rest result ok test public void test url get throw exception string url ip config instance path instance list query query query new instance add param service name app test callback map map callback map new callback map naco rest template get url header new instance query map class callback map thread sleep http rest result map rest result callback map get rest result system out println rest result get datum system out println rest result get header assert assert true rest result ok assert assert equal rest result get datum get dom app test test public void test url by map throw exception string url ip config instance path instance list map string string param new hash map param put service name app test callback map map callback map new callback map naco rest template get url header new instance param map class callback map thread sleep http rest result map rest result callback map get rest result system out println rest result get datum system out println rest result get header assert assert true rest result ok assert assert equal rest result get datum get dom app test test public void test url delete throw exception string url ip config instance path instance query query query new instance add param ip 11.11 11.11 add param port add param service name app test callback map string callback map new callback map naco rest template delete url header new instance query string class callback map thread sleep http rest result string rest result callback map get rest result system out println rest result get datum system out println rest result get header assert assert true rest result ok 
naco rest template interceptor i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port fix method order method sorter jvm public class naco rest template interceptor i t case local server port private int port private naco rest template naco rest template http client bean holder get naco rest template logger factory get logger naco rest template interceptor i t case class private final string config path naco v1 c private string ip null private class termination interceptor implement http client request interceptor override public http client response intercept return new http client response override public header get header return header empty override public input stream get body throw i o exception return new byte array input stream stop request get byte override public int get status code return naco exception server error override public string get status text return null override public void close throw i o exception override public boolean be intercept uri uri string http method request http entity request http entity return true before public void init throw naco exception naco rest template set interceptor array as list new termination interceptor ip string format http localhost d port test public void test url post config throw exception string url ip config path config map string string param new hash map param put datum id test param put group default group param put content aaa b http rest result string rest result naco rest template post form url header new instance query empty param string class assert assert equal rest result get code assert assert equal stop request rest result get datum system out println rest result get datum system out println rest result get header 
naco rest template i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port fix method order method sorter jvm public class naco rest template i t case local server port private int port private naco rest template naco rest template http client bean holder get naco rest template logger factory get logger naco rest template i t case class private final string instance path naco v1 n private final string config path naco v1 c private string ip null before public void init throw naco exception ip string format http localhost d port test public void test url post config throw exception string url ip config path config map string string param new hash map param put datum id test param put group default group param put content aaa b http rest result string rest result naco rest template post form url header new instance query empty param string class assert assert true rest result ok system out println rest result get datum system out println rest result get header test public void test url get return rest result throw exception string url ip config path config query query query new instance add param beta true add param datum id test add param group default group http rest result config info4 beta rest result naco rest template get url header new instance query new type reference rest result config info4 beta get type assert assert true rest result ok system out println rest result get datum system out println rest result get header test public void test url post form throw exception string url ip instance path instance map string string param new hash map param put service name app test param put port param put ip 11.11 11.11 http rest result string rest result naco rest template post form url header new instance query new instance param string class assert assert true rest result ok system out println rest result get datum test public void test url put from throw exception string url ip instance path instance map string string param new hash map param put service name app test change param put port param put ip 11.11 11.11 http rest result string rest result naco rest template put form url header new instance query new instance param string class assert assert true rest result ok system out println rest result get datum test public void test url get throw exception string url ip instance path instance list query query query new instance add param service name app test http rest result map rest result naco rest template get url header new instance query map class assert assert true rest result ok assert assert equal rest result get datum get dom app test system out println rest result get datum test public void test url get by map throw exception string url ip instance path instance list map string string param new hash map param put service name app test http rest result map rest result naco rest template get url header new instance param map class assert assert true rest result ok assert assert equal rest result get datum get dom app test system out println rest result get datum test public void test url delete throw exception string url ip instance path instance query query query new instance add param ip 11.11 11.11 add param port add param service name app test http rest result string rest result naco rest template delete url header new instance query string class assert assert true rest result ok system out println rest result 
config derby raft d i t case suppress warning all ignore fix method order value method sorter name ascend public class config derby raft d i t case extend base cluster test test public void test a publish config throw exception boolean result iconfig7 publish config raft test cluster test this be raft cluster lessspring assert assert true result thread util sleep configurable application context context7 application get configurable application context context8 application get configurable application context context9 application get persist service operate7 context7 get bean embed storage persist service impl class persist service operate8 context8 get bean embed storage persist service impl class persist service operate9 context9 get bean embed storage persist service impl class string s7 operate7 find config info raft test cluster test get content string s8 operate8 find config info raft test cluster test get content string s9 operate9 find config info raft test cluster test get content assert assert array equal the three node must have consistent datum new string s7 s8 s9 new string this be raft cluster lessspr this be raft cluster lessspr this be raft cluster lessspr test public void test b publish config throw exception thread util sleep boolean result iconfig8 publish config raft test cluster test this be raft cluster lessspring assert assert true result thread util sleep configurable application context context7 application get configurable application context context8 application get configurable application context context9 application get persist service operate7 context7 get bean embed storage persist service impl class persist service operate8 context8 get bean embed storage persist service impl class persist service operate9 context9 get bean embed storage persist service impl class string s7 operate7 find config info raft test cluster test get content string s8 operate8 find config info raft test cluster test get content string s9 operate9 find config info raft test cluster test get content assert assert array equal the three node must have consistent datum new string s7 s8 s9 new string this be raft cluster lessspr this be raft cluster lessspr this be raft cluster lessspr test public void test c publish config throw exception thread util sleep boolean result iconfig9 publish config raft test cluster test this be raft cluster lessspring assert assert true result thread util sleep configurable application context context7 application get configurable application context context8 application get configurable application context context9 application get persist service operate7 context7 get bean embed storage persist service impl class persist service operate8 context8 get bean embed storage persist service impl class persist service operate9 context9 get bean embed storage persist service impl class string s7 operate7 find config info raft test cluster test get content string s8 operate8 find config info raft test cluster test get content string s9 operate9 find config info raft test cluster test get content assert assert array equal the three node must have consistent datum new string s7 s8 s9 new string this be raft cluster lessspr this be raft cluster lessspr this be raft cluster lessspr test public void test d modify config throw exception boolean result iconfig7 publish config raft test cluster test this be raft cluster lessspr it be for modify assert assert true result thread util sleep configurable application context context7 application get configurable application context context8 application get configurable application context context9 application get persist service operate7 context7 get bean embed storage persist service impl class persist service operate8 context8 get bean embed storage persist service impl class persist service operate9 context9 get bean embed storage persist service impl class string s7 operate7 find config info raft test cluster test get content string s8 operate8 find config info raft test cluster test get content string s9 operate9 find config info raft test cluster test get content assert assert array equal the three node must have consistent datum new string s7 s8 s9 new string this be raft cluster lessspr it be for modify this be raft cluster lessspr it be for modify this be raft cluster lessspr it be for modify test public void test l client operation throw exception final string datum id test l client operation final string group id test l client operation string content test l client operation system current time millis publish by boolean result iconfig7 publish config datum id group id content assert assert true result thread util sleep string v1 iconfig7 get config datum id group id l string v1 iconfig8 get config datum id group id l string v1 iconfig9 get config datum id group id l assert assert equal content v1 assert assert equal content v1 assert assert equal content v1 publish by content test l client operation system current time millis result iconfig8 publish config datum id group id content assert assert true result thread util sleep string v2 iconfig7 get config datum id group id l string v2 iconfig8 get config datum id group id l string v2 iconfig9 get config datum id group id l assert assert equal content v2 assert assert equal content v2 assert assert equal content v2 publish by content test l client operation system current time millis result iconfig9 publish config datum id group id content assert assert true result thread util sleep string v3 iconfig7 get config datum id group id l string v3 iconfig8 get config datum id group id l string v3 iconfig9 get config datum id group id l assert assert equal content v3 assert assert equal content v3 assert assert equal content v3 delete by result iconfig9 remove config datum id group id assert assert true result thread util sleep string v4 iconfig7 get config datum id group id l string v4 iconfig8 get config datum id group id l string v4 iconfig9 get config datum id group id l assert assert null v4 assert assert null v4 assert assert null v4 test public void test k config listener throw exception string datum id test h config listener string group test h config listener string content test h config listener count down latch latch new count down latch new count down latch new count down latch atomic reference string be new atomic reference atomic integer i new atomic integer iconfig7 add listener datum id group new abstract listener override public void receive config info string config info system out println config info r set config info latch i get and increment count down iconfig7 publish config datum id group content thread util sleep l latch await l time unit millisecond assert assert equal content r get assert assert equal content iconfig7 get config datum id group l content content system current time millis iconfig7 publish config datum id group content thread util sleep l latch await l time unit millisecond assert assert equal content r get assert assert equal content iconfig7 get config datum id group l test public void test e derby op throw exception string url http 127.0 0.1 naco v1 c op derby query query query new instance add param sql select from user rest result list map string object result http client get url header empty query new generic type rest result list map string object get type system out println result get datum assert assert true result ok list map string object list result get datum assert assert equal list size assert assert equal naco list get get username test public void test g derby op no select throw exception string url http 127.0 0.1 naco v1 c op derby query query query new instance add param sql update user set username naco rest result object result http client get url header empty query new generic type rest result object get type system out println result assert assert false result ok assert assert equal only query statement be allow to be execute result get message test public void test h derby have error throw exception thread util sleep boolean result iconfig7 publish config raft test raft error cluster test this be raft cluster lessspring assert assert true result notify center register to publisher raft db error recover event class count down latch latch1 new count down latch notify center register subscriber new subscriber raft db error event override public void on event raft db error event event latch1 count down override public class extend event subscribe type return raft db error event class notify center publish event new raft db error event latch1 await l time unit millisecond result iconfig7 publish config raft test raft error cluster test this be raft cluster lessspring assert assert false result count down latch latch2 new count down latch notify center register subscriber new subscriber raft db error recover event override public void on event raft db error recover event event latch2 count down override public class extend event subscribe type return raft db error recover event class notify center publish event new raft db error recover event latch2 await l time unit millisecond result iconfig7 publish config raft test raft error cluster test this be raft cluster lessspring assert assert true result test public void test f id generator leader transfer throw exception configurable application context context7 application get configurable application context context8 application get configurable application context context9 application get id generator manager manager7 context7 get bean id generator manager class id generator manager manager8 context8 get bean id generator manager class id generator manager manager9 context9 get bean id generator manager class c p protocol protocol7 context7 get bean c p protocol class c p protocol protocol8 context8 get bean c p protocol class c p protocol protocol9 context9 get bean c p protocol class final string config group com alibaba naco config server constant constant config model raft group long pre id 1 l long current id 1 l if protocol7 be leader config group pre id manager7 next id config info id if protocol8 be leader config group pre id manager8 next id config info id if protocol9 be leader config group pre id manager9 next id config info id transfer leader to ip map string string transfer new hash map transfer put j raft constant transfer leader inet util get self ip rest result string result protocol7 execute transfer system out println result assert assert true result ok time unit seconds sleep assert assert true protocol7 be leader config group current id manager7 next id config info id assert assert not equal pre id current id pre id current id transfer leader to ip transfer new hash map transfer put j raft constant transfer leader inet util get self ip result protocol8 execute transfer system out println result assert assert true result ok time unit seconds sleep assert assert true protocol8 be leader config group current id manager8 next id config info id assert assert not equal pre id current id pre id current id transfer leader to ip transfer new hash map transfer put j raft constant transfer leader inet util get self ip result protocol9 execute transfer system out println result assert assert true result ok time unit seconds sleep assert assert true protocol9 be leader config group current id manager9 next id config info id assert assert not equal pre id current id 
member lookup i t case fix method order value method sorter name ascend public class member lookup i t case extend base test static final string path path get system get property user home member look to string static final string name cluster conf server member manager member manager before public void before throw exception system set property naco home path application util inject environment new standard environment application util set be standalone false system out println application util get standalone mode system out println array to string lookup factory lookup type value disk util force mkdir path disk util force mkdir path get path conf to string file file path get path conf name to file disk util touch file string ip inet util get self ip disk util write file file ip ip ip get byte standard charset utf false try member manager new server member manager new mock servlet context catch exception e e print stack trace after public void after throw exception try member manager shutdown catch throwable ex ex print stack trace disk util delete directory path test public void test a lookup file config throw exception try lookup factory create look up member manager catch throwable ignore member lookup lookup lookup factory get look up system out println lookup assert assert true lookup instanceof file config member lookup func lookup test public void test b lookup standalone throw exception application util set be standalone true try lookup factory create look up member manager catch throwable ignore finally application util set be standalone false member lookup lookup lookup factory get look up system out println lookup assert assert true lookup instanceof standalone member lookup test public void test c lookup address server throw exception application util set be standalone false system out println application util get cluster conf file path disk util delete file path get path conf to string cluster conf system out println new file application util get cluster conf file path exist try lookup factory create look up member manager catch throwable ignore member lookup lookup lookup factory get look up system out println lookup assert assert true lookup instanceof address server member lookup try func lookup catch nacos exception e system out println e get err msg assert assert true string util contain ignore case e get err msg jmenv tbsite net private void func member lookup lookup throw exception func lookup private void func member lookup lookup int expect size throw exception lookup start map string member tmp member manager get server list system out println lookup tmp assert assert equal expect size tmp size 
server member manager i t case fix method order method sorter name ascend public class server member manager i t case private server member manager member manager before class public static void init class throw exception system set property constant naco server ip 127.0 0.1 system set property server port application util set be standalone true application util inject environment new standard environment after class public static void destroy class system clear property constant naco server ip system clear property server port before public void before throw exception member manager new server member manager new mock servlet context after public void after throw exception member manager shutdown test public void test kis first string first ip 127.0 0.1 string second ip 127.0 0.1 string third ip 127.0 0.1 map string member map new hash map map put first ip member builder ip 127.0 0.1 port state node state up build map put second ip member builder ip 127.0 0.1 port state node state up build map put third ip member builder ip 127.0 0.1 port state node state up build list member member new array list member map value collection sort member list string ss member util simple member member assert assert equal ss get member get get address test public void test member change throw exception atomic integer integer new atomic integer count down latch latch new count down latch notify center register subscriber new subscriber member change event override public void on event member change event event integer increment and get latch count down override public class extend event subscribe type return member change event class collection member member member manager all member system out println member member manager member join member member add member builder ip 115.159 3.213 port build boolean changed member manager member join member assert assert true change latch await l time unit millisecond assert assert equal integer get test public void test member health check throw exception atomic reference collection member health member new atomic reference count down latch first new count down latch count down latch second new count down latch notify center register subscriber new subscriber member change event override public void on event member change event event system out println event health member set member util select target member event get member member node state down equal member get state if first get count first count down return if second get count second count down override public class extend event subscribe type return member change event class string first ip 127.0 0.1 string second ip 127.0 0.1 string third ip 127.0 0.1 map string member map new hash map map put first ip member builder ip 127.0 0.1 port state node state up build map put second ip member builder ip 127.0 0.1 port state node state up build map put third ip member builder ip 127.0 0.1 port state node state up build set member first member list new hash set map value member manager member join map value first await set member copy new hash set first member list copy remove all health member get assert assert true copy be empty member member map get first ip member set state node state down assert assert true member manager update member second await copy new hash set first member list copy remove all health member get assert assert equal copy size assert assert true copy contain map get first ip 
name raft d i t case ignore fix method order value method sorter name ascend public class name raft d i t case extend base cluster test test public void test register instance throw exception string service name naming base random domain name instance instance new instance instance set ephemeral true instance set service name service name instance set cluster name c1 instance set ip 11.11 11.11 instance set port try inaming7 register instance service name instance catch throwable ex ex print stack trace assert fail ex get message return list instance list inaming8 get all instance service name assert assert equal list size instance host list get assert assert equal host get ip instance get ip assert assert equal host get port instance get port assert assert equal host get service name name util get group name instance get service name default group assert assert equal host get cluster name instance get cluster name 
