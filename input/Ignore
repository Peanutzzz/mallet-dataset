address server controller test ignore public class address server controller test private static final string product naco naco private static final string product config config private static final string product name name private static final string default url cluster serverlist private static final string get serverlist url formart http 127.0 0.1 s s product naco cluster default test public void post cluster string ip 127.0 0.100 127.0 0.102 127.0 0.104 hash map string string param new hash map param put ip ip string response simple http test util do post http 127.0 0.1 naco v1 as node param utf system err println response test public void get cluster string get url string format get serverlist url formart product naco default url cluster string response simple http test util do get get url new hash map utf system err println response test public void delete cluster hash map string string delete ip new hash map delete ip put ip 127.0 0.104 string response simple http test util do delete http 127.0 0.1 naco v1 as node delete ip utf system err println response test public void delete cluster with spec ip hash map string string param new hash map param put ip 127.0 0.103 string response simple http test util do delete http 127.0 0.1 naco v1 as node param utf system err println response test public void put cluster string ip 127.0 0.114 hash map string string param new hash map param put ip ip string response simple http test util do put http 127.0 0.1 naco v1 as node param utf system err println response product config cluster cluster01 test public void post cluster with product string ip 127.0 0.101 127.0 0.102 127.0 0.103 hash map string string param new hash map param put ip ip param put product product config string response simple http test util do post http 127.0 0.1 naco v1 as node param utf system err println response test public void get cluster with product hash map string string param new hash map string get url string format get serverlist url formart product config default url cluster string response simple http test util do get get url param utf system err println response test public void delete cluster with product hash map string string param new hash map param put product product config string response simple http test util do delete http 127.0 0.1 naco v1 as node param utf system err println response test public void delete cluster with product and ip hash map string string param new hash map param put product product config param put ip 127.0 0.196 string response simple http test util do delete http 127.0 0.1 naco v1 as node param utf system err println response test public void put cluster with product string ip 127.0 0.196 hash map string string param new hash map param put ip ip param put product product config string response simple http test util do put http 127.0 0.1 naco v1 as node param utf system err println response product name cluster cluster01 test public void post cluster with product and cluster string ip 127.0 0.100 127.0 0.200 127.0 0.31 hash map string string param new hash map param put ip ip param put product product name param put cluster cluster01 string response simple http test util do post http 127.0 0.1 naco v1 as node param utf system err println response test public void get cluster with product and cluster hash map string string param new hash map string get url string format get serverlist url formart product name cluster01 string response simple http test util do get get url param utf system err println response test public void delete cluster with product and cluster hash map string string param new hash map param put product product name param put cluster cluster01 string response simple http test util do delete http 127.0 0.1 naco v1 as node param utf system err println response test public void delete cluster with product and cluster and ip hash map string string param new hash map param put product product name param put cluster cluster01 param put ip 127.0 0.200 string response simple http test util do delete http 127.0 0.1 naco v1 as node param utf system err println response test public void put cluster with product and cluster string ip 127.0 0.171 hash map string string param new hash map param put ip ip param put product product name param put cluster cluster01 string response simple http test util do put http 127.0 0.1 naco v1 as node param utf system err println response 
config test ignore public class config test private static config service config service before public static void before throw exception property property new property property set property property key const server addr 127.0 0.1 config service naco factory create config service property after public void cleanup throw exception config service shut down test public static void test throw exception final string datum id lessspr final string group lessspr final string content lessspr system current time millis boolean result config service publish config datum id group content assert assert true result thread util sleep l string response config service get config and sign listener datum id group new abstract listener override public void receive config info string config info system err println config info assert assert equal content response scanner scanner new scanner system in system out println input content while scanner have next line string s scanner next if exit equal s scanner close return config service publish config datum id group s 
name test ignore public class name test test public void test service list throw exception property property new property property put property key const server addr 127.0 0.1 property put property key const username naco property put property key const password naco instance instance new instance instance set ip 1.1 1.1 instance set port instance set weight map string string map new hash map string string map put net type external map put version 2.0 instance set metadata map naming service naming service naco factory create naming service property name service register instance naco test instance thread util sleep l list instance list naming service get all instance naco test system out println list thread util sleep l expression selector expression selector new expression selector expression selector set expression instance metadata register source dubbo list view string service list naming service get service of server expression selector 
instance test test ignore public void check sum thread safe throw exception count down latch count down latch new count down latch for int i i i thread thread new thread new runnable override public void run for int j j integer max value j check sum thread safe version test count down latch count down thread start count down latch await 
config derby raft d i t case suppress warning all ignore fix method order value method sorter name ascend public class config derby raft d i t case extend base cluster test test public void test a publish config throw exception boolean result iconfig7 publish config raft test cluster test this be raft cluster lessspring assert assert true result thread util sleep configurable application context context7 application get configurable application context context8 application get configurable application context context9 application get persist service operate7 context7 get bean embed storage persist service impl class persist service operate8 context8 get bean embed storage persist service impl class persist service operate9 context9 get bean embed storage persist service impl class string s7 operate7 find config info raft test cluster test get content string s8 operate8 find config info raft test cluster test get content string s9 operate9 find config info raft test cluster test get content assert assert array equal the three node must have consistent datum new string s7 s8 s9 new string this be raft cluster lessspr this be raft cluster lessspr this be raft cluster lessspr test public void test b publish config throw exception thread util sleep boolean result iconfig8 publish config raft test cluster test this be raft cluster lessspring assert assert true result thread util sleep configurable application context context7 application get configurable application context context8 application get configurable application context context9 application get persist service operate7 context7 get bean embed storage persist service impl class persist service operate8 context8 get bean embed storage persist service impl class persist service operate9 context9 get bean embed storage persist service impl class string s7 operate7 find config info raft test cluster test get content string s8 operate8 find config info raft test cluster test get content string s9 operate9 find config info raft test cluster test get content assert assert array equal the three node must have consistent datum new string s7 s8 s9 new string this be raft cluster lessspr this be raft cluster lessspr this be raft cluster lessspr test public void test c publish config throw exception thread util sleep boolean result iconfig9 publish config raft test cluster test this be raft cluster lessspring assert assert true result thread util sleep configurable application context context7 application get configurable application context context8 application get configurable application context context9 application get persist service operate7 context7 get bean embed storage persist service impl class persist service operate8 context8 get bean embed storage persist service impl class persist service operate9 context9 get bean embed storage persist service impl class string s7 operate7 find config info raft test cluster test get content string s8 operate8 find config info raft test cluster test get content string s9 operate9 find config info raft test cluster test get content assert assert array equal the three node must have consistent datum new string s7 s8 s9 new string this be raft cluster lessspr this be raft cluster lessspr this be raft cluster lessspr test public void test d modify config throw exception boolean result iconfig7 publish config raft test cluster test this be raft cluster lessspr it be for modify assert assert true result thread util sleep configurable application context context7 application get configurable application context context8 application get configurable application context context9 application get persist service operate7 context7 get bean embed storage persist service impl class persist service operate8 context8 get bean embed storage persist service impl class persist service operate9 context9 get bean embed storage persist service impl class string s7 operate7 find config info raft test cluster test get content string s8 operate8 find config info raft test cluster test get content string s9 operate9 find config info raft test cluster test get content assert assert array equal the three node must have consistent datum new string s7 s8 s9 new string this be raft cluster lessspr it be for modify this be raft cluster lessspr it be for modify this be raft cluster lessspr it be for modify test public void test l client operation throw exception final string datum id test l client operation final string group id test l client operation string content test l client operation system current time millis publish by boolean result iconfig7 publish config datum id group id content assert assert true result thread util sleep string v1 iconfig7 get config datum id group id l string v1 iconfig8 get config datum id group id l string v1 iconfig9 get config datum id group id l assert assert equal content v1 assert assert equal content v1 assert assert equal content v1 publish by content test l client operation system current time millis result iconfig8 publish config datum id group id content assert assert true result thread util sleep string v2 iconfig7 get config datum id group id l string v2 iconfig8 get config datum id group id l string v2 iconfig9 get config datum id group id l assert assert equal content v2 assert assert equal content v2 assert assert equal content v2 publish by content test l client operation system current time millis result iconfig9 publish config datum id group id content assert assert true result thread util sleep string v3 iconfig7 get config datum id group id l string v3 iconfig8 get config datum id group id l string v3 iconfig9 get config datum id group id l assert assert equal content v3 assert assert equal content v3 assert assert equal content v3 delete by result iconfig9 remove config datum id group id assert assert true result thread util sleep string v4 iconfig7 get config datum id group id l string v4 iconfig8 get config datum id group id l string v4 iconfig9 get config datum id group id l assert assert null v4 assert assert null v4 assert assert null v4 test public void test k config listener throw exception string datum id test h config listener string group test h config listener string content test h config listener count down latch latch new count down latch new count down latch new count down latch atomic reference string be new atomic reference atomic integer i new atomic integer iconfig7 add listener datum id group new abstract listener override public void receive config info string config info system out println config info r set config info latch i get and increment count down iconfig7 publish config datum id group content thread util sleep l latch await l time unit millisecond assert assert equal content r get assert assert equal content iconfig7 get config datum id group l content content system current time millis iconfig7 publish config datum id group content thread util sleep l latch await l time unit millisecond assert assert equal content r get assert assert equal content iconfig7 get config datum id group l test public void test e derby op throw exception string url http 127.0 0.1 naco v1 c op derby query query query new instance add param sql select from user rest result list map string object result http client get url header empty query new generic type rest result list map string object get type system out println result get datum assert assert true result ok list map string object list result get datum assert assert equal list size assert assert equal naco list get get username test public void test g derby op no select throw exception string url http 127.0 0.1 naco v1 c op derby query query query new instance add param sql update user set username naco rest result object result http client get url header empty query new generic type rest result object get type system out println result assert assert false result ok assert assert equal only query statement be allow to be execute result get message test public void test h derby have error throw exception thread util sleep boolean result iconfig7 publish config raft test raft error cluster test this be raft cluster lessspring assert assert true result notify center register to publisher raft db error recover event class count down latch latch1 new count down latch notify center register subscriber new subscriber raft db error event override public void on event raft db error event event latch1 count down override public class extend event subscribe type return raft db error event class notify center publish event new raft db error event latch1 await l time unit millisecond result iconfig7 publish config raft test raft error cluster test this be raft cluster lessspring assert assert false result count down latch latch2 new count down latch notify center register subscriber new subscriber raft db error recover event override public void on event raft db error recover event event latch2 count down override public class extend event subscribe type return raft db error recover event class notify center publish event new raft db error recover event latch2 await l time unit millisecond result iconfig7 publish config raft test raft error cluster test this be raft cluster lessspring assert assert true result test public void test f id generator leader transfer throw exception configurable application context context7 application get configurable application context context8 application get configurable application context context9 application get id generator manager manager7 context7 get bean id generator manager class id generator manager manager8 context8 get bean id generator manager class id generator manager manager9 context9 get bean id generator manager class c p protocol protocol7 context7 get bean c p protocol class c p protocol protocol8 context8 get bean c p protocol class c p protocol protocol9 context9 get bean c p protocol class final string config group com alibaba naco config server constant constant config model raft group long pre id 1 l long current id 1 l if protocol7 be leader config group pre id manager7 next id config info id if protocol8 be leader config group pre id manager8 next id config info id if protocol9 be leader config group pre id manager9 next id config info id transfer leader to ip map string string transfer new hash map transfer put j raft constant transfer leader inet util get self ip rest result string result protocol7 execute transfer system out println result assert assert true result ok time unit seconds sleep assert assert true protocol7 be leader config group current id manager7 next id config info id assert assert not equal pre id current id pre id current id transfer leader to ip transfer new hash map transfer put j raft constant transfer leader inet util get self ip result protocol8 execute transfer system out println result assert assert true result ok time unit seconds sleep assert assert true protocol8 be leader config group current id manager8 next id config info id assert assert not equal pre id current id pre id current id transfer leader to ip transfer new hash map transfer put j raft constant transfer leader inet util get self ip result protocol9 execute transfer system out println result assert assert true result ok time unit seconds sleep assert assert true protocol9 be leader config group current id manager9 next id config info id assert assert not equal pre id current id 
cmdb i t case run with spring runner class spring boot test class naco class property server servlet context path naco web environment spring boot test web environment random port ignore public class cmdb i t case private naming service name private url base public static final long time out autowired private test rest template rest template local server port private int port before public void set up throw exception string url string format http s s test ip dom port this base new url url if naming null naming name factory create naming service test ip dom port after public void cleanup throw exception t c description cmdb label throw exception test public void cmdb get instance list throw exception string service name random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 string service name2 random domain name naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep 5 l object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body assert assert equal result get host size t c description cmdb label instance throw exception test public void cmdb get instance list throw exception string service name random domain name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 string service name2 random domain name naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body assert assert equal result get host size t c description cmdb ip instance throw exception test public void cmdb get instance list throw exception string service name random domain name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 string service name2 random domain name naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 66.66 66.66 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb service name throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n service param new param append param service name service name append param namespace id constant default namespace id do string class http method get system out println service list jackson util to obj http result get body http result request naco v1 n instance list param new param append param service name service name append param client i p 66.66 66.66 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb ip instance service name throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 77.77 77.77 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb selector throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb selector throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 list string params array as list service name service name protect threshold selector json to string response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal json get host size http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb expression throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb expression null instance throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label json put expression response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http ok http result get status code value http result request naco v1 n instance list param new param append param service name service name append param client i p 11.11 11.11 do string class http method get assert assert equal http u be l connection http ok http result get status code value json node result jackson util to obj http result get body system out println instance list result assert assert equal result get host size t c description cmdb type label throw exception test public void cmdb get instance list throw exception string service name random domain name string service name2 random domain name system out println service name naming service create service name constant default namespace id constant default group instance register service name constant default namespace id constant default group 11.11 11.11 string value of test port dom c1 instance register service name constant default namespace id constant default group 22.22 22.22 string value of test port dom c1 instance register service name constant default namespace id constant default group 33.33 33.33 string value of test port dom c2 instance register service name constant default namespace id constant default group 44.44 44.44 string value of test port dom c2 instance register service name constant default namespace id constant default group 55.55 55.55 string value of test port dom c1 instance register service name constant default namespace id constant default group 66.66 66.66 string value of test port dom c1 naming service create service name2 constant default namespace id constant default group instance register service name2 constant default namespace id constant default group 77.77 77.77 string value of test port dom c2 instance register service name2 constant default namespace id constant default group 88.88 88.88 string value of test port dom c2 time unit seconds sleep object node json jackson util create empty json node json put type label1 json put expression consumer label label1 provider label label1 consumer label label2 provider label label2 response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold append param selector json to string do string class http method put assert assert equal http u be l connection http bad request http result get status code value public void instance register string service name string namespace string group name string ip string port string cluster name throw i o exception response entity string http result request naco v1 n instance param new param append param service name service name append param ip ip append param port port append param namespace id namespace append param group name group name append param cluster name cluster name append param ephemeral false do string class http method post assert assert equal http u be l connection http ok http result get status code value public void naming service create string service name string namespace throw i o exception naming service create service name namespace constant default group public void naming service create string service name string namespace string group name throw i o exception list string list param array as list service name service name protect threshold 0.3 namespace id namespace group name group name response entity string http result request naco v1 n service param new param append param service name service name append param protect threshold 0.3 append param namespace id namespace append param group name group name do string class http method post assert assert equal http u be l connection http ok http result get status code value private t response entity t request string path multi value map string string param class t clazz return request path param clazz org springframework http http method get private t response entity t request string path multi value map string string param class t clazz org springframework http http method http method http header header new http header http entity entity new http entity t header uri component builder builder uri component builder from http url this base to string path query param param return this rest template exchange builder to uri string http method entity clazz 
name raft d i t case ignore fix method order value method sorter name ascend public class name raft d i t case extend base cluster test test public void test register instance throw exception string service name naming base random domain name instance instance new instance instance set ephemeral true instance set service name service name instance set cluster name c1 instance set ip 11.11 11.11 instance set port try inaming7 register instance service name instance catch throwable ex ex print stack trace assert fail ex get message return list instance list inaming8 get all instance service name assert assert equal list size instance host list get assert assert equal host get ip instance get ip assert assert equal host get port instance get port assert assert equal host get service name name util get group name instance get service name default group assert assert equal host get cluster name instance get cluster name 
rest a p i i t case test ignore public void test invalid namespace string service name naming base random domain name response entity string response request naming base name controller path service param new param append param service name service name append param protect threshold 0.6 append param namespace id invalid namespace do string class http method post assert assert true response get status code is4xx client error response request naming base name controller path service param new param append param service name service name append param protect threshold 0.6 append param namespace id invalid namespace do string class http method post assert assert true response get status code is4xx client error 
flow rule test ignore deprecate test for legacy flow rule public class flow rule test test public void test flow rule grade flow rule flow rule new flow rule flow rule set grade rule constant flow grade qp flow rule set count flow rule set limit app default flow rule set strategy rule constant strategy direct default controller default controller new default controller flow rule get grade flow rule set rater default controller context context mock context class default node node mock default node class cluster node cn mock cluster node class when context get origin then return when node get cluster node then return cn when cn pass qp then return 1d assert false flow rule pass check context node flow rule set grade rule constant flow grade thread default controller new default controller flow rule get grade flow rule set rater default controller when cn cur thread num then return assert true flow rule pass check context node test public void test flow rule strategy flow rule flow rule new flow rule flow rule set grade rule constant flow grade qp flow rule set count flow rule set limit app default flow rule set strategy rule constant strategy chain default controller default controller new default controller flow rule get grade flow rule set rater default controller flow rule set ref resource entry1 context context mock context class default node dn mock default node class when context get name then return entry1 when dn pass qp then return 1d assert false flow rule pass check context dn when context get name then return entry2 assert true flow rule pass check context dn strategy relate flow rule set strategy rule constant strategy chain cluster node cn mock cluster node class assert true flow rule pass check context dn test public void test origin flow rule flow rule new flow rule flow rule set grade rule constant flow grade qp flow rule set count flow rule set limit app default flow rule set strategy rule constant strategy direct default controller default controller new default controller flow rule get grade flow rule set rater default controller flow rule set ref resource entry1 context context mock context class default node dn mock default node class when context get origin then return origin1 when dn pass qp then return 1d when context get origin node then return dn first scenario limit app as default cluster node cn mock cluster node class when dn get cluster node then return cn when cn pass qp then return 1d assert true flow rule pass check context dn new object false when cn pass qp then return 0d assert true flow rule pass check context dn new object flow rule set strategy rule constant strategy chain flow rule set resource entry1 when context get name then return entry1 assert true flow rule pass check context dn new object false when context get name then return entry2 assert true flow rule pass check context dn new object relate node flow rule set strategy rule constant strategy relate flow rule set resource worong assert true flow rule pass check context dn new object second scenario test a context with the same origin1 flow rule set limit app origin1 when context get name then return entry1 direct node flow rule set strategy rule constant strategy direct assert true flow rule pass check context dn new object false chain node flow rule set resource entry1 flow rule set strategy rule constant strategy chain when context get name then return entry1 assert true flow rule pass check context dn new object false when context get name then return entry2 assert true flow rule pass check context dn new object relate node flow rule set strategy rule constant strategy relate flow rule set resource not exit assert true flow rule pass check context dn new object when context get origin then return origin2 assert true flow rule pass check context dn new object limit app other flow rule set limit app other flow rule set resource hello world flow rule set strategy rule constant strategy direct assert true flow rule pass check context dn new object false flow rule set strategy rule constant strategy chain flow rule set resource entry1 when context get name then return entry1 assert true flow rule pass check context dn new object false when context get name then return entry2 assert true flow rule pass check context dn new object 
etcd datum source test ignore value before run this test you need to set up you etcd server public class etcd datum source test private final string end point http 127.0 0.1 before public void set up sentinel config set config etcd config end point end point flow rule manager load rule new array list after public void tear down sentinel config set config etcd config end point flow rule manager load rule new array list test public void test read source throw exception etcd datum source datum source new etcd datum source foo value value kv kv client client builder endpoint end point build get k v client kv client put byte sequence from foo get byte byte sequence from test get byte assert assert not null datum source read source equal test kv client put byte sequence from foo get byte byte sequence from test2 get byte assert assert not null datum source get property equal test2 test public void test dynamic update throw interrupted exception string demo key etcd demo key readable datum source string list flow rule flow rule etcd datum source new etcd datum source demo key value json parse array value flow rule class flow rule manager register2 property flow rule etcd datum source get property kv kv client client builder endpoint end point build get k v client final string rule1 n n resource test resource n control behavior n count 5.0 n grade n limit app default n strategy n n kv client put byte sequence from demo key get byte byte sequence from rule1 get byte thread sleep flow rule flow rule flow rule manager get rule get assert assert true flow rule get resource equal test resource assert assert true flow rule get count 5.0 assert assert true flow rule get grade final string rule2 n n resource test resource n control behavior n count 6.0 n grade n limit app default n strategy n n kv client put byte sequence from demo key get byte byte sequence from rule2 get byte thread sleep flow rule flow rule manager get rule get assert assert true flow rule get resource equal test resource assert assert true flow rule get count 6.0 assert assert true flow rule get grade 
sentinel mode redis datum source test ignore value before run this test you need to set up you redis sentinel public class sentinel mode redis datum source test private string host localhost private int redis sentinel port private string redis sentinel master id my master private string rule key sentinel rule flow rule key private string channel sentinel rule flow channel private final redis client client redis client create redis u be i builder sentinel host redis sentinel port with sentinel master id redis sentinel master id build before public void init datum converter string list flow rule flow config parser build flow config parser redis connection config config redis connection config builder with redis sentinel host redis sentinel port with redis sentinel host redis sentinel port with sentinel master id redis sentinel master id build init redis rule datum readable datum source string list flow rule redis datum source new redi datum source config rule key channel flow config parser flow rule manager register2 property redis datum source get property test public void test connect to sentinel and pub msg success int max queueing time ms new random next int string flow rule json resource test limit app default grade count 0.0 strategy ref resource null control behavior warm up period sec max queueing time ms max queueing time ms controller null redis command string string sub command client connect sync sub command multi sub command set rule key flow rule json sub command publish channel flow rule json sub command exec await timeout time unit seconds until new callable list flow rule override public list flow rule call throw exception return flow rule manager get rule matcher have size list flow rule rule flow rule manager get rule assert assert equal rule get get max queueing time ms max queueing time ms string value sub command get rule key list flow rule flow rule value in redis build flow config parser convert value assert assert equal flow rule value in redis size assert assert equal flow rule value in redi get get max queueing time ms max queueing time ms after public void clear resource redis command string string string redis command client connect sync string redis command del rule key client shutdown private converter string list flow rule build flow config parser return source json parse object source new type reference list flow rule private void init redis rule datum string flow rule json resource test limit app default grade count 0.0 strategy ref resource null control behavior warm up period sec max queueing time ms controller null redis command string string string redis command client connect sync string ok string redis command set rule key flow rule json assert assert equal ok ok 
bucket sink migration test ignore test public void write snapshot throw exception final file out dir temp folder new folder bucket sink string sink new bucket sink string out dir get absolute path set writer new string writer string set batch size set part prefix part prefix set in progress prefix set pend prefix set valid length prefix set in progress suffix in progress suffix set pend suffix pend suffix set valid length suffix valid length suffix one input stream operator test harness string object test harness new one input stream operator test harness new stream sink sink test harness setup test harness open test harness process element new stream record test1 0 l test harness process element new stream record test2 0 l check local f out dir test harness process element new stream record test3 0 l test harness process element new stream record test4 0 l test harness process element new stream record test5 0 l check local f out dir operator subtask state snapshot test harness snapshot 0 l 0 l operator snapshot util write state handle snapshot src test resource bucket sink migration test flink flink generate savepoint version snapshot test harness close 
jdbc i t case test ignore public void test insert throw exception stream execution environment env stream execution environment get execution environment env set restart strategy new restart strategy no restart strategy configuration env set parallelism env from element test datum add sink jdbc sink sink string format insert template input table ps t ps set int t id ps set string t title ps set string t author if t price null ps set null type double else ps set double t price ps set int t qty new jdbc connection option builder with url get db metadata get url with driver name get db metadata get driver class build env execute assert equal array as list test datum select book 
flink kafka producer migration operator test ignore override public void write snapshot throw exception throw new unsupported operation exception 
kafka010 i t case ignore this test be disabled because of https issue apache org jira browse flink test timeout public void test timestamp throw exception final string topic tstopic create test topic topic produce a event time stream into kafka stream execution environment env stream execution environment get execution environment env set parallelism env get config set restart strategy restart strategy no restart env set stream time characteristic time characteristic event time datum stream long stream with timestamp env add source new source function long private static final long serial version u i d l boolean running true override public void run source context long ctx throw exception long i while run ctx collect with timestamp i i if i l run false override public void cancel run false final type information serialization schema long long ser new type information serialization schema type long env get config flink kafka producer010 flink kafka producer010 configuration prod flink kafka producer010 write to kafka with timestamp stream with timestamp topic new keyed serialization schema wrapper long ser standard prop new flink kafka partitioner long private static final long serial version u i d l override public int partition long next byte key byte value string target topic int partition return int next prod set parallelism prod set write timestamp to kafka true env execute produce some consume stream from kafka env stream execution environment get execution environment env set parallelism env get config set restart strategy restart strategy no restart env set stream time characteristic time characteristic event time flink kafka consumer010 long kafka source new flink kafka consumer010 topic new limited long deserializer standard prop kafka source assign timestamp and watermark new assigner with punctuate watermark long private static final long serial version u i d l nullable override public watermark check and get next watermark long last element long extract timestamp if last element return new watermark last element return null override public long extract timestamp long element long previous element timestamp return previous element timestamp datum stream long stream env add source kafka source generic type info object object type info new generic type info object class stream transform timestamp validate operator object type info new timestamp validate operator set parallelism env execute consume again delete test topic topic 
flink kafka consumer base migration test ignore test public void write snapshot throw exception write snapshot src test resource kafka consumer migration test flink flink generate savepoint version snapshot partition state final hash map kafka topic partition long empty state new hash map write snapshot src test resource kafka consumer migration test flink flink generate savepoint version empty state snapshot empty state 
kafka migration test base ignore test public void write snapshot throw exception try check state flink generate savepoint version be present start cluster operator subtask state snapshot initialize test state operator snapshot util write state handle snapshot get operator snapshot path flink generate savepoint version get finally shutdown cluster 
flink kinesis consumer migration test ignore test public void write snapshot throw exception write snapshot src test resource kinesis consumer migration test flink flink generate savepoint version snapshot test state write empty state snapshot write snapshot src test resource kinesis consumer migration test flink flink generate savepoint version empty snapshot new hash map 
serializer test instance ignore public class serializer test instance t extend serializer test base t private final type serializer t serializer private final class t type class private final int length private final t test datum safe vararg public serializer test instance type serializer t serializer class t type class int length t test datum this new deeply equal checker serializer type class length test datum safe vararg public serializer test instance deeply equal checker checker type serializer t serializer class t type class int length t test datum super checker this serializer serializer this type class type class this length length this test datum test datum override protect type serializer t create serializer return this serializer override protect int get length return this length override protect class t get type class return this type class override protect t get test datum return this test datum public void test all for method method serializer test base class get method if method get annotation test class null continue try method invoke this catch illegal access exception e throw new runtime exception unable to invoke test method get name e catch invocation target exception e sneaky throw e get cause suppress warning unchecked private static e extend throwable void sneaky throw throwable e throw e throw e e 
type serializer upgrade test base test ignore public void generate test setup file throw exception file create directory get serializer snapshot file path get parent try thread context class loader ignore new thread context class loader test specification setup setup classloader type serializer previous element t prior serializer test specification setup create prior serializer first use the serializer to write test datum note it be important that we write test datum first because some serializer configuration mutate only after be use for serialization e g dynamic type registration for pojo kryo datum output serializer test datum out new datum output serializer initial output buffer size prior serializer serialize test specification setup create test datum test datum out write contents to get generate datum file path test datum out get copy of buffer then write the serializer snapshot datum output serializer serializer snapshot out new datum output serializer initial output buffer size write serializer snapshot serializer snapshot out prior serializer current version write contents to get generate serializer snapshot file path serializer snapshot out get copy of buffer 
allround mini cluster test ignore test be already part of end to end test this be for manual debug public class allround mini cluster test extend test logger before class public static void before class org apache log4j property configurator configure allround mini cluster test class get class loader get resource log4j property class rule public static mini cluster with client resource mini cluster resource new mini cluster with client resource new mini cluster resource configuration builder set number task manager set number slot per task manager set configuration create configuration build class rule public static temporary folder temporary folder new temporary folder private static configuration create configuration configuration configuration new configuration configuration set boolean checkpoint option local recovery true configuration set string execution failover strategy key region return configuration test public void run test throw exception file checkpoint dir temporary folder new folder datum stream allround test program main new string environment parallelism state backend checkpoint directory checkpoint dir to u be i to string state backend rock state backend rock incremental true test simulate failure true test simulate failure max failure string value of integer max value test simulate failure num record 
continuous file processing migration test ignore test public void write reader snapshot throw exception file test folder temp folder new folder timestamp file input split split1 new timestamped file input split new path test test1 null timestamped file input split split2 new timestamped file input split new path test test2 null timestamped file input split split3 new timestamped file input split new path test test2 null timestamped file input split split4 new timestamped file input split new path test test3 null this always block to ensure that the reader doesn t to any actual processing so that we keep the state for the four splits final one shot latch block latch new one shot latch block file input format format new blocking file input format block latch new path test folder get absolute path one input stream operator test harness timestamp file input split file input split test harness create harness format test harness set time characteristic time characteristic event time test harness open create some state in the reader test harness process element new stream record split1 test harness process element new stream record split2 test harness process element new stream record split3 test harness process element new stream record split4 take a snapshot of the operator s state this will be use to initialize another reader and compare the result of the two operator final operator subtask state snapshot synchronize test harness get checkpoint lock snapshot test harness snapshot 0 l 0 l operator snapshot util write state handle snapshot src test resource reader migration test flink flink generate savepoint version snapshot 
continuous file processing migration test ignore test public void write monitor source snapshot throw exception file test folder temp folder new folder long file mod time long min value for int i i i tuple2 file string file create file and fill with datum test folder file i this be test line file mod time file f0 last modify text input format format new text input format new path test folder get absolute path final continuous file monitoring function string monitoring function new continuous file monitoring function format file processing mode process continuously interval stream source timestamped file input split continuous file monitoring function string src new stream source monitoring function final abstract stream operator test harness timestamp file input split test harness new abstract stream operator test harness src test harness open final throwable error new throwable final one shot latch latch new one shot latch run the source asynchronously thread runner new thread override public void run try monitor function run new dummy source context override public void collect timestamped file input split element latch trigger override public void mark as temporarily idle catch throwable t t print stack trace error t runner start if latch be trigger latch await final operator subtask state snapshot synchronize test harness get checkpoint lock snapshot test harness snapshot 0 l 0 l operator snapshot util write state handle snapshot src test resource monitor function migration test file mod time flink flink generate savepoint version snapshot monitoring function cancel runner join test harness close 
row csv input format test test ignore test disabled because we do not support double quote escape quote right now public void test parser correctness throw exception rfc compliance test content take from http en wikipedia org wiki comma separate value example string file content year make model description price n ford e350 ac abs moon 3000.00 n chevy venture extend edition 4900.00 n jeep grand cherokee must sell air moon roof load 4799.00 n chevy venture extend edition very large 5000.00 n venture extend edition 4900.00 file input split split create temp file file content type information field type new type information basic type info int type info basic type info string type info basic type info string type info basic type info string type info basic type info double type info row csv input format format new row csv input format path field type format set skip first line as header true format set field delimiter format configure new configuration format open split row result new row row r1 new row r1 set field r1 set field ford r1 set field e350 r1 set field ac abs moon r1 set field 3000.0 row r2 new row r2 set field r2 set field chevy r2 set field venture extend edition r2 set field r2 set field 4900.0 row r3 new row r3 set field r3 set field jeep r3 set field grand cherokee r3 set field must sell air moon roof load r3 set field 4799.0 row r4 new row r4 set field r4 set field chevy r4 set field venture extend edition very large r4 set field r4 set field 5000.0 row r5 new row r5 set field r5 set field r5 set field venture extend edition r5 set field r5 set field 4900.0 row expect line new row r1 r2 r3 r4 r5 for row expect expected line result format next record result assert equal expected result assert null format next record result assert true format reach end 
c e p migration test ignore test public void write after branch pattern snapshot throw exception key selector event integer key selector new key selector event integer private static final long serial version u i d l override public integer get key event value throw exception return value get id final event start event new event start 1.0 final sub event middle event1 new sub event foo1 1.0 10.0 final sub event middle event2 new sub event foo2 2.0 10.0 one input stream operator test harness event map string list event harness new keyed one input stream operator test harness get key cep opearator false new n f a factory key selector basic type info int type info try harness setup harness open harness process element new stream record event start event harness process element new stream record event new event foobar 1.0 harness process element new stream record event new sub event barfoo 1.0 5.0 harness process element new stream record event middle event1 harness process element new stream record event middle event2 harness process watermark new watermark do snapshot and save to file operator subtask state snapshot harness snapshot 0 l 0 l operator snapshot util write state handle snapshot src test resource cep migration after branch flink flink generate savepoint version snapshot finally harness close 
c e p migration test ignore test public void write start new pattern after migration snapshot throw exception key selector event integer key selector new key selector event integer private static final long serial version u i d l override public integer get key event value throw exception return value get id final event start event1 new event start 1.0 final sub event middle event1 new sub event foo1 1.0 10.0 one input stream operator test harness event map string list event harness new keyed one input stream operator test harness get key cep opearator false new n f a factory key selector basic type info int type info try harness setup harness open harness process element new stream record event start event1 harness process element new stream record event new event foobar 1.0 harness process element new stream record event new sub event barfoo 1.0 5.0 harness process element new stream record event middle event1 harness process watermark new watermark do snapshot and save to file operator subtask state snapshot harness snapshot 0 l 0 l operator snapshot util write state handle snapshot src test resource cep migration start new pattern flink flink generate savepoint version snapshot finally harness close 
c e p migration test ignore test public void write single pattern after migration snapshot throw exception key selector event integer key selector new key selector event integer private static final long serial version u i d l override public integer get key event value throw exception return value get id final event start event1 new event start 1.0 one input stream operator test harness event map string list event harness new keyed one input stream operator test harness get key cep opearator false new single pattern n f a factory key selector basic type info int type info try harness setup harness open harness process watermark new watermark do snapshot and save to file operator subtask state snapshot harness snapshot 0 l 0 l operator snapshot util write state handle snapshot src test resource cep migration single pattern afterwards flink flink generate savepoint version snapshot finally harness close 
c e p migration test ignore test public void write and or subtyp condition pattern after migration snapshot throw exception key selector event integer key selector new key selector event integer private static final long serial version u i d l override public integer get key event value throw exception return value get id final event start event1 new sub event start 1.0 6.0 one input stream operator test harness event map string list event harness new keyed one input stream operator test harness get key cep opearator false new n f a complex condition factory key selector basic type info int type info try harness setup harness open harness process element new stream record start event1 harness process watermark new watermark do snapshot and save to file operator subtask state snapshot harness snapshot 0 l 0 l operator snapshot util write state handle snapshot src test resource cep migration condition flink flink generate savepoint version snapshot finally harness close 
abstract queryable state test base test ignore public void test wrong job id and wrong queryable state name throw exception final deadline deadline deadline now plus test timeout final long num element l stream execution environment env stream execution environment get execution environment env set state backend state backend env set parallelism max parallelism env set restart strategy restart strategy fix delay restart integer max value l datum stream tuple2 integer long source env add source new test ascend value source num element value state descriptor tuple2 integer long value state new value state descriptor any source get type source key by new key selector tuple2 integer long integer private static final long serial version u i d l override public integer get key tuple2 integer long value return value f0 as queryable state hakuna value state try auto cancellable job closable job graph new auto cancellable job deadline cluster client env client util submit job cluster client closable job graph get job graph completable future job status job status future cluster client get job status closable job graph get job id while deadline have time leave job status future get deadline time leave to millis time unit millisecond equal job status run thread sleep job status future cluster client get job status closable job graph get job id assert equal job status run job status future get deadline time leave to millis time unit millisecond final job i d wrong job id new job i d completable future value state tuple2 integer long unknown job future client get kv state wrong job id this be the wrong job id hakuna basic type info int type info value state try unknown job future get deadline time leave to millis time unit millisecond fail by now the request must have fail catch execution exception e assert assert true get e get cause get message e get cause instanceof runtime exception assert assert true get e get cause get message e get cause get message contain flink job not find exception could not find flink job wrong job id catch exception f fail unexpected type of exception f get message completable future value state tuple2 integer long unknown q s name client get kv state closable job graph get job id wrong hakuna this be the wrong name basic type info int type info value state try unknown q s name get deadline time leave to millis time unit millisecond fail by now the request must have fail catch execution exception e assert assert true get e get cause get message e get cause instanceof runtime exception assert assert true get e get cause get message e get cause get message contain unknown kv state location no kv state location find for kv state instance with name wrong hakuna catch exception f fail unexpected type of exception f get message 
blob cache cleanup test test ignore manual test due to stall ensure a blob be retain first and only delete after the long timeout public void test permanent blob defer cleanup throw i o exception interrupt exception file should be delete between and 10 after last job release long cleanup interval 5 l job i d job id new job i d list permanent blob key key new array list blob server server null permanent blob cache cache null final byte buf new byte try configuration config new configuration config set string blob server option storage directory temporary folder new folder get absolute path config set long blob server option cleanup interval cleanup interval server new blob server config new void blob store server start inet socket address server address new inet socket address localhost server get port cache new permanent blob cache config new void blob store server address upload blob key add server put permanent job id buf buf key add server put permanent job id buf check file count for job job id server check file count for job job id cache register once cache register job job id check file count for job job id server check file count for job job id cache for permanent blob key key key cache get file job id key register again let s say from another thread or so cache register job job id for permanent blob key key key cache get file job id key assert equal check file exist job id key cache true check file count for job job id server check file count for job job id cache after release once nothing should change cache release job job id assert equal check file exist job id key cache true check file count for job job id server check file count for job job id cache after release the second time the job be up for defer cleanup cache release job job id file should still be accessible for now assert equal check file exist job id key cache true check file count for job job id cache thread sleep cleanup interval still accessible assert equal check file exist job id key cache true check file count for job job id cache thread sleep cleanup interval file be up for cleanup now wait for it verify job cleanup cache job id key server should be unaffected check file count for job job id server finally if cache null cache close if server null server close now everything should be clean up check file count for job job id server 
job master execution deployment reconciliation test test ignore public void test execution deployment reconciliation throw exception job master builder testing on completion action on completion action new job master builder testing on completion action final completable future void task deployment future new completable future job master job master create and start job master on completion action task deployment future job master gateway job master gateway job master get self gateway job master gateway class rpc service resource get testing rpc service register gateway job master gateway get address job master gateway final allocation id expose resource manager gateway resource manager gateway create resource manager gateway final completable future execution attempt i d task cancellation future new completable future task executor gateway task executor gateway create task executor gateway task cancellation future local unresolved task manager location local unresolved task manager location new local unresolved task manager location register task executor and offer slot resource manager gateway job master gateway task executor gateway local unresolved task manager location task deployment future get assert false task cancellation future be done execution attempt i d unknown deployment new execution attempt i d the deployment report be miss the just deploy task but contain the id of some other unknown deployment the job master should cancel the unknown deployment and fail the job job master gateway heartbeat from task manager local unresolved task manager location get resource i would new task executor to job manager heartbeat payload new accumulator report collection empty list new execution deployment report collection singleton unknown deployment assert that task cancellation future get be unknown deployment assert that on completion action get job reach globally terminal state future get get state be job status fail 
coordinator event exactly once i t case test ignore public void test throw exception final int num events1 final int num events2 final int delay1 final int delay2 final job vertex task1 build job vertex task num events1 delay1 operator accumulator final job vertex task2 build job vertex task num events2 delay2 operator accumulator final job graph job graph new job graph coordinator event job task1 task2 job graph set snapshot setting create checkpoint setting task1 task2 final job execution result result mini cluster execute job block job graph check list contain sequence result get accumulator result operator accumulator num events2 check list contain sequence result get accumulator result operator accumulator num events1 
operator coordinator scheduler test ignore test public void deploy task cancellation notify coordinator throw exception final default scheduler scheduler create and start scheduler final testing operator coordinator coordinator get coordinator scheduler cancel task scheduler assert equal coordinator get fail task size assert that coordinator get fail task contain assert that coordinator get fail task not contain 
operator coordinator scheduler test ignore test public void run task cancellation notify coordinator throw exception final default scheduler scheduler create scheduler and deploy task final testing operator coordinator coordinator get coordinator scheduler cancel task scheduler assert equal coordinator get fail task size assert that coordinator get fail task contain assert that coordinator get fail task not contain 
file state backend test ignore test public void test concurrent map if queryable throw exception super test concurrent map if queryable 
memory state backend test ignore test public void test concurrent map if queryable throw exception super test concurrent map if queryable 
bucket state serializer test test ignore public void prepare deserialization empty throw i o exception final string scenario name empty final java nio file path scenario path get resource path scenario name current version file util delete directory scenario path to file file create directory scenario path final java nio file path output path get output path scenario name current version final path test bucket path new path output path resolve bucket id to string final bucket string string bucket create new bucket test bucket path final bucket state string bucket state bucket on reception of checkpoint byte byte simple versioned serialization write version and serialize bucket state serializer bucket state file write get snapshot path scenario name current version byte 
bucket state serializer test test ignore public void prepare deserialization only in progress throw i o exception final string scenario name only in progress final java nio file path scenario path get resource path scenario name current version file util delete directory scenario path to file file create directory scenario path final java nio file path output path get output path scenario name current version final path test bucket path new path output path resolve bucket id to string final bucket string string bucket create new bucket test bucket path bucket write in progress content system current time millis final bucket state string bucket state bucket on reception of checkpoint final byte byte simple versioned serialization write version and serialize bucket state serializer bucket state file write get snapshot path scenario name current version byte 
bucket state serializer test test ignore public void prepare deserialization full throw i o exception prepare deserialization full true full 
bucket state serializer test test ignore public void prepare deserialization null in progress throw i o exception prepare deserialization full false full no in progress 
window operator migration test ignore test public void write session window with count trigger snapshot throw exception final int session size list state descriptor tuple2 string integer state desc new list state descriptor window contents string int tuple create serializer new execution config window operator string tuple2 string integer iterable tuple2 string integer tuple3 string long long time window operator new window operator event time session window with gap time seconds session size new time window serializer new tuple key selector string basic type info string type info create serializer new execution config state desc new internal iterable window function new session window function purge trigger of count trigger of null late datum output tag one input stream operator test harness tuple2 string integer tuple3 string long long test harness new keyed one input stream operator test harness operator new tuple key selector basic type info string type info test harness setup test harness open add element out of order test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key1 test harness process element new stream record new tuple2 key1 do snapshot and save to file operator subtask state snapshot test harness snapshot 0 l 0 l operator snapshot util write state handle snapshot src test resource win op migration test session with stateful trigger flink flink generate savepoint version snapshot test harness close 
window operator migration test ignore test public void write session window with count trigger in mint condition snapshot throw exception final int session size list state descriptor tuple2 string integer state desc new list state descriptor window contents string int tuple create serializer new execution config window operator string tuple2 string integer iterable tuple2 string integer tuple3 string long long time window operator new window operator event time session window with gap time seconds session size new time window serializer new tuple key selector string basic type info string type info create serializer new execution config state desc new internal iterable window function new session window function purge trigger of count trigger of null late datum output tag one input stream operator test harness tuple2 string integer tuple3 string long long test harness new keyed one input stream operator test harness operator new tuple key selector basic type info string type info test harness setup test harness open do snapshot and save to file operator subtask state snapshot test harness snapshot operator snapshot util write state handle snapshot src test resource win op migration test session with stateful trigger mint flink flink generate savepoint version snapshot test harness close 
window operator migration test ignore test public void write reduce event time window snapshot throw exception final int window size reduce state descriptor tuple2 string integer state desc new reduce state descriptor window contents new sum reducer string int tuple create serializer new execution config window operator string tuple2 string integer tuple2 string integer tuple2 string integer time window operator new window operator tumble event time window of time of window size time unit seconds new time window serializer new tuple key selector basic type info string type info create serializer new execution config state desc new internal single value window function new pass through window function string time window tuple2 string integer event time trigger create null late datum output tag concurrent link queue object expect output new concurrent link queue one input stream operator test harness tuple2 string integer tuple2 string integer test harness new keyed one input stream operator test harness operator new tuple key selector basic type info string type info test harness setup test harness open add element out of order test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key1 test harness process element new stream record new tuple2 key1 test harness process element new stream record new tuple2 key1 test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key2 test harness process watermark new watermark expect output add new watermark test harness util assert output equal sort output be not correct expected output test harness get output new tuple2 result sort comparator test harness process watermark new watermark expect output add new watermark test harness util assert output equal sort output be not correct expected output test harness get output new tuple2 result sort comparator do snapshot and save to file operator subtask state snapshot test harness snapshot operator snapshot util write state handle snapshot src test resource win op migration test reduce event time flink flink generate savepoint version snapshot test harness close 
window operator migration test ignore test public void write apply event time window snapshot throw exception final int window size list state descriptor tuple2 string integer state desc new list state descriptor window contents string int tuple create serializer new execution config window operator string tuple2 string integer iterable tuple2 string integer tuple2 string integer time window operator new window operator tumble event time window of time of window size time unit seconds new time window serializer new tuple key selector basic type info string type info create serializer new execution config state desc new internal iterable window function new rich sum reducer time window event time trigger create null late datum output tag concurrent link queue object expect output new concurrent link queue one input stream operator test harness tuple2 string integer tuple2 string integer test harness new keyed one input stream operator test harness operator new tuple key selector basic type info string type info test harness setup test harness open add element out of order test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key1 test harness process element new stream record new tuple2 key1 test harness process element new stream record new tuple2 key1 test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key2 test harness process watermark new watermark expect output add new watermark test harness util assert output equal sort output be not correct expected output test harness get output new tuple2 result sort comparator test harness process watermark new watermark expect output add new watermark test harness util assert output equal sort output be not correct expected output test harness get output new tuple2 result sort comparator do snapshot and save to file operator subtask state snapshot test harness snapshot operator snapshot util write state handle snapshot src test resource win op migration test apply event time flink flink generate savepoint version snapshot test harness close 
window operator migration test ignore test public void write reduce processing time window snapshot throw exception final int window size reduce state descriptor tuple2 string integer state desc new reduce state descriptor window contents new sum reducer string int tuple create serializer new execution config window operator string tuple2 string integer tuple2 string integer tuple2 string integer time window operator new window operator tumble processing time window of time of window size time unit seconds new time window serializer new tuple key selector basic type info string type info create serializer new execution config state desc new internal single value window function new pass through window function string time window tuple2 string integer processing time trigger create null late datum output tag concurrent link queue object expect output new concurrent link queue one input stream operator test harness tuple2 string integer tuple2 string integer test harness new keyed one input stream operator test harness operator new tuple key selector basic type info string type info test harness setup test harness open test harness set processing time test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key1 test harness set processing time test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key3 expect output add new stream record new tuple2 key1 expect output add new stream record new tuple2 key2 test harness util assert output equal sort output be not correct expected output test harness get output new tuple2 result sort comparator do snapshot and save to file operator subtask state snapshot test harness snapshot operator snapshot util write state handle snapshot src test resource win op migration test reduce processing time flink flink generate savepoint version snapshot test harness close 
window operator migration test ignore test public void write apply processing time window snapshot throw exception final int window size list state descriptor tuple2 string integer state desc new list state descriptor window contents string int tuple create serializer new execution config window operator string tuple2 string integer iterable tuple2 string integer tuple2 string integer time window operator new window operator tumble processing time window of time of window size time unit seconds new time window serializer new tuple key selector basic type info string type info create serializer new execution config state desc new internal iterable window function new rich sum reducer time window processing time trigger create null late datum output tag concurrent link queue object expect output new concurrent link queue one input stream operator test harness tuple2 string integer tuple2 string integer test harness new keyed one input stream operator test harness operator new tuple key selector basic type info string type info test harness setup test harness open test harness set processing time test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key1 test harness set processing time test harness process element new stream record new tuple2 key2 test harness process element new stream record new tuple2 key3 expect output add new stream record new tuple2 key1 expect output add new stream record new tuple2 key2 test harness util assert output equal sort output be not correct expected output test harness get output new tuple2 result sort comparator do snapshot and save to file operator subtask state snapshot test harness snapshot operator snapshot util write state handle snapshot src test resource win op migration test apply processing time flink flink generate savepoint version snapshot test harness close 
window operator migration test ignore test public void write window with kryo serialize key snapshot throw exception final int window size type information tuple2 non pojo type integer input type new type hint tuple2 non pojo type integer get type info reduce state descriptor tuple2 non pojo type integer state desc new reduce state descriptor window contents new sum reducer input type create serializer new execution config type serializer non pojo type key serializer type information of non pojo type class create serializer new execution config assert true key serializer instanceof kryo serializer window operator non pojo type tuple2 non pojo type integer tuple2 non pojo type integer tuple2 non pojo type integer time window operator new window operator tumble event time window of time of window size time unit seconds new time window serializer new tuple key selector key serializer state desc new internal single value window function new pass through window function event time trigger create null late datum output tag concurrent link queue object expect output new concurrent link queue one input stream operator test harness tuple2 non pojo type integer tuple2 non pojo type integer test harness new keyed one input stream operator test harness operator new tuple key selector type information of non pojo type class test harness setup test harness open add element out of order test harness process element new stream record new tuple2 new non pojo type key2 test harness process element new stream record new tuple2 new non pojo type key2 test harness process element new stream record new tuple2 new non pojo type key1 test harness process element new stream record new tuple2 new non pojo type key1 test harness process element new stream record new tuple2 new non pojo type key1 test harness process element new stream record new tuple2 new non pojo type key2 test harness process element new stream record new tuple2 new non pojo type key2 test harness process element new stream record new tuple2 new non pojo type key2 test harness process watermark new watermark expect output add new watermark test harness util assert output equal sort output be not correct expected output test harness get output new tuple2 result sort comparator test harness process watermark new watermark expect output add new watermark test harness util assert output equal sort output be not correct expected output test harness get output new tuple2 result sort comparator do snapshot and save to file operator subtask state snapshot test harness snapshot operator snapshot util write state handle snapshot src test resource win op migration test kryo serialize key flink flink generate savepoint version snapshot test harness close 
local executor i t case test ignore todo reopen when flink be fix public void test create table with compute column throw exception assume assume true planner equal blink final map string string replace vars new hash map replace var put var planner planner replace var put var source p a t h1 file fake path1 replace var put var source p a t h2 file fake path2 replace var put var execution type batch replace var put var update mode update mode append replace var put var max row replace var put var result mode table final executor executor create modify executor cluster client replace var final string ddl template create table s n a int n b bigint n c as a n with n connector type filesystem n format type csv n connector path xxx n n final session context session new session context test session new environment string session id executor open session session try executor use catalog session id catalog1 executor create table session id string format ddl template my table1 assert equal collection singleton list my table1 executor list table session id executor create table session id string format ddl template my table2 assert equal array as list my table1 my table2 executor list table session id finally executor close session session id 
local executor i t case test ignore todo reopen when flink be fix public void test create table with watermark throw exception final map string string replace vars new hash map replace var put var planner planner replace var put var source p a t h1 file fake path1 replace var put var source p a t h2 file fake path2 replace var put var execution type batch replace var put var update mode update mode append replace var put var max row replace var put var result mode table final executor executor create modify executor cluster client replace var final string ddl template create table s n a int n b timestamp n watermark for b as b interval second n with n connector type filesystem n format type csv n connector path xxx n n final session context session new session context test session new environment string session id executor open session session try executor use catalog session id catalog1 executor create table session id string format ddl template my table1 assert equal collection singleton list my table1 executor list table session id executor create table session id string format ddl template my table2 assert equal array as list my table1 my table2 executor list table session id finally executor close session session id 
java table environment i t case ignore test public void test as from tuple to pojo throw exception execution environment env execution environment get execution environment batch table environment table env batch table environment create env config list tuple4 string integer double string datum new array list datum add new tuple4 rofl 1.0 hi datum add new tuple4 lol 1.0 hi datum add new tuple4 test I 3.33 hello world table table table env from datum set env from collection datum q w e r select q as a w as b e as c r as d datum set small pojo2 d table env to datum set table small pojo2 class list small pojo2 result d collect string expect rofl 1,1 hi n lol 2,1 hi n test I 4,3 hello world n compare result as text result expect 
join cancel i t case ignore take too long public class join cancel i t case extend cancel test base test sort match that be cancel while still read sort private void execute task join function tuple2 integer integer tuple2 integer integer tuple2 integer integer joiner boolean slow throw exception execute task joiner slow parallelism private void execute task join function tuple2 integer integer tuple2 integer integer tuple2 integer integer joiner boolean slow int parallelism throw exception execution environment env execution environment get execution environment datum set tuple2 integer integer input1 env create input new infinite integer tuple input format slow datum set tuple2 integer integer input2 env create input new infinite integer tuple input format slow input1 join input2 join operator base join hint repartition sort merge where equal to with joiner output new discard output format tuple2 integer integer env set parallelism parallelism run and cancel job env create program plan test public void test cancel sort match while read slow input throw exception execute task new simple matcher integer true test public void test cancel sort match while read fast input throw exception execute task new simple matcher integer false test public void test cancel sort match prior to first record reading throw exception execute task new stuck in open matcher integer false private void execute task with generator join function tuple2 integer integer tuple2 integer integer tuple2 integer integer joiner int key int vals int msec till cancel int max time till cancel throw exception execution environment env execution environment get execution environment datum set tuple2 integer integer input1 env create input new uniform int tuple generator input format key val datum set tuple2 integer integer input2 env create input new uniform int tuple generator input format key val input1 join input2 join operator base join hint repartition sort merge where equal to with joiner output new discard output format tuple2 integer integer env set parallelism parallelism run and cancel job env create program plan msec till cancel max time till cancel test public void test cancel sort match while do heavy sorting throw exception execution environment env execution environment get execution environment heavy compare generator input format input new heavy compare generator input format datum set tuple2 heavy compare integer input1 env create input input datum set tuple2 heavy compare integer input2 env create input input input1 join input2 join operator base join hint repartition sort merge where equal to with new join function tuple2 heavy compare integer tuple2 heavy compare integer tuple2 heavy compare integer override public tuple2 heavy compare integer join tuple2 heavy compare integer first tuple2 heavy compare integer second throw exception throw new exception job should be cancel in sort merge phase never run here output new discard output format tuple2 heavy compare integer run and cancel job env create program plan test sort match that be cancel while in the matching phase test public void test cancel sort match while join throw exception execute task with generator new delaying matcher integer test public void test cancel sort match with long cancel response throw exception execute task with generator new long cancel time matcher integer test system corner case test public void test cancel sort match with highparallelism throw exception execute task new simple matcher integer false private static final class simple matcher in implement join function tuple2 in in tuple2 in in tuple2 in in private static final long serial version u i d 1 l override public tuple2 in in join tuple2 in in first tuple2 in in second throw exception return new tuple2 first f0 second f0 private static final class delay matcher in implement join function tuple2 in in tuple2 in in tuple2 in in private static final long serial version u i d 1 l private static final int wait time per record sec override public tuple2 in in join tuple2 in in first tuple2 in in second throw exception thread sleep wait time per record return new tuple2 first f0 second f0 private static final class long cancel time matcher in implement join function tuple2 in in tuple2 in in tuple2 in in private static final long serial version u i d 1 l private static final int wait time per record sec override public tuple2 in in join tuple2 in in first tuple2 in in second throw exception final long start system current time millis long remain wait time per record do try thread sleep remain catch interrupted exception iex while remain wait time per record system current time milli start return new tuple2 first f0 second f0 private static final class stick in open matcher in extend rich join function tuple2 in in tuple2 in in tuple2 in in private static final long serial version u i d 1 l override public void open configuration parameter throw exception synchronize this wait override public tuple2 in in join tuple2 in in first tuple2 in in second throw exception return new tuple2 first f0 second f0 
legacy stateful job savepoint migration i t case test ignore public void write savepoint throw exception final stream execution environment env stream execution environment get execution environment env set stream time characteristic time characteristic event time switch flink generate savepoint backend type case state backend loader rocksdb state backend name env set state backend new rock d b state backend new memory state backend break case state backend loader memory state backend name env set state backend new memory state backend break default throw new unsupported operation exception env enable checkpoint env set parallelism env set max parallelism env add source new legacy checkpoint source num source element set max parallelism uid legacy checkpoint source flat map new legacy checkpoint flat map start new chain uid legacy checkpoint flat map key by flat map new legacy checkpoint flat map with key state start new chain uid legacy checkpoint flat map with key state key by flat map new key state set flat map start new chain uid key state set flat map key by transform custom operator new type hint tuple2 long long get type info new checkpointed udf operator new legacy checkpoint flat map with key state uid legacy checkpoint operator key by transform timely stateful operator new type hint tuple2 long long get type info new timely stateful operator uid timely stateful operator add sink new accumulator count sink tuple2 long long execute and savepoint env src test resource get savepoint path flink generate savepoint version flink generate savepoint backend type new tuple2 accumulator count sink num element accumulator num source element 
manual window speed i t case ignore public class manual window speed i t case extend abstract test base rule public temporary folder temp folder new temporary folder test public void test tumble ingestion time window with fs backend throw exception final stream execution environment env stream execution environment get execution environment env set stream time characteristic time characteristic ingestion time env set parallelism string checkpoint temp folder new folder to u be i to string env set state backend new f state backend checkpoint env add source new infinite tuple source key by time window time seconds reduce new reduce function tuple2 string integer private static final long serial version u i d 1 l override public tuple2 string integer reduce tuple2 string integer value1 tuple2 string integer value2 throw exception return tuple2 of value1 f0 value1 f1 value2 f1 filter new filter function tuple2 string integer private static final long serial version u i d 1 l override public boolean filter tuple2 string integer value throw exception return value f0 start with tuple print env execute test public void test tumble ingestion time window with f backend with lateness throw exception final stream execution environment env stream execution environment get execution environment env set stream time characteristic time characteristic ingestion time env set parallelism string checkpoint temp folder new folder to u be i to string env set state backend new f state backend checkpoint env add source new infinite tuple source key by time window time seconds allow lateness time seconds reduce new reduce function tuple2 string integer private static final long serial version u i d 1 l override public tuple2 string integer reduce tuple2 string integer value1 tuple2 string integer value2 throw exception return tuple2 of value1 f0 value1 f1 value2 f1 filter new filter function tuple2 string integer private static final long serial version u i d 1 l override public boolean filter tuple2 string integer value throw exception return value f0 start with tuple print env execute test public void test tumble ingestion time window with rock d b backend throw exception final stream execution environment env stream execution environment get execution environment env set stream time characteristic time characteristic ingestion time env set parallelism env set state backend new rock d b state backend new memory state backend env add source new infinite tuple source key by time window time seconds reduce new reduce function tuple2 string integer private static final long serial version u i d 1 l override public tuple2 string integer reduce tuple2 string integer value1 tuple2 string integer value2 throw exception return tuple2 of value1 f0 value1 f1 value2 f1 filter new filter function tuple2 string integer private static final long serial version u i d 1 l override public boolean filter tuple2 string integer value throw exception return value f0 start with tuple print env execute test public void test tumble ingestion time window with rock d b backend with lateness throw exception final stream execution environment env stream execution environment get execution environment env set stream time characteristic time characteristic ingestion time env set parallelism env set state backend new rock d b state backend new memory state backend env add source new infinite tuple source key by time window time seconds allow lateness time seconds reduce new reduce function tuple2 string integer private static final long serial version u i d 1 l override public tuple2 string integer reduce tuple2 string integer value1 tuple2 string integer value2 throw exception return tuple2 of value1 f0 value1 f1 value2 f1 filter new filter function tuple2 string integer private static final long serial version u i d 1 l override public boolean filter tuple2 string integer value throw exception return value f0 start with tuple print env execute test public void test align processing time window throw exception final stream execution environment env stream execution environment get execution environment env set stream time characteristic time characteristic processing time env set parallelism env set state backend new rock d b state backend new memory state backend env add source new infinite tuple source key by time window time seconds reduce new reduce function tuple2 string integer private static final long serial version u i d 1 l override public tuple2 string integer reduce tuple2 string integer value1 tuple2 string integer value2 throw exception return tuple2 of value1 f0 value1 f1 value2 f1 filter new filter function tuple2 string integer private static final long serial version u i d 1 l override public boolean filter tuple2 string integer value throw exception return value f0 start with tuple print env execute a source that emit element with a fix set of key as fast as possible use for rough performance estimation public static class infinite tuple source implement parallel source function tuple2 string integer private static final long serial version u i d 1 l private int num key private volatile boolean running true public infinite tuple source int num key this num key num key override public void run source context tuple2 string integer out throw exception random random new random while run tuple2 string integer tuple new tuple2 string integer tuple random next int num key out collect tuple override public void cancel this run false 
y a r n session f i f o i t case ignore the test be too resource consume 8.5 gb of memory test public void test resource computation throw exception run test log info start test resource computation run with arg new string j flink uberjar get absolute path t flink lib folder get absolute path jm m tm m number of connected task manager change to null run type yarn session log info finish test resource computation assert that yar test logger resource get message have item contain string this yarn session require mb of memory in the cluster there be currently only mb available 
y a r n session f i f o i t case ignore the test be too resource consume gb of memory test public void testfull alloc throw exception run test log info start testfull alloc run with arg new string j flink uberjar get absolute path t flink lib folder get absolute path jm m tm m number of connected task manager change to null run type yarn session log info finish testfull alloc assert that yar test logger resource get message have item contain string there be not enough memory available in the yarn cluster the task manager s require mb each node manager available n after allocate the job manager mb and 1/2 task manager the follow node manager be available 
