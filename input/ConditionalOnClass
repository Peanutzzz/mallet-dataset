tenant filter conditional on class filter class public class tenant filter extend once per request filter override protect void do filter internal http servlet request request http servlet response response filter chain filter chain throw i o exception servlet exception try tenant id string tenant id request get parameter common constant tenant id param if str util be empty tenant id tenant id request get header security constant tenant header id if str util be not empty tenant id tenant context holder set tenant tenant id filter chain do filter request response finally tenant context holder clear 
trace filter conditional on class filter class public class trace filter extend once per request filter resource private trace property trace property override protect boolean should not filter http servlet request request return trace property get enable override protect void do filter internal http servlet request request http servlet response response filter chain filter chain throw i o exception servlet exception try string trace id request get header common constant trace id header if str util be not empty trace id mdc put common constant log trace id trace id filter chain do filter request response finally mdc clear 
audit log aspect slf4j aspect conditional on class http servlet request class request context holder class public class audit log aspect value spring application name private string application name private audit log property audit log property private i audit service audit service public audit log aspect audit log property audit log property i audit service audit service this audit log property audit log property this audit service audit service sp e l private spel expression parser spel expression parser new spel expression parser private default parameter name discoverer name discoverer new default parameter name discoverer before within audit log annotation audit log public void before method join point join point audit log audit log if audit log property get enable if audit service null log warn audit log aspect audit service be null return if audit log null audit log join point get target get class get declare annotation audit log class audit audit get audit audit log join point audit service save audit sp e l private string get val by sp e l string sp e l method signature method signature object arg string param name name discoverer get parameter name method signature get method if param name null param name length expression expression spel expression parser parse expression sp e l spring evaluation context context new standard evaluation context for int i i arg length i context set variable param name i args i return expression get value context to string return null private audit get audit audit log audit log join point join point audit audit new audit audit set timestamp local date time now audit set application name application name method signature method signature method signature join point get signature audit set class name method signature get declare type name audit set method name method signature get name servlet request attribute attribute servlet request attribute request context holder get request attribute http servlet request request attribute get request string user id request get header x userid header string user name request get header x user header string client id request get header x tenant header audit set user id user id audit set user name user name audit set client id client id string operation audit log operation if operation contain object arg join point get arg operation get val by sp e l operation method signature arg audit set operation operation return audit 
log auto configure configuration conditional on class hikari config class enable configuration property log db property class public static class log db auto configure 
db audit service impl slf4j conditional on property name zlt audit log log type have value db conditional on class jdbc template class public class db audit service impl implement i audit service private static final string insert sql insert into sys logger application name class name method name user id user name client id operation timestamp value private final jdbc template jdbc template public db audit service impl autowired require false log db property log db property datum source datum source if log db property null string util be not empty log db property get jdbc url datum source new hikari datum source log db property this jdbc template new jdbc template datum source post construct public void init string sql create table if not exist sys logger n id int not null auto increment n application name varchar character set utf8 collate utf8 general ci null comment n class name varchar character set utf8 collate utf8 general ci not null comment n method name varchar character set utf8 collate utf8 general ci not null comment n user id int null comment id n user name varchar character set utf8 collate utf8 general ci null comment n client id varchar character set utf8 collate utf8 general ci null comment id n operation varchar character set utf8 collate utf8 general ci not null comment n timestamp varchar character set utf8 collate utf8 general ci not null comment n primary key id use btree n engine inno d b character set utf8 collate utf8 general ci row format dynamic this jdbc template execute sql async override public void save audit audit this jdbc template update insert sql audit get application name audit get class name audit get method name audit get user id audit get user name audit get client id audit get operation audit get timestamp 
redus distribute lock slf4j conditional on class redis template class deprecate public class redis distribute lock autowired private redis template string object redis template private thread local string lock flag new thread local private static final string unlock lua lua static unlock lua if redi call get key argv then return redi call del key else return end public redis distribute lock redis template string object redis template super this redi template redis template param key key param expire param retry time param sleep millis return public boolean lock string key long expire int retry time long sleep millis boolean result set redis key expire while result retry time try log debug get redi distribute lock fail retry retry time thread sleep sleep milli catch interrupted exception e log warn interrupted e thread current thread interrupt result set redis key expire return result private boolean set redis final string key final long expire try boolean status redis template execute redis callback boolean connection string uuid uuid random u u i d to string lock flag set uuid byte key byte redis template get string serializer serialize key byte uuid byte redis template get string serializer serialize uuid boolean result connection set key byte uuid byte expiration from expire time unit millisecond redi string command set option if absent return result return status catch exception e log error set redis distribute lock occur a exception e return false param key key return public boolean release lock string key try lua redis value key redis spring redis connection boolean result redis template execute redis callback boolean connection byte script byte redis template get string serializer serialize unlock lua return connection eval script byte return type boolean redis template get string serializer serialize key redis template get string serializer serialize lock flag get return result catch exception e log error release redis distribute lock occur a exception e finally lock flag remove return false 
redisson distribute lock conditional on class redisson client class conditional on property prefix zlt lock name locker type have value redis match if missing true public class redisson distribute lock implement distribute lock autowired private redisson client redisson private r lock get lock string key boolean be fair if be fair return redisson get fair lock common constant lock key prefix key return redisson get lock common constant lock key prefix key override public r lock lock string key long lease time time unit unit boolean be fair r lock lock get lock key be fair lock lock lease time unit return lock override public r lock lock string key long lease time time unit unit return lock key lease time unit false override public r lock lock string key boolean be fair return lock key null be fair override public r lock lock string key return lock key null false override public r lock try lock string key long wait time long lease time time unit unit boolean be fair throw interrupted exception r lock lock get lock key be fair if lock try lock wait time lease time unit return lock return null override public r lock try lock string key long wait time long lease time time unit unit throw interrupted exception return try lock key wait time lease time unit false override public r lock try lock string key long wait time time unit unit boolean be fair throw interrupted exception return try lock key wait time unit be fair override public r lock try lock string key long wait time time unit unit throw interrupted exception return try lock key wait time unit false override public void unlock object lock if lock null if lock instanceof r lock r lock r lock r lock lock if r lock be lock r lock unlock else throw new lock exception require r lock type 
rule configure bean conditional on class naco server class conditional on miss bean public i rule version isolation rule return new version isolation rule 
lb isolation filter conditional on class filter class public class lb isolation filter extend once per request filter value config constant config ribbon isolation enable false private boolean enable isolation override protect boolean should not filter http servlet request request return enable isolation override protect void do filter internal http servlet request request http servlet response response filter chain filter chain throw i o exception servlet exception try string version request get header common constant z l t version if str util be not empty version lb isolation context holder set version version filter chain do filter request response finally lb isolation context holder clear 
sentinel auto configure configuration conditional on class http servlet request class public static class webmvc handler bean public block exception handler webmvc block exception handler return request response e response set status result result result fail e get message response get writer print j s o n util to json str result 
sentinel auto configure configuration conditional on class server response class public static class webflux handler bean public block request handler webflux block exception handler return exchange t server response status http status too many request content type media type application json body body inserter from value result fail t get message 
custom error web flux auto configuration configuration conditional on web application type conditional on web application type reactive conditional on class web flux configurer class auto configure before web flux auto configuration class enable configuration property server property class resource property class public class custom error web flux auto configuration private final server property server property private final application context application context private final resource property resource property private final list view resolver view resolver private final server codec configurer server codec configurer public custom error web flux auto configuration server property server property resource property resource property object provider list view resolver view resolver provider server codec configurer server codec configurer application context application context this server property server property this application context application context this resource property resource property this view resolver view resolver provider get if available collection empty list this server codec configurer server codec configurer bean order order highest precedence public error web exception handler error web exception handler error attribute error attribute json error web exception handler exception handler new json error web exception handler error attribute this resource property this server property get error this application context exception handler set view resolver this view resolver exception handler set message writer this server codec configurer get writer exception handler set message reader this server codec configurer get reader return exception handler 
